(function(){var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(c,a){if(a){for(var b=ba,d=c.split("."),e=0;e<d.length-1;e++){var f=d[e];f in b||(b[f]={});b=b[f]}d=d[d.length-1];e=b[d];f=a(e);f!=e&&null!=f&&aa(b,d,{configurable:!0,writable:!0,value:f})}}var da;
if("function"==typeof Object.setPrototypeOf)da=Object.setPrototypeOf;else{var ea;a:{var fa={sq:!0},ha={};try{ha.__proto__=fa;ea=ha.sq;break a}catch(c){}ea=!1}da=ea?function(c,a){c.__proto__=a;if(c.__proto__!==a)throw new TypeError(c+" is not extensible");return c}:null}var ia=da;ca("Object.setPrototypeOf",function(c){return c||ia});function ja(){ja=function(){};ba.Symbol||(ba.Symbol=ka)}var ka=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function la(){ja();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return ma(this)}});la=function(){}}function ma(c){var a=0;return na(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function na(c){la();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function oa(c,a){la();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}ca("Array.prototype.keys",function(c){return c?c:function(){return oa(this,function(a){return a})}});ca("Array.prototype.values",function(c){return c?c:function(){return oa(this,function(a,b){return b})}});
ca("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});ca("Array.prototype.find",function(c){return c?c:function(a,b){a:{var d=this;d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var c=d[f];if(a.call(b,c,f,d)){d=c;break a}}d=void 0}return d}});
var p=function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};return function(a,b){function d(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)}}();function pa(c){return"object"===typeof c&&"[object Array]"===Object.prototype.toString.apply(c)}function qa(c){return"string"===typeof c}function t(c){return"number"===typeof c}function ra(c){return"object"===typeof c};var u=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.$f=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.ic=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.Ad=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.kb=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var x=new (function(){function c(){this.Hn={};this.xn={}}c.prototype.add=function(a,b){x.Hn[a]=b};c.prototype.Vj=function(a,b){x.xn[a]=b};c.prototype.encode=function(a,b){for(var d=a.split(","),e=b,f=0;f<d.length;f++)e=x.Hn[d[f]](e);return e};c.prototype.decode=function(a,b){for(var d=a.split(","),e=b,f=0;f<d.length;f++)e=x.xn[d[f]](e);return e};return c}());
x.add("base64",function(c){for(var a="",b,d,e,f,g,h,k=0;k<c.length;)b=c.charCodeAt(k++),d=c.charCodeAt(k++),e=c.charCodeAt(k++),f=b>>2,b=(b&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:isNaN(e)&&(h=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);
return a});
x.Vj("base64",function(c){var a="",b=0,d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(c=c.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");b<c.length;){var e=d[c.charAt(b++)];var f=d[c.charAt(b++)];var g=d[c.charAt(b++)];var h=d[c.charAt(b++)];
e=e<<2|f>>4;f=(f&15)<<4|g>>2;var k=(g&3)<<6|h;a+=String.fromCharCode(e);64!==g&&(a+=String.fromCharCode(f));64!==h&&(a+=String.fromCharCode(k))}return a});
x.add("ascii85",function(c){for(var a="",b,d,e,f,g,h,k,l,m=0;m<c.length;)b=c.charCodeAt(m++),d=c.charCodeAt(m++),e=c.charCodeAt(m++),f=c.charCodeAt(m++),g=(b<<24|d<<16|e<<8|f)>>>0,b=(g/52200625|0)%85+33,h=(g/614125|0)%85+33,k=(g/7225|0)%85+33,l=(g/85|0)%85+33,g=g%85+33,a+=String.fromCharCode(b)+String.fromCharCode(h),isNaN(d)||(a+=String.fromCharCode(k),isNaN(e)||(a+=String.fromCharCode(l),isNaN(f)||(a+=String.fromCharCode(g))));return a+"~>"});
x.add("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);128>d?a+=String.fromCharCode(d):(127<d&&2048>d?a+=String.fromCharCode(d>>6|192):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128)),a+=String.fromCharCode(d&63|128))}return a});
x.Vj("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);127>=d?a+=String.fromCharCode(d):2047>=d?(a+=String.fromCharCode(192|d>>6),a+=String.fromCharCode(128|d&63)):65535>=d?(a+=String.fromCharCode(224|d>>12),a+=String.fromCharCode(128|d>>6&63),a+=String.fromCharCode(128|d&63)):1114111>=d?(a+=String.fromCharCode(240|d>>18),a+=String.fromCharCode(128|d>>12&63),a+=String.fromCharCode(128|d>>6&63),a+=String.fromCharCode(128|d&63)):a+=String.fromCharCode(63)}return a});
x.Vj("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);128>d?a+=String.fromCharCode(d):(127<d&&2048>d?a+=String.fromCharCode(d>>6|192):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128)),a+=String.fromCharCode(d&63|128))}return a});x.add("hex",function(c){for(var a=[],b=0;b<c.length;b++){var d=c.charCodeAt(b);16>d&&a.push("0");a.push(d.toString(16))}return a.join("")});
x.add("sha1",function(c){var a=[1518500249,1859775393,2400959708,3395469782];c+=String.fromCharCode(128);for(var b=Math.ceil((c.length/4+2)/16),d=Array(b),e=0;e<b;e++){d[e]=Array(16);for(var f=0;16>f;f++)d[e][f]=c.charCodeAt(64*e+4*f)<<24|c.charCodeAt(64*e+4*f+1)<<16|c.charCodeAt(64*e+4*f+2)<<8|c.charCodeAt(64*e+4*f+3)}d[b-1][14]=8*(c.length-1)/Math.pow(2,32);d[b-1][14]=Math.floor(d[b-1][14]);d[b-1][15]=8*(c.length-1)&4294967295;c=1732584193;f=4023233417;var g=2562383102,h=271733878,k=3285377520,
l=Array(80);for(e=0;e<b;e++){for(var m=0;16>m;m++)l[m]=d[e][m];for(m=16;80>m;m++){var n=l[m-3]^l[m-8]^l[m-14]^l[m-16];l[m]=n<<1|n>>>31}n=c;var r=f;var q=g;var v=h;var y=k;for(m=0;80>m;m++){var z=Math.floor(m/20);a:switch(z){case 0:var w=r&q^~r&v;break a;case 1:w=r^q^v;break a;case 2:w=r&q^r&v^q&v;break a;default:w=r^q^v}z=(n<<5|n>>>27)+w+y+a[z]+l[m]&4294967295;y=v;v=q;q=r<<30|r>>>2;r=n;n=z}c=c+n&4294967295;f=f+r&4294967295;g=g+q&4294967295;h=h+v&4294967295;k=k+y&4294967295}return String.fromCharCode(c>>
24&255)+String.fromCharCode(c>>16&255)+String.fromCharCode(c>>8&255)+String.fromCharCode(c>>0&255)+String.fromCharCode(f>>24&255)+String.fromCharCode(f>>16&255)+String.fromCharCode(f>>8&255)+String.fromCharCode(f>>0&255)+String.fromCharCode(g>>24&255)+String.fromCharCode(g>>16&255)+String.fromCharCode(g>>8&255)+String.fromCharCode(g>>0&255)+String.fromCharCode(h>>24&255)+String.fromCharCode(h>>16&255)+String.fromCharCode(h>>8&255)+String.fromCharCode(h>>0&255)+String.fromCharCode(k>>24&255)+String.fromCharCode(k>>
16&255)+String.fromCharCode(k>>8&255)+String.fromCharCode(k>>0&255)});var ta=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.bn(a,"");return x.encode("utf8",a.join(""))};c.prototype.bn=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.Sm(""+
this.attributes[d])),a.push('"')));if(this.children.length||void 0!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].bn(a,b+"  ");void 0!==this.text&&a.push(b+"  "+this.Sm(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.pp=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.We=
function(a){this.children.push(a)};c.prototype.Sm=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var A=function(){function c(a,b){this.type=a;this.values=b}c.Ek=function(a){a.toLowerCase()in c.xm&&(a=c.xm[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;var f=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==f)a=parseInt(f[1],16)/255,b=parseInt(f[2],16)/255,d=parseInt(f[3],16)/255,f=1;else if(f=e.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/
255,d=parseFloat(f[3])/255,f=parseFloat(f[4]);else if(f=d.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/255,d=parseFloat(f[3])/255,f=1;else if(f=b.exec(a),null!==f)a=parseInt(f[1],16),a=(16*a+a)/255,b=parseInt(f[2],16),b=(16*b+b)/255,d=parseInt(f[2],16),d=(16*d+d)/255,f=1;else return null;return new c(c.RGBA,[a,b,d,f])};c.pc=function(a){return c.Ek(a)||new c(c.RGBA,[1,0,1,1])};c.Lt=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};
c.prototype.toString=function(){function a(b){b=Math.round(255*b);return 16>b?"0"+b.toString(16):b.toString(16)}var b=this.Hd(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+Math.round(255*b.values[0])+","+Math.round(255*b.values[1])+","+Math.round(255*b.values[2])+","+b.values[3]+")"};c.prototype.Hd=function(a){return c.er[this.type][a](this)};c.prototype.Pa=function(a){a.type!==this.type&&(a=a.Hd(this.type));if(this.type===c.Bc){var b=this.values[0],d=a.values[0];
b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.RGBA=0;c.Lm=1;c.Bc=2;c.Zp=3;c.Jv=3;c.er=[[ua,va,wa,ya],[za,ua,Aa,Ba],[Ca,Da,ua,Ea],[Fa,Ga,Ha,ua]];c.xm={aliceblue:"#f0f8ff",
antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",
darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",
honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",
limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Ia=.9505,Ka=1,La=1.089;
function Ca(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),g=d*(1-e*b);b=d*(1-(1-e)*b);var h=e=0,k=0;switch(Math.floor(a/60)%6){case 0:e=d;h=b;k=f;break;case 1:e=g;h=d;k=f;break;case 2:e=f;h=d;k=b;break;case 3:e=f;h=g;k=d;break;case 4:e=b;h=f;k=d;break;case 5:e=d,h=f,k=g}return new A(A.RGBA,[e,h,k,c.values[3]])}
function wa(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new A(A.Bc,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function Ba(c){function a(b){return b>6/29*(6/29)*(6/29)?Math.pow(b,1/3):1/3*(29/6)*(29/6)*b+4/29}var b=a(c.values[1]/Ka);return new A(A.Zp,[116*b-16,500*(a(c.values[0]/Ia)-b),200*(b-a(c.values[2]/La)),c.values[3]])}
function Ga(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new A(A.Lm,[b>e?Ia*b*b*b:3*(b-16/116)*e*e*Ia,a>e?Ka*a*a*a:3*(a-16/116)*e*e*Ka,d>e?La*d*d*d:3*(d-16/116)*e*e*La,c.values[3]])}function va(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new A(A.Lm,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function za(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new A(A.RGBA,b)}function ua(c){return new A(c.type,c.values.concat())}function ya(c){return Ba(va(c))}function Fa(c){return za(Ga(c))}function Aa(c){return wa(za(c))}
function Da(c){return va(Ca(c))}function Ea(c){return ya(Ca(c))}function Ha(c){return Aa(Ga(c))};var B=new (function(){function c(){this.disabled={};this.th=[];this.ar=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.gt(a,arguments)}};c.prototype.addListener=function(a){this.th.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.th.length;b++)if(this.th[b]===a){this.th.splice(b,1);break}};c.prototype.zr=
function(){this.ar||this.addListener(function(a,b){console.log(a+": "+b)})};c.prototype.gt=function(a,b){var d=[],e;if(!this.disabled[a]){var f=b[0].split("%s");d.push(f[0]);for(e=1;e<f.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(f[e]);d=d.join("");e=
0;for(f=this.th;e<f.length;e++)(0,f[e])(a,d)}};return c}());(function(){function c(a){this.log=B.create("Layout");this.ue=a.itemSize||100;this.algorithm=a.algorithm||"wrap";this.io=a.gravity||"down";this.hn=!1!==a.resize;"down"===this.io?(this.offsetWidth="offsetWidth",this.offsetHeight="offsetHeight",this.width="width",this.height="height",this.top="top",this.left="left",this.clientWidth="clientWidth",this.clientHeight="clientHeight"):"up"===this.io?(this.offsetWidth="offsetWidth",this.offsetHeight="offsetHeight",this.width="width",this.height="height",this.top=
"bottom",this.left="left",this.clientWidth="clientWidth",this.clientHeight="clientHeight"):(this.offsetWidth="offsetHeight",this.offsetHeight="offsetWidth",this.width="height",this.height="width",this.top="left",this.left="top",this.clientWidth="clientHeight",this.clientHeight="clientWidth")}c.prototype.jg=function(a){return a[this.offsetWidth]};c.prototype.rh=function(a){return a[this.offsetHeight]};c.prototype.Il=function(a,b){if(this.hn){var d=this.jg(a),e=this.rh(a);a.style[this.width]=""+b+"px";
a.style[this.height]=""+b/d*e+"px"}};c.prototype.wp=function(a,b){if(this.hn){var d=this.jg(a),e=this.rh(a);a.style[this.height]=""+b+"px";a.style[this.width]=""+b/e*d+"px"}};c.prototype.wf=function(a,b,d){a.style[this.top]=d+"px";a.style[this.left]=b+"px"};c.prototype.Zs=function(a){"absolute"!==window.getComputedStyle(a).getPropertyValue("position")&&(a.style.position="relative");for(var b=0;b<a.children.length;b++)a.children[b].style.position="absolute";"wrap"===this.algorithm?this.bt(a):"mason"===
this.algorithm?this.$s(a):"perfect"===this.algorithm&&this.at(a)};c.prototype.bt=function(a){for(var b=a[this.clientWidth],d=0,e=0,f=0,c=0;c<a.children.length;c++){var h=a.children[c];this.Il(h,this.ue);var k=this.jg(h),l=this.rh(h);d+k>b?0===d?(this.wf(h,d,e),e+=l):(e+=f,d=0,this.wf(h,d,e),f=l):(this.wf(h,d,e),d+=k,f=Math.max(f,l))}};c.prototype.$s=function(a){var b=a[this.clientWidth],d;if(0>=b)this.log("Skipping layout; width is <= 0");else{this.log("Laying out to width %s",b);var e=Math.round(b/
this.ue);this.ue=b/e;b=[];for(var f=0;f<e;f++)b.push(0);for(f=0;f<a.children.length;f++){var c=a.children[f];this.Il(c,this.ue);var h=this.rh(c),k=0;for(d=1;d<e;d++)b[d]<b[k]&&(k=d);d=k*this.ue;var l=b[k];this.wf(c,d,l);b[k]+=h}}};c.prototype.at=function(a){var b=a[this.clientWidth],d=0,e=[];var f=0;for(var c,h=0;h<a.children.length;h++){var k=a.children[h];this.wp(k,this.ue);var l=this.jg(k);if(f+l>b)if(0===e.length){this.wf(k,0,d);this.Il(k,b);d+=this.rh(k);continue}else{for(var m=b/f,n=f=0;n<e.length;n++)c=
e[n],this.wp(c,this.ue*m),this.wf(c,f,d),f+=this.jg(c);d+=this.ue*m;f=0;e.length=0}e.push(k);f+=l}for(h=f=0;h<e.length;h++)c=e[h],this.wf(c,f,d),f+=this.jg(c)};return c})();var Ma=B.create("JQUERY"),Na=/\s+/,Oa=/^[\s\xA0]+/,Pa=/[\s\xA0]+$/,Qa=/[\n\t]/g,Ra={B:1,BIG:1,I:1,SMALL:1,TT:1,ABBR:1,ACRONYM:1,CITE:1,CODE:1,DFN:1,EM:1,KBD:1,STRONG:1,SAMP:1,VAR:1,A:1,BDO:1,BR:1,IMG:1,MAP:1,OBJECT:1,Q:1,SCRIPT:1,SPAN:1,SUB:1,SUP:1,BUTTON:1,INPUT:1,LABEL:1,SELECT:1,TEXTAREA:1},Sa=[],Ta=!1;function Ua(){var c=window;!Ta&&c.attachEvent&&(c.attachEvent("onresize",function(a){a.sl=a;for(var b=0;b<Sa.length;b++)Sa[b].call(this,a)}),Ta=!0)}
function Va(c,a,b,d){this.name=c;this.yr=a;this.Ji=b;this.zv=d}
function C(c,a){var b=/#(.*)$/,d=/\.(.*)$/,e=/^<\s*([a-zA-Z0-9]+).*>$/,f=/^([A-Za-z]+)$/;a=a||document;var g=new Wa,h;try{var k=("object"===typeof HTMLElement?c instanceof HTMLElement:"object"===typeof c&&1===c.nodeType&&"string"===typeof c.nodeName||3===c.nodeType)||c===window||c===document||c===document.body||c instanceof Element}catch(E){k=!1}if(k)return g[g.length++]=c,g;if(c instanceof Wa)return c;if("string"!==typeof c)return g;k=c.split(",");for(var l=0;l<k.length;l++){var m=k[l];if(null!==
(h=b.exec(m)))m=document.getElementById(h[1]),null!==m&&(g[g.length++]=m);else if(null!==(h=e.exec(m)))m=h[1],g[g.length++]=document.createElement(m);else if(null!==(h=d.exec(m))){m=g;var n=a;var r=[];var q=h[1].split(/\s+/);for(h=0;h<q.length;h++){var v=q[h].replace(/([\/\\\^$*+?.()|\[\]{}])/g,"\\$1");r.push(new RegExp("(^|\\s)"+v+"(\\s|$)"))}v=n.getElementsByTagName("*");var y=[];h=0;for(n=v.length;h<n;h++){var z=v[h],w=!0;for(q=0;q<r.length;q++)if(!r[q].test(z.className)){w=!1;break}w&&y.push(z)}r=
y;for(h=0;h<r.length;h++)m[m.length++]=r[h]}else if(null!==(h=f.exec(m)))for(m=g,r=a.getElementsByTagName(h[1]),h=0;h<r.length;h++)m[m.length++]=r[h];else if(""!==m)throw console.log(m),"Error: can't parse selector: "+m;}return g}
var Wa=function(){function c(){this.length=0}c.prototype.iq=function(a){for(var b=[],d=this.length-1;0<=d;d--)b.push(this[d]);for(;b.length;)for(d=b.pop(),a(d),d=d.lastChild;d;)b.push(d),d=d.previousSibling};c.prototype.first=function(){var a=new c;this.length&&(a[a.length++]=this[0]);return a};c.prototype.children=function(){for(var a=new c,b=0;b<this.length;b++){var d=this[b];if(d instanceof Node)for(d=d.firstChild;d;)a[a.length++]=d,d=d.nextSibling}return a};c.prototype.Za=function(){for(var a=
0;a<this.length;a++){var b=C(this[a]).ea("display");"none"!==b&&(this[a].Lo=b);this[a].style.display="none"}};c.prototype.show=function(){for(var a=0;a<this.length;a++)this[a].Lo?this[a].style.display=this[a].Lo:"none"===C(this[a]).ea("display")&&(this[a].style.display=this[a].tagName in Ra?"inline":"block");return this};c.prototype.toggle=function(a){void 0===a&&this.length&&(a="none"===this.ea("display"));a?this.show():this.Za()};c.prototype.apply=function(a,b,d){if(a instanceof Node){b=C(b);for(var e=
0;e<b.length;e++){var f=b[e];f instanceof Node&&d(a,f)}}return this};c.prototype.Aq=function(a,b){var d=C(a)[0];if(d instanceof Node)for(var e=0;e<this.length;e++){var f=this[e];f instanceof Node&&b(d,f)}};c.prototype.Kp=function(a,b){var d=C(a)[0],e=this[0];d instanceof Node&&e instanceof Node&&b(d,e)};c.prototype.xk=function(a){for(var b=0;b<this.length;b++){var d=this[b];d instanceof Node&&a(d)}return this};c.prototype.Id=function(a){return this.kb(function(b,d){d instanceof HTMLElement&&a(d)})};
c.prototype.Nn=function(a){var b=this[0];b instanceof HTMLElement&&a(b);return this};c.prototype.append=function(a){return this.apply(this[0],a,function(b,a){b.appendChild(a)})};c.prototype.Zj=function(a){this.Aq(a,function(b,a){b.appendChild(a)})};c.prototype.Ot=function(a){this.apply(this[0],a,function(b,a){b.insertBefore(a,b.firstChild)})};c.prototype.fi=function(a){this.Kp(a,function(b,a){b.parentNode&&b.parentNode.insertBefore(a,b.nextSibling)})};c.prototype.Hq=function(a){this.Kp(a,function(b,
a){b.parentNode&&b.parentNode.insertBefore(a,b)})};c.prototype.remove=function(){return this.xk(function(a){a.parentNode&&a.parentNode.removeChild(a)})};c.prototype.empty=function(){return this.xk(function(a){for(;null!==a.firstChild;)a.removeChild(a.firstChild)})};c.prototype.text=function(a){if(0===arguments.length){var b="";this.iq(function(a){3===a.nodeType&&(b+=a.nodeValue)});return b}return this.xk(function(b){for(;null!==b.firstChild;)b.removeChild(b.firstChild);b.appendChild(document.createTextNode(a))})};
c.prototype.Gg=function(a){this.kb(function(b,d){Ma("Trigger "+a);var e=document;if(e.createEventObject)if(e=e.createEventObject(),"resize"===a){Ma("Calling stored window resize functions");for(var f=0;f<Sa.length;f++)Sa[f].call(d,e)}else d.fireEvent("on"+a,e);else e=document.createEvent("HTMLEvents"),e.initEvent(a,!0,!0),d.dispatchEvent(e)})};c.prototype.width=function(a){if(0<this.length){if(1===arguments.length){for(var b=Math.max(0,arguments[0]),d=0;d<this.length;d++)this[d].style.width=""+b+
"px";return this}b=this[0];if(b===window)return b.innerWidth||document.documentElement.clientWidth;if(b instanceof HTMLElement)return b.clientWidth}return 0};c.prototype.height=function(a){if(0<this.length){if(1===arguments.length)return this.Id(function(b){b.style.height=""+a+"px"});var b=this[0];if(b===window)return b.innerHeight||document.documentElement.clientHeight;if(b instanceof HTMLElement)return b.clientHeight}return 0};c.prototype.outerWidth=function(){var a=this[0];return a instanceof HTMLElement?
a.offsetWidth:0};c.prototype.outerHeight=function(){var a=this[0];return a instanceof HTMLElement?a.offsetHeight:0};c.prototype.offset=function(a){var b=this[0];if(b instanceof HTMLElement){if(a){var d=this.offsetParent().offset();b.style.left=a.left-d.left+"px";b.style.top=a.top-d.top+"px";return this}a=b.getBoundingClientRect();if("pageYOffset"in window){d=window.pageXOffset;var e=window.pageYOffset}else d=document.body.scrollLeft,e=document.body.scrollTop;if(b!==document.body)for(b=b.parentNode;b&&
b!==document.body&&"scrollTop"in b;)d+=b.scrollLeft,e+=b.scrollTop,b=b.parentNode;return{top:a.top+e,left:a.left+d}}return{left:0,top:0}};c.prototype.offsetParent=function(){var a=this[0];if(!(a instanceof HTMLElement)||"fixed"===this.ea("position"))return C(document.body);for(a=a.parentNode;a&&"static"===C(a).ea("position")&&"BODY"!==a.tagName;)a=a.parentNode;return C(a)};c.prototype.Qs=function(a){this.Id(function(b){b.innerHTML=a})};c.prototype.clone=function(){var a=this[0];return a instanceof
Node?C(a.cloneNode(!0)):new c};c.prototype.find=function(a){var b=this[0];return b instanceof Element?C(a,b):new c};c.prototype.Qb=function(a,b){if(2===arguments.length)return this.Id(function(d){d.setAttribute(a,b.toString())});var d=this[0];return d instanceof Element?d.getAttribute(a):""};c.prototype.replaceWith=function(a){var b=this[0];a=a[0];b instanceof Node&&a instanceof Node&&b.parentNode&&b.parentNode.replaceChild(a,b);return this};c.prototype.Qe=function(a){if(a&&"string"===typeof a){var b=
(a||"").split(Na);return this.Id(function(d){if(1===d.nodeType)if(d.className){for(var e=" "+d.className+" ",f=d.className,c=0,h=b.length;c<h;c++)0>e.indexOf(" "+b[c]+" ")&&(f+=" "+b[c]);d.className=Xa(f)}else d.className=a})}return this};c.prototype.bu=function(){var a="zwibbler-selected".split(Na);this.Id(function(b){if(1===b.nodeType&&b.className){for(var d=(" "+b.className+" ").replace(Qa," "),e=0,f=a.length;e<f;e++)d=d.replace(" "+a[e]+" "," ");b.className=Xa(d)}})};c.prototype.kb=function(a){for(var b=
0;b<this.length;b++)a(b,this[b]);return this};c.prototype.focus=function(){return this.Nn(function(a){a.focus()})};c.prototype.blur=function(){return this.Nn(function(a){a.blur()})};c.prototype.submit=function(){return this.kb(function(a,b){b instanceof HTMLFormElement&&b.submit()})};c.prototype.select=function(){return this.kb(function(a,b){b.select&&b.select()})};c.prototype.ea=function(a,b){var d=a.split("-");a=d[0];for(var e=1;e<d.length;e++)a="ms"!==d[e]?a+(d[e].substr(0,1).toUpperCase()+d[e].substr(1)):
a+d[e];if(2===arguments.length)return this.Id(function(d){d.style[a]=""+b});d=this[0];return d instanceof HTMLElement?d.currentStyle?d.currentStyle[a]:window.getComputedStyle?window.getComputedStyle(d,null)[a]:d.style[a]:""};c.prototype.vv=function(){var a=this[0];a&&"value"in a&&(a.value="OK");return this};c.prototype.xa=function(a,b){function d(a){e[0]===window&&"resize"===a&&window.attachEvent?(Sa.push(b),Ua()):window.addEventListener?e.kb(function(d,e){function f(a){a.sl=a;return b.call(e,a)}
e.__JqlListeners||(e.__JqlListeners=[]);e.addEventListener(a,f,!1);e.__JqlListeners.push(new Va(a,e,b,f))}):e.kb(function(d,e){e.attachEvent("on"+a,function(a){a.sl=a;a.which=a.button;a.pageX=a.clientX;a.pageY=a.clientY;a.preventDefault=function(){a.returnValue=!1};a.stopPropagation=function(){a.cancelBubble=!0};a.target=a.target||a.srcElement;return b.call(e,a)})})}for(var e=this,f=a.split(" "),c=0;c<f.length;c++)d(f[c]);return this};c.prototype.bind=function(a,b){return this.xa(a,b)};c.prototype.Hg=
function(a,b){window.addEventListener&&this.kb(function(d,e){if(e.__JqlListeners)for(var f=e.__JqlListeners,c=0;c<f.length;c++){var h=f[c];if(a===h.name&&e===h.yr&&b===h.Ji){e.removeEventListener(a,h.zv,!1);f.splice(c,1);break}}})};c.prototype.$k=function(a){this.xa("keydown",a)};c.prototype.wh=function(a){this.xa("mousedown",a)};c.prototype.ot=function(a){this.xa("mouseup",a)};c.prototype.dl=function(a){this.xa("mousemove",a)};c.prototype.click=function(a){return a?this.xa("click",a):this.Gg("click")};
c.prototype.mr=function(a){this.xa("dblclick",a)};c.prototype.mt=function(a){this.xa("mouseover",a)};c.prototype.nt=function(a){this.xa("mouseout",a)};c.prototype.load=function(a){return this.xa("load",a)};c.prototype.ld=function(a){return this.xa("change",a)};c.prototype.resize=function(a){a?this.xa("resize",a):this.Gg("resize");return this};c.prototype.Hr=function(){this.Id(function(a){a.style.display="block"})};c.prototype.scrollLeft=function(a){if(1===arguments.length)return this.Id(function(b){b.scrollLeft=
a});var b=this[0];return b instanceof HTMLElement?b.scrollLeft:0};c.prototype.scrollTop=function(a){if(1===arguments.length)return this.Id(function(b){b.scrollTop=a});var b=this[0];return b instanceof HTMLElement?b.scrollTop:0};return c}();function Xa(c){return null===c?"":c.toString().replace(Oa,"").replace(Pa,"")}
function Ya(c){var a=c.url||"",b=c.type||"GET",d=c.Vu||function(){},e=c.error||function(){},f=c.data||"";c=c.Iq||function(){};var g="";try{var h=new XMLHttpRequest}catch(l){try{h=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{h=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e(null,"",null);return}}}if("object"===typeof f)for(var k in f)Object.hasOwnProperty.call(f,k)&&(g.length&&(g+="&"),g+=encodeURIComponent(k),g+="=",g+=encodeURIComponent(f[k]));"GET"===b&&(a+="?"+g,g="");c(h,h);h.open(b,a,!0);
h.onreadystatechange=function(){if(4===h.readyState)if(200===h.status){var b=h.responseText,a=h.getResponseHeader("content-type");if(a&&0===a.indexOf("application/json"))try{b=JSON.parse(b)}catch(n){}d(b,"",h)}else e(h,"",null)};"POST"===b&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");h.send(g)}function bb(c){for(var a=arguments[0],b=1;b<arguments.length;b++){var d=arguments[b],e;for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a};var cb=function(){function c(a,b){this.Jt=a;this.name=b;this.ia=C("<div>").ea("border-top","1px solid #888").ea("padding","5px").ea("cursor","default");this.Jt.append(this.ia);this.update(0)}c.prototype.update=function(a){this.ia.text(this.name+"... "+Math.round(100*a)+"%")};c.prototype.error=function(a){var b=this,d=C("<input>").Qb("type","button").vv();d.click(function(){b.done()});this.ia.Qs(this.name+"... "+a+" ");this.ia.append(d)};c.prototype.done=function(){this.ia.remove()};c.all=[];return c}();var db=function(){function c(a,b,d,e,f){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=0);this.Ye=a;this.left=b;this.top=d;this.right=e;this.bottom=f;this.zIndex=1;this.insertBefore=null;this.ia=C("<div>")}c.prototype.Za=function(){this.ia&&this.ia.remove()};c.prototype.show=function(a){this.ia.ea("position","fixed");this.ia.ea("background",this.Ye);this.ia.ea("opacity","0.25");this.ia.ea("left",""+this.left+"px");this.ia.ea("top",""+this.top+"px");
this.ia.ea("right",""+this.right+"px");this.ia.ea("bottom",""+this.bottom+"px");this.ia.ea("display","none");this.ia.click(function(b){a(b)});this.insertBefore?(this.ia.ea("z-index",""+this.zIndex),C(this.ia).Hq(this.insertBefore)):(this.ia.ea("z-index",""+this.zIndex),C("body").append(this.ia));this.ia.Hr()};return c}();var eb=function(){function c(a){this.Uc=this.$d=0;this.ia=a;this.ia.ea("position","absolute");this.ia.ea("margin","0px");this.ia.ea("padding","0px")}c.prototype.width=function(a){function b(b){b=parseInt(d.ia.ea(b),10);return isNaN(b)?0:b}var d=this;if(void 0===a)return this.ia.outerWidth();a-=b("border-left-width");a-=b("border-right-width");a-=b("padding-right");a-=b("padding-left");a-=b("margin-left");a-=b("margin-right");this.$d=a=Math.max(0,a);this.ia.ea("width",""+a+"px");return a};c.prototype.height=
function(a){function b(b){b=parseInt(d.ia.ea(b),10);return isNaN(b)?0:b}var d=this;if(void 0===a)return this.ia.outerHeight();a-=b("border-top-width");a-=b("border-bottom-width");a-=b("padding-top");a-=b("padding-bottom");a-=b("margin-top");a-=b("margin-bottom");this.Uc=a=Math.max(0,a);this.ia.ea("height",""+this.Uc+"px");return a};c.prototype.moveTo=function(a,b){null!==a&&this.ia.ea("left",""+a+"px");null!==b&&this.ia.ea("top",""+b+"px")};c.prototype.show=function(){this.ia.show()};c.prototype.Za=
function(){this.ia.Za()};c.prototype.Zf=function(){this.ia.remove()};return c}();var fb=function(){function c(){this.$g=[];this.log=B.create("DESTRUCTOR")}c.prototype.add=function(a){this.$g.push(a)};c.prototype.bind=function(a,b,d){a.bind(b,d);this.add(function(){a.Hg(b,d)})};c.prototype.Zf=function(){this.log("Running %s destructors",this.$g.length);for(var a=this.$g.length-1;0<=a;a--)this.$g[a]();this.$g.length=0};return c}();var gb=function(c){function a(b,a){var d=c.call(this,b)||this;d.il=0;d.Zk={};d.yb=!1;d.timeout=null;d.lines=[];d.Rb="#ffffff #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");d.ia.ea("background","black");d.ia.ea("font-family",'"Lucida Console","Dejavu Sans Mono",Monospace,"Courier New"');d.ia.ea("font-size","11px");d.ia.ea("line-height","12px");d.ia.ea("overflow","scroll");d.ia.ea("cursor","default");d.dt=B.addListener(function(b,
a){return d.dn(b,a)});a.add(function(){B.removeListener(d.dt)});d.dn("DEBUG","Debug window starting");d.Sv=d.Rb[0];return d}p(a,c);a.prototype.show=function(){eb.prototype.show.call(this);this.yb=!0;this.Mm();this.ia[0].scrollTop=this.ia[0].scrollHeight};a.prototype.Za=function(){this.yb=!1;eb.prototype.Za.call(this)};a.prototype.ds=function(b){b in this.Zk||(this.Zk[b]=this.Rb[this.il],this.il=(this.il+1)%this.Rb.length);return this.Zk[b]};a.prototype.dn=function(b,a){var d,f=this;var c=a.split("\n");
var h=0;for(d=c.length;h<d;h++){var k=c[h];this.lines.push({key:b,line:k})}this.yb&&null===this.timeout&&(this.timeout=setTimeout(function(){return f.Mm()},100))};a.prototype.Mm=function(){var b;var a=this.ia[0].scrollTop>this.ia[0].scrollHeight-this.ia[0].clientHeight-100;var e=this.lines;var f=0;for(b=e.length;f<b;f++){var c=e[f];var h=c.key;c=c.line;var k=this.ds(h);k=C("<div>").ea("color",k);k.ea("border-bottom","1px solid #222");k.text(""+h+": "+c);this.ia.append(k)}a&&(this.ia[0].scrollTop=
this.ia[0].scrollHeight);this.timeout=null;this.lines.length=0};return a}(eb);function hb(c,a){function b(b){for(var a=b.changedTouches,d=0;d<a.length;d++){var e;a:{var f=a[d],c=-1;if("identifier"in f)for(e=0;e<k.length;e++){if(f.identifier===k[e].identifier)break a}else{var l=0;for(e=0;e<k.length;e++){var m=k[e].ag(f);if(-1===c||m<l)c=e,l=m}}e=c}-1===e?"touchend"!==b.type&&(k.push(new h(a[d])),g("New touch %s",a[d].identifier)):"touchend"!==b.type?(k[e].pageX=a[d].pageX,k[e].pageY=a[d].pageY):(g("Remove touch %s",a[d].identifier),k.splice(e,1))}}function d(){for(var b=0,a=
0,d=0;d<k.length;d++)g("Active touch: %s,%s",k[d].pageX,k[d].pageY),b+=k[d].pageX,a+=k[d].pageY;return{x:b/k.length,y:a/k.length}}function e(b,a){for(var d=0,e=0;e<k.length;e++){var f=k[e];d+=Math.sqrt((f.pageX-b)*(f.pageX-b)+(f.pageY-a)*(f.pageY-a))}return d/k.length}function f(b,a){b.preventDefault=function(){a.preventDefault()};b.stopPropagation=function(){a.stopPropagation()};return b}var g=B.create("GESTURES");if(c.aw)c.addEventListener("gesture",a,!1),g("No emulation needed");else{var h=function(){function b(b){this.Oh=
b.pageX;this.Ph=b.pageY;this.pageX=b.pageX;this.pageY=b.pageY;this.identifier=b.identifier}b.prototype.ag=function(b){return Math.sqrt((this.pageX-b.pageX)*(this.pageX-b.pageX)+(this.pageY-b.pageY)*(this.pageY-b.pageY))};return b}(),k=[],l=!1,m=1,n=0,r,q;c.addEventListener("touchstart",function(c){b(c);g("touchend; inGesture=%s active.length=%s",l,k.length);2<=k.length&&!l&&(l=!0,q=d(),r=e(q.x,q.y),m=1,n=0,a(f({type:"gesturestart",pageX:q.x,pageY:q.y,scale:m,rotation:n},c)))});c.addEventListener("touchmove",
function(c){b(c);if(2<=k.length){q=d();m=e(q.x,q.y)/r;for(var g=q.x,h=q.y,l=0,v=0;v<k.length;v++)l+=Math.atan2(k[v].pageY-h,k[v].pageX-g)-Math.atan2(k[v].Ph-h,k[v].Oh-g);n=l/k.length/Math.PI*180;a(f({type:"gesturechange",pageX:q.x,pageY:q.y,scale:m,rotation:n},c))}});c.addEventListener("touchend",function(d){b(d);g("touchend; inGesture=%s active.length=%s",l,k.length);l&&2>k.length&&(l=!1,a(f({type:"gestureend",pageX:q.x,pageY:q.y,scale:m,rotation:n},d)))})}};var ib=function(){function c(a,b){this.ia=a;this.size=b;this.canvas=document.createElement("canvas");this.pb=0;this.ii=!1;this.mg="";this.strokeStyle="#000000";this.Qd={x:0,y:0};this.lf={x:0,y:0};this.rg={x:0,y:0};this.mid={x:0,y:0};this.log=B.create("ColourWheel");this.height=this.width=b;this.canvas.width=this.width;this.canvas.height=this.height;this.canvas.style.cursor="crosshair";this.ia.appendChild(this.canvas);"G_vmlCanvasManager"in window&&window.G_vmlCanvasManager.initElement(this.canvas);
this.ka=this.canvas.getContext("2d");var d=document.createElement("input");d.setAttribute("type","range");this.Fg=document.createElement("input");this.Fg.setAttribute("type","checkbox");"range"===d.type?(this.ia.appendChild(document.createElement("br")),this.ia.appendChild(d),d.min="0",d.max="255",d.value="255",this.Cd=d):(this.Cd=null,d="colourcheckbox"+this.pb,this.Fg.setAttribute("id",d),this.ia.appendChild(document.createElement("br")),this.ia.appendChild(this.Fg),this.pb+=1,d=C("<label>").Qb("for",
d).text("Transparent"),this.ia.appendChild(d[0]));this.fb=this.height;this.te=.8*this.height;if(c.Cache[b])this.data=c.Cache[b];else{d=this.ka.getImageData(0,0,this.fb,this.fb);for(var e=this.fb/2,f=this.te/2,g,h=0;h<this.fb;h++){var k=Math.sqrt(e*e-(h-e)*(h-e)),l=Math.floor(-k+e),m=Math.floor(k+e),n=f*f-(h-e)*(h-e);if(0<=n){k=Math.sqrt(n);n=Math.floor(-k+e);var r=Math.floor(k+e);for(k=h*this.fb*4+4*l;l<=n;l++)g=Math.atan2(h-e,l-e),g=new A(A.Bc,[g/Math.PI*180,1,1,1]),g=g.Hd(A.RGBA),d.data[k++]=255*
g.values[0],d.data[k++]=255*g.values[1],d.data[k++]=255*g.values[2],d.data[k++]=255;k=h*this.fb*4+4*r;l=r}else k=h*this.fb*4+4*l;for(;l<=m;l++)g=Math.atan2(h-e,l-e),g=new A(A.Bc,[g/Math.PI*180,1,1,1]),g=g.Hd(A.RGBA),d.data[k++]=255*g.values[0],d.data[k++]=255*g.values[1],d.data[k++]=255*g.values[2],d.data[k++]=255}this.data=d;c.Cache[b]=d}this.ob=new A(A.Bc,[20,1,1,1]);this.update();this.ja();var q=this;q.ii=!1;q.mg="";C(this.canvas).wh(function(b){if("mousedown"===b.type){var a=C(q.canvas).offset(),
d=b.pageX-a.left;a=b.pageY-a.top;q.ii=!0;q.sn(d,a);b.stopPropagation();b.preventDefault()}});C(this.canvas).dl(function(b){if(q.ii&&"mousemove"===b.type){var a=C(q.canvas).offset();q.sn(b.pageX-a.left,b.pageY-a.top)}b.stopPropagation();b.preventDefault()});C(window).ot(function(){q.ii=!1;q.mg=""});null!==this.Cd&&C(this.Cd).ld(function(){q.Cd&&(q.ob.values[3]=parseFloat(q.Cd.value)/255,q.update(),q.ja())});C(this.Fg).ld(function(){q.ob.values[3]=q.Fg.checked?0:1;q.update();q.ja()})}c.prototype.up=
function(a){this.ob=A.pc(a).Hd(A.Bc);null!==this.Cd&&(this.Cd.value=""+Math.round(255*this.ob.values[3]));this.Fg.checked=0===this.ob.values[3]?!0:!1;this.ja();this.update()};c.prototype.update=function(){this.rl&&this.rl(this.ob.toString())};c.prototype.ja=function(){this.ka.save();this.ka.lineWidth=1;this.ka.fillStyle="rgb(128, 128, 128)";this.ka.fillRect(0,0,this.width,this.height);this.ka.putImageData(this.data,0,0);var a=this.ob.values[0]/180*Math.PI;this.ka.beginPath();var b={x:Math.cos(a)*
this.te/2+this.fb/2,y:Math.sin(a)*this.te/2+this.fb/2},d={x:Math.cos(a+2*Math.PI/3)*this.te/2+this.fb/2,y:Math.sin(a+2*Math.PI/3)*this.te/2+this.fb/2},e={x:Math.cos(a+4*Math.PI/3)*this.te/2+this.fb/2,y:Math.sin(a+4*Math.PI/3)*this.te/2+this.fb/2},f=Math.cos(a)*this.fb/2+this.fb/2,c=Math.sin(a)*this.fb/2+this.fb/2;a={x:d.x+(e.x-d.x)/2,y:d.y+(e.y-d.y)/2};this.ka.moveTo(b.x,b.y);this.ka.lineTo(d.x,d.y);this.ka.lineTo(e.x,e.y);this.ka.lineTo(b.x,b.y);var h=this.ka.createLinearGradient(d.x,d.y,e.x,e.y);
h.addColorStop(0,"#ffffff");h.addColorStop(1,"#000000");this.ka.fillStyle=h;this.ka.fill();h=this.ka.createLinearGradient(b.x,b.y,a.x,a.y);var k=this.ob.Hd(A.Bc);k.values[1]=1;k.values[2]=1;k=k.Hd(A.RGBA);k.values[3]=1;h.addColorStop(0,k.toString());k.values[3]=0;h.addColorStop(1,k.toString());this.ka.fillStyle=h;this.ka.fill();this.strokeStyle="#000000";this.ka.beginPath();this.ka.moveTo(b.x,b.y);this.ka.lineTo(f,c);this.ka.stroke();c=1-this.ob.values[2];f=this.ob.values[1]*b.x+c*e.x+(1-this.ob.values[1]-
c)*d.x;c=this.ob.values[1]*b.y+c*e.y+(1-this.ob.values[1]-c)*d.y;this.ka.beginPath();this.ka.arc(f,c,4,0,2*Math.PI,!1);this.ka.stroke();this.ka.restore();this.Qd=b;this.lf=d;this.rg=e;this.mid=a};c.prototype.sn=function(a,b){var d=Math.sqrt((a-this.fb/2)*(a-this.fb/2)+(b-this.fb/2)*(b-this.fb/2));if("ring"===this.mg||"triangle"!==this.mg&&d>=this.te/2&&d<=this.fb/2)this.ob.values[0]=Math.atan2(this.fb/2-b,this.fb/2-a)/Math.PI*180+180,0===this.ob.values[1]&&(this.ob.values[1]=1,this.ob.values[2]=1),
this.mg="ring";else{var e=this.Qd;d=this.lf;var f=this.rg;var c=(e.x-f.x)*(d.y-f.y)-(d.x-f.x)*(e.y-f.y);d=((d.y-f.y)*(a-f.x)-(d.x-f.x)*(b-f.y))/c;c=1-Math.max(0,d)-Math.max(0,(-(e.y-f.y)*(a-f.x)+(e.x-f.x)*(b-f.y))/c);this.ob.values[1]=Math.min(Math.max(d,0),1);this.ob.values[2]=1-Math.min(Math.max(c,0),1);this.mg="triangle"}0===this.ob.values[3]&&(this.ob.values[3]=1,null!==this.Cd&&(this.Cd.value="255"));this.ja();this.update()};c.isSupported=function(){var a=document.createElement("canvas");"G_vmlCanvasManager"in
window&&window.G_vmlCanvasManager.initElement(a);return a.getContext&&a.getContext("2d").getImageData};c.Cache=[];return c}();var jb=function(){function c(a){this.code="en";this.data={};this.log=B.create("LANGUAGE");this.data=this.Wo(a,{})}c.prototype.xp=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Yj=function(a){this.Wo(a,this.data)};c.prototype.Wo=function(a,b){for(var d=a.split("\n"),e=/^([ \t]*)([^:]+):([^:]+):(.*)/,
f=0;f<d.length;f++){var c=e.exec(d[f]);if(c){var h=c[2],k=c[3];c=c[4];h in b||(b[h]={});k in b[h]&&this.log("Warning: Replacing %s:%s",h,k);b[h][k]=c}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.Um(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.Um(a,b)};c.prototype.Um=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(var e=0;e<b.length;e++)d=d.replace("^"+e,b[e]);return d};return c}();var kb=function(){function c(a,b,d,e){void 0===e&&(e=[]);this.jb=a;this.yc=b;this.xj=d;this.Kc=e}c.prototype.clone=function(a,b){void 0===b&&(b=this.xj);for(var d=[],e=0,f=this.Kc;e<f.length;e++)d.push(f[e].clone());return new c(a,this.yc,b,d)};c.prototype.inverse=function(a,b){void 0===a&&(a=this.jb);void 0===b&&(b=this.xj);for(var d=[],e=this.Kc.length-1;0<=e;e--)d.push(this.Kc[e].inverse());return new c(a,this.yc,b,d)};return c}(),lb=function(){function c(a,b,d){this.Oq=a;this.Gq=b;this.zo=d}c.prototype.getData=
function(){return this.Oq};c.prototype.eg=function(){return this.zo};c.prototype.empty=function(){return this.Gq===this.zo};return c}(),mb,nb=mb||(mb={});nb[nb.Numbered=0]="Numbered";nb[nb.Random=1]="Random";
var ob=function(){function c(a,b){void 0===a&&(a=!1);this.ln=a;this.Xe=b;this.log=B.create("OTDocument");this.sc=[];this.next=0;this.local=[];this.all=[];this.Lb=0;this.Le={};this.Hb=!1;this.oq=-1;this.Mj=""}c.prototype.Ed=function(){return 0<this.next};c.prototype.Dd=function(){return this.next<this.sc.length};c.prototype.ib=function(){this.Ed()&&this.fp(this.sc[--this.next],!0)};c.prototype.wd=function(){this.Dd()&&this.fp(this.sc[this.next++],!1)};c.prototype.cs=function(){return this.local.length?
this.Xe===mb.Mg?new lb(this.encode(this.local),this.Lb.toString(),(this.Lb+this.local.length).toString()):new lb(this.encode(this.local),this.local[0].yc,this.local[this.local.length-1].jb):new lb("","0","0")};c.prototype.lt=function(a){if(this.Xe===mb.Mg){a=parseInt(a,10)-this.Lb;for(var b=0;b<a;b++)this.all[this.Lb+b].jb=(this.Lb+b+1).toString(),this.Lb+b+1<this.all.length&&(this.all[this.Lb+b+1].yc=this.all[this.Lb+b].jb);this.Lb+=a;this.local.splice(0,a)}else for(b=this.local.length-1;0<=b;b--)if(a===
this.local[b].jb){this.local.splice(0,b+1);break}};c.prototype.eg=function(){return this.all.length?this.all[this.all.length-1].jb:this.zi()};c.prototype.Wj=function(a){this.Hb||(this.sc.length=this.next,this.sc.push(a),this.next+=1,this.local.push(a),this.all.push(a),this.ln&&(this.log("Executing LOCAL %s",a.jb),this.dh(a)),this.Xe===mb.bq&&(this.Le[a.jb]=a))};c.prototype.dh=function(a){var b=0;for(a=a.Kc;b<a.length;b++)this.zb(a[b])};c.prototype.Nr=function(a){for(var b=this.all.length-1;0<=b&&
this.all[b].jb!==a;b--);return b};c.prototype.fp=function(a,b){var d=this.Nr(a.jb);if(-1===d)this.log("ERROR");else{var e=this.Ti();b?(e=a.inverse(e,this.now()),e.yc=this.all[d].jb):e=a.clone(e,this.now());for(d=b?d+1:d;d<this.all.length;d++)this.fm(this.all[d],[e]);this.local.push(e);this.all.push(e);this.ln&&this.dh(e)}};c.prototype.fm=function(a,b){if(a.yc!==b[0].yc)throw Error("Error: Expected same parentage.");for(var d=0,e=a.Kc;d<e.length;d++)for(var f=e[d],c=0,h=b;c<h.length;c++){var k=h[c];
f=this.bv(f,k.Kc,a.jb,k.jb)}b[0].yc=a.jb};c.prototype.bv=function(a,b,d,e){for(var f=0;f<b.length;f++){var c=b[f];b[f]=this.em(a,c,d,e);a=this.em(c,a,e,d)}return a};c.prototype.yq=function(a){var b=this.decode(a);if(null!==b&&0!==b.length){a=this.all.length;if(this.Xe===mb.Mg){if(this.Lb===this.all.length)for(var d=0;d<b.length;d++)this.all.push(b[d]);else{for(this.Hb=!0;a!==this.Lb;)--a,this.dh(this.all[a].inverse());this.Hb=!1;var e=this.all.slice(this.Lb);this.all.length=this.Lb;for(var f=0;f<
b.length;f++)d=b[f],this.fm(d,e);this.all=this.all.concat(b,e)}this.Lb+=b.length}else{for(a=0;a<b.length;a++)d=b[a],d.jb in this.Le||(this.Le[d.jb]=d);a={};a[this.zi()]=[];for(e in this.Le)a[e]=[];for(e in this.Le)d=this.Le[e],d.yc in a&&a[d.yc].push(d.jb);for(e in a)a[e].sort();e=a[this.zi()];b=this.zi();for(d=0;d<this.all.length&&1===e.length&&e[0]===this.all[d].jb;d++)b=e[0],e=a[e[0]];this.Hb=!0;for(e=this.all.length-1;e>=d;e--)this.log("Executing INVERSE %s",this.all[e].jb),this.dh(this.all[e].inverse());
this.Hb=!1;this.all.length=d;d=[];this.Mk(a,b,d);a=this.all.length;for(b=1;b<d.length;b++)this.all.push(d[b])}this.Hb=!0;for(d=a;d<this.all.length;d++)this.log("Executing REMOTE %s",this.all[d].jb),this.dh(this.all[d]);0<this.all.length-a&&this.pa();this.Hb=!1;this.log("Done addremotechanges")}};c.prototype.Mk=function(a,b,d){d.push(this.Le[b]);for(b=a[b];1===b.length;)d.push(this.Le[b[0]]),b=a[b[0]];if(0!==b.length){var e=d.length;this.Mk(a,b[0],d);for(var f=1;f<b.length;f++){var c=[];this.Mk(a,
b[f],c);for(var h=e;h<d.length;h++)this.fm(d[h],c);d.push.apply(d,c)}}};c.prototype.zi=function(){return(0).toString()};c.prototype.Ti=function(){return this.Xe===mb.Mg?(this.oq--).toString():this.Mj+Math.floor(1E6*Math.random()).toString(36)};c.prototype.show=function(){this.log("%s",JSON.stringify(this.all,null,2))};c.prototype.now=function(){return Math.floor((new Date).getTime()/1E3)};c.prototype.mu=function(a){this.Mj=a};c.prototype.Rq=function(a,b){if(this.Xe===mb.Mg){var d=parseInt(a,10),e=
parseInt(b,10);return 0>d&&0>e?d>e:0<d&&0<e?d<e:0<e?!1:!0}return a<b};c.prototype.pa=function(){};return c}(),pb=function(){function c(a,b,d){this.type=a;this.Vb=b;this.newValue=d}c.prototype.clone=function(){return new c(this.type,this.Vb,this.newValue)};c.prototype.inverse=function(){return"a"===this.type?new c("a",-this.Vb,this.newValue-this.Vb):new c("m",1/this.Vb,this.newValue/this.Vb)};return c}();
(function(c){function a(b,a){var d=c.call(this,!0,b)||this;d.prefix=a;d.value=0;d.mu(a);return d}p(a,c);a.prototype.zb=function(b){"a"===b.type?(this.log("Add to  %s  %s",this.value,b.Vb),this.value+=b.Vb):"m"===b.type&&(this.log("Multiply %s by %s",this.value,b.Vb),this.value*=b.Vb);if(this.value!==b.newValue)throw Error("Document value should be "+b.newValue+", but got "+this.value);};a.prototype.decode=function(b){b=JSON.parse(b,function(b,a){if(a instanceof Object){if(a.Vb)return new pb(a.type,
a.Vb,a.newValue);if(a.Kc)return new kb(a.jb,a.yc,a.xj,a.Kc)}return a});if(this.Xe===mb.Mg)for(var a=this.Lb,e=a+1,f=0;f<b.length;f++){var c=b[f];c.yc=a.toString();c.jb=e.toString();a=e;e+=1}return b};a.prototype.encode=function(b){return JSON.stringify(b)};a.prototype.em=function(b,a,e,f){this.log("transform %s/,%s",e,f);if(this.Rq(e,f))return e=b.newValue,e="a"===a.type?e+a.Vb:e*a.Vb,new pb(a.type,a.Vb,e);e=a.newValue;e="a"===b.type?e+b.Vb:e*b.Vb;this.log("   Modified op2 with value "+e);return new pb("a",
e-b.newValue,e)};a.prototype.add=function(b){var a=this.Ti();this.Wj(new kb(a,this.eg(),Math.round((new Date).getTime()/1E3),[new pb("a",b,this.value+b)]))};a.prototype.multiply=function(b){var a=this.Ti();this.Wj(new kb(a,this.eg(),Math.round((new Date).getTime()/1E3),[new pb("m",b,this.value*b)]))};return a})(ob);var qb=mb;var rb=function(){function c(a,b){this.Wb=a;this.index=b}c.prototype.encode=function(){return this.Wb+";"+this.index};return c}(),tb=function(){function c(a,b,d,e){this.eb=a;this.aa=e;this.type="c";this.Ma=new rb(b,d)}c.prototype.encode=function(){var a=JSON.stringify(this.aa);return"C"+this.eb+";"+this.Ma.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(){return new c(this.eb,this.Ma.Wb,this.Ma.index,this.aa)};c.prototype.inverse=function(){return new sb(this.eb,this.Ma.Wb,this.Ma.index)};
c.Ne=function(a,b){var d=/C([^;]+);([^;]+);(\d+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var f=parseInt(e[4],10),g=JSON.parse(a.substr(d.lastIndex,f));return{ld:new c(e[1],e[2],parseInt(e[3],10),g),position:d.lastIndex+f+1}}return null};return c}(),sb=function(){function c(a,b,d){this.eb=a;this.Wb=b;this.index=d;this.aa=null;this.type="d";this.Ma=new rb(b,d)}c.prototype.clone=function(){return new c(this.eb,this.Ma.Wb,this.Ma.index)};c.prototype.inverse=function(){if(null===this.aa)throw Error("DeleteOp should have been executed before inverse");
return new tb(this.eb,this.Ma.Wb,this.Ma.index,this.aa)};c.prototype.encode=function(){return"D"+this.eb+";"+this.Ma.encode()+";"};c.Ne=function(a,b){var d=/D([^;]+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{ld:new c(e[1],e[2],parseInt(e[3],10)),position:d.lastIndex}:null};return c}(),ub=function(){function c(a,b){this.eb=a;this.aa=b;this.Xi=null;this.type="s"}c.prototype.clone=function(){return new c(this.eb,this.aa)};c.prototype.inverse=function(){if(null===this.Xi)throw Error("SetPropertiesOp was not executed before inversion");
return new c(this.eb,this.Xi)};c.prototype.encode=function(){var a=JSON.stringify(this.aa);return"S"+this.eb+";"+a.length+";"+a+";"};c.Ne=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var f=parseInt(e[2],10),g=JSON.parse(a.substr(d.lastIndex,f));return{ld:new c(e[1],g),position:d.lastIndex+f+1}}return null};return c}(),vb=function(){function c(a,b,d,e,f){this.eb=a;this.type="m";this.src=new rb(b,d);this.Ma=new rb(e,f)}c.prototype.clone=function(){return new c(this.eb,
this.src.Wb,this.src.index,this.Ma.Wb,this.Ma.index)};c.prototype.inverse=function(){return new c(this.eb,this.Ma.Wb,this.Ma.index,this.src.Wb,this.src.index)};c.prototype.encode=function(){return"M"+this.eb+";"+this.src.encode()+";"+this.Ma.encode()+";"};c.Ne=function(a,b){var d=/M([^;]+);([^;]+);(\d+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{ld:new c(e[1],e[2],parseInt(e[3],10),e[4],parseInt(e[5],10)),position:d.lastIndex}:null};return c}(),wb=function(c){function a(b,
a){void 0===a&&(a=!1);var d=c.call(this,a,qb.bq)||this;d.Ke=b;d.If=[];return d}p(a,c);a.prototype.jt=function(b){return"N"+this.Mj+"-"+b};a.prototype.createNode=function(b,a,e,f){this.Hb||(a=new tb(b,a,e,f),this.If.push(a));return b};a.prototype.Ec=function(b,a,e){this.Hb||(a=new sb(b,a,e),a.aa=this.Ke.vc(b),this.If.push(a))};a.prototype.gf=function(b,a,e,f,c){this.Hb||(b=new vb(b,f,c,a,e),this.If.push(b))};a.prototype.Ib=function(b,a){if(!this.Hb){var d=new ub(b,a);this.If.push(d)}};a.prototype.pa=
function(){if(!this.Hb&&this.If.length){for(var b=new kb(this.Ti(),this.eg(),this.now()),a=0,e=this.If;a<e.length;a++)b.Kc.push(e[a]);this.Wj(b)}else this.Hb&&this.Ke.pa();this.If.length=0};a.prototype.zb=function(b){this.log("Execute "+b.type);switch(b.type){case "c":this.Ke.createNode(b.eb,b.Ma.Wb,b.Ma.index,b.aa);break;case "d":-1===b.Ma.index?this.log("op was nullified."):(b.aa=this.Ke.vc(b.eb),this.Ke.Ec(b.eb,b.Ma.Wb,b.Ma.index));break;case "s":b.Xi={};var a=this.Ke.vc(b.eb),e;for(e in b.aa)b.Xi[e]=
a[e];this.Ke.Ib(b.eb,b.aa);break;case "m":-1!==b.src.index&&this.Ke.gf(b.eb,b.Ma.Wb,b.Ma.index,b.src.Wb,b.src.index)}};a.prototype.decode=function(b){for(var a=[],e=0,f=/B([^;]+);([^;]+);([^;]+);\d+;/g;e<b.length;){var c;switch(b[e]){case "B":f.lastIndex=e;if((c=f.exec(b))&&c.index===e){e=parseInt(c[1],36);var h=c[2];c=c[3];if(isNaN(e))return this.log("Error: TS is not a number."),null;c=new kb(c,h,e);a.push(c);e=f.lastIndex}else return null;continue;case "C":c=tb.Ne(b,e);break;case "D":c=sb.Ne(b,
e);break;case "S":c=ub.Ne(b,e);break;case "M":c=vb.Ne(b,e);break;default:return null}if(0===a.length)return this.log("Got change outside of batch"),null;e=c.position;a[a.length-1].Kc.push(c.ld)}return a};a.prototype.encode=function(b){for(var a="",e=0;e<b.length;e++){var f=b[e];a+="B"+f.xj.toString(36)+";"+f.yc+";"+f.jb+";"+f.Kc.length+";";var c=0;for(f=f.Kc;c<f.length;c++)a+=f[c].encode()}return a};a.prototype.em=function(b,a,e,f){function d(a,d,e){a="c"===b.type?1:-1;switch(e.type){case "c":e=e.clone();
c(d,e.Ma,a,"c");break;case "d":e=e.clone();c(d,e.Ma,a,"d");break;case "m":e=e.clone(),c(d,e.src,a,"d"),c(d,e.Ma,a,"c")}return e}function c(b,d,e,f){b.Wb===d.Wb&&0<=d.index&&(b.index<d.index||b.index==d.index&&0<e?(d.index+=e,k.log("Shift "+a.type+" by "+e)):b.index===d.index&&0>e&&"d"===f&&(d.index=-1,k.log("NULLIFY")))}var k=this;this.log("xform "+e+":"+b.type+"/"+f+":"+a.type);"c"===b.type?a=d(b.type,b.Ma,a):"d"===b.type?a=d(b.type,b.Ma,a):"m"===b.type&&(a=d("d",b.src,a),a=d("c",b.Ma,a));return a};
return a}(ob);
(function(){function c(){this.ra={};this.log=B.create("DebugTree");this.root={eb:"0",parent:null,children:[],aa:{name:"root"}};this.ra["0"]=this.root}c.prototype.createNode=function(a,b,d,e){this.log("create node "+a+" child of "+b);b=this.ra[b];e={eb:a,parent:b,children:[],aa:e};b.children.splice(d,0,e);this.ra[a]=e};c.prototype.Ec=function(a){this.log("delete node "+a);if(a in this.ra){var b=this.ra[a].parent;if(b)for(var d=0;d<b.children.length;d++)if(b.children[d].eb===a){b.children.splice(d,1);
break}delete this.ra[a]}};c.prototype.gf=function(a,b,d){this.log("move "+a+" to "+b+":"+d);if(a in this.ra){var e=this.ra[a];this.Ec(a);this.createNode(a,b,d,e.aa)}};c.prototype.Ib=function(a,b){if(a in this.ra)for(var d in b)b.hasOwnProperty(d)&&(this.ra[a].aa[d]=b[d])};c.prototype.vc=function(a){return a in this.ra?this.ra[a].aa:{}};c.prototype.pa=function(){};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a){for(var b="("+a.aa.name,d=0;d<a.children.length;d++)b+=
" "+this.encode(a.children[d]);return b+")"};return c})();var xb=function(){function c(){this.Ui=!1;this.Sa={};this.log=B.create("EventEmitter")}c.prototype.ta=function(a){for(var b=this,d=1;d<arguments.length;d++);var e=Array.prototype.slice.apply(arguments);setTimeout(function(){b.bf.apply(b,e)},0)};c.prototype.bf=function(a){for(var b=1;b<arguments.length;b++);this.Sa||(this.Sa={});b=Array.prototype.slice.call(arguments,1);var d,e=!1;if(a in this.Sa){var f=this.Sa[a];var c=0;for(d=f.length;c<d;c++){var h=f[c];this.Ui||e||(this.log("Emit %s",a),e=!0);
h.apply(null,b)}}};c.prototype.xa=function(a,b){this.Sa||(this.Sa={});this.bind(a,b)};c.prototype.once=function(a,b){function d(){e.Hg(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.Sa?this.Sa[a].push(b):this.Sa[a]=[b];return b};c.prototype.Hg=function(a,b){var d,e;if(a in this.Sa){var f=this.Sa[a];var c=d=0;for(e=f.length-1;d<=e;c=d+=1)if(f[c]===b){f.splice(c,1);break}}};return c}();var yb=function(c){function a(b){var a=c.call(this)||this;a.ae=b;a.Vv=(new Date).getTime();a.uj=1;a.hf={};a.buttons=[];a.ke=0;a.log=B.create("TOOLBAR");a.ia=document.createElement("div");a.ia.style.width=b+"px";a.ia.style.height="320px";a.ia.style.border="none";a.ia.style.backgroundColor="#ffffff";a.ia.style.MozUserSelect="none";a.ia.style.WebkitUserSelect="none";a.ia.style.Lv="none";a.ia.style.uv="none";a.ke=0;return a}p(a,c);a.prototype.width=function(){return parseInt(this.ia.style.width,10)};
a.prototype.focus=function(b){0<this.buttons.length&&(0<arguments.length&&(this.Pg(!1),this.ke=b||0),this.Pg(!0))};a.prototype.blur=function(){0<this.buttons.length&&this.Pg(!1)};a.prototype.Pg=function(b){this.buttons[this.ke].ia.style.outline=b?"1px dotted gray":"none"};a.prototype.ec=function(b,a){if(0!==this.buttons.length){var d="next"===b||"previous"===b;d&&this.Pg(!1);switch(b){case "next":this.ke=Math.min(this.ke+1,this.buttons.length-1);break;case "previous":this.ke=Math.max(this.ke-1,0);
break;case "enter":this.buttons[this.ke].Wq(a)}d&&(this.Pg(!0),a.stopPropagation(),a.preventDefault())}};a.prototype.moveTo=function(b,a){C(this.ia).ea("left",""+b+"px");C(this.ia).ea("top",""+a+"px")};a.prototype.show=function(b){void 0===b&&(b=!1);this.ia.style.display=b?"block":"none"};a.prototype.Re=function(b,a,e,f){this.hf[b]=this.lc(e,a,f)};a.prototype.Sq=function(){for(var b in this.hf)this.hf.hasOwnProperty(b)&&(this.hf[b].ia.style.background="#ffffff",this.hf[b].ya.style.background="#ffffff")};
a.prototype.qp=function(b){this.Sq();b in this.hf&&(b=this.hf[b],b.ia.style.background="#9fb3e7",b.ya.style.background="#9fb3e7")};a.prototype.lc=function(b,a,e){function d(){var b=h.style.background;h.style.background="#e7d69f";k.style.background="#e7d69f";var a=h.style.background;setTimeout(function(){h.style.background===a&&(h.style.background=b,k.style.background=b)},200)}var c=this,h=document.createElement("div"),k=document.createElement("img"),l=this;h.style.display="inline";h.style.cssFloat=
"left";h.style.overflow="hidden";h.style.width=this.ae+"px";h.style.height=this.ae+"px";h.style.margin="1px";h.style.uv="none";k.src=b;k.style.cursor="pointer";k.setAttribute("title",a);k.style.maxWidth=this.ae+"px";k.style.maxHeight=this.ae+"px";k.draggable=!1;k.style.ew="none";k.$v=function(b){b.preventDefault()};h.appendChild(k);C(k).bind("load",function(){var b=(c.ae-k.height)/2;k.style.marginLeft=(c.ae-k.width)/2+"px";k.style.marginTop=b+"px"});this.ia.appendChild(h);var m=this.buttons.length;
e&&(C(h).bind("touchstart",function(b){b.preventDefault();d();e(b);l.ta("click",b)}),C(h).click(function(b){d();e(b);l.focus(m);l.ta("click",b)}));this.uj+=this.ae+1;b={ia:h,ya:k,Wq:e};this.buttons.push(b);return b};a.prototype.Tr=function(b){if(!(0>=b)){var a=(this.ae+2)*Math.ceil(this.uj/b)+1;this.ia.style.width=""+a+"px";this.ia.style.height=""+b+"px";this.log("Toolbar width/height = %s,%s totalHeight=%s",a,b,this.uj)}};return a}(xb);var zb=function(c){function a(b){var d=c.call(this)||this;d.ia=b;d.Uj=!1;d.duration=200;d.right=!0;d.gi=a.gq();d.prefix=a.Im;d.nh=null;d.left=!1;d.qg=null;d.log=B.create("SlidingPanel",!1);b.ea("display","none");d.gi&&(b=d.ia.outerWidth(),d.ea("TransitionProperty","transform"),d.ea("Transform","translate("+b+"px,0)"));d.body=C(".body");return d}p(a,c);a.gq=function(){var b=(document.body||document.documentElement).style,d="transition",e=["Moz","Webkit","Khtml","O","ms"];d=d.charAt(0).toUpperCase()+
d.substr(1);for(var f=0;f<e.length;f++)if("string"===typeof b[e[f]+d])return a.Im=e[f],!0;return!1};a.prototype.show=function(b,a){void 0===a&&(a=!1);var d=this;this.nh&&(clearTimeout(this.nh),this.nh=null);!1!==a&&(a=!0);this.Uj=!0;this.ia.show();var f=this.ia.outerWidth();this.ia.Za();"right"===b?(this.left=!1,this.ia.ea("left",""+(C(window).width()-f)+"px")):this.left=!0;a&&(d.qg=new db,d.qg.zIndex=parseFloat(d.ia.ea("z-index"))||0,d.qg.insertBefore=d.ia,d.qg.show(function(){d.Ft()}));d.gi?(this.log("Performing transition"),
d.ia.ea("display","block"),d.left?d.ea("Transform","translate(-"+f+"px,0)"):d.ea("Transform","translate("+f+"px,0)"),d.ea("TransitionDuration",""+d.duration+"ms"),d.ea("TransitionDuration",""+d.duration+"ms",d.body),window.setTimeout(function(){d.ea("Transform","translate(0,0)");d.ea("Transform","translate("+(d.left?f:-f)+"px,0)",d.body);window.setTimeout(function(){d.Uo()},d.duration)},1)):(this.log("No transitions allowed"),d.ia.ea("display","block"),d.Uo())};a.prototype.Ft=function(){this.Za()};
a.prototype.ea=function(b,a,e){void 0===e&&(e=this.ia);0!==e.length&&(b=""!==this.prefix?this.prefix+b:b.charAt(0).toLowerCase()+b.substr(1),e[0].style[b]=a,this.log("%s=%s",b,a))};a.prototype.yb=function(){return this.Uj};a.prototype.Za=function(){var b=this;if(!this.nh){this.Uj=!1;b.qg&&b.qg.Za();var a=this.ia.outerWidth();b.gi?this.left?b.ea("Transform","translate(-"+a+"px,0)"):b.ea("Transform","translate("+a+"px,0)"):b.ia.ea("display","none");b.ea("Transform","translate(0,0)",this.body);b.gi?
this.nh=window.setTimeout(function(){b.ia.ea("display","none");b.ta("hide")},b.duration):b.ta("hide")}};a.prototype.Uo=function(){this.ia.find(".focus").focus();this.ta("show")};a.Im="";return a}(xb);var Ab=function(c){function a(){var b=c.call(this)||this;b.keys={};b.Ui=!0;b.Ru=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(b,a){return a.length-b.length}).join("|"),"g");b.log=B.create("KEYMAP");b.Ji=function(a){b.Ns(a)};return b}p(a,c);a.prototype.map=function(b,a){var d=b.toLowerCase().split(","),f;if("string"===typeof a){var c=a.split(",");for(f=0;f<d.length;f++)for(var h=
0;h<c.length;h++)this.Nm(d[f],c[h])}else for(f=0;f<d.length;f++)this.Nm(d[f],a)};a.prototype.Nm=function(a,d){if(0!==a.length){var b=a.match(this.Ru)||[],f=!1,c=!1,h=!1,k=!1,l=[],m;for(m=0;m<b.length;m++)switch(b[m]){case "alt":h=!0;break;case "control":case "ctrl":c=!0;break;case "shift":f=!0;break;case "home":l.push(36);break;case "end":l.push(35);break;case "pageup":l.push(33);break;case "pagedown":l.push(34);break;case "delete":case "del":l.push(46);break;case "backspace":l.push(8);break;case "up":l.push(38);
break;case "right":l.push(39);break;case "down":l.push(40);break;case "left":l.push(37);break;case "escape":case "esc":l.push(27);break;case "enter":l.push(13);break;case "ins":case "insert":l.push(45);break;case "f4":l.push(115);break;case "meta":case "command":case "cmd":case "\u2318":k=!0;break;default:alert("key entry not found: "+b[m])}var n=this;b=function(b){f&&-1===b.indexOf("-shift")&&(b+="-shift");c&&-1===b.indexOf("-control")&&(b+="-control");h&&-1===b.indexOf("-alt")&&(b+="-alt");k&&-1===
b.indexOf("-meta")&&(b+="-meta");"string"===typeof d?n.log("Keyboard mapping: %s->%s",b,d):n.log("Keyboard mapping: %s->%s",b,"function()");if(b in n.keys){var a,e=n.keys[b];for(a=0;a<e.length&&e[a]!==d;a++);a===e.length&&n.keys[b].push(d)}else n.keys[b]=[d]};if(0===l.length)switch(m=a.toUpperCase().charAt(a.length-1),m){case "=":b("107-shift");b("187");b("61");break;case "+":b("107");b("61-shift");break;case "-":b("109");b("189");b("173");break;default:l.push(m.charCodeAt(0))}for(m=0;m<l.length;m++)b(""+
l[m])}};a.prototype.ss=function(b){var a="";b.keyCode&&(a+=b.keyCode);b.shiftKey&&(a+="-shift");b.ctrlKey&&(a+="-control");b.altKey&&(a+="-alt");b.metaKey&&(a+="-meta");return a};a.prototype.translate=function(b){var a=[];b=this.ss(b);b in this.keys&&(a=this.keys[b]);this.log("%s",b);return a};a.prototype.Ns=function(a){for(var b=0,e=this.translate(a);b<e.length;b++){var f=e[b];"string"===typeof f?(this.log("action: %s",f),this.bf("*",f,a)):f(a)}};a.prototype.Cq=function(a){C(a).bind("keydown",this.Ji)};
a.prototype.detach=function(a){C(a).Hg("keydown",this.Ji)};return a}(xb);function Bb(c){var a=document.createElement("input");C(a).Qb("type","range");if("range"===a.type)return a.Cu=function(b,d){a.min=""+b;a.max=""+d},a.fo=function(){return parseFloat(a.value)},a.Pl=function(b){a.value=""+b},a;var b=C("<div>");b.ea("display","inline-block");b.ea("vertical-align","top");b.ea("height","1em");b.ea("width","10em");b.ea("padding","0.25em");b.ea("position","relative");var d=C("<div>");d.ea("top","50%");d.ea("height","0");d.ea("border-top","1px solid black");d.ea("border-bottom",
"1px solid #888888");d.ea("position","absolute");d.ea("left","0");d.ea("right","0");var e=C("<div>");e.ea("height","1em");e.ea("left","0px");e.ea("background","#888888");e.ea("border-top","1px solid #cccccc");e.ea("border-left","1px solid #cccccc");e.ea("border-bottom","1px solid #000000");e.ea("border-right","1px solid #000000");e.ea("width","0.5em");e.ea("position","absolute");e.ea("cursor","pointer");b.append(d);b.append(e);var f=b[0];f.type="range";f.min="0";f.max="100";f.value="0";f.onchange=
function(){};f.Cu=function(a,b){f.min=""+a;f.max=""+b};f.Pl=function(a){f.value=""+a;var d=b.width()-e.width();a=a/parseFloat(f.max)*d;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,b.width());e.ea("left",""+a+"px")};f.fo=function(){return parseFloat(f.value)};var g,h,k,l=B.create("RANGE");C(e).wh(function(a){"mousedown"===a.type&&(k=!0,g=a.pageX,h=parseInt(e.ea("left"),10),l("Mousedown at %s, ox=%s",g,h),a.stopPropagation(),a.preventDefault())});C(b).wh(function(a){if("mousedown"===a.type){var d=b.width()-
e.width(),c=a.pageX-C(b).offset().left;c=Math.max(c,0);c=Math.min(c,d);e.ea("left",""+c+"px");g=a.pageX;h=c;c=c/d*(parseFloat(f.max)-parseFloat(f.min))+parseFloat(f.min);c=Math.round(c);f.value=""+c;f.onchange&&f.onchange.call(f,a);k=!0}});C(b).dl(function(a){if(k&&"mousemove"===a.type){var d=b.width()-e.width(),c=a.pageX-g+h;c=Math.max(c,0);c=Math.min(c,d);e.ea("left",""+c+"px");c=c/d*(parseFloat(f.max)-parseFloat(f.min))+parseFloat(f.min);c=Math.round(c);f.value=""+c;f.onchange&&f.onchange.call(f,
a)}});c.bind(C(document.body),"mouseup",function(){k=!1});return f};function Cb(c,a,b){this.ya=c;this.oj=a;this.fn=b;this.tj=0}
var Db=new (function(){function c(){this.Cb=[];this.am=!1;this.log=B.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.Cb.length);for(var b=0;b<this.Cb.length;b++)this.Cb[b].ya.complete?this.Cb[b].fn(this.Cb[b].ya,this.Cb[b].oj):5E3>this.Cb[b].tj?(this.Cb[b].tj+=250,a.push(this.Cb[b])):this.Cb[b].fn(this.Cb[b].ya,this.Cb[b].oj);this.Cb=a;this.Cb.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.am=!1)};c.prototype.load=
function(a,b){var d=this,e=document.createElement("img"),c=new Cb(e,a,b);this.Cb.push(c);var g=0<=a.indexOf("://"),h="://"+window.location.host;0!==a.indexOf("data:")&&g&&-1===a.indexOf(h)&&(this.log("Using cross origin request for img"),e.crossOrigin="");e.addEventListener("load",function(){d.log("LoadFn called. complete=%s",e.complete);if(e.complete)for(var a=0;a<d.Cb.length;a++){var f=d.Cb[a];if(f.ya===e){d.Cb.splice(a,1);b(e,f.oj);break}}else d.am||(d.am=!0,setTimeout(d.timeout,250),c.tj=250)},
!1);e.addEventListener("error",function(){d.log("Error loading %s",a);b(null,c.oj)},!1);e.src=a;return e};return c}());var Eb=function(c){function a(a){var b=c.call(this,C("<div>"))||this;b.parent=a;b.Sa={};b.maxWidth=128;b.maxHeight=0;b.Qu=2;b.Zs="grid";b.jl=0;b.Bi=1;b.cells=[];b.bm=null;b.log=B.create("ListView");a.append(b.ia);b.ia.ea("overflow-x","auto");b.ia.ea("overflow-y","auto");return b}p(a,c);a.prototype.xa=function(a,d){this.Sa[a]=d};a.prototype.ij=function(a,d){this.maxWidth=a;this.maxHeight=d};a.prototype.ei=function(a,d,e){var b=this,c=this.Bi;var h={ya:null,index:this.jl,to:!1};this.jl+=1;Db.load(a,
function(a){if(c===b.Bi&&null!==a){var f=a.width;var g=a.height;b.maxWidth&&f>b.maxWidth&&(a.width=b.maxWidth,a.height=g/f*b.maxWidth);b.maxHeight&&g>b.maxHeight&&(a.width=b.maxHeight/(g/f),a.height=b.maxHeight);var k=C(a);k.ea("margin",""+b.Qu+"px");k.ea("border-width","3");k.ea("border-color","white");k.ea("border-style","solid");k.ea("image-rendering","optimizeQuality");k.mt(function(){b.log("Mouseenter");return k.ea("border-color","#888888")});k.nt(function(){return k.ea("border-color","white")});
k.click(function(){if("click"in b.Sa)return b.Sa.click(d)});e&&k.Qb("title",e);h.ya=k;b.cells.push(h);b.cells.sort(function(a,b){return a.index-b.index});b.bm||(b.bm=setTimeout(function(){b.bm=null;b.format()},500))}})};a.prototype.format=function(){var a;var d=null;var e=this.cells;var c=0;for(a=e.length;c<a;c++){var g=e[c];!g.to&&g.ya&&(null===d?this.ia.Ot(g.ya):d.ya&&d.ya.fi(g.ya),g.to=!0);d=g}};a.prototype.clear=function(){this.ia.empty();this.cells.length=0;this.Bi+=1};return a}(eb);
Eb.prototype=bb({},eb.prototype,Eb.prototype);var Gb=function(){function c(){this.items=[];this.next=0;this.fe=!1;this.log=B.create("UNDOSTACK")}c.prototype.pa=function(a,b,d){void 0===b&&(b=!1);a=a instanceof Fb?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].zb(d);for(d=this.top();d;)if(d[d.length-1].Jo(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.fe=!0;this.next=this.items.length}};c.prototype.ib=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.Ed()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].ib(a);this.fe=!0}};c.prototype.wd=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.Dd()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].zb(a);this.fe=!0}};c.prototype.Ed=function(){return 0<this.next};c.prototype.Dd=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.fe=!1};c.prototype.top=function(){return this.items.length?
this.items[this.items.length-1]:null};return c}(),Fb=function(){function c(){}c.prototype.zb=function(){};c.prototype.ib=function(){};c.prototype.Jo=function(){return!1};return c}();var Hb=function(){function c(a){this.next=a}c.prototype.qm=function(a){for(var b=0;b<a.length;b++)this.Ra(a.charCodeAt(b))};c.prototype.Ra=function(a){this.next.Ra(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.cg=function(){return this.next.cg()};return c}(),Ib=function(){function c(){this.data="";this.log=B.create("BYTESTREAM")}c.prototype.qm=function(a){for(var b=0;b<a.length;b++)this.Ra(a.charCodeAt(b))};c.prototype.cg=function(){return this};c.prototype.Ra=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.ic=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.Jj=function(a,b){c.Dm[a]=b};c.Kg=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.Dm[e](b))}return b};c.Dm={};return c}();var Jb=function(c){function a(a){a=c.call(this,a)||this;a.Rg=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}p(a,c);a.prototype.Ra=function(a){this.Rg=this.Rg<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.Ra(this.keys.charCodeAt(this.Rg>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.Ra(this.keys.charCodeAt(this.Rg>>this.size-6&63)),this.Rg=this.size=0);for(;a--;)this.next.Ra(61);
this.next.flush()};return a}(Hb);Ib.Jj("Base64Encoder",function(c){return new Jb(c)});var Kb=function(c){function a(a){a=c.call(this,a)||this;a.items=[];return a}p(a,c);a.prototype.Ra=function(a){4===this.items.length&&this.Rm();this.items.push(a)};a.prototype.Rm=function(){var a=this.items[0];var d=this.items[1];var e=this.items[2];var c=this.items[3];a=(a<<24|d<<16|e<<8|c)>>>0;var g=(a/614125|0)%85+33;var h=(a/7225|0)%85+33;var k=(a/85|0)%85+33;var l=a%85+33;this.next.Ra((a/52200625|0)%85+33);this.next.Ra(g);isNaN(d)||(this.next.Ra(h),isNaN(e)||(this.next.Ra(k),isNaN(c)||this.next.Ra(l)));
this.items.length=0};a.prototype.flush=function(){0<this.items.length&&this.Rm();this.next.qm("~>");this.next.flush()};return a}(Hb);Ib.Jj("Ascii85Encoder",function(c){return new Kb(c)});var Lb=function(){function c(a){this.next=a;this.vd=this.mf=0;this.Ho=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];this.log=B.create("BITWRITER")}c.prototype.Ra=function(a){this.Rp(a,8)};c.prototype.Rp=function(a,b){this.mf=this.mf<<b|a&this.Ho[b];for(this.vd+=b;8<=this.vd;)this.next.Ra(this.mf>>>this.vd-8&255),this.vd-=8,this.mf&=this.Ho[this.vd]};c.prototype.flush=function(){this.vd&&(this.next.Ra(this.mf<<8-this.vd),this.mf=this.vd=0);this.next.flush()};return c}();var Mb=function(c){function a(a){var b=c.call(this,a)||this;b.ng=258;b.Rv=0;b.Gf=0;b.first=!0;b.Ug=[];b.vl=[];b.$j=[];b.Yv=0;b.ek=9;b.log=B.create("LZWEncoder");b.Kq=new Lb(a);b.Pm();return b}p(a,c);a.prototype.Ra=function(a){if(this.first)this.Gf=a,this.first=!1;else{var b=this.kq(this.Gf,a);void 0!==this.Ug[b]?this.Gf=this.Ug[b]:(this.ci(this.Gf),this.Ug[b]=this.ng,this.vl[b]=this.Gf,this.Gf=this.$j[b]=a,4095>this.ng?(this.ng+=1,this.ek=Math.ceil(Math.log(this.ng)/Math.log(2))):this.Pm())}};a.prototype.kq=
function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.Ug[c]||this.vl[c]===a&&this.$j[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.Pm=function(){this.ci(a.Tp);this.ng=258;this.ek=9;this.Ug.length=0;this.vl.length=0;this.$j.length=0};a.prototype.flush=function(){this.first||(this.ci(this.Gf),this.ci(a.Yp))};a.prototype.ci=function(a){this.Kq.Rp(a,this.ek)};a.Tp=256;a.Yp=257;return a}(Hb);Ib.Jj("LZWEncoder",function(c){return new Mb(c)});var Nb=B.create("MISC");function Ob(c){"jQuery"in window&&c instanceof window.jQuery&&(c=c[0]);return C(c)}function Pb(c){var a=document.createElement("canvas");c&&c.appendChild(a);"G_vmlCanvasManager"in window&&(Nb("Emulating canvas in IE"),window.Hv.Uv(a),C(a).bind("selectstart",function(a){Nb("Cancelled selectstart on canvas");a.stopPropagation();a.preventDefault()}));a.style.background="transparent";return a}function Qb(){return(new Date).getTime()}
var Rb=/MSIE ([0-9]{1,}[\.0-9]{0,})/,Sb=0,Tb=!1;function Ub(){if(Tb)var c=Sb;else{c=-1;if("Microsoft Internet Explorer"===navigator.appName){var a=Rb.exec(navigator.userAgent);null!==a&&(c=parseFloat(a[1]))}Sb=c;Tb=!0;Nb("IE version is %s",c)}return 0<=c&&9>c}function Vb(){for(var c=document.getElementsByTagName("*"),a=0,b=0;b<c.length;b++){var d=parseInt(C(c[b]).ea("z-index"),10)||0;d>a&&(a=d)}return a}
function Wb(){if(null===Xb){var c=document.createElement("div");c.style.visibility="hidden";c.style.width="100px";document.body.appendChild(c);var a=c.offsetWidth;c.style.overflow="scroll";var b=document.createElement("div");b.style.width="100%";c.appendChild(b);b=b.offsetWidth;c.parentNode.removeChild(c);Xb=a-b;Nb("ScrollbarWidth calculated as %spx",Xb)}return Xb}var Xb=0;function Yb(c,a){var b=A.pc(c);b.values[3]=a;return b.toString()}
function Zb(c){var a=atob(c.split(",")[1]);c=c.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(a.length),d=new Uint8Array(b),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return new Blob([b],{type:c})}function $b(c,a){var b="function"!==typeof a?function(b){return b===a}:a;for(var d=0,e=0;e<c.length;e++)b(c[e])?d+=1:d&&(c[e-d]=c[e]);c.length-=d}
function ac(){var c=document.documentElement,a=c.scrollHeight>C(c).height();c=c.scrollWidth>C(c).width();a=a?Wb():0;c=c?Wb():0;var b=document.documentElement.scrollTop||document.body.scrollTop,d=document.documentElement.scrollLeft||document.body.scrollLeft;return{width:C(window).width()-a,height:C(window).height()-c,x:d,y:b}}function bc(c){var a=ac(),b=c.offset();b.left=Math.min(b.left,a.x+a.width-c.outerWidth());b.top=Math.min(b.top,a.y+a.height-c.outerHeight());c.offset(b)}
function cc(c,a){function b(a,b){return{stopPropagation:function(){a.stopPropagation()},preventDefault:function(){a.preventDefault()},sl:a,type:b.type,target:b.target,pageX:b.pageX,pageY:b.pageY,scale:b.scale,rotation:b.rotation}}var d=1,e=0;c.addEventListener("mousedown",function(c){3===(c.buttons&3)&&(d=1,e=0,a(b(c,{type:"gesturestart",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e})))},!1);c.addEventListener("contextmenu",function(a){a.preventDefault()},!1);c.addEventListener("mousemove",
function(c){3===(c.buttons&3)&&a(b(c,{type:"gesturechange",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e}))},!1);c.addEventListener("mouseup",function(e){5!==(e.buttons&3)&&a(b(e,{type:"gestureend",target:e.target,pageX:e.pageX,pageY:e.pageY,scale:d,rotation:0}))},!1);c.addEventListener("wheel",function(c){3===(c.buttons&3)&&(d=0<c.deltaY?1.1*d:d/1.1,0<c.deltaX?e+=10:0>c.deltaY&&(e-=10),a(b(c,{type:"gesturechange",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e})))})}
function dc(c,a){"erase"===a?c.Qf?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.Qf,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())};var ec=function(c){function a(a,d,e,f,g){var b=c.call(this)||this;b.size=d;b.Wd=e;b.Ov=f;b.Rb=[];b.width=0;b.Uc=0;b.Vg=0;b.Qp=!1;b.log=B.create("COLOURPANEL");b.canvas=C(Pb(a[0]));b.ia=b.canvas;b.canvas.ea("position","absolute");b.canvas.ea("border","none");b.canvas.ea("border-top","1px solid black");b.canvas.ea("display","block");b.ka=b.canvas[0].getContext("2d");b.Rb="string"===typeof g?b.wn():g;b.Ql(100);b.canvas.bind("touchstart",function(a){if("touchstart"===a.type){var d=b.canvas.offset();b.qc(a.touches[0].pageX-
d.left,a.touches[0].pageY-d.top,!0);a.preventDefault();a.stopPropagation()}});b.canvas.wh(function(a){if("mousedown"===a.type){var d=b.canvas.offset();b.qc(a.pageX-d.left,a.pageY-d.top,0===a.button)||(a.preventDefault(),a.stopPropagation())}});b.canvas.bind("contextmenu",function(a){a.preventDefault();a.stopPropagation();return!1});return b}p(a,c);a.prototype.Fe=function(a,d){this.size=a;this.Wd=d;this.format();this.ja()};a.prototype.wn=function(){function a(a){for(var b=30;100>b;b+=20)a.values[2]=
b/100,d.push(a.toString())}var d="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");a(new A(A.Bc,[0,0,0,1]));for(var e=0;720>e;e+=35){var c=new A(A.Bc,[e,.5,0,1]);a(c)}return d};a.prototype.ou=function(a){this.Rb="string"===typeof a?this.wn():a.slice(0);this.log("Set colours to %s len=%s",this.Rb,this.Rb.length);this.format();this.ja()};a.prototype.Ql=function(a){this.width=a;
this.canvas.Qb("width",""+this.width);this.format();this.ja()};a.prototype.vp=function(a){this.Uc=a;this.canvas.Qb("height",""+(this.Uc-1))};a.prototype.height=function(){return this.Uc};a.prototype.moveTo=function(a,d){this.canvas.ea("left",""+a+"px");this.canvas.ea("top",""+d+"px")};a.prototype.format=function(){this.Vg=Math.floor(this.width/this.size);var a=Math.ceil(this.Rb.length/this.Vg);this.log("Format to width=%s; height=%s wrap=%s, cpr=%s",this.width,a*this.size,this.Qp,this.Vg);this.Qp?
this.vp(a*this.size):this.vp(this.size)};a.Cm=function(a,d,e,c){a.fillStyle="#ffffff";a.fillRect(d,e,c,c);a.beginPath();a.strokeStyle="#000000";a.moveTo(d,e);a.lineTo(d+c,e+c);a.moveTo(d+c,e);a.lineTo(d,e+c);a.stroke()};a.Bm=function(a,d,e,c){for(var b,f=0;f<c;f+=5){b=0===f/5%2;for(var k=0;k<c;k+=5)a.fillStyle=b?"#000000":"#ffffff",b=!b,a.fillRect(d+k,e+f,5,5)}b=a.createLinearGradient(d+c,e+c,d,e);b.addColorStop(0,"rgba(255, 255, 255, 1.0)");b.addColorStop(1,"rgba(255, 255, 255, 0.0)");a.fillStyle=
b;a.fillRect(d,e,c,c)};a.prototype.ja=function(){for(var b=0,d=0,e=0;e<this.Rb.length;e++){var c=A.pc(this.Rb[e]);this.ka.fillStyle=this.Rb[e];this.ka.fillRect(b,d,this.size,this.size);0===c.values[3]?a.Cm(this.ka,b,d,this.size):.5===c.values[3]&&a.Bm(this.ka,b,d,this.size);b+=this.size;b>=this.width&&(d+=this.size,b=0)}};a.prototype.Za=function(){this.canvas.Za()};a.prototype.show=function(){this.canvas.show()};a.prototype.qc=function(a,d,e){a=Math.floor(a/this.size);d=Math.floor(d/this.size);var b=
d*this.Vg+a;this.log("row=%s col=%s index=%s coloursPerRow=%s",d,a,b,this.Vg);return b<this.Rb.length?("rgba(0,0,0,0.0)"===this.Rb[b]?this.ta("opacity",0,e):"rgba(0,0,0,0.5)"===this.Rb[b]?this.ta("opacity",.5,e):this.ta("colour",this.Rb[b],e),!0):!1};return a}(xb);var fc=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.ua=a;b.Zo=e;b.log=B.create("PageSelector");b.current=0;b.kd=[];b.enabled=!1;b.page=0;b.ia=C(d);b.ia.Qe("zwibbler-page-selector");b.Zo||(b.ia.ea("overflow-y","scroll"),b.ia.ea("text-align","center"));e||f||(a=C("<input>").Qb("type","button").Qb("value","Add Page"),b.ia.append(a),a.click(function(){b.ua.Cf(b.ua.qh(b.ua.le()+1))}),a=C("<input>").Qb("type","button").Qb("value","Delete Page"),b.ia.append(a),a.click(function(){b.ua.zn(b.ua.le())}),
b.enabled=!1);return b}p(a,c);a.prototype.hj=function(a){this.enabled=a;var b=this;this.enabled&&this.ua&&setTimeout(function(){b.yl()},10)};a.prototype.Gl=function(a){function b(){null===c&&e.enabled&&(c=setTimeout(function(){e.yl();e.Db(e.ua.le());c=null},100))}var e=this,c=null;this.ua=a;a.xa("document-changed",function(){b()});a.xa("resource-loaded",function(){b()});a.xa("set-page",function(a){e.Db(a)})};a.prototype.yl=function(){this.log("Regenerate page views.");for(var a=this.ia.width()-6-
10-Wb(),d=this.ia.height()-6,e=this.ua.Gc(),c=0;c<e;c++){var g=this.ua.ao(c),h=a,k=d;d>a?k=a/g.width*g.height:h=d/g.height*g.width;var l=c===this.kd.length?this.ht(c):this.kd[c];l.width=h;l.height=k;if(l=l.getContext("2d"))l.save(),l.fillStyle="#ffffff",l.fillRect(0,0,h,k),l.scale(h/g.width,h/g.width),l.translate(-g.x,-g.y),this.ua.ja(l,{page:c}),l.restore()}for(;c<this.kd.length;c++)C(this.kd[c]).remove();this.kd.length=e};a.prototype.ht=function(a){var b=Pb(this.ia[0]);this.Zo||(C(b).ea("margin-left",
"10px"),C(b).ea("margin-right","10px"),C(b).ea("margin-top","5px"),C(b).ea("margin-bottom","5px"));C(b).ea("border-width","3px");this.log("Make canvas for page %s, currentPage is %s",a,this.page);a===this.page?C(b).ea("border-color","#9fb3e7"):C(b).ea("border-color","transparent");C(b).ea("border-style","solid");this.kd.push(b);b.page=a;var e=this;C(b).click(function(){e.ua.Cf(a);e.ua.ta("page-preview-clicked",a)});return b};a.prototype.Db=function(a){a!==this.page&&this.log("Set page %s",a);this.page<
this.kd.length&&C(this.kd[this.page]).ea("border-color","transparent");this.page=a;this.page<this.kd.length&&C(this.kd[this.page]).ea("border-color","#9fb3e7")};return a}(xb);function D(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw Error(a);}
var gc=function(){function c(a){var b=this;this.Lc=0;this.log=B.create("BinaryReader");if("string"===typeof a)this.length=a.length,this.getUint8=function(){D(b.Lc<a.length);return a.charCodeAt(b.Lc++)&255};else{var d=new Uint8Array(a);this.length=d.length;this.getUint8=function(){D(b.Lc<d.length);return d[b.Lc++]}}}c.prototype.seek=function(a){D(0<=a&&a<=this.length);var b=this.Lc;this.Lc=a;return b};c.prototype.getUint16=function(){return(this.getUint8()<<8|this.getUint8())>>>0};c.prototype.getUint32=
function(){return this.getInt32()>>>0};c.prototype.getInt16=function(){var a=this.getUint16();a&32768&&(a-=65536);return a};c.prototype.getInt32=function(){return this.getUint8()<<24|this.getUint8()<<16|this.getUint8()<<8|this.getUint8()};c.prototype.Mb=function(){return this.getInt16()};c.prototype.Is=function(){this.getUint16()};c.prototype.ef=function(){return this.getInt16()/16384};c.prototype.Kk=function(){return this.getInt32()/65536};c.prototype.eo=function(a){for(var b="",d=0;d<a;d++)b+=String.fromCharCode(this.getUint8());
return b};c.prototype.Js=function(a){for(var b="",d=0;d<a;d+=2)b+=String.fromCharCode(this.getUint16());return b};c.prototype.getDate=function(){var a=1E3*(4294967296*this.getUint32()+this.getUint32())+Date.UTC(1904,1,1);return new Date(a)};return c}(),hc=function(){function c(a){this.format=0;this.jn=[];this.log=B.create("CMAP0");for(var b=0;256>b;b++){var d=a.getUint8();this.log("   Glyph[%s] = %s",b,d);this.jn.push(d)}}c.prototype.map=function(a){return 0<=a&&255>=a?this.jn[a]:0};return c}(),ic=
function(){function c(a){this.file=a;this.format=4;this.cache={};this.log=B.create("CMAP4");var b,d=[],e=a.getUint16()/2;a.getUint16();a.getUint16();a.getUint16();for(b=0;b<e;b++)d.push({Ni:0,pj:0,In:a.getUint16(),qo:0});a.getUint16();for(b=0;b<e;b++)d[b].pj=a.getUint16();for(b=0;b<e;b++)d[b].qo=a.getUint16();for(b=0;b<e;b++){var c=a.getUint16();d[b].Ni=c?a.Lc-2+c:0}this.wa=d}c.prototype.map=function(a){if(!(a in this.cache)){for(var b=0;b<this.wa.length;b++){var d=this.wa[b];if(d.pj<=a&&d.In>=a){if(d.Ni){var e=
d.Ni+2*(a-d.pj);this.file.seek(e);var c=this.file.getUint16()}else c=d.qo+a&65535;this.log("Charcode %s is between %s and %s; maps to %s (%s) roffset=%s",a,d.pj,d.In,e,c,d.Ni);this.cache[a]=c;break}}b===this.wa.length&&(this.cache[a]=0)}return this.cache[a]};return c}(),jc=function(){function c(a,b,d){this.file=a;this.map={};this.jf=-1;this.log=B.create("KERN0");this.Wu=b&&!d||!b&&d;this.file=a;this.offset=a.Lc;this.rt=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(b=0;b<this.rt;b++){d=
a.getUint16();var e=a.getUint16(),c=a.Mb();this.map[d<<16|e]=c}this.reset()}c.prototype.reset=function(){this.jf=-1};c.prototype.get=function(a){var b=0;if(0<=this.jf){var d=this.jf<<16|a;d in this.map&&(b=this.map[d])}this.jf=a;return this.Wu?{x:0,y:b}:{x:b,y:0}};return c}(),kc=function(){function c(a){this.dk=[];this.sh=[];this.im=this.flags=this.Fo=this.version=0;this.ee=new Date;this.so=this.tm=this.rm=this.um=this.sm=0;this.fontFamily=this.bg="";this.xh=0;this.log=B.create("TrueType");this.file=
new gc(a);this.mb=this.Xt(this.file);this.Tt(this.file);this.Wt(this.file);this.Rt(this.file);this.Ut(this.file);this.Vt(this.file);this.length=this.Ls()}c.prototype.Xt=function(a){var b={};a.getUint32();var d=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(var e=0;e<d;e++){var c=a.eo(4);b[c]={Qq:a.getUint32(),offset:a.getUint32(),length:a.getUint32()};"head"!==c&&this.log("Table %s has checksum 0x%s",c,b[c].Qq.toString(16))}return b};c.prototype.Tt=function(a){D("head"in this.mb);a.seek(this.mb.head.offset);
this.version=a.Kk();a.Kk();a.getUint32();this.Fo=a.getUint32();D(1594834165===this.Fo);this.flags=a.getUint16();this.im=a.getUint16();this.ee=a.getDate();a.getDate();this.sm=a.Mb();this.um=a.Mb();this.rm=a.Mb();this.tm=a.Mb();a.getUint16();a.getUint16();a.getInt16();this.so=a.getInt16();a.getInt16()};c.prototype.Rt=function(a){D("cmap"in this.mb);var b=this.mb.cmap.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=0;e<d;e++){var c=a.getUint16(),g=a.getUint16(),h=a.getUint32();this.log("CMap platformid=%s specificid=%s offset=%s",
c,g,h);3===c&&1>=g&&this.Qt(a,b+h)}};c.prototype.Qt=function(a,b){var d=a.seek(b),e=a.getUint16(),c=a.getUint16();a.getUint16();var g;this.log("    Cmap format %s length %s",e,c);0===e?g=new hc(a,c):4===e&&(g=new ic(a,c));g&&this.dk.push(g);a.seek(d)};c.prototype.Vt=function(a){if("kern"in this.mb){a.seek(this.mb.kern.offset);var b=a.getUint16(),d=a.getUint16();this.log("Kern Table version: %s",b);this.log("Kern nTables: %s",d);for(var e=0;e<d;e++){b=a.getUint16();var c=a.getUint16(),g=a.getUint16(),
h=g>>8,k=g&4,l=0===(g&1);this.log("Kerning subtable version %s format %s length %s coverage: %s",b,h,c,g);b=null;0===h?b=new jc(a,l,0!=k):(this.log("Unknown format -- skip"),a.seek(a.Lc+c));b&&this.sh.push(b)}}};c.prototype.Wt=function(a){D("name"in this.mb);var b=this.mb.name.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=a.getUint16(),c=0;c<d;c++){var g=a.getUint16(),h=a.getUint16(),k=a.getUint16(),l=a.getUint16(),m=a.getUint16(),n=a.getUint16();n=a.seek(b+e+n);m=0===g||3===g?a.Js(m):
a.eo(m);this.log("Name %s/%s id %s language %s: %s",g,h,l,k,m);a.seek(n);switch(l){case 1:this.fontFamily=m;break;case 4:this.bg=m}}};c.prototype.Ut=function(a){D("hhea"in this.mb);a.seek(this.mb.hhea.offset);a.Kk();a.Mb();a.Mb();a.Mb();a.Is();a.Mb();a.Mb();a.Mb();a.getInt16();a.getInt16();a.Mb();a.getInt16();a.getInt16();a.getInt16();a.getInt16();a.getInt16();this.xh=a.getUint16()};c.prototype.ps=function(a){D("hmtx"in this.mb);var b=this.file;b.seek(this.mb.hmtx.offset+4);var d=this.mb.hmtx.offset;
if(a<this.xh){var e=this.file.seek(d+4*a);var c=b.getUint16();a=b.getInt16()}else e=b.seek(d+4*(this.xh-1)),c=b.getUint16(),b.seek(d+4*this.xh+2*(a-this.xh)),a=b.Mb();this.file.seek(e);return{gn:c,ct:a}};c.prototype.Ls=function(){D("maxp"in this.mb);var a=this.file.seek(this.mb.maxp.offset+4),b=this.file.getUint16();this.file.seek(a);return b};c.prototype.ns=function(a){D("loca"in this.mb);var b=this.mb.loca,d=this.file;if(1===this.so){b=d.seek(b.offset+4*a);a=d.getUint32();var e=d.getUint32()}else b=
d.seek(b.offset+2*a),a=2*d.getUint16(),e=2*d.getUint16();d.seek(b);return a===e?0:a+this.mb.glyf.offset};c.prototype.ep=function(a){var b=this.ns(a);a=this.file;if(0===b||b>=this.mb.glyf.offset+this.mb.glyf.length)return null;D(b>=this.mb.glyf.offset);D(b<this.mb.glyf.offset+this.mb.glyf.length);a.seek(b);b={Gd:[],zh:a.getInt16(),oa:[],sm:a.Mb(),um:a.Mb(),rm:a.Mb(),tm:a.Mb()};D(-1<=b.zh);-1===b.zh?this.St(a,b):this.Yt(a,b);return b};c.prototype.Yt=function(a,b){function d(b,d,c){for(var f=0,k=0;k<
g;k++){var l=h[k];l&d?f=l&c?f+a.getUint8():f-a.getUint8():~l&c&&(f+=a.getInt16());e[k][b]=f}}b.Gd=[];for(var e=b.oa=[],c=0;c<b.zh;c++)b.Gd.push(a.getUint16());a.seek(a.getUint16()+a.Lc);if(0!==b.zh){var g=Math.max.apply(null,b.Gd)+1,h=[];for(c=0;c<g;c++){var k=a.getUint8();h.push(k);e.push({x:0,y:0,og:0<(k&1)});if(k&8){var l=a.getUint8();D(0<l);for(c+=l;l--;)h.push(k),e.push({x:0,y:0,og:0<(k&1)})}}d("x",2,16,b.sm,b.rm);d("y",4,32,b.um,b.tm)}};c.prototype.St=function(a,b){var d,e,c=32;b.Gd=[];for(b.oa=
[];c&32;){c=a.getUint16();var g=a.getUint16();var h=1;var k=d=0;var l=1;var m=e=0;if(c&1){var n=a.getInt16();var r=a.getInt16()}else n=a.getUint8(),r=a.getUint8();c&2&&(e=n,m=r);c&8?l=h=a.ef():c&64?(h=a.ef(),l=a.ef()):c&128&&(h=a.ef(),d=a.ef(),k=a.ef(),l=a.ef());this.log("Read component glyph index %s",g);this.log("Transform: [%s %s %s %s %s %s]",h,d,k,l,e,m);n=a.Lc;if(g=this.ep(g)){var q=b.oa.length;for(r=0;r<g.Gd.length;r++)b.Gd.push(g.Gd[r]+q);for(r=0;r<g.oa.length;r++){q=g.oa[r].x;var v=g.oa[r].y;
q=h*q+d*v+e;v=k*q+l*v+m;b.oa.push({x:q,y:v,og:g.oa[r].og})}}a.seek(n)}b.zh=b.Gd.length;c&256&&a.seek(a.getUint16()+a.Lc)};c.prototype.qr=function(a,b,d,e){b=this.ep(b);if(null!==b)for(var c=0,g=0,h=0,k=0,l;g<b.oa.length;g++){var m=b.oa[g];0===c?(a.moveTo(m.x+d,m.y+e),c=1):1===c?m.og?a.lineTo(m.x+d,m.y+e):c=2:(l=b.oa[g-1],m.og?(a.quadraticCurveTo(l.x+d,l.y+e,m.x+d,m.y+e),c=1):a.quadraticCurveTo(l.x+d,l.y+e,(l.x+m.x)/2+d,(l.y+m.y)/2+e));g===b.Gd[h]&&(2===c&&(l=m,m=b.oa[k],m.og?a.quadraticCurveTo(l.x+
d,l.y+e,m.x+d,m.y+e):a.quadraticCurveTo(l.x+d,l.y+e,(l.x+m.x)/2+d,(l.y+m.y)/2+e)),k=g+1,h+=1,c=0)}};c.prototype.transform=function(a,b){a.scale(b/this.im,-b/this.im)};c.prototype.wr=function(a,b,d,e,c){a.save();a.translate(d,e);this.transform(a,c);e=d=0;this.eu();for(c=0;c<b.length;c++){var f=this.kt(b.charCodeAt(c)),h=this.ps(f),k=this.tt(f);this.log("Metrics for %s code %s index %s: %s %s kern: %s,%s",b.charAt(c),b.charCodeAt(c),f,h.gn,h.ct,k.x,k.y);this.qr(a,f,d+k.x,e+k.y);d+=h.gn}a.restore()};
c.prototype.kt=function(a){for(var b=0,d=0;d<this.dk.length&&!(b=this.dk[d].map(a));d++);return b};c.prototype.eu=function(){for(var a=0;a<this.sh.length;a++)this.sh[a].reset()};c.prototype.tt=function(a){for(var b,d=0,e=0,c=0;c<this.sh.length;c++)b=this.sh[c].get(a),d+=b.x,e+=b.y;return{x:d,y:e}};return c}(),lc=function(c){function a(){var a=c.call(this)||this;a.fonts={};a.yh=0;a.tk=[];a.log=B.create("FontCollection");return a}p(a,c);a.prototype.add=function(a,d){this.yh+=1;var b=this;Ya({url:a,
Vu:function(e){b.mq(a,d,e)},error:function(){b.Ia(a)},Iq:function(a,b){b.overrideMimeType("text/plain; charset=x-user-defined")}})};a.prototype.Ia=function(a){this.log("Error fetching "+a);--this.yh;this.Om()};a.prototype.mq=function(a,d,e){this.log("Got font %s; result is %s bytes",a,e.length);for(var b="",c=0;c<e.length;c++)b+=String.fromCharCode(e.charCodeAt(c)&255);e=new kc(b);this.log("Loaded '%s'",e.bg);for(c=0;c<e.bg.length;c++)this.log("   %s, %s",e.bg.charAt(c),e.bg.charCodeAt(c));d=d||e.fontFamily;
this.fonts[d]={name:e.bg,url:a,data:b,font:e};--this.yh;this.Om()};a.prototype.Om=function(){if(0===this.yh){this.ta("done");for(var a=0;a<this.tk.length;a++)this.tk[a]();this.tk.length=0}};a.prototype.get=function(a){this.log("Lookup font %s",a);for(var b=0;b<a.length;b++)this.log("   %s, %s",a.charAt(b),a.charCodeAt(b));if(a in this.fonts)return this.fonts[a].font;this.log("Lookup font %s; not found",a);for(var e in this.fonts)this.log("Searched: '%s'",e)};return a}(xb);var mc=B.create("Graphics",!0),F=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Pa=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.Jd=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.ti=function(a,b){var d=a.x,e=a.y,c=this.x,g=this.y,h=b.x-d,k=b.y-e,l=h*h+k*k;if(0===l)return this.Pa(a);l=((c-d)*h+(g-e)*k)/l;1<
l?l=1:0>l&&(l=0);d=d+l*h-c;e=e+l*k-g;return Math.sqrt(d*d+e*e)};return c}();function nc(c,a){this.width=c;this.height=a}function G(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function I(c,a,b,d){var e=G(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function oc(c){c.x*=-1;c.y*=-1;return c}
var K=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.gp()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.Me=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,g=1;g<a.length;g++)a[g].x<b&&(b=a[g].x),a[g].x>d&&(d=a[g].x),a[g].y<e&&(e=a[g].y),a[g].y>f&&(f=a[g].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.Jd=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Vh=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.hm=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.Gt=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.Wc=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.gp=
function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.xc=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=
Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.Fd=function(){return new F(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),O=function(){function c(){this.log=B.create("MATRIX");this.Zb="Matrix";if(0===arguments.length)this.m11=1,this.m21=
this.m12=0,this.m22=1,this.Da=this.Ca=0;else if(1===arguments.length){if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Ca=arguments[0][4];this.Da=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Ca=arguments[4],this.Da=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.Ca+"    "+
this.m21+" "+this.m22+" "+this.Da+"    0 0 1 ]"};c.prototype.ic=function(){return[this.m11,this.m12,this.m21,this.m22,this.Ca,this.Da]};c.prototype.Wk=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Ca&&0===this.Da};c.prototype.Jd=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Ca===a.Ca&&this.Da===a.Da};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+this.m22*a.m21;
b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Ca=this.m11*a.Ca+this.m12*a.Da+this.Ca;b.Da=this.m21*a.Ca+this.m22*a.Da+this.Da;return b};c.prototype.apply=function(a,b){return new F(this.m11*a+this.m12*b+this.Ca,this.m21*a+this.m22*b+this.Da)};c.prototype.Th=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Ca,this.Da):a.transform(this.m11,this.m21,this.m12,this.m22,this.Ca,this.Da)};c.prototype.clone=function(){return new c(this.m11,
this.m12,this.m21,this.m22,this.Ca,this.Da)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Da-this.Ca*this.m22)/a,(this.Ca*this.m21-this.m11*this.Da)/a)};c.prototype.Np=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),g=Math.sqrt(d*d+e*e);return new c(a/f,d/g,b/f,e/g,this.Ca,this.Da)};c.prototype.fg=function(){return new F(Math.sqrt(this.m11*this.m11+this.m21*this.m21),
Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.xo=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new M(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new N(a,b,d))};return c}(),N=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}p(a,c);return a}(O),M=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}p(a,
c);return a}(O),P=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}p(a,c);return a}(O),pc=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}p(a,c);return a}(O);
function rc(c,a,b,d,e,f,g,h,k,l){if(!(8<++rc.depth)){var m=(a+d)/2,n=(b+e)/2,r=(d+f)/2,q=(e+g)/2,v=(f+h)/2,y=(g+k)/2,z=(m+r)/2,w=(n+q)/2;r=(r+v)/2;q=(q+y)/2;var E=(z+r)/2,J=(w+q)/2,H=h-a,T=k-b;d=Math.abs((d-h)*T-(e-k)*H);f=Math.abs((f-h)*T-(g-k)*H);(d+f)*(d+f)<l*(H*H+T*T)?c.push(new F(E,J)):(rc(c,a,b,m,n,z,w,E,J,l),rc(c,E,J,r,q,v,y,h,k,l))}--rc.depth}(rc||(rc={})).depth=0;
function sc(c,a,b,d,e,f,g,h){if(!(8<++rc.depth)){var k=(a+d)/2,l=(b+e)/2,m=(d+f)/2,n=(e+g)/2,r=(k+m)/2,q=(l+n)/2,v=f-a,y=g-b;d=Math.abs((d-f)*y-(e-g)*v);d*d<=h*(v*v+y*y)?c.push(new F(r,q)):(sc(c,a,b,k,l,r,q,h),sc(c,r,q,m,n,f,g,h))}--rc.depth}
function tc(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var g=c[f-1].x;var h=c[f-1].y;for(d=0;d<f;d++){var k=c[d].x;var l=c[d].y;if(k>g){var m=g;var n=k;var r=h;h=l}else m=k,n=g,r=l;k<a===a<=g&&(b-r)*(n-m)<(h-r)*(a-m)&&(e=!e);g=k;h=l}return e}function uc(c,a,b,d,e,f,g,h){b-=c;d-=a;g-=e;var k=h-f;var l=-g*d+b*k;if(0===l)return null;h=(-d*(c-e)+b*(a-f))/l;e=(g*(a-f)-k*(c-e))/l;return 0<=h&&1>=h&&0<=e&&1>=e?new F(c+e*b,a+e*d):null}
function vc(c,a,b,d,e){for(var f=[],g=new F(c,a),h=1;h<=e.length;h++){var k=e[h-1],l=e[h%e.length];(k=uc(c,a,b,d,k.x,k.y,l.x,l.y))&&f.push(k)}f.sort(function(a,b){return a.Pa(g)-b.Pa(g)});return f}function wc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,g=c[e-1].y,h=c[e].x-f,k=c[e].y-g,l=((a-f)*h+(b-g)*k)/(h*h+k*k);1<l?l=1:0>l&&(l=0);f=f+l*h-a;g=g+l*k-b;if(f*f+g*g<=d)return!0}return!1}
(function(){function c(a){this.Ub=a}c.prototype.clear=function(){for(var a=0;a<this.Ub.width*this.Ub.height*4;a++)this.Ub.data[a]=0};c.prototype.getImageData=function(){return this.Ub};c.prototype.width=function(){return this.Ub.width};c.prototype.height=function(){return this.Ub.height};c.prototype.get=function(a,b){var d=this.Ub.width*b*4+4*a;return this.Ub.data[d]|this.Ub.data[d+1]<<8|this.Ub.data[d+2]<<16|this.Ub.data[d+3]<<24};c.prototype.set=function(a,b,d){a=this.Ub.width*b*4+4*a;this.Ub.data[a]=
d&255;this.Ub.data[a+1]=d>>8&255;this.Ub.data[a+2]=d>>16&255;this.Ub.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.$d=a;this.Uc=b;this.data=[]}c.prototype.width=function(){return this.$d};c.prototype.height=function(){return this.Uc};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.$d;a.height=this.Uc;a=a.getContext("2d").getImageData(0,0,this.$d,this.Uc);for(var b=this.$d*this.Uc,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.$d*b+a]};c.prototype.set=function(a,b,d){this.data[this.$d*b+a]=d};return c})();
var Q=function(){function c(a){this.closed=!1;this.ba=[];a instanceof K&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.ba=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.ba.push(c.Tc,a,b)};c.prototype.lineTo=function(a,b){this.ba.push(c.Sc,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,f,g){this.ba.push(c.Ig,a,b,d,e,f,g)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(c.Ng,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.ba.push(c.Rc)};c.prototype.ja=function(a){for(var b=0;b<this.ba.length;){switch(this.ba[b]){case c.Tc:a.moveTo&&a.moveTo(this.ba[b+1],this.ba[b+2]);break;case c.Sc:a.lineTo&&a.lineTo(this.ba[b+1],this.ba[b+2]);break;case c.Ig:a.bezierCurveTo&&a.bezierCurveTo(this.ba[b+1],this.ba[b+2],
this.ba[b+3],this.ba[b+4],this.ba[b+5],this.ba[b+6]);break;case c.Ng:a.quadraticCurveTo&&a.quadraticCurveTo(this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4]);break;case c.Rc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.Cc[this.ba[b]]}};c.prototype.Vd=function(){for(var a=0,b,d=[];a<this.ba.length;){var e=c.Hm[this.ba[a]];for(b=0;b<e;b++)d.push(new F(this.ba[a+1+2*b],this.ba[a+1+2*b+1]));a+=c.Cc[this.ba[a]]}return d};c.prototype.transform=function(a){for(var b=0,d,e;b<this.ba.length;){e=
c.Hm[this.ba[b]];for(d=0;d<e;d++){var f=a.apply(this.ba[b+1+2*d],this.ba[b+1+2*d+1]);this.ba[b+1+2*d]=f.x;this.ba[b+1+2*d+1]=f.y}b+=c.Cc[this.ba[b]]}};c.prototype.clone=function(){var a=new c;a.ba=this.ba.concat();return a};c.prototype.rn=function(a){for(var b=0,d,e=d=0,f=new K(this.ba[1],this.ba[2],0,0),g;b<this.ba.length;){switch(this.ba[b]){case c.Tc:case c.Sc:d=this.ba[b+1];e=this.ba[b+2];f.hm(d,e);break;case c.Ig:var h=g=[],k=this.ba[b+5],l=this.ba[b+6];rc(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+
3],this.ba[b+4],k,l,a*a);h.push(new F(k,l));for(d=0;d<g.length;d++)f.hm(g[d].x,g[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.Ng:h=g=[];k=this.ba[b+3];l=this.ba[b+4];sc(h,d,e,this.ba[b+1],this.ba[b+2],k,l,a*a);h.push(new F(k,l));for(d=0;d<g.length;d++)f.hm(g[d].x,g[d].y);d=this.ba[b+3];e=this.ba[b+4]}b+=c.Cc[this.ba[b]]}return f};c.prototype.append=function(a){this.ba=this.ba.concat(a.ba)};c.prototype.cm=function(a){for(var b=0,d=0,e=0,f=new c,g;b<this.ba.length;){switch(this.ba[b]){case c.Tc:d=
this.ba[b+1];e=this.ba[b+2];f.moveTo(d,e);break;case c.Sc:d=this.ba[b+1];e=this.ba[b+2];f.lineTo(d,e);break;case c.Ig:var h=g=[],k=this.ba[b+5],l=this.ba[b+6];rc(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4],k,l,a*a);h.push(new F(k,l));2===g.length&&1E-4>d*(g[0].y-g[1].y)+g[0].x*(g[1].y-e)+g[1].x*(e-g[0].y)&&(g[0]=g[1],g.length=1);for(d=0;d<g.length;d++)f.lineTo(g[d].x,g[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.Ng:h=g=[];k=this.ba[b+3];l=this.ba[b+4];sc(h,d,e,this.ba[b+1],this.ba[b+
2],k,l,a*a);h.push(new F(k,l));for(d=0;d<g.length;d++)f.lineTo(g[d].x,g[d].y);d=this.ba[b+3];e=this.ba[b+4];break;case c.Rc:f.closePath()}b+=c.Cc[this.ba[b]]}return f};c.prototype.ap=function(a,b,d){void 0===d&&(d=0);return tc(this.Vd(),a,b)||0<d&&this.ul(a,b,d)};c.prototype.ul=function(a,b,d){var e=0,f=0,g=0;for(d*=d;g<this.ba.length;){switch(this.ba[g]){case c.Tc:e=this.ba[g+1];f=this.ba[g+2];break;case c.Sc:var h=this.ba[g+1];var k=this.ba[g+2];var l=h-e;var m=k-f;var n=l*l+m*m;n=((a-e)*l+(b-f)*
m)/n;1<n?n=1:0>n&&(n=0);e+=n*l;m=f+n*m;f=e-a;m-=b;f=f*f+m*m;if(f<=d)return!0;e=h;f=k}g+=c.Cc[this.ba[g]]}return!1};c.prototype.Xq=function(a){a=a.Vd();for(var b=0,d=new F(0,0),e=new F(0,0),f=new c,g=!1,h;b<this.ba.length;){switch(this.ba[b]){case c.Tc:d.x=this.ba[b+1];d.y=this.ba[b+2];(g=tc(a,d.x,d.y))||f.moveTo(d.x,d.y);break;case c.Sc:e.x=this.ba[b+1];e.y=this.ba[b+2];h=vc(d.x,d.y,e.x,e.y,a);for(var k=0;k<h.length;k++)g?f.moveTo(h[k].x,h[k].y):f.lineTo(h[k].x,h[k].y),g=!g;g||f.lineTo(e.x,e.y);d.x=
e.x;d.y=e.y}b+=c.Cc[this.ba[b]]}return f};c.prototype.vi=function(a,b){for(var d=0,e=0,f=b[0],g,h=new F(0,0),k;d<this.ba.length;){switch(this.ba[d]){case c.Tc:k=this.ba[d+1];g=this.ba[d+2];a.moveTo(k,g);h=new F(k,g);break;case c.Sc:k=this.ba[d+1];var l=g=this.ba[d+2],m=new F(k,l);g=h.Pa(m);if(!(0>=g)){for(;g>f;)h.x+=(m.x-h.x)*f/g,h.y+=(m.y-h.y)*f/g,e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),g-=f,e=(e+1)%b.length,f=b[e];g<=f&&(h=new F(k,l),e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),f-=g)}}d+=c.Cc[this.ba[d]]}};
c.prototype.Gn=function(a){for(var b=0,d=0,e=0,f=!1;b<this.ba.length;){switch(this.ba[b]){case c.Tc:d=this.ba[b+1];e=this.ba[b+2];f=!0;break;case c.Sc:a(d,e,this.ba[b+1],this.ba[b+2],f),d=this.ba[b+1],e=this.ba[b+2],f=!1}b+=c.Cc[this.ba[b]]}};c.prototype.Lq=function(){var a=0;this.Gn(function(b,d,e,c){a+=G(b,d,e,c)});return a};c.prototype.Mq=function(a){var b=new c,d=0;this.Gn(function(e,c,g,h,k){if(d<=a){k&&b.moveTo(e,c);k=G(e,c,g,h);if(d+k>=a){var f=a-d;g=e+(g-e)*f/k;h=c+(h-c)*f/k}d+=k;b.lineTo(g,
h)}});return b};c.Tc=0;c.Sc=1;c.Ig=2;c.Ng=3;c.Rc=4;c.Cc=[3,3,7,5,1];c.Hm=[1,1,3,2,0];return c}();function xc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var g=c[b],h=c[d-1],k=0,l=0;for(f=b+1;f<d;f++){var m=c[f].ti(g,h);m>k&&(k=m,l=f)}0<l&&k>a?(xc(c,a,b,l,e),xc(c,a,l,d,e)):e.push(g)}}function yc(c,a){var b=[];xc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].Jd(b[b.length-1])&&b.push(c[c.length-1]);return b}
var zc=function(){function c(){this.oa=[];if(1===arguments.length){var a=arguments[0];if(a instanceof K)this.oa.push(new F(a.x,a.y)),this.oa.push(new F(a.right(),a.y)),this.oa.push(new F(a.right(),a.bottom())),this.oa.push(new F(a.x,a.bottom()));else if(a instanceof Array)this.oa=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.transform=function(a){for(var b=0;b<this.oa.length;b++)this.oa[b]=a.apply(this.oa[b].x,this.oa[b].y)};c.prototype.add=function(a,
b){this.oa.push(new F(a,b))};c.prototype.Wc=function(a,b,d){void 0===d&&(d=0);return tc(this.oa,a,b)||d&&wc(this.oa,a,b,d)};c.prototype.qn=function(){return K.Me(this.oa)};c.prototype.clone=function(){return new c(this.oa.slice(0))};c.prototype.Jd=function(a){if(this.oa.length!==a.oa.length)return!1;for(var b=0;b<this.oa.length;b++){var d=this.oa[b],e=a.oa[b];if(d.x!==e.x||d.y!==e.y)return!1}return!0};c.prototype.xc=function(a){for(var b=[],d=0;d<this.oa.length;d++){var e=this.oa[0===d?this.oa.length-
1:d-1],c=this.oa[d],g=this.oa[d===this.oa.length-1?0:d+1],h=G(e.x,e.y,c.x,c.y),k=G(g.x,g.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/h+(c.x-g.x)/k)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/h+(c.y-g.y)/k)/Math.sqrt(2)*a})}this.oa=b};c.prototype.ja=function(a){if(!(1>this.oa.length)){a.moveTo(this.oa[0].x,this.oa[0].y);for(var b=1;b<this.oa.length;b++)a.lineTo(this.oa[b].x,this.oa[b].y);a.closePath()}};c.prototype.Vd=function(){return this.oa};c.Gv=function(a,b){for(var d=0,e=0,c=!1,g=[],h=[],k=0;k<b.length;k++)h.push(0);
for(;;){var l=0,m=-1;for(k=0;k<b.length;k++)if(h[k]<b[k].length){var n=b[k][h[k]];if(0===k||n<l){l=n;m=k;var r=1-h[k]%2}}if(-1===m)return g;h[m]+=1;"intersection"===a?r?(e+=1,e===b.length&&(d=l)):(e===b.length&&(g.push(d),g.push(l)),--e):r?(e+=1,0===m?(c=!0,1===e)&&(d=l):c&&2===e&&(g.push(d),g.push(l))):(c&&1===e&&(g.push(d),g.push(l)),--e,0===m&&(c=!1),c&&1===e&&(d=l))}};return c}();
function Ac(c,a,b,d,e,f,g,h){b-=c;d-=a;g-=e;h-=f;var k=-g*d+b*h;if(0===k)return null;e=(g*(a-f)-h*(c-e))/k;return new F(c+e*b,a+e*d)}
function Bc(c,a){function b(a){var b,e;var c=[];var k=b=0;for(e=a.length;k<e;k++){var l=a[k];a[b+1]&&(c[b]=d(l,a[b+1]));b+=1}return c}function d(a,b){return new F(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Bc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var k=b=0;for(e=a.length;k<e;k++){var l=a[k];c[2*b]=l;a[b+1]&&(c[2*b+1]=d(l,a[b+1]));b+=1}return c}(c))),a-1):c}
function Cc(c,a){var b;void 0===b&&(b=null);var d=a.match(/[A-Z]|[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/gi),e=0,f=0,g,h=0,k=0,l=[];if(d)for(g=0;g<d.length;g++){var m=d[g++];var n=d;for(l.length=0;g<n.length;g++){var r=parseFloat(n[g]);if(isNaN(r)){g--;break}else l.push(r)}if("M"===m){c.moveTo(l[0],l[1]);for(m=2;m<l.length;m+=2)c.lineTo(l[m],l[m+1]);e=l[l.length-2];f=l[l.length-1]}else if("m"===m)for(c.moveTo(l[0]+e,l[1]+f),e=l[0]+e,f=l[1]+f,m=2;m<l.length;m+=2)c.lineTo(l[m]+e,l[m+1]+f),e=l[m]+e,f=
l[m+1]+f;else if("L"===m){for(m=0;m<l.length;m+=2)c.lineTo(l[m],l[m+1]);e=l[l.length-2];f=l[l.length-1]}else if("l"===m)for(m=0;m<l.length;m+=2)c.lineTo(l[m]+e,l[m+1]+f),e=l[m]+e,f=l[m+1]+f;else if("H"===m)for(m=0;m<l.length;m+=1)c.lineTo(l[m],f),e=l[m];else if("h"===m)for(m=0;m<l.length;m+=1)c.lineTo(l[m]+e,f),e=l[m]+e;else if("V"===m)for(m=0;m<l.length;m+=1)c.lineTo(e,l[m]),f=l[m];else if("v"===m)for(m=0;m<l.length;m+=1)c.lineTo(e,l[m]+f),f=l[m]+f;else if("C"===m)for(m=0;m<l.length;m+=6)c.bezierCurveTo(l[m],
l[m+1],l[m+2],l[m+3],l[m+4],l[m+5]),h=l[m+2],k=l[m+3],e=l[m+4],f=l[m+5];else if("c"===m)for(m=0;m<l.length;m+=6)c.bezierCurveTo(l[m]+e,l[m+1]+f,l[m+2]+e,l[m+3]+f,l[m+4]+e,l[m+5]+f),h=l[m+2]+e,k=l[m+3]+f,e=l[m+4]+e,f=l[m+5]+f;else if("S"===m)for(m=0;m<l.length;m+=4)h=e+e-h,k=f+f-k,c.bezierCurveTo(h,k,l[m],l[m+1],l[m+2],l[m+3]),h=l[m],k=l[m+1],e=l[m+2],f=l[m+3];else if("s"===m)for(m=0;m<l.length;m+=4)h=e+e-h,k=f+f-k,c.bezierCurveTo(h,k,l[m]+e,l[m+1]+f,l[m+2]+e,l[m+3]+f),h=l[m]+e,k=l[m+1]+f,e=l[m+2]+
e,f=l[m+3]+f;else"z"===m||"Z"===m?c.closePath():b?b(m,l):mc("Unknown command: %s",m)}}
var Dc=function(){function c(){this.items=[];this.sa=new O}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){var d=this.sa.apply(a,b);this.items.push("M",d.x,d.y)};c.prototype.lineTo=function(a,b){var d=this.sa.apply(a,b);this.items.push("L",d.x,d.y)};c.prototype.transform=function(a,b,
d,e,c,g){a=new O(a,d,b,e,c,g);this.sa=this.sa.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,g){a=this.sa.apply(a,b);d=this.sa.apply(d,e);c=this.sa.apply(c,g);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c}();
function Ec(c,a,b,d,e,f){if(!(2>a.length)){void 0===e&&(e=!0);void 0===f&&(f=!0);var g=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,h=[],k=[],l=new F(0,0),m=l,n=l,r=l,q=l,v=[],y=b/2,z;for(z=1;z<a.length;z++){n=a[z-1];q=a[z];r=I(n.x,n.y,q.x,q.y);l=new F(r.y,-r.x);"middle"===d?(m=new F(n.x-r.x*y-l.x*y,n.y-r.y*y-l.y*y),n=new F(n.x-r.x*y+l.x*y,n.y-r.y*y+l.y*y)):"outside"===d?m=new F(n.x-l.x*b,n.y-l.y*b):(m=n,n=new F(n.x+l.x*b,n.y+l.y*b));if(k.length){var w=k[k.length-1];var E=v[v.length-1];m=Ac(w.x,
w.y,w.x+E.x,w.y+E.y,m.x,m.y,m.x+r.x,m.y+r.y)||m;w=h[h.length-1];n=Ac(w.x,w.y,w.x+E.x,w.y+E.y,n.x,n.y,n.x+r.x,n.y+r.y)||n}k.push(m);h.push(n);v.push(r)}g?(w=k[0],E=v[0],m=Ac(w.x,w.y,w.x+E.x,w.y+E.y,m.x,m.y,m.x+r.x,m.y+r.y)||m,w=h[0],n=Ac(w.x,w.y,w.x+E.x,w.y+E.y,n.x,n.y,n.x+r.x,n.y+r.y)||n,k[0].x=m.x,k[0].y=m.y,h[0].x=n.x,h[0].y=n.y,k.push(m),h.push(n)):"middle"===d?(k.push(new F(q.x+r.x*y-l.x*y,q.y+r.y*y-l.y*y)),h.push(new F(q.x+r.x*y+l.x*y,q.y+r.y*y+l.y*y))):"outside"===d?(k.push(new F(q.x-l.x*b,
q.y-l.y*b)),h.push(q)):(k.push(q),h.push(new F(q.x+l.x*b,q.y+l.y*b)));if(f){c.moveTo(k[0].x,k[0].y);for(z=1;z<k.length;z++)c.lineTo(k[z].x,k[z].y);g&&(c.closePath(),c.moveTo(h[h.length-1].x,h[h.length-1].y))}else e&&c.moveTo(h[h.length-1].x,h[h.length-1].y);if(e){for(z=h.length-1;0<=z;z--)c.lineTo(h[z].x,h[z].y);!g&&f&&c.lineTo(k[0].x,k[0].y)}}};var Fc=function(){function c(a,b,d,e){this.view=a;this.xf=b;this.Da=this.Ca=0;this.Na=!1;this.log=B.create("SELECT");this.Ro(d,e)}c.prototype.xb=function(a){if("touchmove"===a.type){var b=this.view.jc(a.changedTouches[0]);this.Ua(b.x,b.y,a)}else"touchend"===a.type&&(b=this.view.jc(a.changedTouches[0]),this.ab(b.x,b.y,a));return!0};c.prototype.$a=function(a){this.log("Gesture detected; aborting select box.");this.view.Qa(this.xf);return this.xf.$a?this.xf.$a(a):!1};c.prototype.Ta=function(a,b){return this.Ro(a,
b)};c.prototype.Ro=function(a,b){this.Ca=a;this.Da=b;return this.Na=!0};c.prototype.Ua=function(a,b){if(this.Na){var d=this;this.view.ja(function(e){e.save();e.strokeStyle="#0050B7";e.lineWidth=2/d.view.scale;e.fillStyle="rgba(0, 80, 183, 0.2)";var c=new K(d.Ca+.5,d.Da+.5,a-d.Ca,b-d.Da);e.fillRect(c.x,c.y,c.width,c.height);e.strokeRect(c.x,c.y,c.width,c.height);e.restore()});return!0}return!1};c.prototype.ab=function(a,b){this.Na=!1;this.view.sb();this.view.iu(new K(this.Ca,this.Da,a-this.Ca,b-this.Da));
this.view.Tb();this.view.ja();this.view.Qa(this.xf);return!0};return c}();var Gc=B.create("FitCurve");
function Hc(c){function a(a,b){E.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);Gc("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}function g(a){return a.x*a.x+a.y*a.y}function h(a,b){var d=Math.sqrt(g(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function k(a,b,d){void 0===
d&&Gc("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function l(a,b){return{x:a.x+b.x,y:a.y+b.y}}function m(a,b){return{x:a.x*b,y:a.y*b}}function n(a,b){return{x:a.x-b.x,y:a.y-b.y}}function r(a,c,g,q,y,r){var v,z=[],w=[[],[]],H=[];var J=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var E=g-c+1;for(v=0;v<E;v++){var T={x:y.x,y:y.y};var W={x:r.x,y:r.y};h(T,d(q[v]));h(W,e(q[v]));z[v]=[T,W]}w[0][0]=0;w[0][1]=0;w[1][0]=0;w[1][1]=0;H[0]=0;for(v=H[1]=0;v<E;v++)w[0][0]+=b(z[v][0],z[v][0]),w[0][1]+=b(z[v][0],z[v][1]),
w[1][0]=w[0][1],w[1][1]+=b(z[v][1],z[v][1]),T=1-q[v],W=q[v],T=n(a[c+v],l(m(a[c],T*T*T),l(m(a[c],d(q[v])),l(m(a[g],e(q[v])),m(a[g],W*W*W))))),H[0]+=b(z[v][0],T),H[1]+=b(z[v][1],T);q=w[0][0]*w[1][1]-w[1][0]*w[0][1];v=w[0][0]*H[1]-w[0][1]*H[0];H=H[0]*w[1][1]-H[1]*w[0][1];0===q&&(q=w[0][0]*w[1][1]*1E-11);w=H/q;H=v/q;if(0>w||0>H)return w=f(a[g],a[c])/3,J[0]=a[c],J[3]=a[g],k(J[0],h(y,w),J[1]),k(J[3],h(r,w),J[2]),J;J[0]=a[c];J[3]=a[g];k(J[0],h(y,w),J[1]);k(J[3],h(r,H),J[2]);return J}function q(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function v(a){var b=Math.sqrt(Math.sqrt(g(a)));0!==b&&(a.x/=b,a.y/=b);return a}function y(a,b,d,e,c){var f,h=(d-b+1)/2;var k=0;for(f=b+1;f<d;f++){var l=q(3,e,c[f-b]);l=n(l,a[f]);l=g(l);l>=k&&(k=l,h=f)}return{Io:k,Fp:h}}function z(b,d,e,c,g,l){var m;var E=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var J=l*l;if(2===e-d+1)l=f(b[e],b[d])/3,E[0]=
b[d],E[3]=b[e],k(E[0],h(c,l),E[1]),k(E[3],h(g,l),E[2]),a(3,E);else{var H=[0];for(m=d+1;m<=e;m++)H[m-d]=H[m-d-1]+f(b[m],b[m-1]);for(m=d+1;m<=e;m++)H[m-d]/=H[e-d];var T=H;E=r(b,d,e,T,c,g);m=y(b,d,e,E,T);H=m.Io;m=m.Fp;if(H<l)a(3,E);else{if(H<J||w)for(J=0;4>J;J++){m=b;H=d;var W=e;var Pd=E;var qc=[];for(E=H;E<=W;E++){var Qd=qc,Rd=E-H,L,Ja=Pd,Za=m[E],$a=T[E-H],sa=[];var xa=[];var ab=q(3,Ja,$a);for(L=0;2>=L;L++)sa[L]={x:0,y:0},sa[L].x=3*(Ja[L+1].x-Ja[L].x),sa[L].y=3*(Ja[L+1].y-Ja[L].y);for(L=0;1>=L;L++)xa[L]=
{x:0,y:0},xa[L].x=2*(sa[L+1].x-sa[L].x),xa[L].y=2*(sa[L+1].y-sa[L].y);L=q(2,sa,$a);xa=q(1,xa,$a);Qd[Rd]=$a-((ab.x-Za.x)*L.x+(ab.y-Za.y)*L.y)/(L.x*L.x+L.y*L.y+(ab.x-Za.x)*xa.x+(ab.y-Za.y)*xa.y)}W=qc;E=r(b,d,e,W,c,g);m=y(b,d,e,E,W);H=m.Io;m=m.Fp;if(H<l||w){a(3,E);return}T=W}W={x:0,y:0};J=n(b[m-1],b[m]);H=n(b[m],b[m+1]);W.x=(J.x+H.x)/2;W.y=(J.y+H.y)/2;J=W=v(W);z(b,d,m,c,J,l);J.x=-J.x;J.y=-J.y;z(b,m,e,J,g,l)}}}var w=!0;void 0===w&&(w=!1);var E=new Q;E.moveTo(c[0].x,c[0].y);(function(a,b,d){var e=n(a[1],
a[0]);e=v(e);var c=b-1;c=n(a[c-1],a[c]);c=v(c);z(a,0,b-1,e,c,d)})(c,c.length,25);return E};var Ic=function(){function c(a){this.view=a;this.start=new F(0,0);this.Wl=new F(0,0);this.active=!1;this.rect=null;this.log=B.create("PanZoomMixin")}c.prototype.$a=function(a){this.log("onGesture(%s)",a.type);if(!this.view.da.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new F(a.pageX,a.pageY),this.Wl=this.view.gb(a.pageX,a.pageY),this.rect=this.view.se(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.da.Bl(1/
a.scale);a=new P(a,a,this.Wl.x,this.Wl.y);a=(new M(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.Kh(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var Jc=function(){function c(a){this.view=a;this.state="none";this.start=new F(0,0);this.Hp=this.Gp=0;this.log=B.create("PanTool");this.gc=new Ic(a)}c.prototype.uc=function(){this.log("Entering PanToolBehaviour");this.view.canvas.style.cursor="all-scroll"};c.prototype.Jc=function(){this.log("Leaving PanToolBehaviour")};c.prototype.$a=function(a){return this.gc.$a(a)};c.prototype.xb=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.gb(b.pageX,b.pageY);return this.Ta(b.x,b.y,
a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.Ua(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.ab(b.x,b.y,a)):!0};c.prototype.bo=function(a){switch(a.type){case "touchend":case "touchstart":case "touchmove":return new F(a.changedTouches[0].pageX,a.changedTouches[0].pageY);case "mousedown":case "mouseup":case "mousemove":case "pointerdown":case "pointermove":case "pointerup":return new F(a.pageX,a.pageY);default:return this.log("Can't handle event: %s",
a.type),new F(0,0)}};c.prototype.Ta=function(a,b,d){this.log("onMouseDown type %s",d.type);this.state="dragging";this.start=this.bo(d);this.Gp=this.view.tb;this.Hp=this.view.hb;return!0};c.prototype.Ua=function(a,b,d){if("dragging"!==this.state)return!1;a=this.bo(d);b=this.Hp+a.y-this.start.y;this.view.tb=this.Gp+a.x-this.start.x;this.view.hb=b;this.view.mc();this.view.ja();return!0};c.prototype.ab=function(){this.state="none";return!0};c.prototype.pl=function(a,b,d,e){if(!this.view.da.get("allowZoom"))return this.log("Zooming is disabled."),
!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);d=0<d?1/1.1:1.1;a=new P(d,d,a,b);b=this.view.se();b.transform(a);this.view.Kh(b);e.stopPropagation();e.preventDefault();return!0};c.prototype.ec=function(a){"cancel"===a&&this.view.Xa()};return c}();var Kc=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.Md=d;b.Ui=!0;b.width=32;b.height=500;b.dw=0;b.Kb=new K(0,0,0,0);b.Na=!1;b.Eq="#c0c0c0";b.pn="#808080";b.borderWidth=1;b.he=0;b.ge=100;b.pm=10;b.position=5;b.offset=0;b.log=B.create("SCROLLBAR",!0);b.Ui=!0;b.canvas=Pb(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.ka=b.canvas.getContext("2d");C(b.canvas).bind("click",function(a){b.qc(a)});C(b.canvas).bind("mousedown",function(a){b.Ta(a)});e.bind(C(document.body),
"mousemove",function(a){b.Ua(a)});e.bind(C(document.body),"mouseup",function(a){b.ab(a)});C(b.canvas).bind("touchstart",function(a){b.xb(a)});e.bind(C(document.body),"touchmove",function(a){b.xb(a)});e.bind(C(document.body),"touchend",function(a){b.xb(a)});b.format();return b}p(a,c);a.prototype.Zj=function(a){a.appendChild(this.canvas)};a.prototype.moveTo=function(a,d){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.Fe=function(a,d){this.width=a;this.height=d;this.canvas.width=
this.width;this.canvas.height=d;this.format();this.ja()};a.prototype.Za=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.Ws=function(){return"block"===this.canvas.style.display};a.prototype.Ap=function(a,d,e,c){this.he=a;this.ge=d-a;this.pm=e;this.position=c;this.format();this.ja()};a.prototype.format=function(){var a=this.Md?this.width:this.height;var d=this.pm/this.ge*a;a*=(this.position-this.he)/this.ge;this.Kb=this.Md?new K(a,
0,d-1,this.height-1):new K(0,a,this.width-1,d-1);this.Kb.x=Math.round(this.Kb.x)+.5;this.Kb.y=Math.round(this.Kb.y)+.5;this.Kb.width=Math.round(this.Kb.width);this.Kb.height=Math.round(this.Kb.height)};a.prototype.ja=function(){this.ka.beginPath();this.ka.fillStyle=this.Eq;this.ka.strokeStyle=this.pn;this.ka.lineWidth=this.borderWidth;this.ka.rect(this.borderWidth/2,this.borderWidth/2,this.width-this.borderWidth,this.height-this.borderWidth);this.ka.fill();this.ka.stroke();this.ka.beginPath();this.ka.fillStyle=
this.pn;this.ka.strokeStyle="#000000";this.ka.rect(this.Kb.x,this.Kb.y,this.Kb.width,this.Kb.height);this.ka.fill();this.ka.stroke()};a.prototype.Ln=function(a){var b=C(this.canvas).offset(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===a.type)e=a.pageX,c=a.pageY;return new F(e-b.left,c-b.top)};a.prototype.xb=function(a){switch(a.type){case "touchstart":this.Ta(a);
break;case "touchend":this.ab(a);break;case "touchmove":this.Ua(a)}};a.prototype.qc=function(){};a.prototype.bp=function(a){a=this.Md?a.x/this.width*this.ge+this.he:a.y/this.height*this.ge+this.he;a=Math.min(a,this.ge-this.pm+this.he);return a=Math.max(a,this.he)};a.prototype.Ta=function(a){a.preventDefault();a=this.Ln(a);this.Kb.Wc(a.x,a.y)?this.Md?(this.offset=a.x-this.Kb.x,a.x-=this.offset):(this.offset=a.y-this.Kb.y,a.y-=this.offset):(this.position=this.bp(a),this.offset=0,this.Md?this.Kb.x=(this.position-
this.he)/this.ge*this.width:this.Kb.y=(this.position-this.he)/this.ge*this.height,this.ta("scroll",this.position),this.ja());this.Na=!0};a.prototype.Ua=function(a){this.Na&&(this.Na&&"mousemove"===a.type&&0===a.buttons?this.Na=!1:(a.preventDefault(),a=this.Ln(a),this.Md?a.x-=this.offset:a.y-=this.offset,this.position=this.bp(a),this.ta("scroll",this.position),this.format(),this.ja()))};a.prototype.ab=function(){this.Na&&(this.Na=!1)};a.prototype.Hi=function(){return this.Md?this.height:this.width};
a.Nv=0;a.Kv=1;a.Fv=2;a.Mv=3;return a}(xb);function Lc(c,a,b,d,e,f){var g=!1;c.save();switch(b){case 0:case 3:var h=a.height;var k=a.width;break;default:h=a.width,k=a.height}switch(b){case 2:g=!0}c.translate(a.x,a.y);c.fillStyle="rgba(0, 0, 0, 0.2)";c.fillStyle="#ccc";c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle="black";c.strokeStyle="black";c.font="10px sans-serif";a=Math.ceil(50/e);b=f/e;var l=Math.ceil(b/a)*a;f=l;c.beginPath();if(g)for(b=(l-b)*e;b<k;)c.moveTo(0,b),c.lineTo(h,b),g=f.toString()+d,c.fillText(g,0,b+1+10),f+=a,
b+=e*a;else for(b=(l-b)*e;b<k;)c.moveTo(b,h),c.lineTo(b,0),g=f.toString()+d,c.fillText(g,b+1,10),f+=a,b+=e*a;c.stroke();c.restore()};var Mc=function(){function c(a){this.zc=a;this.ji=[];this.Al=!0;this.log=B.create("cloudAddon");this.Sd=a.la("cloudRadius")}c.prototype.format=function(){var a=this.zc.bd.Vd();this.log("Format cloud; %s points",a.length);this.ji=this.Yq(a,this.Sd)};c.prototype.Yq=function(a,b){var d=[],e=5/6*b*2,c,g=a[a.length-1];for(c=0;c<a.length;c++){var h=a[c];var k=h.x-g.x,l=h.y-g.y,m=Math.sqrt(k*k+l*l);k/=m;l/=m;var n=m/e+.5|0;1>n&&(n=1);n=m/n;for(var r=0;r+.1*n<m;r+=n)d.push({x:g.x+r*k,y:g.y+r*l,mn:0,end:0});
g=h}h=d[d.length-1];for(c=0;c<d.length;c++)e=d[c],k=e.x-h.x,l=e.y-h.y,g=.5*Math.sqrt(k*k+l*l)/b,-1>g&&(g=-1),1<g&&(g=1),k=Math.atan2(l,k),g=Math.acos(g),g=[k-g,Math.PI+k+g],h.end=g[0],e.mn=g[1],h=e;return d};c.prototype.ja=function(a){this.log("Drawing cloud with %s circles",this.ji.length);var b=15*Math.PI/180,d=this.Sd;a.beginPath();for(var e=0;e<this.ji.length;e++){var c=this.ji[e];a.arc(c.x,c.y,d,c.mn,c.end+b)}a.stroke()};return c}();var R=function(){function c(a,b){this.id=a;this.ha=b;this.parent=null;this.aa={};this.rect=new K(0,0,1,1);this.ai=!1;this.cb=new K(0,0,1,1);this.order=0;this.page=null;this.hc=0;this.log=B.create("BaseNode");this.aa.matrix=new O;this.aa.layer="default";this.ak(c.va)}c.Vc=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.ak=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.aa[b]=a[b])};c.prototype.clip=function(){};c.prototype.toString=
function(){return this.type()+":"+this.id};c.prototype.hg=function(){return!1};c.prototype.sd=function(){return null};c.prototype.wi=function(){};c.prototype.uo=function(){return!1};c.prototype.Li=function(){return"text"in this.aa};c.prototype.On=function(a,b){var d=typeof this.aa[a],e=typeof b;d!==e&&"string"===e&&"number"===d&&(this.log("Convert property %s to a number.",a),b=parseFloat(b));return b};c.prototype.clone=function(a){a=c.create(this.type(),a(),this.ha);a.Ib(this.vc());return a};c.prototype.vc=
function(){var a={},b;for(b in this.aa)this.aa.hasOwnProperty(b)&&(a[b]=this.la(b));return a};c.prototype.Ib=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b])};c.prototype.Kd=function(){var a=this.la("layer");return a?""+a:"default"};c.prototype.wo=function(){return void 0!==this.children};c.prototype.Vk=function(){return null!==this.parent&&null!==this.parent.parent&&"PageNode"!==this.parent.type()};c.prototype.type=function(){return"BaseNode"};c.prototype.Ga=function(){return this.aa.matrix};
c.prototype.oe=function(){return this.aa.matrix.inverse()};c.prototype.zg=function(a){this.aa.matrix=a};c.prototype.setProperty=function(a,b){b=this.On(a,b);if(a in this.aa||"customData"===a||"tag"===a||"locked"===a||"lockSize"===a||"lockRotation"===a||"lockPosition"===a||"lockEditMode"===a||"rotationHandles"===a||"lockAspectRatio"===a||"zIndex"===a||"wallAffinity"===a||"snap"===a||"opacity"===a)pa(b)&&(b=b.slice(0)),"opacity"===a&&(b=parseFloat(b)),this.aa[a]=b};c.prototype.la=function(a){a=this.aa[a];
a instanceof Array&&(a=a.slice(0));return a};c.prototype.Qk=function(){return[]};c.prototype.Fk=function(){var a=new zc(this.cb);a.transform(this.Ga());return a};c.prototype.gg=function(){return this.la("zIndex")||0};c.prototype.transform=function(a){this.zg(a.multiply(this.Ga()))};c.prototype.format=function(){};c.prototype.lb=function(a,b){var d=this.oe().apply(a,b);return this.hidden()||this.la("locked")||!this.cb.Wc(d.x,d.y)?null:this};c.prototype.Ce=function(a){this.ai=a};c.prototype.hidden=
function(){return this.ai};c.prototype.Ag=function(){};c.prototype.ol=function(){};c.prototype.ql=function(){};c.prototype.ug=function(a){if(a.ug){var b={"zwibbler:id":""+this.id};if("tag"in this.aa){var d=this.aa.tag;"string"!==typeof d&&(d=JSON.stringify(d));b["zwibbler:tag"]=d}a.ug(b)}};c.prototype.tg=function(a){a.tg&&a.tg()};c.prototype.ja=function(a){a.save();this.ug(a);var b=this.aa.matrix;a.transform(b.m11,b.m21,b.m12,b.m22,b.Ca,b.Da);"erase"===this.aa.strokeStyle?a.Qf?a.strokeStyle=a.Qf:
(a.strokeStyle="#000000",a.globalCompositeOperation="destination-out"):a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);this.Oe(a);this.tg(a);a.restore();c.zm&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())};
c.prototype.Oe=function(){};c.prototype.resolve=function(){return!1};c.prototype.Sr=function(a,b,d){this.eh||(this.eh={});var e=this.eh.insideFill;if(!e||e.Pp!==d){e&&d===e.Pp||(e={Pp:d,value:d},this.eh.insideFill=e);d=/url\(([^\)]+)\)/.exec(d);var c;d&&(c=d[1]);var g=this;c&&(e.value="rgba(0, 0, 0, 0.2)",b.add(this.id,"image",c,null,function(d){g.log("Got image response.");e.value=a.createPattern(d,"repeat");b.ta("reformat",g)}))}};c.prototype.ms=function(){if(this.eh){var a=this.eh.insideFill;if(a)return a.value}return"magenta"};
c.prototype.dg=function(){return""};c.prototype.we=function(){};c.prototype.kh=function(){return null};c.prototype.ne=function(){return null};c.prototype.ff=function(){return this.parent?this.parent.Ck(this):-1};c.va={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};c.zm=!1;c.types={};return c}();var Nc=function(){function c(){this.text="";this.font="10px Arial";this.Qn="Arial";this.fontSize=10;this.lines=[];this.om="top";this.mh="left";this.yo=this.bold=!1;this.textDecoration="";this.log=B.create("TextBox");this.rect=new K(0,0,0,this.fontSize)}c.prototype.vu=function(a,b,d,e,c){this.Qn=a;this.fontSize=b;this.bold=d;this.yo=e;this.textDecoration=c};c.prototype.Bp=function(a){this.text=a};c.prototype.op=function(a,b){switch(a){case "left":case "center":case "right":this.mh=a;break;case null:break;
default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.om=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.Qn+'"';this.bold&&(this.font="bold "+this.font);this.yo&&(this.font="italic "+this.font);this.lines.length=0;var e;a.font=this.font;var c=0;this.rect.width=0;if(0===b){var g=this.text.split("\n");for(e=0;e<g.length;e++){var h=g[e];var k=a.measureText(h).width;
c+=this.fontSize;this.lines.push({x:0,y:c,width:k,text:h});this.rect.width=Math.max(this.rect.width,k)}}else{h=g=0;var l=!1;for(e=0;e<this.text.length;e++){var m=this.text.charAt(e);k=a.measureText(this.text.substr(g,e-g+1)).width;"\n"===m?l=!0:k>b?h?(e=h,l=!0):e>g&&(--e,l=!0):" "===m&&(h=e);l&&(k=" "===this.text.charAt(e)?a.measureText(this.text.substr(g,e-g)).width:a.measureText(this.text.substr(g,e-g+1)).width,c+=this.fontSize,this.lines.push({x:0,y:c,width:k,text:this.text.substr(g,e-g+1)}),g=
e+1,h=0,l=!1,this.rect.width=Math.max(this.rect.width,k))}k&&(c+=this.fontSize,this.lines.push({x:0,y:c,width:k,text:this.text.substr(g,e-g)}),this.rect.width=Math.max(this.rect.width,k))}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("center"===this.mh)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.mh)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"center"===this.mh?this.rect.x=b/2-this.rect.width/2:b&&"right"===
this.mh&&(this.rect.x=b-this.rect.width);d&&"middle"===this.om?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.om&&(this.rect.y=d-this.rect.height)};c.prototype.ja=function(a,b,d){this.fillText(a,b,d);this.En(a,b,d)};c.prototype.En=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var g=this.lines[e];a.moveTo(g.x+b,g.y+d+c);a.lineTo(g.x+b+g.width,g.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();
a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)g=this.lines[e],a.moveTo(g.x+b,g.y+d+c),a.lineTo(g.x+b+g.width,g.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,
b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var Oc=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.nb=new Nc;e.Rk=0;e.border={lineWidth:0,Ye:"#000000"};e.log=B.create("TEXT",!0);e.ak(a.hq);e.aa.text="lorum ipsum dolor";return e}p(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.setProperty=function(a,d){this.aa[a]=this.On(a,d);"textFillStyle"===a?this.aa.fillStyle=d:"fillStyle"===a&&(this.aa.textFillStyle=d)};a.prototype.format=function(a){this.nb.vu(this.aa.fontName,this.aa.fontSize,this.aa.bold,this.aa.italic,this.aa.textDecoration);
var b=this.aa.text;b.length&&10===b.charCodeAt(b.length-1)&&(b=b.substr(0,b.length-1));this.nb.Bp(b);var e=this.aa.matrix;b=e.apply(0,0);e=e.apply(1,0);b=b.Pa(e);e=this.la("wrap");var c=!1!==this.la("scaleFont");this.nb.op(this.aa.textAlign,"top");e?(e=this.aa.baseWidth,void 0===e&&(this.nb.format(a,0,0),e=Math.max(this.nb.rect.width,10),500<e&&(e=500),this.aa.baseWidth=e,this.log("Formatting text for first time; baseWidth=%s",e)),b=Math.ceil(b*e),this.nb.format(a,b,0),a=this.nb.rect.height,this.cb=
new K(0,0,e,a)):c?(this.nb.format(a,0,0),b=this.nb.rect.width,a=this.nb.rect.height,this.cb=new K(0,-(0+this.la("fontSize")),b,a)):(this.nb.format(a,0,0),b=this.nb.rect.width,a=this.nb.rect.height,this.cb=new K(0,0,b,a));a=new zc(this.cb);a.transform(this.Ga());this.rect=a.qn();this.Rk=this.rect.height;this.rect.height+=1.3*this.aa.fontSize;a=this.la("lineWidth")+0;this.rect.xc(a,a);this.border=this.aa.border?this.Mt(this.aa.border):{lineWidth:0,Ye:"#000000"}};a.prototype.Mt=function(a){var b={lineWidth:0,
Ye:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=A.Ek(a[e]))b.Ye=c.toString()}else b.lineWidth=c}return b};a.prototype.Ga=function(){return!1===this.la("scaleFont")?c.prototype.Ga.call(this).Np():c.prototype.Ga.call(this)};a.prototype.ja=function(a){if(0!==this.aa.text.length){a.save();this.ug(a);this.la("wrap")?this.Ga().Np().Th(a):this.Ga().Th(a);"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);var b=this.aa.background;if(b||this.border.lineWidth)a.save(),
b&&(a.fillStyle=b,a.fillRect(this.cb.x,this.cb.y,this.cb.width,this.cb.height)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.Ye,a.lineWidth=this.border.lineWidth,a.rect(this.cb.x,this.cb.y,this.cb.width,this.cb.height),a.stroke()),a.restore();a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;b=0;this.aa.wrap||!1===this.la("scaleFont")||(b=-(0+this.la("fontSize")));var e=this.Ga().fg();e=this.cb.height*e.y;switch(this.aa.verticalAlign){case "bottom":b+=
e-this.nb.rect.height;break;case "middle":b+=(e-this.nb.rect.height)/2}this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");0<this.aa.lineWidth&&this.nb.strokeText(a,0,b);this.nb.fillText(a,0,b);this.nb.En(a,0,b);this.tg(a);a.restore();R.zm&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())}};a.hq={textFillStyle:"#000000",fontName:"Arial",fontSize:20,
lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};return a}(R);R.Vc("TextNode",Oc);var Pc=function(){function c(a,b){this.qa=a;this.fa=b;this.Ou=!0;this.log=B.create("MoveSegment")}c.prototype.ja=function(a){a.moveTo(this.fa.x,this.fa.y)};c.prototype.Ud=function(){return this.tc()};c.prototype.tc=function(){return{x:1,y:0}};return c}(),Qc=function(){function c(a,b,d,e,c){this.qa=a;this.fa=b;this.Sl=e;this.Td=c;this.log=B.create("LineSegment");this.Af=0;this.Ba=new F(0,0);this.Ja=new F(0,0);this.length=0;this.from=new F(0,0);this.fa=b;this.qa=a;this.Td=c;this.Sl=e;d.next();this.aj=
d.next();this.bj=d.next();this.moveTo=this.Bf=null;this.format()}c.prototype.format=function(){var a=G(this.qa.fa.x,this.qa.fa.y,this.fa.x,this.fa.y);this.Af=this.length=a;var b=this.qa.fa.clone();this.qa instanceof c&&this.Td&&(this.Td=Math.min(this.Td,a/2,this.qa.length/2),a=I(this.qa.fa.x,this.qa.fa.y,this.fa.x,this.fa.y),b.x+=a.x*this.Td,b.y+=a.y*this.Td,this.qa.Gu(this.Td),this.Af-=this.Td);this.from=b;null===this.Bf&&(this.Bf=this.fa);a=this.Af/10*this.Sl;10<a&&(a=10);var d=b.x,e=b.y,f=this.fa.x,
g=this.fa.y;d+=a;e+=a;this.Ba=new F(d+this.aj*(f+a-d),e+this.aj*(g+a-e));d=b.x-a;f=this.fa.x-a;e=b.y-a;g=this.fa.y-a;this.Ja=new F(d+this.bj*(f-d),e+this.bj*(g-e))};c.prototype.Gu=function(a){var b=I(this.from.x,this.from.y,this.fa.x,this.fa.y),d=this.fa.clone();d.x-=b.x*a;d.y-=b.y*a;this.Bf=d;this.Af-=a;a=this.Af/10*this.Sl;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,g=d.y;b+=a;e+=a;this.Ba=new F(b+this.aj*(c+a-b),e+this.aj*(g+a-e));this.log("RECALC ctrl1=%s",this.Ba);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;g=d.y-a;this.Ja=new F(b+this.bj*(c-b),e+this.bj*(g-e))};c.prototype.Jh=function(a){this.qa=a;this.format();this.qa instanceof c&&(this.moveTo=this.qa.Bf)};c.prototype.ja=function(a){null!==this.Bf&&(this.Td&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.qa.fa.x,this.qa.fa.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Ba.x,this.Ba.y,this.Ja.x,this.Ja.y,this.Bf.x,this.Bf.y))};c.prototype.Ud=function(){return this.qa?I(this.qa.fa.x,this.qa.fa.y,this.Ba.x,
this.Ba.y):this.tc()};c.prototype.tc=function(){return I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}(),Rc=function(){function c(a,b,d){this.Tl=d;this.fa=b;this.qa=a;this.Tl=d;var e=G(a.fa.x,a.fa.y,b.x,b.y);e||(e=1);var c=(b.x-a.fa.x)/e,g=(b.y-a.fa.y)/e;this.Ja=new F(b.x-e*d*c,b.y-e*d*g);if((b=a.Ja)&&a.qa){var h=I(a.qa.fa.x,a.qa.fa.y,a.fa.x,a.fa.y),k=G(a.qa.fa.x,a.qa.fa.y,a.fa.x,a.fa.y);c=.5*(c+h.x);g=.5*(g+h.y);b.x=a.fa.x-k*d*c;b.y=a.fa.y-k*d*g}this.Ba=new F(a.fa.x+e*d*c,a.fa.y+e*d*g);this.length=
e}c.prototype.Jh=function(a){this.qa=a;var b=a.Ja,d=(this.fa.x-a.fa.x)/this.length,e=(this.fa.y-a.fa.y)/this.length,c=this.Tl;if(b&&a.qa){var g=I(a.qa.fa.x,a.qa.fa.y,a.fa.x,a.fa.y),h=G(a.qa.fa.x,a.qa.fa.y,a.fa.x,a.fa.y);d=.5*(d+g.x);e=.5*(e+g.y);b.x=a.fa.x-h*c*d;b.y=a.fa.y-h*c*e}this.Ba=new F(a.fa.x+this.length*c*d,a.fa.y+this.length*c*e)};c.prototype.ja=function(a){a.bezierCurveTo(this.Ba.x,this.Ba.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.Ud=function(){return this.qa?I(this.qa.fa.x,
this.qa.fa.y,this.Ba.x,this.Ba.y):{x:1,y:0}};c.prototype.tc=function(){return 0<this.Tl?I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y):I(this.qa.fa.x,this.qa.fa.y,this.fa.x,this.fa.y)};return c}(),Sc=function(){function c(a,b,d){this.qa=a;this.control=b;this.fa=d}c.prototype.ja=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.fa.x,this.fa.y)};c.prototype.Ud=function(){return this.qa?I(this.qa.fa.x,this.qa.fa.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.tc=function(){return I(this.control.x,
this.control.y,this.fa.x,this.fa.y)};return c}(),Tc=function(){function c(a,b,d,e){this.qa=a;this.control=b;this.fa=d;this.Sd=e}c.prototype.ja=function(a){a.arcTo(this.control.x,this.control.y,this.fa.x,this.fa.y,this.Sd)};c.prototype.Ud=function(){return{x:1,y:0}};c.prototype.tc=function(){return I(0,0,1,0)};return c}(),Uc=function(){function c(a,b,d,e,c,g,h){this.qa=a;this.Fd=b;this.fa=d;this.Sd=e;this.Vl=c;this.Br=g;this.fr=h}c.prototype.ja=function(a){a.arc(this.Fd.x,this.Fd.y,this.Sd,this.Vl,
this.Br,0!==this.fr)};c.prototype.Ud=function(){return{x:1,y:0}};c.prototype.tc=function(){return I(0,0,1,0)};return c}(),Vc=function(){function c(a,b,d,e){this.Ba=b;this.Ja=d;this.Ba=b;this.Ja=d;this.fa=e;this.qa=a}c.prototype.ja=function(a){a.bezierCurveTo(this.Ba.x,this.Ba.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.Ud=function(){return this.qa?I(this.qa.fa.x,this.qa.fa.y,this.Ba.x,this.Ba.y):{x:1,y:0}};c.prototype.tc=function(){return I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}(),
Wc=function(){function c(a,b,d,e){this.qa=a;this.Ba=b;this.Ja=d;this.fa=e}c.prototype.ja=function(a){if(this.qa){var b=[];this.qa.Ja&&b.push(this.qa.Ja);this.Ba&&b.push(this.Ba);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.fa.x,this.fa.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,this.fa.x,this.fa.y)}};c.prototype.Jh=function(a){this.qa=a};c.prototype.Ud=function(){return this.qa&&this.qa.Ja?I(this.qa.fa.x,this.qa.fa.y,this.Ba.x,this.Ba.y):{x:1,y:0}};c.prototype.tc=function(){return this.Ba?
I(this.Ba.x,this.Ba.y,this.fa.x,this.fa.y):{x:1,y:0}};return c}(),Xc=function(){function c(a,b,d,e,c){this.qa=a;this.Wg=b;this.fa=d;this.log=B.create("SEGMENT");this.qa=a;this.Wg=b;c*=2;var f=2*e.next()-1;e.next();e=this.qa.tc();if(!this.qa.Ou&&e){var h=G(a.fa.x,a.fa.y,b.x,b.y);this.Ba=new F(a.fa.x+.5522847498*e.x*h,a.fa.y+.5522847498*e.y*h)}else this.Ba=new F(a.fa.x+.5522847498*(b.x-a.fa.x),a.fa.y+.5522847498*(b.y-a.fa.y));this.Ja=new F(d.x-.5522847498*(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*
(1-f*c));this.fa=d}c.prototype.Jh=function(a){this.qa=a;var b=this.qa.tc();if(b){var d=G(a.fa.x,a.fa.y,this.Wg.x,this.Wg.y);this.Ba=new F(a.fa.x+.5522847498*b.x*d,a.fa.y+.5522847498*b.y*d)}else this.Ba=new F(a.fa.x+.5522847498*(this.Wg.x-this.qa.fa.x),a.fa.y+.5522847498*(this.Wg.y-this.qa.fa.y))};c.prototype.ja=function(a){a.bezierCurveTo(this.Ba.x,this.Ba.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.Ud=function(){return this.qa?I(this.qa.fa.x,this.qa.fa.y,this.Ba.x,this.Ba.y):{x:1,y:0}};
c.prototype.tc=function(){return I(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}();var Yc=function(){function c(a){this.vh=this.uh=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.np=a;this.reset()}c.prototype.reset=function(){this.vh=this.uh=this.np};c.prototype.next=function(){this.vh=36969*(this.vh&65535)+(this.vh>>16);this.uh=18E3*(this.uh&65535)+(this.uh>>16);return((this.vh<<16)+this.uh)/4294967295/2+.5};return c}();var Zc=function(){function c(a){this.oa=a;this.n=0;this.rd=new F(0,0)}c.prototype.next=function(a){if(0===this.oa.length)return null;if(0===this.n)return this.rd=this.oa[0].clone(),this.n+=1,this.rd.clone();for(;this.n<this.oa.length;){var b=this.rd.Pa(this.oa[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.rd.x+=(this.oa[this.n].x-this.rd.x)*a/b,this.rd.y+=(this.oa[this.n].y-this.rd.y)*a/b,this.rd.clone()}return null};return c}(),$c=function(){function c(a){this.zc=a;this.Al=
!0;this.oa=[];this.log=B.create("WaveAddon");this.Sd=a.la("waveRadius")}c.prototype.format=function(){var a=this.zc.bk(!1).cm(S.Fj).Vd();this.log("Format cloud; %s points",a.length);this.oa=this.wv(a,this.Sd)};c.prototype.wv=function(a,b){var d=new Zc(a),e=1,c=[];if(2>a.length)return c;var g=0;for(var h=1;h<a.length;h++)g+=G(a[h-1].x,a[h-1].y,a[h].x,a[h].y);b=g/Math.round(g/(2*b)+.5)/2;for(g=[];;){h=d.next(2*b);if(!h)break;g.push(h)}g.push(a[a.length-1]);var k=g[0];c.push(k);for(d=1;d<g.length;d++){h=
g[d];var l=I(k.x,k.y,h.x,h.y);var m=b,n=new F(l.y*e,-1*l.x*e);k=new F(k.x+(l.x+n.x)*m,k.y+(l.y+n.y)*m);c.push(k);c.push(h);e*=-1;k=h}for(d=2;d<c.length-1;d+=2)e=c[d-1],g=c[d+1],c[d].x=e.x+(g.x-e.x)/2,c[d].y=e.y+(g.y-e.y)/2;return c};c.prototype.ja=function(a){a.beginPath();a.moveTo(this.oa[0].x,this.oa[0].y);for(var b=1;b<this.oa.length-1;b+=2)a.quadraticCurveTo(this.oa[b].x,this.oa[b].y,this.oa[b+1].x,this.oa[b+1].y)};return c}();var S=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.wa=[];e.Vf=0;e.gd=[];e.mj=[];e.Jp=!1;e.inverse=new O;e.origin=new F(0,0);e.oc=[];e.bd=new Q;e.ko=!1;e.backgroundImage=null;e.log=B.create("PATHNODE");e.log("New PathNode Created");e.Jb=new Oc(0,d);e.Jb.setProperty("text",e.aa.text);e.ak(a.va);e.aa.closed=!1;e.aa.commands=[];e.aa.seed=0;return e}p(a,c);a.prototype.moveTo=function(b,d){var e=this.aa.commands;e.push(a.Nf);e.push(b);e.push(d)};a.prototype.Jq=function(b,d,e,c,g,h){var f=
this.aa.commands;f.push(a.Jg);f.push(g);f.push(h);f.push(b);f.push(d);f.push(e);f.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.Li=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "text":case "textAlign":case "textDecoration":case "wrap":this.aa[a]=d;this.Jb.setProperty(a,d);break;case "textFillStyle":this.Jb.setProperty("fillStyle",d);this.aa[a]=d;break;case "textBackground":this.Jb.setProperty("background",
d);this.aa[a]=d;break;case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.aa[a]=d;break;case "backgroundImage":this.aa[a]=d,this.backgroundImage=null}};a.prototype.kh=function(b){for(var d=0,e=this.aa.commands,c=b/3|0,g=0;g<c;g++)d+=a.Ya[e[d]]+1;g=b%3*2+1;c=e[d+g];d=e[d+g+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);return this.Ga().apply(c,d)};a.prototype.we=function(b,d,e){for(var c=0,g=this.aa.commands,h=b/3|0,k=0;k<
h;k++)c+=a.Ya[g[c]]+1;h=this.inverse.apply(d,e);k=b%3*2+1;g[c+k]=h.x;g[c+k+1]=h.y;if(0===b&&this.aa.closed){for(b=null;c<g.length;)h=a.Ya[g[c]],2<=h&&(b=c),c+=h+1;b&&(c=b,h=this.inverse.apply(d,e),g[c+1]=h.x,g[c+2]=h.y)}};a.prototype.dg=function(){return"commands"};a.prototype.du=function(b){for(var d=this.aa.commands,e=0,c=0;c<b/3;c++)e+=a.Ya[d[e]]+1;d.splice(e,a.Ya[d[e]]+1)};a.prototype.Zr=function(){return this.la("arrowXOffset")||this.la("arrowSize")};a.prototype.format=function(b,d){var e=this,
c=null;this.wa.length=0;this.inverse=this.aa.matrix.inverse();var g=new F(0,0),h=this.aa.commands,k=null,l=this.aa.matrix,m=new Yc(this.aa.seed);this.mj.length=0;for(var n=null,r=null,q=0;q<h.length;){switch(h[q++]){case a.Nf:g=l.apply(h[q++],h[q++]);r=new Pc(k,g);this.wa.push(r);null===c&&(c=g);this.mj.push(g);n=null;break;case a.Zd:k&&(g=l.apply(h[q++],h[q++]),this.wa.push(new Qc(k,g,m,this.aa.sloppiness,this.aa.roundRadius)),this.mj.push(g));break;case a.Of:if(k){g=l.apply(h[q++],h[q++]);var v=
l.apply(h[q++],h[q++]);this.wa.push(new Sc(k,v,g))}break;case a.Ej:if(k){g=l.apply(h[q++],h[q++]);v=l.apply(h[q++],h[q++]);var y=h[q++];this.wa.push(new Tc(k,v,g,y))}break;case a.Dj:if(k){g=l.apply(h[q++],h[q++]);v=l.apply(h[q++],h[q++]);y=h[q++];var z=h[q++],w=h[q++],E=h[q++];this.wa.push(new Uc(k,v,g,y,z,w,E))}break;case a.Jg:k&&(g=l.apply(h[q++],h[q++]),y=l.apply(h[q++],h[q++]),v=l.apply(h[q++],h[q++]),this.wa.push(new Vc(k,y,v,g)));break;case a.Km:k&&(g=l.apply(h[q++],h[q++]),y=l.apply(h[q++],
h[q++]),v=l.apply(h[q++],h[q++]),this.wa.push(new Wc(k,y,v,g)));break;case a.Yh:k&&(g=l.apply(h[q++],h[q++]),this.wa.push(new Rc(k,g,this.aa.smoothness)));break;case a.Gj:k&&(g=l.apply(h[q++],h[q++]),y=l.apply(h[q++],h[q++]),this.wa.push(new Xc(k,y,g,m,this.aa.sloppiness)));break;case a.Rc:this.aa.closed=!0;n&&k&&n!==k&&n.Jh&&r&&(n.Jh(k),k.fa=r.fa);break;default:q++}k=this.wa[this.wa.length-1];null!==n||k instanceof Pc||(n=k)}this.origin=c||new F(0,0);this.Vf=this.wa.length;this.Qr(m);this.rect.x=
this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;c=this.aa.dashes.split(",");this.oc=[];for(q=0;q<c.length;q++)g=parseFloat(c[q]),isNaN(g)||this.oc.push(g);c=this.oc.length?a.Fj:a.Sp;this.bd=this.bk(!0).cm(c);q=0+this.la("shapeWidth");0<q&&(this.bd=this.dr(this.bd,q));this.rect=this.bd.rn(c);q=this.rect.width-2*(this.aa.lineWidth/2+1);g=this.aa.lineWidth;h=this.bd.clone();h.transform(this.oe());this.cb=h.rn(c);c=this.Ga().fg();this.cb.xc(Math.ceil(g/c.x),Math.ceil(g/c.y));
this.rect.xc(g+1,g+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);if(""!==this.aa.text){c=this.rect.Fd();this.Jb.setProperty("textAlign",this.aa.textAlign||"center");this.Jb.setProperty("baseWidth",q);this.Jb.format(b,d);q=c.x-this.Jb.rect.x-this.Jb.rect.width/2;g=0;switch(this.aa.verticalAlign){default:case "middle":g=c.y-this.Jb.rect.y-this.Jb.Rk/2;break;case "top":g=this.rect.y-this.Jb.rect.y;
break;case "bottom":g=this.rect.bottom()-this.Jb.Rk-this.Jb.rect.y}this.Jb.transform(new M(q,g));this.Jb.format(b,d)}this.Jp=0===A.pc(this.aa.fillStyle).values[3]&&!this.backgroundImage;this.gd.length=0;0<this.aa.cloudRadius?this.gd.push(new Mc(this)):0<this.aa.waveRadius?this.gd.push(new $c(this)):this.aa.doubleLine&&this.gd.push(new ad(this));for(q=0;q<this.gd.length;q++)this.gd[q].format(b);(q=this.la("backgroundImage"))&&null===this.backgroundImage&&d.add(this.id,"image",q,null,function(a){e.backgroundImage=
a;d.Dh(e.id)})};a.prototype.Qk=function(){return this.mj};a.prototype.Gi=function(){return this.bd};a.prototype.Qr=function(a){function b(b,d){b=b.clone();k&&(b.x+=d.x*g*.5,b.y+=d.y*g*.5);var f=b.x-d.x*g;var l=b.y-d.y*g;var m=f+d.y*c/2;var n=l-d.x*c/2;f+=-d.y*c/2;l+=d.x*c/2;e.wa.push(new Pc(e.wa[e.wa.length-1],new F(f,l)));e.wa.push(new Rc(e.wa[e.wa.length-1],b,h));e.wa.push(new Rc(e.wa[e.wa.length-1],new F(m,n),h));"solid"===e.aa.arrowStyle&&e.wa.push(new Qc(e.wa[e.wa.length-1],new F(f,l),a,e.aa.smoothness,
0))}if(this.ko=0<this.aa.arrowSize&&!this.aa.closed&&0<this.wa.length){var e=this,c=this.aa.arrowSize,g=this.aa.arrowXOffset,h=this.aa.smoothness,k=this.aa.doubleLine;null===g&&(g=c);var l=this.wa[this.wa.length-1];b(l.fa,l.tc());this.aa.doubleArrow&&b(this.wa[0].fa,oc(this.wa[1].Ud()))}};a.prototype.close=function(){this.aa.commands.push(a.Rc)};a.prototype.Dq=function(){var a=this.wa[this.wa.length-1];8>=G(a.fa.x,a.fa.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.dr=function(a,d){this.log("ConvertToRects: width=%s",
d);for(var b=0,c=a.ba,g=0,h=0,k,l,m=new Q;b<c.length;){this.log("cmd %s %s %s",c[b],c[b+1],c[b+2]);switch(c[b]){case Q.Tc:g=c[b+1];h=c[b+2];break;case Q.Sc:k=c[b+1];l=c[b+2];this.log("(%s,%s-%s,%s)",g,h,k,l);if(0<G(g,h,k,l)){var n=I(g,h,k,l),r=n.y*d/2;n=-n.x*d/2;m.moveTo(g+r,h+n);m.lineTo(k+r,l+n);m.lineTo(k-r,l-n);m.lineTo(g-r,h-n);m.closePath()}g=k;h=l}b+=Q.Cc[c[b]]}return m};a.prototype.clip=function(a){if(this.aa.closed){this.log("Clipping to a path");for(var b=0;b<this.wa.length;b++)this.wa[b].ja(a);
a.closePath()}};a.prototype.Oe=function(a){if(this.aa.spotHighlight)this.log("Not drawing node %s due to spothighlight",this.id);else{var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Ca,b.Da);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.gd.length;e++)this.gd[e].Al&&(b=!1);if(b)for(e=0;e<this.wa.length;e++)this.wa[e].ja(a);for(e=0;e<this.gd.length;e++)this.gd[e].ja(a);if(!b&&0<this.aa.arrowSize)for(e=this.Vf;e<this.wa.length;e++)this.wa[e].ja(a);if(this.aa.closed){a.closePath();
if(this.backgroundImage){a.fillStyle=a.createPattern(this.backgroundImage,"no-repeat");e=Math.max(this.rect.width/this.backgroundImage.naturalWidth,this.rect.height/this.backgroundImage.naturalHeight);var c=this.rect.width-this.backgroundImage.naturalWidth*e,g=this.rect.height-this.backgroundImage.naturalHeight*e;a.translate(this.rect.x+c/2,this.rect.y+g/2);a.scale(e,e);a.fill();a.scale(1/e,1/e);a.translate(-this.rect.x-c/2,-this.rect.y-g/2)}else a.fill();a.shadowColor="rgba(0,0,0,0.0)"}b&&(this.oc.length&&
0<this.aa.lineWidth?(a.beginPath(),this.bd.vi(a,this.oc),a.lineCap="butt"):0<0+this.la("shapeWidth")&&(a.beginPath(),this.bd.ja(a)));0<this.aa.lineWidth&&a.stroke();if(this.aa.arrowSize&&"solid"===this.aa.arrowStyle){a.beginPath();for(e=this.Vf;e<this.wa.length;e++)this.wa[e].ja(a);a.fillStyle=this.aa.strokeStyle;a.fill()}""!==this.aa.text&&this.Jb.ja(a);a.restore()}};a.prototype.lb=function(a,d){if(this.hidden()||this.la("locked"))return null;var b=12+this.aa.shapeWidth/2+this.aa.lineWidth/2;if(a>=
this.rect.x-b&&a<this.rect.x+b+this.rect.width&&d>=this.rect.y-b&&d<this.rect.y+b+this.rect.height)if(this.aa.closed&&!this.Jp){if(this.bd.ap(a,d))return this}else if(this.bd.ul(a,d,b)||""!==this.aa.text&&this.Jb.lb(a,d))return this;return null};a.prototype.bk=function(a){var b=new Q;if(0<this.aa.arrowSize&&!a)for(a=0;a<this.Vf;a++)this.wa[a].ja(b);else for(a=0;a<this.wa.length;a++)this.wa[a].ja(b);this.aa.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.aa.commands;e.push(a.Zd);
e.push(b);e.push(d)};a.prototype.Yg=function(b,d){var e=this.aa.commands;e.push(a.Yh);e.push(b);e.push(d)};a.prototype.hg=function(){return!1!==this.aa.editable&&!0!==this.aa.lockEditMode};a.prototype.sd=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.Vf;b++){var c=this.wa[b];if(a>=this.wa[b].fa.x-e&&a<this.wa[b].fa.x+e&&d>=this.wa[b].fa.y-e&&d<this.wa[b].fa.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+
e&&d>=c.control.y-e&&d<c.control.y+e)return 3*b+1}else if(c.Ba){if(a>=c.Ba.x-e&&a<c.Ba.x+e&&d>=c.Ba.y-e&&d<c.Ba.y+e)return 3*b+1;if(c.Ja&&a>=c.Ja.x-e&&a<c.Ja.x+e&&d>=c.Ja.y-e&&d<c.Ja.y+e)return 3*b+2}}return null};a.prototype.ne=function(b){var d=this.aa.commands;b/=3;var e=0,c=!1,g=0,h;for(h=0;h<d.length;){var k=d[h];if(k===a.Rc){c=!0;break}g+=1;h+=a.Ya[d[h]]+1}0===b&&c&&(b=g-1);for(h=0;h<d.length;e++){c=null;switch(d[h]){case a.Nf:c="move_to";break;case a.Zd:c="line_to";break;case a.Of:c="quadratic_to"}if(b===
e)return c;h+=a.Ya[d[h]]+1}return null};a.eq=function(b,d,e){d/=3;var c=0,g=[],h=new F(0,0),k=!1,l=0,m;for(m=0;m<b.length;){var n=b[m];if(n===a.Rc){k=!0;break}l+=1;m+=a.Ya[b[m]]+1}0===d&&k&&(d=l-1);for(m=0;m<b.length;c++){n=b[m];k=!1;d===c&&(n===a.Of&&"line_to"===e?(g.push(a.Zd,b[m+1],b[m+2]),k=!0):n===a.Zd&&"quadratic_to"===e&&(g.push(a.Of,b[m+1],b[m+2],(h.x+b[m+1])/2,(h.y+b[m+2])/2),k=!0));h=new F(b[m+1],b[m+2]);if(!k)for(n=0;n<1+a.Ya[b[m]];n++)g.push(b[m+n]);m+=a.Ya[b[m]]+1}return g};a.prototype.uo=
function(){return!0};a.prototype.wi=function(a,d,e){a.save();a.lineWidth=1*d;a.strokeStyle="#0050B7";a.fillStyle="#0050B7";d*=8;0===e?a.fillRect(this.origin.x-d,this.origin.y-d,2*d,2*d):a.strokeRect(this.origin.x-d,this.origin.y-d,2*d,2*d);for(var b=1;b<this.Vf;b++){var c=this.wa[b];a.beginPath();if(c.control)a.arc(c.control.x,c.control.y,d,0,2*Math.PI),a.arc(c.control.x,c.control.y,2*d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke();else if(c instanceof Vc||c instanceof Wc){var h=c.Ba;var k=c.Ja;var l=
c.qa.fa;h&&(a.moveTo(l.x,l.y),a.lineTo(h.x,h.y),a.moveTo(h.x+d,h.y),a.arc(h.x,h.y,d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke());a.beginPath();a.moveTo(c.fa.x,c.fa.y);a.lineTo(k.x,k.y);a.moveTo(k.x+d,k.y);a.arc(k.x,k.y,d,0,2*Math.PI);e===3*b+2?a.fill():a.stroke()}e===3*b?a.fillRect(this.wa[b].fa.x-d,this.wa[b].fa.y-d,2*d,2*d):a.strokeRect(this.wa[b].fa.x-d,this.wa[b].fa.y-d,2*d,2*d)}a.restore()};a.Wp=function(a){var b=new U,e=0;for(a=a.ba;e<a.length;){switch(a[e]){case Q.Tc:b.moveTo(a[e+1],a[e+2]);
break;case Q.Sc:b.lineTo(a[e+1],a[e+2]);break;case Q.Ig:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case Q.Ng:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case Q.Rc:b.close()}e+=Q.Cc[a[e]]}return b.ic()};a.va={strokeStyle:"#000000",fillStyle:"#ffffff",fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1};a.Sp=8;a.Fj=
2;a.Nf=0;a.Zd=1;a.Of=2;a.Ej=3;a.Jg=4;a.Yh=5;a.Gj=6;a.Rc=7;a.Km=8;a.Dj=9;a.Iv=.5522847498;a.Ya=[];return a}(R);S.Ya[S.Nf]=2;S.Ya[S.Zd]=2;S.Ya[S.Of]=4;S.Ya[S.Ej]=5;S.Ya[S.Jg]=6;S.Ya[S.Yh]=2;S.Ya[S.Gj]=4;S.Ya[S.Rc]=0;S.Ya[S.Km]=6;S.Ya[S.Dj]=8;
var U=function(){function c(a){void 0===a&&(a=[]);this.ba=a}c.prototype.beginPath=function(){};c.prototype.ld=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=S.Ya[this.ba[e]]+1;this.ba[e+1]=b;this.ba[e+2]=d};c.prototype.moveTo=function(a,b){this.ba.push(S.Nf);this.ba.push(a);this.ba.push(b)};c.prototype.lineTo=function(a,b){this.ba.push(S.Zd);this.ba.push(a);this.ba.push(b)};c.prototype.Yg=function(a,b){this.ba.push(S.Yh);this.ba.push(a);this.ba.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(S.Of);
this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.Ze=function(a,b,d,e){this.ba.push(S.Gj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,g){this.ba.push(S.Jg);this.ba.push(c);this.ba.push(g);this.ba.push(a);this.ba.push(b);this.ba.push(d);this.ba.push(e)};c.prototype.arc=function(a,b,d,e,c,g){void 0===g&&(g=!0);var f=(new N(-c,a,b)).apply(a+d,b);this.ba.push(S.Dj);this.ba.push(f.x);this.ba.push(f.y);this.ba.push(a);
this.ba.push(b);this.ba.push(d);this.ba.push(e);this.ba.push(c);this.ba.push(g?1:0)};c.prototype.arcTo=function(a,b,d,e,c){this.ba.push(S.Ej);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b);this.ba.push(c)};c.prototype.Un=function(){for(var a=[],b=0;b<this.ba.length;){for(var d=this.ba[b],e=0;e<S.Ya[d];e+=2)a.push(new F(this.ba[b+1+e],this.ba[b+1+e+1]));b+=S.Ya[d]+1}a=K.Me(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.translate=function(a,b){for(var d=0;d<this.ba.length;){for(var e=
this.ba[d],c=0;c<S.Ya[e];c+=2)this.ba[d+1+c]+=a,this.ba[d+2+c]+=b;d+=S.Ya[e]+1}};c.prototype.closePath=function(){this.ba.push(S.Rc)};c.prototype.close=function(){this.closePath()};c.prototype.ic=function(){return this.ba};return c}();U.prototype.change=U.prototype.ld;U.prototype.moveTo=U.prototype.moveTo;U.prototype.lineTo=U.prototype.lineTo;U.prototype.curveTo=U.prototype.Yg;U.prototype.quadraticCurveTo=U.prototype.quadraticCurveTo;U.prototype.cornerTo=U.prototype.Ze;U.prototype.bezierCurveTo=U.prototype.bezierCurveTo;
U.prototype.arc=U.prototype.arc;U.prototype.arcTo=U.prototype.arcTo;U.prototype.getBoundingBox=U.prototype.Un;U.prototype.translate=U.prototype.translate;U.prototype.closePath=U.prototype.closePath;U.prototype.close=U.prototype.close;U.prototype.toArray=U.prototype.ic;R.Vc("PathNode",S);U.prototype.beginPath=U.prototype.beginPath;U.prototype.change=U.prototype.ld;U.prototype.moveTo=U.prototype.moveTo;U.prototype.lineTo=U.prototype.lineTo;U.prototype.curveTo=U.prototype.Yg;
U.prototype.quadraticTo=U.prototype.cw;U.prototype.cornerTo=U.prototype.Ze;U.prototype.bezierTo=U.prototype.Jq;U.prototype.arc=U.prototype.arc;U.prototype.arcTo=U.prototype.arcTo;U.prototype.getBoundingBox=U.prototype.Un;U.prototype.translate=U.prototype.translate;U.prototype.closePath=U.prototype.closePath;U.prototype.close=U.prototype.close;U.prototype.toArray=U.prototype.ic;var ad=function(){function c(a){this.zc=a;this.Sd=0;this.Al=!0;this.Ki=!1;this.path=new Q;this.$i=new Q;this.log=B.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.zc.la("doubleLine"));var a=this.zc.bk(!1).cm(S.Fj),b=this.zc.Zr();if(0<b){var d=a.Lq();d>b&&(a=a.Mq(d-b))}a=a.Vd();b=this.zc.la("doubleLine");this.path=new Q;this.$i=new Q;d=this.zc.la("doubleLineDashSide");this.Ki=!1;"outer"===d?(Ec(this.path,a,b,"middle",!0,!1),Ec(this.$i,a,b,
"middle",!1,!0),this.Ki=!0):"inner"===d?(Ec(this.path,a,b,"middle",!1,!0),Ec(this.$i,a,b,"middle",!0,!1),this.Ki=!0):Ec(this.path,a,b,"middle",!0,!0)};c.prototype.ja=function(a){a.beginPath();this.zc.oc.length&&this.Ki?(this.$i.vi(a,this.zc.oc),this.path.ja(a)):this.zc.oc.length?this.path.vi(a,this.zc.oc):this.path.ja(a)};return c}();var bd=function(c){function a(){var a=c.call(this)||this;a.vg=[];a.Ue=!1;a.canvas=null;a.log=B.create("FORMAT",!0);return a}p(a,c);a.prototype.add=function(a,d,e,c,g){var b;var f=this.vg;var l=0;for(b=f.length;l<b;l++){var m=f[l];m.type===d&&m.kl===a&&(m.lj=!0)}this.log("Request URL %s",e.substr(0,64));this.vg.push({kl:a,type:d,url:e,bw:c||{},tn:g,lj:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.Ue&&a<this.vg.length;)this.vg[a].lj?this.vg.shift():(this.pq(this.vg[0]),a+=1);this.Ue||
this.ta("done")};a.prototype.pq=function(a){var b=this;b.Ue=!0;b.log("Processing request for item %s url=%s",a.kl,a.url.substr(0,64));if(0===a.type.indexOf("image")){var e=0<=a.url.indexOf("svg+xml");Db.load(a.url,function(d,c){if(null!==d){b.log("Image request completed for item %s url %s",a.kl,c.substr(0,64));if(e){b.log("Doing double-copy to eliminate SVG");var f=document.createElement("canvas");f.width=d.naturalWidth;f.height=d.naturalHeight;f.getContext("2d").drawImage(d,0,0);Db.load(f.toDataURL(),
function(d,e){null!==d?(b.log("SVG elimination succeeded; url=%s",e.substr(0,20)),a.tn(d,e)):b.log("Image conversion from SVG failed.");b.Ue=!1;a.lj=!0;b.check()});return}a.tn(d,c)}else b.log("Image request failed for url %s",c);b.Ue=!1;a.lj=!0;b.check()})}};a.prototype.br=function(a,d){this.ta("convert-dom-request",a,d)};a.prototype.Dh=function(a){this.ta("reformat",a)};a.prototype.pd=function(){if(null===this.canvas)return new K(0,0,0,0);var a=C(this.canvas).offset();return new K(a.left,a.top,this.canvas.width,
this.canvas.height)};a.prototype.Hk=function(){return C(this.canvas)};return a}(xb);var cd=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.children=[];return b}p(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.clone=function(b){for(var d=new a(b(),this.ha),e=0;e<this.children.length;e++){var c=this.children[e].clone(b);c.parent=d;d.children.push(c)}return d};a.prototype.format=function(a,d){for(var b=0;b<this.children.length;b++)this.children[b].format(a,d),0===b?this.rect=this.children[b].rect.clone():this.rect.Vh(this.children[b].rect)};a.prototype.ja=
function(a){for(var b=0;b<this.children.length;b++)this.children[b].ja(a)};a.prototype.lb=function(a,d){for(var b=this.children.length-1;0<=b;b--){var c=this.children[b].lb(a,d);if(c)return c}return null};a.prototype.Ck=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};return a}(R);R.Vc("GroupNode",cd);var dd=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.oa=[];b.oc=[];b.log=B.create("BRUSH",!0);b.log("New BrushNode created.");b.aa.points=[];b.aa.strokeStyle="#ff00ff";b.aa.lineWidth=10;return b}p(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");a in this.aa||"dashes"===a||"lineCap"===a?this.aa[a]=d:c.prototype.setProperty.call(this,a,d)};a.prototype.la=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.la.call(this,
a)};a.prototype.format=function(){var a,d;this.oa.length=0;var e=this.aa.points;var c=a=0;for(d=e.length-1;a<=d;c=a+=2)this.oa.push(new F(e[c],e[c+1]));c=K.Me(this.oa);e=this.Ga().fg();a=this.aa.lineWidth;c.xc(a/e.x,a/e.y);this.cb=c.clone();c=new zc(c);c.transform(this.aa.matrix);this.rect=K.Me(c.oa);this.oc=[];if("dashes"in this.aa)for(e=this.aa.dashes.split(","),c=0;c<e.length;c++)a=parseFloat(e[c]),isNaN(a)||this.oc.push(a);this.log("Format brushnode")};a.prototype.lb=function(a,d){if(this.rect.Wc(a,
d)){var b=this.oe().apply(a,d);if(wc(this.oa,b.x,b.y,12+this.aa.lineWidth/2))return this}return null};a.prototype.Oe=function(b){var d=this.aa.points;if(0!==d.length){b.save();b.beginPath();var e=this.la("lineCap")||"round";b.lineCap=e;b.lineJoin="round"===e?"round":"bevel";if(1<this.oc.length){e=this.oa;var c=this.oc;if(0!==e.length){b.moveTo(e[0].x,e[0].y);var g=0;for(var h=1,k=c[0],l=e[0].clone(),m;h<e.length;)m=l.Pa(e[h]),0===m?h+=1:m<=k?(l=e[h].clone(),g&1?b.moveTo(l.x,l.y):b.lineTo(l.x,l.y),
k-=m,h+=1):(l.x+=(e[h].x-l.x)*k/m,l.y+=(e[h].y-l.y)*k/m,g&1?b.moveTo(l.x,l.y):b.lineTo(l.x,l.y),g=(g+1)%c.length,k=c[g])}}else for(b.moveTo(d[0],d[1]),e=c=2,g=d.length-1;c<=g;e=c+=2)b.lineTo(d[e],d[e+1]);this.oe().Th(b);dc(b,this.aa.strokeStyle);if(a.cq){this.Ga().Th(b);b.beginPath();e=c=0;for(g=d.length-1;c<=g;e=c+=2)b.rect(d[e]-2,d[e+1]-2,4,4);b.fillStyle="#ff0000";b.fill()}b.restore()}};a.cq=!1;return a}(R);R.Vc("BrushNode",dd);function ed(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function fd(){if(void 0===c)var c=window.location.hash;0===c.indexOf("#/")&&(c="#"+c.substr(2));var a=c,b;c={};var d=a.indexOf("#");0<=d&&(a=a.substr(d+1));d=a.indexOf("#");0<=d&&(a=a.substr(0,d));a=a.split("&");d=0;for(b=a.length;d<b;d++){var e=a[d];var f=e.split("=");e=ed(f[0]);f=1<f.length?ed(f[1]):"";e.length&&(c[e]=f)}return c};var gd=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),hd=function(c){function a(a){var b=c.call(this)||this;b.options={angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!1,allowZoom:!0,autoPickTool:!0,
autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,clickToDrawShapes:!1,colourPicker:"wheel",colourPalette:"auto",debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",defaultStrokeStyle:"#000000",defaultText:"Lorum ipsum dolor",
defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:"#000000",defaultTextStrokeStyle:"#000000",defaultTextLineWidth:0,defaultZoom:1,drawCircleStyle:"box",drawShapeStyle:"box",fonts:["Arial","Times New Roman"],gridBlocks:10,gridSpacing:20,gridColour:"#cccccc",imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",keyDelete:"Delete,Backspace",
keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",
keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",leaveTextToolOnBlur:!1,maximumZoom:0,minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pagePlacement:"centre",pageSelectorDiv:"",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,
showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showKeyboardHelp:!0,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,
simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:0,symmetry:0,textMode:"interactive",toolbarButtonSize:50,useTouch:"auto",units:"",enableArrowKeysNudge:!1,showMenu:!1};b.log=B.create("CONFIG");for(var e in a)e in b.options||alert("Zwibbler: Unknown option '"+e+"'"),b.set(e,a[e],!0);C(window).xa("hashchange",function(){b.log("Reload parameters from url hash");b.Co()});b.Co();""===b.co()?(b.Nd=b.options.imageFolder.replace("$SCRIPT/",
""),b.Nd=b.Nd.replace("$SCRIPT","")):b.Nd=b.options.imageFolder.replace("$SCRIPT",b.co());""!==b.Nd&&"/"!==b.Nd[b.Nd.length-1]&&(b.Nd+="/");"auto"===b.options.useTouch&&b.log("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);b.log("Detect clipboard support: %s",b.Uk());for(var f in b.options)b.log("%s=%s",f,b.options[f]);return b}p(a,c);a.prototype.Co=function(){var a=fd(),d;for(d in a)this.set(d,a[d])};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);if(!(a in
this.options))return this.log("Error: %s is not a configuration option.",a),!1;if("defaultZoom"===a){if("page"!==d&&"width"!==d&&!t(d)&&(d=parseFloat(d),isNaN(d)))return this.log("Error: Config option %s must be a number or 'page' or 'width'",a),!1}else if("allowSelectBox"!==a)if("colourPalette"===a)"auto"!==d&&"string"===typeof d&&(d=A.Lt(d));else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d))return this.log("Error: Config option %s expects a number",a),
!1}else"boolean"===typeof this.options[a]&&(d="1"===d||"true"===d||""===d);this.log("Set config %s=%s",a,d);this.options[a]=d;e||(this.bf("update",a,d),this.bf(a,d,!1));return!0};a.prototype.xa=function(a,d){d(a,this.options[a],!0);return c.prototype.xa.call(this,a,d)};a.prototype.co=function(){var a=gd;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.Hu=function(){return this.options.showBrushTool};a.prototype.Dp=function(){return this.options.showPropertyPanel};a.prototype.Iu=
function(){return this.options.showColourPanel};a.prototype.Bg=function(){return this.options.showDebug};a.prototype.Lu=function(){return this.options.showToolbar};a.prototype.Ha=function(a){return this.options[a]};a.prototype.get=function(a){return this.Ha(a)};a.prototype.Wd=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.Xr=function(){if("auto"===this.options.allowSelectBox){var a=this.Wd(),d=document.documentElement.offsetHeight,
e=window.innerHeight,c=!a||a&&0<e-d+50;this.log("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",c,a,d,e);return c}return this.options.allowSelectBox};a.prototype.gs=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.Ab=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===a.indexOf("/")?a:this.Nd+a};a.prototype.Jk=function(a){a=Ob(this.get(a));return 0<
a.length?a[0]:null};a.prototype.Bq=function(a){var b={};this.Uk()&&(this.log("Using system clipboard. Ignore keyCut/keyCopy/keyPaste."),b.keyCut=1,b.keyCopy=1,b.keyPaste=1);for(var e in this.options)if(this.options.hasOwnProperty(e)&&0===e.indexOf("key")&&!b[e]){for(var c="",g=0;g<e.length;g++){var h=e.charAt(g);c=h===h.toUpperCase()?c+("-"+h.toLowerCase()):c+h}a.map(this.options[e],c.substr(4))}};a.prototype.Yn=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?
"circle":"rectangle"};a.prototype.Bl=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&this.log("Zoom restricted to %s",a);return a};a.prototype.Uk=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};return a}(xb);var id=function(c){function a(a,d,e){var b=c.call(this,C("<div>"))||this;b.da=a;b.language=d;b.vb=e;b.cj=[];b.dj={};b.view=null;b.ra=[];b.onclick=null;b.log=B.create("PROP");b.ia.Qe("PropertyPanel");b.vn=ib.isSupported()&&"wheel"===a.get("colourPicker");b.vn||b.log("ColourWheel not supported in this canvas.");b.ia.ea("background","#ffffff");b.ia.ea("border","none");b.ia.ea("font-family","tahoma,arial,helvetica,sans");b.ia.ea("color","#4fa0d3");b.ia.ea("font-weight","bold");b.ia.ea("font-size","10pt");
b.ia.ea("overflow-y","scroll");b.ia.click(function(){b.log("PropertyPanel clicked.");b.ta("click")});return b}p(a,c);a.prototype.xa=function(a,d){if("click"===a)this.onclick=d;else throw Error("This object only handles the click event");};a.prototype.ta=function(){if(this.onclick)this.onclick()};a.prototype.Do=function(a){this.cj.length=0;this.dj={};this.ra=a.concat();for(var b=!1,e=0;e<a.length;e++){var c=a[e];c.Vk()&&(b=!0);var g=c.vc(),h;for(h in g)g.hasOwnProperty(h)&&this.et(h,c)}this.gr();this.da.get("showKeyboardHelp")&&
this.Ku(a,b)};a.prototype.Ku=function(a,d){var b=C("<div>").Qe("keydiv");b.ea("font-size","8pt");b.ea("color","#909090");b.ea("font-weight","normal");C(this.ia).append(b);var c=this.language.fn();b.append("<h1>"+c("keyboard")+"</h1>");var g=[{key:this.da.get("keyCurveTool"),description:c("draw-curves")},{key:this.da.get("keyLineTool"),description:c("draw-lines")}];0<a.length&&g.push({key:this.da.get("keyDelete"),description:c("delete-selection")},{key:this.da.get("keyDuplicate"),description:c("duplicate-selection")},
{key:this.da.get("keyMoveUp"),description:c("move-selection-closer")},{key:this.da.get("keyMoveDown"),description:c("move-selection-away")});1<a.length&&g.push({key:this.da.get("keyGroup"),description:c("group-selection")});d&&g.push({key:this.da.get("keyUngroup"),description:c("break-apart-group")});g.push({key:this.da.get("keyZoomIn"),description:c("zoom-in")});g.push({key:this.da.get("keyZoomOut"),description:c("zoom-out")});g.push({key:c("arrow-keys"),description:c("move-while-zoomed")});for(c=
0;c<g.length;c++){var h=C("<a>").text(g[c].key).Qe("key");h.ea("background","#d0d0d0");h.ea("border-left","1px solid #808080");h.ea("border-right","1px solid #e0e0e0");h.ea("border-top","1px solid #808080");h.ea("border-bottom","1px solid #e0e0e0");h.ea("padding-left","0.5em");h.ea("padding-right","0.5em");h.ea("margin-right","1em");h.ea("color","#4fa0d3");h.ea("font-weight","bold");h=C("<p>").append(h);h[0].appendChild(document.createTextNode(g[c].description));b.append(h)}};a.prototype.jr=function(a,
d){var b=this.language.fn();if("strokeStyle"===d)return{name:d,type:"colour",display:b("outline-colour")};if("fillStyle"===d)return{name:d,type:"colour",display:b("fill-colour")};if("lineWidth"===d){var c=[{name:b("thickness-pencil"),value:1},{name:b("thickness-pen"),value:2},{name:b("thickness-marker"),value:4},{name:b("thickness-brush"),value:10}];!0!==a.la("closed")&&"TextNode"!==a.type()||c.unshift({name:b("none"),value:0});return{name:d,display:b("outline-thickness"),type:"select",values:c}}if("sloppiness"===
d)return{name:"sloppiness",display:b("sloppiness"),type:"select",values:[{name:b("sloppiness-draftsman"),value:0},{name:b("sloppiness-artist"),value:.25},{name:b("sloppiness-cartoonist"),value:.5},{name:b("sloppiness-child"),value:1},{name:b("sloppiness-drunk"),value:2}]};if("smoothness"===d)return{name:"smoothness",display:b("smoothness"),type:"select",values:[{name:b("smoothness-sharpest"),value:0},{name:b("smoothness-sharper"),value:.1},{name:b("smoothness-sharp"),value:.2},{name:b("smoothness-smooth"),
value:.3},{name:b("smoothness-smoothest"),value:.5}]};if("shadow"===d)return{name:"shadow",display:b("shadow"),type:"select",values:[{name:b("yes"),value:!0},{name:b("no"),value:!1}]};if("dashes"===d)return{name:"dashes",display:b("line-style"),type:"select",values:[{name:b("line-style-solid"),value:""},{name:b("line-style-short-dashes"),value:"5,5"},{name:b("line-style-long-dashes"),value:"10,5"}]};if("matrix"===d||"inverse"===d||"closed"===d||"commands"===d||"seed"===d)return{name:d,type:"none"};
if("text"===d)return{name:"text",display:b("text"),type:"textarea"};if("textFillStyle"===d)return{name:"textFillStyle",display:b("text-colour"),type:"colour"};if("fontSize"===d)return{name:"fontSize",display:b("font-size"),type:"select",values:[{name:"10",value:10},{name:"12",value:12},{name:"15",value:15},{name:"20",value:20},{name:"30",value:30},{name:"40",value:40},{name:"50",value:50},{name:"60",value:60},{name:"100",value:100}]};if("fontName"===d){var g=[],h=this.da.Ha("fonts");for(c=0;c<h.length;c++)g.push({name:h[c],
value:h[c]});return{name:"fontName",display:b("font"),type:"select",values:g}}return"arrowSize"===d?{name:"arrowSize",display:b("arrowhead-size"),type:"select",values:[{name:b("arrowhead-size-none"),value:0},{name:b("arrowhead-size-tiny"),value:10},{name:b("arrowhead-size-small"),value:15},{name:b("arrowhead-size-medium"),value:20},{name:b("arrowhead-size-large"),value:30}]}:"arrowStyle"===d?{name:"arrowStyle",display:b("arrowhead-style"),type:"select",values:[{name:b("arrowhead-style-simple"),value:"simple"},
{name:b("arrowhead-style-solid"),value:"solid"}]}:"doubleArrow"===d?{name:"doubleArrow",display:b("double-arrows"),type:"select",values:[{name:b("no"),value:!1},{name:b("yes"),value:!0}]}:"url"===d?{name:"url",display:b("image-url"),type:"text"}:"rows"===d?{name:d,display:"Rows",type:"text"}:"columns"===d?{name:d,display:"Columns",type:"text"}:{name:d,display:"Display-"+d,type:"text"}};a.prototype.et=function(a,d){var b=this.da;a in this.dj?(b=this.dj[a],b.value!==d.la(a)&&(b.value=null)):"locked"===
a||"points"===a||!0===d.la("closed")&&("arrowSize"===a||"arrowStyle"===a||"doubleArrow"===a)||!1===d.la("closed")&&("fontName"===a||"fontSize"===a||"textFillStyle"===a||"text"===a||"fillStyle"===a)||"ImageNode"===d.type()&&("fillStyle"===a||"strokeStyle"===a||"lineWidth"===a||"shadow"===a)||"BrushNode"===d.type()&&"fillStyle"===a||"TextNode"===d.type()&&"fillStyle"===a||"lockSize"===a||"lockRotate"===a||"rotateAround"===a||"layer"===a||0===a.indexOf("cell-")||"fontName"===a&&!b.get("showFontNameProperty")||
"fontSize"===a&&!b.get("showFontSizeProperty")||"smoothness"===a&&!b.get("showSmoothnessProperty")||"sloppiness"===a&&!b.get("showSloppinessProperty")||(b={xl:this.jr(d,a),value:d.la(a)},b.xl.display&&0===b.xl.display.indexOf("Display-")||(this.cj.push(b),this.dj[a]=b))};a.prototype.gr=function(){function a(){h.yv(this)}function d(){var a=this;"timer"in a&&clearTimeout(a.timer);a.timer=setTimeout(function(){h.apply(a.Ac.name,a.value)},250)}function e(a){13===a.keyCode&&h.apply(this.Ac.name,this.value)}
function c(){var a=parseInt(this.value,10);this.Ac&&this.Ac.values&&h.apply(this.Ac.name,this.Ac.values[a].value)}C(this.ia).empty();var g,h=this;for(g=0;g<this.cj.length;g++){var k=this.cj[g],l=k.xl;if("none"!==l.type){var m=document.createElement("div");var n=document.createElement("span");n.appendChild(document.createTextNode(l.display||l.name));m.appendChild(n);m.appendChild(document.createElement("br"));if("select"===l.type){var r=document.createElement("select");for(n=0;n<l.values.length;n++){var q=
l.values[n],v=document.createElement("option");v.appendChild(document.createTextNode(q.name));v.setAttribute("value",n.toString());q.value===k.value&&v.setAttribute("selected","");r.appendChild(v)}r.Ac=l;r.onchange=c;m.appendChild(r)}else if("colour"===l.type)n=document.createElement("input"),n.setAttribute("type","text"),n.value=k.value,n.Ac=l,C(n).$k(e),m.appendChild(n),k=document.createElement("img"),k.src=this.da.Ab("wd-wheel.png"),k.style.verticalAlign="middle",k.input=n,m.appendChild(k),C(k).click(a);
else if("text"===l.type)n=document.createElement("input"),n.setAttribute("type","text"),n.value=k.value,n.Ac=l,C(n).$k(e),m.appendChild(n);else if("textarea"===l.type)n=document.createElement("textarea"),n.setAttribute("rows","3"),n.setAttribute("cols","20"),n.value=k.value,n.Ac=l,C(n).$k(d),m.appendChild(n);else if("button"===l.type)n=document.createElement("input"),n.setAttribute("type","button"),n.value="Edit",n.Ac=l,m.appendChild(n);else throw"Error: No such property";this.ia.append(C(m))}}};
a.prototype.apply=function(a,d){this.view.setProperty(a,d)};a.prototype.yv=function(a){if(!a.mo){var b="#000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" "),e=this;if(this.vn){b=document.createElement("div");var c=new ib(b,120);c.up(a.input.value);c.rl=function(b){e.fk(b,a.input,a.input.Ac)};a.xv=c;a.mo=!0;a.parentNode.appendChild(b)}else{c=this.da.get("colourPalette");"auto"===c&&(c=b);b=new ec(C(a.parentNode),
20,!1,!0,c);b.ia.ea("position","static");a.xv=b;a.mo=!0;a.parentNode.appendChild(b.ia[0]);var g=Bb(e.vb);b.xa("colour",function(b){e.fk(b,a.input,a.input.Ac);b=A.pc(b).values[3];g.Pl(Math.round(100*b))});g.min="0";g.max="100";var h=A.pc(a.input.value);g.Pl(Math.round(100*h.values[3]));g.onchange=function(){h=A.pc(a.input.value);h.values[3]=g.fo()/100;e.fk(h.toString(),a.input,a.input.Ac)};a.parentNode.appendChild(document.createElement("br"));a.parentNode.appendChild(g)}}};a.prototype.fk=function(a,
d,e){this.view.setProperty(e.name,a);d.value=a};return a}(eb);var jd=function(){function c(a,b){void 0===b&&(b="repeat");this.ya=a;this.repeat=b}c.prototype.loaded=function(){return this.ya instanceof HTMLImageElement?this.ya.complete:!0};c.prototype.setTransform=function(){};return c}(),kd=function(){function c(a,b,d,e){this.Uu=[];this.from=new F(a,b);this.fa=new F(d,e)}c.prototype.addColorStop=function(a,b){this.Uu.push({offset:a,Ye:b})};return c}(),ld=function(){function c(){this.stack=[];this.sa=new O;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({sa:this.sa.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,
globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.sa=a.sa,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.sa=a.sa,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=a.globalAlpha,
this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor)};c.prototype.drawImage=function(a,b,d,e,c,g,h,k,l){var f=a.width,n=a.height,r=0,q=f,v=n;void 0!==e&&void 0!==c&&void 0!==g&&void 0!==h&&void 0!==k&&void 0!==l?(r=b,0-d,q=e,v=c,b=g,d=h,f=k,n=l):void 0!==e&&void 0!==c&&(f=e,n=c);this.Qm(a,r,0,q,v,b,d,f,n)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,b,d,e,c,g){g&&(g=e,
e=c,c=g);for(;0>e;)e+=2*Math.PI;for(;0>c;)c+=2*Math.PI;e>c&&(e-=2*Math.PI);var f=2*Math.PI;var k=e%f;var l=c%f;l===k&&(l+=2*Math.PI);c=[];e=Math.PI/2;g=k<l?1:-1;var m=k;for(f=Math.min(f,Math.abs(l-k));1E-5<f;){k=m+g*Math.min(f,e);var n=(k-m)/2,r=d*Math.cos(n),q=d*Math.sin(n),v=.5522847498*Math.tan(n);l=r+v*q;r=-q+v*r;q=-r;v=n+m;n=Math.cos(v);v=Math.sin(v);c.push({Pc:d*Math.cos(m),Qc:d*Math.sin(m),Xd:l*n-r*v,Yd:l*v+r*n,Av:l*n-q*v,Cv:l*v+q*n,Bv:d*Math.cos(k),Dv:d*Math.sin(k)});f-=Math.abs(k-m);m=k}for(d=
0;d<c.length;d++)e=c[d],0===d&&this.moveTo(e.Pc+a,e.Qc+b),this.bezierCurveTo(e.Xd+a,e.Yd+b,e.Av+a,e.Cv+b,e.Bv+a,e.Dv+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,e){this.beginPath();this.rect(a,b,d,e);this.stroke()};c.prototype.setTransform=function(a,b,d,e,c,g){this.sa=new O(a,d,b,e,c,g)};c.prototype.transform=function(a,b,d,e,c,g){a=new O(a,d,b,e,c,g);this.sa=this.sa.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};c.prototype.scale=function(a,
b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,e){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,e){this.rect(a,b,d,e);this.fill()};c.prototype.Sf=function(a){var b=null,d="10",e="normal",c="normal",g="normal",h="normal",k=!1;a=a.split(/\s+/);a:for(;;){var l=a.shift();if(!l)break;
switch(l){case "normal":break;case "italic":case "oblique":e=l;break;case "small-caps":g=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":c=l;break;default:if(k){b=l;a.length&&(b+=" "+a.join(" "));2<b.length&&('"'===b.charAt(0)||"'"===b.charAt(0))&&(b=b.substr(1,b.length-2));break a}else l=l.split("/"),d=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:e,fontVariant:g,fontWeight:c,fontSize:d,lineHeight:h,
fontFamily:b}};c.prototype.createPattern=function(a,b){return new jd(a,b)};c.prototype.createLinearGradient=function(a,b,d,e){return new kd(a,b,d,e)};c.prototype.clip=function(){};return c}();var md=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.cc=[];this.fonts={};this.images=[];this.wj={};this.pb=1;this.$q=!0;this.page={};this.log=B.create("PdfWriter");this.bb=this.object("Pages",{Kids:[],Count:0});this.Nq=this.object("Catalog",{Pages:this.bb._id+" 0 R"});this.Cg()}c.prototype.Rs=function(){if(null!==c.Qj)return c.Qj;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.Qj=
b;this.log("JPEG supported: %s",b);return b};c.prototype.Cg=function(a,b,d,e){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===e&&(e=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,e);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+e],Parent:this.bb._id+" 0 R"});this.bb.Kids.push(this.page._id+" 0 R");this.bb.Count+=1;this.wj={}};c.prototype.object=function(a,b){var d=this.cc.length+1;a&&(b.Type=a);b._id=d;this.cc.push(b);return b};c.prototype.zq=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.$q){var b=Ib.Kg("LZWEncoder");b.qm(a);b.flush();a=b.cg().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.hv=function(a){if(!(a in this.fonts)){var b="F"+this.pb;this.pb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.$h("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.Op=function(a,b){var d=""+a+"-"+b;if(!(d in this.wj)){var e="gs"+this.pb;this.pb+=1;var c=this.object("ExtGState",{_name:e});b?c.ca=this.Mc(a):c.CA=this.Mc(a);this.wj[d]=e;this.$h("ExtGState",c)}return this.wj[d]};c.prototype.$h=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.Oj=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].oh===a&&b===this.images[d].po)return this.images[d].Ah;return null};c.prototype.yj=function(a,b){var d,e=this.Oj(a);if(!e){var c="I"+this.pb;this.pb+=1;b instanceof HTMLCanvasElement?e=b:(e=document.createElement("canvas"),e.width=b.width,e.height=b.height,e.getContext("2d").drawImage(b,0,0));var g=e.getContext("2d").getImageData(0,0,e.width,e.height),h=!1;if(this.Rs()){this.log("Using JPEG encoding");var k="[/DCTDecode]";var l=Ib.Kg("");
for(d=0;d<g.data.length;d+=4)h=h||255>g.data[d+3];d=e.toDataURL("image/jpeg");var m=atob(d.split(",")[1]);for(d=0;d<m.length;d++)l.Ra(m.charCodeAt(d))}else{this.log("Using LZW encoding");k="[/LZWDecode]";l=Ib.Kg("LZWEncoder");for(d=0;d<g.data.length;d+=4)l.Ra(g.data[d]),l.Ra(g.data[d+1]),l.Ra(g.data[d+2]),h=h||255>g.data[d+3];var n="[ <</EarlyChange 0 >> ]"}l.flush();l=l.cg().toString();c=this.object("XObject",{Subtype:"/Image",Width:e.width,Height:e.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:l.length,Interpolate:"true",Filter:k,_name:c,_stream:l});n&&(c.DecodeParms=n);if(h){l=Ib.Kg("LZWEncoder");for(d=0;d<g.data.length;d+=4)l.Ra(g.data[d+3]);l.flush();l=l.cg().toString();n=this.object("XObject",{Subtype:"/Image",Width:e.width,Height:e.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:l.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:l});c.SMask=n._id+" 0 R"}this.images.push({oh:a,po:"",Ah:c});e=c}this.$h("XObject",e);return"/"+e._name};c.prototype.zj=
function(a,b){var d=this.Oj(a.ya,b.toString());if(!d){d="P"+this.pb;this.pb+=1;this.yj(a.ya,a.ya);var e=this.Oj(a.ya),c=new O(a.ya.width,0,0,-a.ya.height,0,a.ya.height);c=b.multiply(c);var g="1",h="1",k=b.fg();k=Math.max(k.x,k.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)g=""+Math.ceil(this.width/a.ya.width/k);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)h=""+Math.ceil(this.height/a.ya.height/k);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:g,YStep:h,Matrix:"[ "+this.Mc(c.m11,c.m21,c.m12,c.m22,c.Ca,c.Da)+"]",Resources:"<< /XObject << /"+e._name+" "+e._id+" 0 R >> >>"});d._stream="/"+e._name+" Do";this.images.push({oh:a.ya,po:b.toString(),Ah:d})}this.$h("Pattern",d);return"/"+d._name};c.prototype.zf=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.cc.length;d++)this.cn(a,b,this.cc[d],!1);var e=a.join("").length;a.push("xref\n0 "+(this.cc.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.cc.length;d++){for(var c=""+b[d];10>c.length;)c="0"+c;a.push(c+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.cc.length+1)+"\n");a.push("   /Root "+this.Nq._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(e+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.zf(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.cn=function(a,b,d,e){e?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var c in d)if(d.hasOwnProperty(c)&&"Type"!==c&&"_"!==c.charAt(0)){e&&a.push("    ");a.push("   /"+c+" ");var g=d[c];"object"===typeof g&&"[object Array]"===Object.prototype.toString.apply(g)?a.push("[ "+g.join(" ")+" ]"):"object"===typeof g?this.cn(a,b,g,!0):a.push(g);a.push("\n")}e&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));e||a.push("endobj\n")};c.prototype.Dr=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.Mc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var e=""+a[d];0<e.indexOf("e")&&(e=a[d].toFixed(20));b.push(e)}return b.join(" ")};c.Qj=null;return c}(),nd=function(c){function a(a,d){var b=c.call(this)||this;b.Pr=d;b.path=[];b.x=0;b.y=0;b.Xo=[];b.pf="";b.vf="";b.uf=-1;b.tf=
"";b.sf="";b.rf="";b.qf="";b.nf=-1;b.log=B.create("PDFContext");b.Rd=a.clone();b.Rd.transform(new P(.75,.75,0,0));b.rb=new md(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.$m=b.qq;b.Zm();return b}p(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.Xo.push({pf:this.pf,vf:this.vf,uf:this.uf,tf:this.tf,sf:this.sf,rf:this.rf,qf:this.qf,nf:this.nf})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.Xo.pop();a&&(this.stream.push("Q"),this.pf=a.pf,this.vf=a.vf,this.uf=a.uf,this.tf=a.tf,this.sf=a.sf,this.rf=a.rf,this.qf=a.qf,this.nf=a.nf)};a.prototype.Cg=function(a){var b=new P(.75,.75,0,0);a&&(this.Rd=a.clone(),this.Rd.transform(b));this.zk();this.rb.Cg(this.Rd.x,this.Rd.y,this.Rd.width,this.Rd.height);this.Zm();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.Zm=function(){this.log("Start page: %s",this.Rd);this.setTransform(1,0,0,1,0,0);this.vf=this.pf=
"";this.uf=-1;this.qf=this.rf=this.sf=this.tf="";this.nf=-1};a.prototype.zk=function(){this.stream.length&&this.rb.zq(this.rb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.toString=function(){this.zk();return this.rb.zf()};a.prototype.toBlob=function(){this.zk();return this.rb.toBlob()};a.prototype.setTransform=function(a,d,e,c,g,h){var b=this.Rd.Fd();this.sa=(new O(a,e,d,c,g,h)).multiply(new pc(0,b.x,b.y)).multiply(new P(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};
a.prototype.fill=function(){this.Rj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.Sj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.sa.apply(a,d);this.path.push(this.rb.Mc(b.x,b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.sa.apply(a,d);this.path.push(this.rb.Mc(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=
function(a,d,e,c,g,h){a=this.sa.apply(a,d);e=this.sa.apply(e,c);c=this.sa.apply(g,h);this.path.push(this.rb.Mc(a.x,a.y,e.x,e.y,c.x,c.y)+" c");this.x=g;this.y=h};a.prototype.quadraticCurveTo=function(a,d,e,c){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*e,2/3*d+1/3*c,e,c)};a.prototype.fillText=function(a,d,e){this.$m(a,d,e,0)};a.prototype.strokeText=function(a,d,e){this.$m(a,d,e,1)};a.prototype.Rj=function(){if(this.pf!==this.fillStyle){if(this.fillStyle instanceof jd){var a=this.rb.zj(this.fillStyle,
this.sa);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=A.pc(this.fillStyle).Hd(A.RGBA),this.stream.push(this.rb.Mc(a.values[0],a.values[1],a.values[2])+" rg"),a=this.rb.Op(a.values[3],!0),this.stream.push("/"+a+" gs"));this.pf=this.fillStyle}};a.prototype.Sj=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.vf!==this.strokeStyle){if(this.strokeStyle instanceof jd){var e=this.rb.zj(this.strokeStyle,
this.sa);this.stream.push("/Pattern CS");this.stream.push(e+" SCN")}else"string"===typeof this.strokeStyle&&(e=A.pc(this.strokeStyle).Hd(A.RGBA),this.stream.push(this.rb.Mc(e.values[0],e.values[1],e.values[2])+" RG"),e=this.rb.Op(e.values[3],!1),this.stream.push("/"+e+" gs"));this.vf=this.strokeStyle}this.uf!==this.lineWidth&&(this.uf=this.lineWidth,this.stream.push(this.rb.Mc(72*this.lineWidth/96)+" w"));this.tf!==this.lineJoin&&(this.tf=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.sf!==
this.lineCap&&(this.sf=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.rq=function(a,d,e,c){var b=this.Sf(this.font);if(this.rf!==b.fontSize||this.qf!==b.fontFamily){var f=this.rb.hv(b.fontFamily);this.stream.push(f+" "+this.rb.Mc(parseFloat(b.fontSize))+" Tf");this.rf=b.fontSize;this.qf=b.fontFamily}this.nf!==c&&(this.stream.push(c+" Tr"),this.nf=c);0===c?this.Rj():this.Sj();this.stream.push("BT");d=this.sa.multiply(new O(1,0,0,-1,d,e));this.stream.push(this.rb.Mc(d.m11,d.m21,d.m12,
d.m22,d.Ca,d.Da)+" Tm");this.stream.push(this.rb.Dr(a)+" Tj");this.stream.push("ET")};a.prototype.qq=function(a,d,e,c){var b=this.Sf(this.font),f=this.Pr.get(b.fontFamily);f?(0===c?this.Rj():this.Sj(),this.beginPath(),f.wr(this,a,d,e,parseFloat(b.fontSize)),0===c?this.fill():this.stroke()):this.rq(a,d,e,c)};a.prototype.measureText=function(){return{width:1}};a.prototype.Sf=function(a){var b="",e="",c="normal",g="normal",h="normal",k="normal";a=a.split(/\s+/);a:for(;;){var l=a.shift();if(!l)break;
switch(l){case "normal":break;case "italic":case "oblique":c=l;break;case "small-caps":h=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":g=l;break;default:if(""===e)l=l.split("/"),e=l[0],1<l.length&&(k=l[1]);else{b=l;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:c,fontVariant:h,fontWeight:g,fontSize:e,lineHeight:k,fontFamily:b}};a.prototype.Qm=function(a,d,e,c,
g,h,k,l,m){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,e,c,g,h,k,l,m);k+=m;var b=document.createElement("canvas"),f=b.getContext("2d");b.width=c;b.height=g;f.drawImage(a,-d,-e);a=this.rb.yj(a instanceof HTMLImageElement?[a.src,d,e,c,g].join():a,b);this.stream.push("q");h=this.sa.multiply(new O(l,0,0,-m,h,k));this.stream.push(this.rb.Mc(h.m11,h.m21,h.m12,h.m22,h.Ca,h.Da)+" cm");this.stream.push(a+" Do");this.stream.push("Q")};a.prototype.zf=function(){return this.rb.zf()};return a}(ld);var od=function(){function c(){this.ba=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.ba.push({Tg:"L",Qd:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.ba.push({Tg:"M",Qd:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,e,c){this.ba.push({Tg:"Q",Qd:a.apply(b,d),lf:a.apply(e,c)})};c.prototype.bezierCurveTo=function(a,b,d,e,c,g,h){this.ba.push({Tg:"C",Qd:a.apply(b,d),lf:a.apply(e,c),rg:a.apply(g,h)})};c.prototype.closePath=function(){this.ba.push({Tg:"Z"})};
c.prototype.Ip=function(a){a=a.inverse();for(var b="",d=0;d<this.ba.length;d++){var e=this.ba[d];0<d&&(b+=" ");b+=e.Tg;if(e.Qd){var c=a.apply(e.Qd.x,e.Qd.y);b+=c.x+","+c.y;e.lf&&(c=a.apply(e.lf.x,e.lf.y),b+=","+c.x+","+c.y,e.rg&&(e=a.apply(e.rg.x,e.rg.y),b+=","+e.x+","+e.y))}}return b};return c}(),pd=function(c){function a(a){var b=c.call(this)||this;b.sa=new O;b.ba=[];b.path=new od;b.cc=[];b.log=B.create("SvgContext");b.Lg=1;b.Pf=2;b.Hj=4;b.log("SVG context rect: %s",a);b.root=new ta("svg",{xmlns:"http://www.w3.org/2000/svg",
"xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.pk=new ta("defs",{});b.root.We(b.pk);b.Ld=[b.root];return b}p(a,c);a.prototype.ug=function(a){a=new ta("g",a||{});this.ik().We(a);this.Ld.push(a)};a.prototype.tg=function(){var a=this.Ld.pop();if(a&&1===a.children.length){var d=a.children[0];d.pp(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=
d.children;a.text=d.text}};a.prototype.ik=function(){return this.Ld[this.Ld.length-1]};a.prototype.node=function(a,d,e,c){function b(a,b){if(b instanceof jd)e[a]="url(#"+f.zj(b)+")";else if("string"===typeof b){var d=A.pc(b),c=d.values[3];1>c&&(d.values[3]=1,e[a+"-opacity"]=""+c);e[a]=d.toString()}}void 0===e&&(e={});var f=this;this.sa.Wk()||(e.transform="matrix("+this.sa.m11+" "+this.sa.m21+" "+this.sa.m12+" "+this.sa.m22+" "+this.sa.Ca+" "+this.sa.Da+")");d&this.Lg?b("fill",this.fillStyle):e.fill=
"none";d&this.Pf&&(b("stroke",this.strokeStyle),e["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(e["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(e["stroke-linecap"]=this.lineCap));d&this.Hj&&(d=this.Sf(this.font),e["font-weight"]=d.fontWeight,e["font-size"]=parseFloat(d.fontSize),e["font-style"]=d.fontStyle,e["font-family"]=d.fontFamily);this.wq(new ta(a,e,c))};a.prototype.wq=function(a){var b=!0,e=null,c={},g,h=this.ik();0===h.children.length?b=!1:e=h.children[h.children.length-
1];!e||a.name===e.name&&a.text===e.text||(b=!1);if(b&&e)for(g in e.attributes)if(e.attributes.hasOwnProperty(g))if(g in a.attributes){var k=e.attributes[g],l=a.attributes[g];if(k!==l)if(0===g.indexOf("fill")||0===g.indexOf("stroke"))if("none"===k)c[g]=l;else if("none"===l)c[g]=k;else{b=!1;break}else{b=!1;break}}else c[g]=e.attributes[g];if(b&&e)for(g in a.attributes)a.attributes.hasOwnProperty(g)&&(g in e.attributes||(c[g]=a.attributes[g]));b&&e?e.pp(c):h.We(a)};a.prototype.Oi=function(a){if(a===
this.Pf){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof jd?!0:"string"===typeof a?0<A.pc(a).values[3]:!1};a.prototype.Tm=function(a){for(var b=0;b<this.cc.length;b++)if(this.cc[b].oh===a)return this.cc[b].Ah;return null};a.prototype.yj=function(a){var b=this.Tm(a);if(b)return b;b="image"+this.cc.length;this.cc.push({oh:a,Ah:b});var e=document.createElement("canvas"),c=e.getContext("2d");e.width=a.width;e.height=a.height;c.drawImage(a,0,0);e=e.toDataURL();
a=new ta("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":e});this.pk.We(a);return b};a.prototype.zj=function(a){var b=this.Tm(a);if(b)return b;var c=this.yj(a.ya);b="pattern"+this.cc.length;this.cc.push({oh:a,Ah:b});var f=new ta("pattern",{id:b});"no-repeat"===a.repeat?(f.attributes.width="1",f.attributes.height="1"):"repeat-x"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.ya.width,f.attributes.height=1E4):("repeat-y"===a.repeat?(f.attributes.patternUnits=
"userSpaceOnUse",f.attributes.width=1E4):(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.ya.width),f.attributes.height=a.ya.height);f.We(new ta("use",{"xlink:href":"#"+c}));this.pk.We(f);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.toBlob=function(){for(var a=this.toString(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);return new Blob([d],{type:"image/svg+xml"})};a.prototype.beginPath=
function(){this.path=new od};a.prototype.transform=function(a,d,c,f,g,h){a=new O(a,c,d,f,g,h);this.sa=this.sa.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.Oi(this.Lg)&&this.node("path",this.Lg,{d:this.path.Ip(this.sa)})};a.prototype.stroke=function(){this.Oi(this.Pf)&&this.node("path",this.Pf,{d:this.path.Ip(this.sa)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.sa,a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.sa,
a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(this.sa,a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,g,h){this.path.bezierCurveTo(this.sa,a,d,c,f,g,h)};a.prototype.fillText=function(a,d,c){this.Oi(this.Lg)&&(this.Sf(this.font),this.node("text",this.Lg|this.Hj,{x:d,y:c},a))};a.prototype.strokeText=function(a,d,c){this.Oi(this.Pf)&&(this.Sf(this.font),this.node("text",this.Pf|this.Hj,{x:d,y:c},a))};a.prototype.Qm=function(a,d,c,f,g,h,k,l,m){var b=document.createElement("canvas"),
e=b.getContext("2d");b.width=f;b.height=g;e.drawImage(a,-d,-c);a=b.toDataURL();this.ik().We(new ta("image",{transform:"matrix("+this.sa.m11+" "+this.sa.m21+" "+this.sa.m12+" "+this.sa.m22+" "+this.sa.Ca+" "+this.sa.Da+")",x:h,y:k,width:l,height:m,"xlink:href":a}))};a.prototype.measureText=function(){return{width:1}};a.prototype.Cg=function(){};return a}(ld);var ud=new (function(){function c(){this.log=B.create("serializer")}c.prototype.Ij=function(a){if(a instanceof Array)var b=this.ro(a);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.ft(a);else if(0===a.indexOf("zwibbler3."))b=JSON.parse(a.substr(10)),b=this.ro(b);else if(0===a.indexOf("zwibblerclip."))b=new qd(!1),a=b.Eo(a,new O),b.pa(a),b.Eh();else throw Error("Format detection failed.");}for(a=1;a<b.Gc();a++)b.dm(a,
!1);return b};c.prototype.ft=function(a){function b(a){var b=new O;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Ca=a.dx;b.Da=a.dy;return b}function d(a,c){switch(a.type){case "Node":for(var e=[],h=a.children,k=h.length-1;0<=k;k--){var l=f.pb;try{d(h[k],c+1)}catch(E){continue}e.push(l)}0<c&&g.push(new rd(f.Wa(),e));break;case "PathNode":case "ArrowNode":var v=a;h=0;"arrowSize"in v&&(h=v.arrowSize,v=v.path);e=b(v.matrix);h={strokeStyle:v.strokeStyle,fillStyle:v.fillStyle,lineWidth:v.lineWidth,
smoothness:v.smoothness,sloppiness:v.sloppiness,shadow:v.shadow,arrowSize:h,seed:Math.round(65535*Math.random())};"textNode"in v&&(k=v.textNode,h.fontSize=k.fontSize,h.fontName=k.fontName,h.text=k.text,h.textFillStyle="textFillStyle"in k?k.textFillStyle:k.fillStyle);"path"in v&&(v=v.path);var y=v.startX,z=v.startY;k=v.closed;l=new U;v=v.segments;y=e.apply(y,z);l.moveTo(y.x,y.y);for(y=0;y<v.length;y++){var w=v[y];switch(w.type){case 1:z=e.apply(w.x,w.y);l.lineTo(z.x,z.y);break;case 2:z=e.apply(w.x,
w.y);l.Yg(z.x,z.y);break;case 3:z=e.apply(w.x1,w.y1);w=e.apply(w.x,w.y);l.Ze(z.x,z.y,w.x,w.y);break;default:throw"Unknown path segment type: "+w.type;}}k&&l.close();h.commands=l.ic();g.push(new V(f.Wa(),"PathNode",h));break;case "TextNode":e=b(a.matrix);e=e.multiply(new M(0,1.3*a.fontSize));e={fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:e};g.push(new V(f.Wa(),"TextNode",e));break;default:throw Error("Unknown node type: "+a.type);}}var c=B.create("IMPORT"),
f=new qd,g=[];try{var h=JSON.parse(a)}catch(k){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{h=JSON.parse(a)}catch(l){throw c("Couldn't parse file."),"Couldn't parse file.";}}c("Successfully parsed!");d(h,0);f.pa(g);return f};c.prototype.ro=function(a){function b(a,d){if(void 0!==a){var e={};for(var g in a)a.hasOwnProperty(g)&&"children"!==g&&"parent"!==g&&"id"!==g&&"type"!==g&&(e[g]="matrix"===g?new O(a[g]):a[g]);g=f;0!==a.id&&c.push(new V(g,a.type,e,d,-1));f+=1;if(void 0!==a.children)for(e=
0;e<a.children.length;e++)b(a.children[e],g)}}var d;a=JSON.parse(JSON.stringify(a));var c=[],f=0,g={},h=!1;for(d=0;d<a.length;d++){var k=a[d];if("document"===k.type)delete k.type,c.push(new sd(k));else{"PageNode"===k.type&&(h=!0);if("parent"in k){if(!(k.parent in g))throw"Error: child "+k.id+" references parent "+k.parent+" before it was defined.";var l=g[k.parent];void 0!==l.children?l.children.push(k):l.children=[k]}"GroupNode"!==k.type&&"PageNode"!==k.type||void 0!==k.children||(k.children=[]);
g[k.id]=k}}h||(f+=1);b(g[0],f);for(d=0;d<c.length;d++)this.log(c[d].toString());a=new qd(h);a.pa(c);a.Eh();return a};c.prototype.Kn=function(a){function b(a,c){var e={id:c.id,type:c.type()};d.push(e);a&&(e.parent=a.id);var f=c.vc(),g;for(g in f)f.hasOwnProperty(g)&&("matrix"===g?e[g]=f[g].ic():"inverse"!==g&&(e[g]=f[g]));if(c.wo()&&c.children)for(e=0;e<c.children.length;e++)b(c,c.children[e])}var d=[],c={type:"document"},f=!1,g;for(g in a.aa)a.aa.hasOwnProperty(g)&&(c[g]=a.aa[g],f=!0);f&&d.push(c);
b(null,a.getRootNode());return d};c.prototype.Lj=function(a,b,d){if("list"===b)a=this.Kn(a),b="application/json";else if("zwibbler3"===b)a=this.Kn(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("svg"===b){b=a.re();var c=new pd(b);a.ja(c);a=c;b="image/svg+xml"}else if("pdf"===b){b=a.re();c=new nd(b,td.fonts);var f=a.Va;for(b=0;b<a.Gc();b++)0<b&&c.Cg(),a.Db(b),a.ja(c);a.Db(f);a=c;b="application/pdf"}else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===d)var g=
a;else if("data-uri"===d)g="data:"+b+";base64,"+x.encode("base64",a);else{if("blob"===d)for(d=new Uint8Array(a.length),b=0;b<a.length;b++)d[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===d?g=a.toString():"data-uri"===d?g="data:"+b+";base64,"+x.encode("base64",a.toString()):"blob"===d&&(g=a.toBlob());else if("object"===d)g=a;else throw"Error in ZwibblerDocument.save()";return g};return c}());var vd=new (function(){function c(){this.Ak={}}c.prototype.hi=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.hi()?window.localStorage.setItem(a,b):this.Ak[a]=""+b};c.prototype.getItem=function(a){return this.hi()?window.localStorage.getItem(a):this.Ak[a]};c.prototype.removeItem=function(a){this.hi()?window.localStorage.removeItem(a):delete this.Ak[a]};return c}());function wd(c){function a(a){b&&clearTimeout(b);b=setTimeout(function(){b=null;c()},arguments.length?a:1E3)}var b=null;a.cancel=function(){b&&(clearTimeout(b),b=null)};return a};var zd=function(){function c(a,b,d,c,f,g,h){this.view=a;this.node=b;this.handle=d;this.xf=g;this.Ph=this.Oh=0;this.log=B.create("MoveEditNode");this.Vo=b.kh(d);this.Fa=b.la("snap")||0;this.Ta(c,f,h)}c.prototype.uc=function(){this.log("Entering MoveEditNode")};c.prototype.Jc=function(){this.log("Leaving MoveEditNode")};c.prototype.xb=function(a){if("touchmove"===a.type){var b=a.touches[0];b=this.view.gb(b.pageX,b.pageY);return this.Ua(b.x,b.y,a)}return"touchend"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,
b.pageY),this.ab(b.x,b.y,a)):!1};c.prototype.Ta=function(a,b){var d=this.view.Fa(new F(a,b),this.Fa);a=d.x;b=d.y;this.log("onMouseDown(%s,%s)",a,b);this.Oh=a;this.Ph=b;return!0};c.prototype.Ua=function(a,b){var d=this.view.Fa(new F(a,b),this.Fa);a=d.x;b=d.y;this.node.we(this.handle,a,b);this.node.format(this.view.ka,this.view.request);this.view.ja();return!1};c.prototype.ab=function(a,b){var d=this.view.Fa(new F(a,b),this.Fa);a=d.x;b=d.y;this.log("onMouseUp(%s,%s)",a,b,this.Oh,this.Ph);a!==this.Oh||
b!==this.Ph?this.view.pa([new xd(this.node.id,this.handle,this.Vo.x,this.Vo.y,a,b)]):this.view.ju(this.node.id,this.handle);this.view.ja();this.view.Qa(this.xf||new yd(this.view));return!0};return c}();function Ad(){this.y=this.x=0}
var Bd=function(c){function a(a,d,e){var b=c.call(this)||this;b.sa=a;b.tl=d;b.origin=e;a=b.sa.apply(d.x,d.y);b.x=a.x;b.y=a.y;return b}p(a,c);a.prototype.lh=function(a){var b=1,c=1,f=this.sa.inverse(),g=f.apply(this.x+a.x,this.y+a.y);a=new F(this.tl.x-this.origin.x,this.tl.y-this.origin.y);g=new F(g.x-this.origin.x,g.y-this.origin.y);g=(g.x*a.x+g.y*a.y)/(a.x*a.x+a.y*a.y);0!==a.x&&0!==a.y?c=b=g:0!==a.x?b=g:c=g;return this.sa.multiply(new P(b,c,this.origin.x,this.origin.y)).multiply(f)};return a}(Ad),
Cd=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.sa=a;b.tl=d;b.li=f;b.log=B.create("RotationSelHandle");b.origin=b.sa.apply(e.x,e.y);a=b.sa.apply(d.x,d.y);b.x=a.x;b.y=a.y;b.Vl=Math.atan2(b.y-b.origin.y,b.x-b.origin.x);b.li=f;return b}p(a,c);a.prototype.lh=function(a){a=Math.atan2(this.y+a.y-this.origin.y,this.x+a.x-this.origin.x)-this.Vl;if(this.li){var b=Math.PI/16;a=Math.floor(a/b)*b}return new N(-a,this.origin.x,this.origin.y)};return a}(Ad),Dd=function(c){function a(a){var b=c.call(this)||
this;b.sa=a;return b}p(a,c);a.prototype.lh=function(a){return new M(a.x,a.y)};return a}(Ad),Ed=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}p(a,c);a.prototype.lh=function(){return new O};return a}(Ad);function Fd(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Hd=function(){function c(a,b,d,c,f,g){this.view=a;this.handle=b;this.Zu=d;this.Fh=new K(0,0,0,0);this.ra=[];this.ve=[];this.zd=new F(0,0);this.log=B.create("TransformSelectionBehaviour");this.view.Ep(this.handle instanceof Cd);this.no=!1;this.Fa=0;this.Ta(c,f,g)}c.prototype.xb=function(a){var b;if(this.no||"touchmove"!==a.type&&"touchstart"!==a.type&&"touchend"!==a.type)return!1;for(b=0;b<a.touches.length;){b=a.touches[b];b=this.view.gb(b.pageX,b.pageY);"touchmove"===a.type&&this.Ua(b.x,b.y,a);
break}for(b=0;b<a.changedTouches.length;){b=a.changedTouches[b];b=this.view.gb(b.pageX,b.pageY);"touchend"===a.type&&this.ab(b.x,b.y,a);break}return!0};c.prototype.$a=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.no=!0;var b=this.Fh.x+this.Fh.width/2,d=this.Fh.y+this.Fh.height/2,c=a.scale;this.view.Gh||(c=1);var f=-a.rotation/180*Math.PI;if(0<this.view.da.get("snap")){var g=Math.PI/
16;f=Math.floor(f/g)*g}c=new P(c,c,b,d);b=new N(f,b,d);b=c.multiply(b);for(d=0;d<this.ra.length;d++)this.ra[d].zg(b.multiply(this.ve[d])),this.ra[d].format(this.view.ka,this.view.request);this.view.gm(b);this.view.ja();if("gestureend"===a.type){for(d=0;d<this.ra.length;d++)this.ra[d].zg(this.ve[d]);this.view.pa([new Gd(Fd(this.ra),b)]);this.Jn()}return!0};c.prototype.Ta=function(a,b){this.ra=this.view.qe();this.Gr(this.ra);this.zd=this.view.Fa(new F(a,b),this.Fa);this.log("onMouseDown(%s,%s)",this.zd.x,
this.zd.y);this.Fh=new K(this.view.ed.x,this.view.ed.y,this.view.ed.width,this.view.ed.height);return!0};c.prototype.Gr=function(a){this.ve=[];for(var b=0;b<a.length;b++)this.ve.push(a[b].Ga()),this.Fa=this.Fa||a[b].la("snap")};c.prototype.Ua=function(a,b){var d=this;var c=this.view.Fa(new F(a,b),this.Fa);var f=c.x;var g=c.y;var h=this.handle.lh(new F(c.x-this.zd.x,c.y-this.zd.y));h=this.Yo(h,a,b);for(var k=0;k<this.ra.length;k++)c=h.multiply(this.ve[k]),this.ra[k].zg(c),this.ra[k].format(this.view.ka,
this.view.request);this.view.gm(h);this.view.ja(function(){if(d.handle instanceof Cd){var a=d.view.ka;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/d.view.scale;a.moveTo(d.handle.origin.x,d.handle.origin.y);a.lineTo(f,g);a.stroke();a.restore()}});return!0};c.prototype.ab=function(a,b){var d=a,c=b,f=this.view.Fa(new F(a,b),this.Fa);a=f.x;b=f.y;this.log("onMouseUp(%s,%s)",a,b);if(f.Jd(this.zd))this.Zu?(d=this.view.ha.lb(d,c,this.view.La))&&d.hg()?(this.log("Didn't move, and has edit mode. Selecting node %s",
d.id),this.view.sb(),this.view.Ef(d)):this.log("Didn't move, but node has no edit mode or failed hittest"):this.log("Didn't move, but toggleEditNode=false");else{this.log("Moved by %s,%s",a-this.zd.x,b-this.zd.y);f=this.handle.lh(new F(f.x-this.zd.x,f.y-this.zd.y));f=this.Yo(f,d,c);for(d=0;d<this.ra.length;d++)this.ra[d].zg(this.ve[d]);this.view.pa([new Gd(Fd(this.ra),f)])}this.Jn();return!0};c.prototype.Jn=function(){this.view.gm(new O);this.view.Ep(!0);this.view.Wf();this.view.update(!0);this.view.Xa()};
c.prototype.Kt=function(a){a=a.split(/\s+/);for(var b,d={kj:"bottom",Ch:"inside",ag:0},c=0;c<a.length;c++)switch(b=a[c],b){case "left":case "top":case "right":case "bottom":case "hcentre":case "vcentre":d.kj=b;break;case "hcenter":d.kj="hcentre";break;case "vcenter":d.kj="vcentre";break;case "inside":case "outside":case "middle":d.Ch=b;break;default:if(b=parseFloat(b))d.ag=b}return d};c.prototype.Yo=function(a,b,d){if(1<this.ra.length||!a.xo())return a;var c=this.ra[0].la("wallAffinity");if(!c)return a;
var f=this.view.ha.lb(b,d,this.view.La,"WallNode");if(null===f)return a;var g=f.sd(b,d,this.view.scale);if("middle"!==f.ne(g))return a;var h=this.Kt(c);a=f.ls(g);var k=this.ve[0].fg();this.log("Scale=%s",k);var l=this.ra[0].cb.clone();c=new O;c=(new P(k.x,k.y,0,0)).multiply(c);l.width*=k.x;l.height*=k.y;switch(h.kj){case "left":c=(new N(-Math.PI/2,0,0)).multiply(c);c=(new M(l.width/2,0)).multiply(c);break;default:case "top":c=(new M(-l.width/2,0)).multiply(c);break;case "right":c=(new N(Math.PI/2,
0,0)).multiply(c);c=(new M(-l.height/2,l.width)).multiply(c);break;case "bottom":c=(new N(Math.PI,0,0)).multiply(c);c=(new M(l.width/2,l.height)).multiply(c);break;case "hcentre":c=(new M(-l.width/2,-l.height/2)).multiply(c);break;case "vcentre":c=(new M(-l.width/2,-l.height/2)).multiply(c),c=(new N(-Math.PI/2,0,0)).multiply(c)}k="outside"===h.Ch;"inside"===h.Ch||k?(k=f.Pk(g,"inside",h.ag,b,d),f=f.Pk(g,"outside",h.ag,b,d),f.Pa(new F(b,d))<k.Pa(new F(b,d))||"outside"===h.Ch?(c=(new N(Math.PI,0,0)).multiply(c),
b=f):b=k):b=f.Pk(g,h.Ch,h.ag,b,d);c=(new N(-a,0,0)).multiply(c);c=(new M(b.x,b.y)).multiply(c);return c.multiply(this.ve[0].inverse())};return c}();var Jd=function(){function c(a,b){this.view=a;this.aa=b;this.yi=!1;this.Aa=this.je=this.ma=null;this.fillStyle="#000000";this.Bk=!1;this.$l="normal";this.log=B.create("Text");this.multiline=a.da.get("multilineText");this.wb=document.createElement("div");a.da.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.$l="top")}c.prototype.uc=function(){this.log("Entering text mode");this.view.canvas.style.cursor="text"};c.prototype.Jc=function(){this.yi&&this.oi();this.view.canvas.style.cursor=
"default";this.log("Leaving text mode");this.ma&&this.ma.parentNode&&(this.ma.parentNode.removeChild(this.ma),this.ma=null);this.wb.parentNode&&this.wb.parentNode.removeChild(this.wb)};c.prototype.xb=function(a){if("touchstart"!==a.type&&"touchend"!==a.type&&"touchmove"!==a.type)return!1;for(var b=0;b<a.touches.length;b++){var d=a.touches[b];d=this.view.gb(d.pageX,d.pageY);"touchstart"===a.type&&this.Ta(d.x,d.y,a)}return!1};c.prototype.Ta=function(a,b,d){this.log("onMouseDown(%s)",d.type);this.yi?
(this.log("Editing somewhere else on mousedown; submit that first."),this.oi(),this.view.da.get("autoPickToolText")&&this.view.Xa()):(d=this.view.ha.lb(a,b,this.view.La),this.Xl(d,a,b));this.log("Eating click");this.view.xi=!0;return!1};c.prototype.Fr=function(){if(this.wb&&this.ma){this.wb.style.fontSize=this.ma.style.fontSize;this.wb.style.fontFamily=this.ma.style.fontFamily;this.wb.style.fontWeight=this.ma.style.fontWeight;this.wb.style.fontStyle=this.ma.style.fontStyle;this.wb.style.whiteSpace=
"pre-line";this.wb.style.position="absolute";this.wb.style.visibility="hidden";this.wb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.wb);this.wb.style.left="0";for(this.wb.style.top="0";this.wb.firstChild;)this.wb.removeChild(this.wb.firstChild);this.wb.appendChild(document.createTextNode(this.ma.value));var a=C(this.wb).width(),b=C(this.ma).width();b<a&&(b=a,this.view.da.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),C(this.ma).width(b+2))}};c.prototype.Xl=
function(a,b,d){function c(){n.ma&&(n.log("Set editBox height to %s",""+n.ma.scrollHeight+"px"),n.ma.style.height=""+n.ma.scrollHeight+"px",n.ma.style.width=""+n.ma.scrollWidth+"px");r=null}var f=0;this.Bk=!1;if(a&&"TextNode"===a.type()||a&&"PathNode"===a.type()&&this.view.da.get("allowTextInShape")){this.Aa=a;"top"!==this.$l&&"TextNode"===a.type()&&this.Aa.Ce(!0);this.view.ja();this.je=new F(a.rect.x,a.rect.y);var g=a.la("fontName");var h=a.la("fontSize");var k=a.la("bold");var l=a.la("italic");
var m=a.la("textDecoration");f=a.rect.width*this.view.scale;f=Math.max(f,200);this.fillStyle=a.la("textFillStyle")||this.Gb("textFillStyle")}else this.Aa=null,this.je=new F(b,d),g=this.Gb("fontName"),h=this.Gb("fontSize"),k=this.Gb("bold"),l=this.Gb("italic"),m=this.Gb("textDecoration"),this.fillStyle=this.aa.fillStyle||this.Gb("textFillStyle")||this.Gb("fillStyle");var n=this;this.ma=document.createElement("textarea");a=C(this.ma).height();this.ma.style.width=f?""+f+"px":"auto";f=this.view.rk(this.je.x,
this.je.y);this.ma.style.position="absolute";this.ma.style.fontFamily=g;this.ma.style.fontSize=""+h*this.view.scale+"px";this.ma.style.overflow="auto";this.ma.style.fontWeight=k?"bold":"normal";this.ma.style.fontStyle=l?"italic":"normal";this.ma.style.padding="0";this.ma.style.border="1px solid #888";this.ma.style.color=this.fillStyle;this.ma.style.backgroundColor=this.Gb("background");this.Aa&&"PathNode"===this.Aa.type()&&(this.ma.style.backgroundColor="white");this.ma.style.textDecoration=m||"none";
this.ma.style.textAlign=this.Gb("textAlign");this.ma.style.zIndex=""+(this.view.gg()+1);this.log("Using z-index %s",this.ma.style.zIndex);"#ffffff"===A.pc(this.fillStyle).toString()&&(this.ma.style.backgroundColor="#808080");g=C(this.view.canvas.parentNode);h=g.offset();l=k=0;"top"===this.$l?(l=C(this.view.canvas).offset(),k=C(this.view.canvas).width(),f=C(this.ma).width(),k=l.left+k/2-f/2,l=l.top):(k=Math.round(f.x)-1,l=Math.round(f.y)-1);this.ma.style.WebkitTransitionDuration="0";this.ma.style.MozTransitionDuration=
"0";this.ma.style.msTransitionDuration="0";this.ma.style.OTransitionDuration="0";this.ma.style.transitionDuration="0";this.ma.style.left=k-h.left+"px";this.ma.style.top=l-h.top+"px";g[0].appendChild(this.ma);bc(C(this.ma));this.yi=!0;this.je=new F(b,d+a);this.Aa&&(this.ma.value=this.Aa.la("text"));var r=null;r=setTimeout(c,0);C(this.ma).bind("keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&n.multiline||13===a.keyCode&&(a.shiftKey||!n.multiline)?(n.log("Enter pressed. create text."),n.oi(),
n.view.Ea.yb&&n.view.Cp(a),n.view.bc.bf("goto-canvas"),n.view.da.get("autoPickToolText")&&n.view.Xa()):27===a.keyCode?(n.log("ESC pressed; cancel."),n.cancel(),n.view.Xa(),n.view.bc.ta("goto-toolbar")):13===a.keyCode&&(r||(r=setTimeout(c,0))))});C(this.ma).bind("input propertychange",function(){null===n.Aa&&n.Fr()});this.view.da.get("leaveTextToolOnBlur")&&(C(this.ma).bind("focus",function(){n.log("Text focus received.")}),C(this.ma).bind("blur",function(){n.ma&&!n.ma.zl&&(n.log("Text blur received -- removing=%s",
!0===n.ma.zl),n.ma.zl=!0,n.oi())}));setTimeout(function(){n.ma&&n.ma.focus()},200);this.ma.focus();this.view.ua.ta("edit-text-shown",n.ma)};c.prototype.cancel=function(){this.ma&&(this.ma.zl=!0,this.ma.parentNode&&this.ma.parentNode.removeChild(this.ma),this.view.ua.ta("edit-text-hidden"));this.ma=null;this.yi=!1;this.Aa&&(this.Aa.Ce(!1),this.view.ja())};c.prototype.Gb=function(a){return a in this.aa?this.aa[a]:"background"===a?this.view.da.get("defaultTextBackground"):this.view.va[a]};c.prototype.oi=
function(){if(this.ma){var a=this.ma.value;this.cancel();if(this.Aa&&this.Aa.la("text")===a&&!this.Bk)this.log("Text was not changed.");else if(null===this.Aa&&""===a)this.log("No text entered.");else if(this.Aa)this.log("Update text in node %s",this.Aa.id),a=[new Id([this.Aa.id],"text",a),new Id([this.Aa.id],"textFillStyle",this.fillStyle)],"bold"in this.aa&&a.push(new Id([this.Aa.id],"bold",this.aa.bold)),"italic"in this.aa&&a.push(new Id([this.Aa.id],"italic",this.aa.bold)),this.view.pa(a);else if(this.je){this.log("Create new text node.");
var b=this.view.ha.pb,d=0,c=this.Gb("fontSize");this.view.da.get("multilineText")||(d=c);d=new M(this.je.x,this.je.y+d);this.view.pa([new V(this.view.ha.Wa(),"TextNode",bb({text:a,background:this.Gb("background"),fontSize:c,fontName:this.Gb("fontName"),bold:this.Gb("bold"),italic:this.Gb("italic"),textFillStyle:this.Gb("textFillStyle"),strokeStyle:this.Gb("textStrokeStyle"),lineWidth:this.Gb("textLineWidth"),layer:this.aa.layer||this.view.La,wrap:this.view.da.get("multilineText")},this.aa)),new Gd([b],
d)])}}};c.prototype.Ua=function(){return!1};c.prototype.ec=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===this.ma&&(this.view.Xa(),this.view.bc.ta("goto-toolbar"))};c.prototype.td=function(a){this.log("Set text colour to %s",a);this.Bk=!0;this.fillStyle=a;this.aa.textFillStyle=a;this.ma&&(this.ma.style.color=a,"#ffffff"===A.pc(a).toString()?this.ma.style.backgroundColor="#808080":this.ma.style.backgroundColor="#ffffff")};c.prototype.ud=function(a,b){this.view.Ol(a,b)};c.prototype.ye=
function(a,b){if("defaultBold"===a)a="bold",this.ma&&(this.ma.style.fontWeight=b?"bold":"normal");else if("defaultItalic"===a)a="italic",this.ma&&(this.ma.style.fontStyle=b?"italic":"normal");else if("defaultTextBackground"===a)a="background",this.ma&&(this.ma.style.backgroundColor=b);else{if("defaultFont"===a){this.ma&&(this.ma.style.fontFamily=b);return}if("defaultFontSize"===a){this.ma&&(this.ma.style.fontSize=b+"px");return}if("defaultTextFillStyle"===a){this.ma&&(this.ma.style.color=b);return}if("defaultTextDecoration"===
a){this.ma&&(this.ma.style.textDecoration=b);return}if("defaultTextAlign"===a){this.ma&&(this.ma.style.textAlign=b);return}}this.log("Update %s=%s",a,b);this.aa[a]=b};c.prototype.Yc=function(){return"text"};c.prototype.Ge=function(a,b){this.aa[a]=b};return c}();var yd=function(){function c(a){this.view=a;this.lp=1;this.log=B.create("DefaultBehaviour");this.view.De("");if(this.Wd=this.view.da.Wd())this.lp=2;this.gc=new Ic(a)}c.prototype.uc=function(){this.log("Entering pick tool.");this.view.canvas.style.cursor="default"};c.prototype.Jc=function(){this.log("Leaving pick tool.")};c.prototype.xb=function(a){if("touchmove"!==a.type&&"touchstart"!==a.type&&"touchend"!==a.type)return!1;for(var b=0;b<a.touches.length;b++){var d=a.touches[b];d=this.view.gb(d.pageX,
d.pageY);if("touchstart"===a.type)return this.Os(d.x,d.y,a);if("touchend"===a.type)return this.ab(d.x,d.y,a)}return!1};c.prototype.$a=function(a){return this.gc.$a(a)};c.prototype.Os=function(a,b,d){return this.Ta(a,b,d)};c.prototype.Ta=function(a,b,d){var c,f;this.log("onMouseDown");if(d.button)return this.log("   -- not main button. ignore."),!1;if(this.view.da.get("readOnly"))return(c=this.view.ha.lb(a,b,this.view.La))?(this.log("layer=%s active=%s",c.Kd(),this.view.La),this.view.ua.ta("node-clicked",
c.id,a,b)):this.log("readOnly mode: Ignoring click."),!1;if(f=this.view.os(a,b))return this.view.Qa(new Hd(this.view,f,!1,a,b,d)),!0;this.view.selection.length&&this.view.Vs(d)&&this.view.Zg();if(this.view.Aa&&(c=this.view.Aa,f=c.sd(a,b,1/this.view.scale*this.lp),null!==f))return this.view.Qa(new zd(this.view,c,f,a,b,this,d)),!0;if(c=this.view.ha.lb(a,b,this.view.La))this.log("layer=%s active=%s",c.Kd(),this.view.La),this.view.ua.ta("node-clicked",c.id,a,b);if(c&&c.Kd()===this.view.La){var g=c===
this.view.Aa,h=this.view.Ts(c);this.log("wasEditNode: %s, wasSelected: %s",g,h);if("WallNode"===c.type()&&1<c.Ob.length&&(f=c.sd(a,b,1/this.view.scale),null!==f))return this.view.Qa(new zd(this.view,c,f,a,b,this,d)),!0;h||(d.shiftKey||this.view.sb(),this.view.Se(c),this.view.Tb());this.view.Qa(new Hd(this.view,this.view.xg?new Dd(c.Ga()):new Ed,!g&&h,a,b,d))}else if(this.view.$o(a,b))this.view.Qa(new Hd(this.view,this.view.xg?new Dd(this.view.selection[0].Ga()):new Ed,!0,a,b,d));else if(this.view.da.Xr())this.view.Ef(null),
this.view.Qa(new Fc(this.view,this,a,b));else return this.log("Disabled select box -- mobile touch active."),this.view.Ef(null),this.view.sb(),this.view.Tb(),this.view.ja(),!1;return!0};c.prototype.ab=function(){this.log("onMouseUp");return!1};c.prototype.ec=function(a,b){this.log("keyboard: %s",a);var d=!0,c=this.view.da.get("nudge");b&&b.ctrlKey&&(c=this.view.da.get("preciseNudge"));switch(a){case "bring-to-front":this.view.Qg();break;case "send-to-back":this.view.Hh();break;case "left":this.view.Vi(-1,
0,c)||(this.view.tb=Math.min(this.view.tb+16,0),this.view.mc(),this.view.ja());break;case "right":this.view.Vi(1,0,c)||(c=this.view.Ve.width,this.view.tb=Math.max(-(c*this.view.scale-c),this.view.tb-16),this.view.mc(),this.view.ja());break;case "up":this.view.Vi(0,-1,c)||(this.view.hb=Math.min(this.view.hb+16,0),this.view.mc(),this.view.ja());break;case "down":this.view.Vi(0,1,c)||(c=this.view.Ve.height,this.view.hb=Math.max(-(c*this.view.scale-c),this.view.hb-16),this.view.mc(),this.view.ja());break;
case "select-none":this.view.sb();this.view.Tb();this.view.ja();this.view.Ea.yb&&this.view.bc.ta("goto-toolbar");break;case "select-all":var f=[];this.view.ha.$e(function(a){f.push(a)});this.view.selectNodes(f);this.view.ja();this.view.Ea.yb&&this.view.bc.ta("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Ri();break;case "move-down":this.view.Qi();break;case "delete":this.view.Zg();break;case "curve-tool":this.view.kk({});break;case "line-tool":this.view.bl({},
!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Uh();break;case "undo":this.view.ib();break;case "redo":this.view.wd();break;case "cut":this.view.nk();break;case "copy":this.view.de();break;case "paste":this.view.sg();break;case "zoom-normal":this.view.da.get("allowZoom")?(c=this.view.me(),this.view.scale=1,this.view.tb=-c.x,this.view.hb=-c.y,this.view.mc(),this.view.ja()):this.log("Zooming is disabled.");break;case "zoom-in":this.view.da.get("allowZoom")?this.view.Bj():
this.log("Zooming is disabled.");break;case "zoom-out":this.view.da.get("allowZoom")?this.view.Cj():this.log("Zooming is disabled.");break;default:d=!1}d&&(b.preventDefault(),b.stopPropagation())};c.prototype.td=function(a,b){if(b){this.view.Fb=a;this.view.ac=a;var d="fillStyle"}else this.view.Sb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.ud=function(a,b){b?(this.view.Fb=Yb(this.view.Fb,a),this.view.ac=Yb(this.view.ac,a)):this.view.Sb=Yb(this.view.Sb,a);this.view.Ol(a,b)};c.prototype.Pd=
function(a,b){this.log("onDoubleClick");var d=this.view.ha.lb(a,b,this.view.La);this.log("hittest: %s, hasText: %s",null!==d,null!==d&&d.Li());this.view.ua.ta("double-click",a,b,d?d.id:null);if(d&&"PathNode"===d.type()&&!this.view.da.get("allowTextInShape"))this.log("Editing text in shape is disabled.");else if(d&&d.Li())this.log("Text double-clicked."),this.view.rj({}),this.view.na instanceof Jd&&this.view.na.Xl(d,a,b);else return!1;return!0};c.prototype.Yc=function(){return"pick"};return c}();var Kd=function(){function c(a,b,d,c){var e=this;this.view=a;this.xf=b;this.options=d;this.mode=c;this.Na=!1;this.Xb=[];this.Sh={};this.from=this.df=null;this.log=B.create("Brush");this.gc=new Ic(this.view);this.view.sb(!0);this.hp=function(){return e.kf()}}c.prototype.kf=function(){console.log("this is ",this);this.el(this.options.lineWidth/2)};c.prototype.uc=function(){this.view.canvas.style.cursor="crosshair";this.el(this.options.lineWidth/2);C(window).xa("resize",this.hp)};c.prototype.Jc=function(){this.view.canvas.style.cursor=
"default";this.view.ja();C(window).Hg("resize",this.hp)};c.prototype.reset=function(){this.Na=!1;this.Xb=[];this.Sh={}};c.prototype.$a=function(a){a=this.gc.$a(a);this.Na&&this.gc.active&&this.reset();return a};c.prototype.el=function(a){var b=document.createElement("canvas");a*=this.view.scale;a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle=
"#ffffff";d.stroke();d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.canvas.style.cursor="url("+b+") "+(a+1)+" "+(a+1)+", auto"};c.prototype.Ih=function(a){this.options.strokeStyle=a};c.prototype.Jl=function(a){this.options.lineWidth=a;this.el(a/2)};c.prototype.xb=function(a){var b;if(this.gc.active)return!0;if("touchstart"===a.type){var d=a.changedTouches;var c=0;for(b=d.length;c<b;c++){var f=d[c];a=this.view.gb(f.pageX,f.pageY,!0);this.Xb.push([a]);f.identifier&&(this.Sh[f.identifier]=
this.Xb[this.Xb.length-1])}this.Na=!0;1===this.Xb.length&&(this.df=this.view.gl())}else if("touchmove"===a.type){var g=a.changedTouches;b=0;for(d=g.length;b<d;b++)f=g[b],a=this.view.gb(f.pageX,f.pageY,!0),f.identifier?f.identifier in this.Sh?c=this.Sh[f.identifier]:(c=[a],this.Xb.push(c),this.Sh[f.identifier]=c):c=this.Kr(a),c?a.x===c[c.length-1].x&&a.y===c[c.length-1].y||c.push(a):this.log("WARNING: Can't find path for touch!");!1===this.Na&&(this.df=this.view.gl(),this.Na=!0);this.df?this.df.ja(this.Bh,
this):this.view.ja()}else"touchend"===a.type&&this.Na&&0===a.touches.length&&(this.pa(),this.Na=!1);return!0};c.prototype.Kr=function(a){var b=0,d;var c=null;for(d=0;d<this.Xb.length;d++){var f=this.Xb[d],g=f[f.length-1].Pa(a);if(null===c||g<b)c=f,b=g}c||(c=[a],this.Xb.push(c));return c};c.prototype.Ta=function(a,b){var d=new F(a,b);this.Na=!0;this.Xb.push([d]);1===this.Xb.length&&(this.df=this.view.gl());return!0};c.prototype.Bh=function(a){var b,d,c,f=this.view.un();a.lineCap=this.options.lineCap||
"round";a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.options.lineWidth;var g=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.beginPath();var h=this.Xb;var k=0;for(d=h.length;k<d;k++){var l=h[k];a.moveTo(l[0].x,l[0].y);var m=b=1;for(c=l.length-1;b<=c;m=b+=1)m=l[m],a.lineTo(m.x,m.y)}dc(a,this.options.strokeStyle);f&&a.restore();a.globalAlpha=g};c.prototype.Ua=function(a,b){var d=new F(a,b);this.Na&&(this.from=this.Xb[0][this.Xb[0].length-1],d.x!==this.from.x||
d.y!==this.from.y)&&(this.Xb[0].push(d),this.df?this.df.ja(this.Bh,this):this.view.ja());return!0};c.prototype.ab=function(a,b,d){this.Ua(a,b,d);this.Na=!1;this.pa();return!0};c.prototype.pa=function(){var a,b,d,c;var f=[];var g=this.Xb;var h=this.view.ha.pb;var k=0;for(d=g.length;k<d;k++){var l=g[k];if("brush"===this.mode){var m=[];1===l.length&&l.push(new F(l[0].x+.1,l[0].y+.1));if(1<l.length){var n=a=0;for(b=l.length-1;a<=b;n=a+=1)m.push(l[n].x),m.push(l[n].y);f.push(new V(this.view.ha.Wa(),"BrushNode",
bb({points:m,layer:this.view.La},this.options)))}}else{if("shapebrush"===this.mode){l=yc(l,20);b=l;if(!(2>b.length)){l=b[0];n=b[b.length-1];m=40>l.Pa(n);for(a=0;a<b.length;a++){var r=b[a];for(c=a+1;c<b.length;c++){var q=b[c];20>Math.abs(r.x-q.x)&&(q.x=r.x);20>Math.abs(r.y-q.y)&&(q.y=r.y)}}r=K.Me(b).Fd();for(a=0;a<b.length;a++)c=b[a],20>Math.abs(c.x-r.x)&&(c.x=r.x),20>Math.abs(c.y-r.y)&&(c.y=r.y);m&&(l.x=n.x,l.y=n.y)}l=b}else if("freehand"===this.mode)m=l,m=yc(m,2),m=Bc(m,4),l=m=yc(m,.5);else if("quadratic"===
this.mode){l=yc(l,10);a=Hc(l);m=a.ba[1];n=a.ba[2];c=a.ba[4];b=a.ba[5];l=a.ba[8];a=a.ba[9];c=((3*c-m)/2+(3*c-l)/2)/2;b=((3*b-n)/2+(3*b-a)/2)/2;r=new Q;r.moveTo(m,n);r.quadraticCurveTo(c,b,l,a);m=r;m=S.Wp(m);f.push(new V(this.view.ha.Wa(),"PathNode",bb({commands:m,fillStyle:this.view.Fb,sloppiness:0,layer:this.view.La},this.options)));continue}1===l.length&&"freehand"===this.mode&&l.push(new F(l[0].x+.1,l[0].y+.1));if(1<l.length){m=new U;m.moveTo(l[0].x,l[0].y);a=l[0].Jd(l[l.length-1]);n=b=1;for(c=
l.length-1;b<=c;n=b+=1)m.lineTo(l[n].x,l[n].y);a&&m.close();f.push(new V(this.view.ha.Wa(),"PathNode",bb({commands:m.ic(),fillStyle:this.view.Fb,sloppiness:0,layer:this.view.La},this.options)))}}}this.view.pa(f);this.view.sb();k=this.view.ha.za(h,!1);f.length&&"quadratic"===this.mode?(k&&this.view.Ef(k),this.view.Xa()):this.view.da.get("singleStrokeBrush")?(k&&this.view.Se(k),this.view.Xa()):this.reset();this.view.Tb()};c.prototype.td=function(a,b){this.options.strokeStyle=a;if(b){this.view.Fb=a;
this.view.ac=a;var d="fillStyle"}else this.view.Sb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.ud=function(a){this.view.ac=Yb(this.view.ac,a);this.options.strokeStyle=Yb(this.options.strokeStyle,a);this.view.Fb=this.view.ac};c.prototype.ec=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.Xa(),this.view.bc.ta("goto-toolbar"))};c.prototype.ye=function(a,b){"defaultBrushWidth"===a?this.Jl(b):"defaultBrushColour"===
a&&this.Ih(b)};c.prototype.Yc=function(){return"circle"===this.mode?"ellipse":this.mode};return c}();var Ld=function(){function c(a,b,d,c,f,g){void 0===d&&(d="");void 0===c&&(c={});void 0===f&&(f=!1);void 0===g&&(g=!1);this.view=a;this.type=b;this.url=d;this.aa=c;this.Mu=f;this.li=g;this.node=null;this.Dk=new F(0,0);this.al=new F(0,0);this.index=0;this.state="start";this.log=B.create("DRAWLINES");"wrap"in this.aa||(this.aa.wrap=this.view.da.get("multilineText"));"fontSize"in this.aa||(this.aa.fontSize=this.view.da.get("defaultFontSize"));this.gc=new Ic(this.view);this.view.sb(!0)}c.prototype.uc=
function(){this.log("Entering DrawLinesBehaviour");this.view.canvas.style.cursor="crosshair";this.view.da.Wd()||this.view.De("click-to-place-first-point-of-line");this.view.ja()};c.prototype.reset=function(){this.uc()};c.prototype.xb=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.gb(b.pageX,b.pageY);return this.Ta(b.x,b.y,a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.Ua(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],
b=this.view.gb(b.pageX,b.pageY),this.ab(b.x,b.y,a)):!1};c.prototype.$a=function(a){a=this.gc.$a(a);this.gc.active&&this.node&&this.reset();return a};c.prototype.ec=function(a){"cancel"===a&&(null!==this.node&&this.view.Ss&&"curve"===this.type&&this.pa(),null!==this.node&&this.view.ha.removeNode(this.node),this.view.Ea.yb?this.view.bc.ta("goto-toolbar"):this.view.Xa())};c.prototype.done=function(){this.view.da.get("autoPickTool")?(this.view.Xa(),this.view.cp()):this.state="start"};c.prototype.en=function(a,
b){this.node instanceof S&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.Yg(a,b):this.node.lineTo(a,b))};c.prototype.Ta=function(a,b){var d=this.view.Fa(new F(a,b));if("start"===this.state)if(this.Dk=new F(a,b),"stampline"===this.type)this.node=R.create("StampLineNode",this.view.ha.Wa(),this.view.ha),this.node.setProperty("x1",d.x),this.node.setProperty("y1",d.y),this.node.setProperty("x2",d.x),this.node.setProperty("y2",d.y),this.node.setProperty("url",this.url),
this.view.ha.Uf(this.node),this.view.De("click-to-set-the-end-of-the-line"),this.view.update(),this.index=3;else{this.node=new S(this.view.ha.Wa(),this.view.ha);this.node.setProperty("seed",Math.round(65535*Math.random()));this.node.setProperty("strokeStyle",this.view.Sb);this.node.setProperty("lineWidth",this.view.va.lineWidth);this.node.setProperty("sloppiness",this.view.va.sloppiness);this.node.setProperty("smoothness",this.view.va.smoothness);for(var c in this.aa)this.aa.hasOwnProperty(c)&&this.node.setProperty(c,
this.aa[c]);this.view.ha.Uf(this.node);"arrow"===this.type&&(this.node.setProperty("arrowSize",this.view.da.Ha("defaultArrowSize")),this.node.setProperty("arrowStyle",this.view.da.Ha("defaultArrowStyle")),this.node.setProperty("arrowXOffset",this.view.da.Ha("defaultArrowXOffset")));this.node.moveTo(d.x,d.y);this.en(d.x,d.y);this.index=3;this.view.update();this.state="predrag"}else if("placing"===this.state)if("arrow"!==this.type&&8>this.Dk.Pa(new F(a,b))&&3<this.index)this.log("Clicked close to start; automatically closing path"),
this.node instanceof S&&this.node.close(),this.pa(),this.done();else if(8>this.al.Pa(new F(a,b)))3<this.index?(this.node instanceof S&&this.node.du(this.index),this.pa()):this.cancel(),this.done();else{if(this.Mu)return this.pa(),this.done(),!0;this.node&&(this.en(d.x,d.y),this.index+=3,this.view.ha.kg(this.node.id),this.view.update())}else return this.log("Invalid state %s",this.state),!0;this.al=new F(d.x,d.y);return!0};c.prototype.ab=function(a,b){var d=new F(a,b);d=this.Dk.Pa(d);this.log("onMouseUp (%s,%s) %s",
a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.pa(),this.done()):(this.state="placing",this.view.De("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.Ua=function(a,b,d){b=this.view.Fa(new F(a,b));a=b.x;b=b.y;if(d.ctrlKey||this.li){d=this.al;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=
7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.we(this.index,a,b),this.node.format(this.view.ka,this.view.request),this.view.ja());return!1};c.prototype.qc=function(){this.log("onMouseClick()");return!0};c.prototype.cr=function(a){for(var b=0,d=[],c,f,g,h,k,l;b<a.length;){var m=a[b];switch(m){case S.Nf:g=a[b+1];h=a[b+2];d.push(m,g,h);break;case S.Zd:c=a[b+1],f=a[b+2],void 0!==g&&void 0!==h&&void 0!==
k&&void 0!==l&&d.push(S.Jg,c,f,(k+g)/2,(l+h)/2,(g+c)/2,(h+f)/2),k=g,l=h,g=c,h=f}b+=S.Ya[m]+1}return d};c.prototype.pa=function(){if(this.node){this.node instanceof S&&this.node.Dq();this.view.ha.removeNode(this.node);var a=this.view.da.Ha("defaultArrowSize"),b=this.node.la("commands");"linear-bezier"===this.type&&(b=this.cr(b));a={arrowSize:"arrow"===this.type?a:0,arrowStyle:this.view.da.Ha("defaultArrowStyle"),arrowXOffset:this.view.da.Ha("defaultArrowXOffset"),commands:b,seed:this.node.la("seed"),
fillStyle:this.view.Fb,strokeStyle:this.view.Sb,lineWidth:this.view.va.lineWidth,sloppiness:this.view.va.sloppiness,smoothness:this.view.va.smoothness,layer:this.view.La};for(var d in this.aa)this.aa.hasOwnProperty(d)&&(a[d]=this.aa[d]);this.view.pa([new V(this.view.ha.Wa(),"PathNode",a)]);this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.ha.removeNode(this.node),this.node=null)};c.prototype.Jc=function(){this.cancel();this.view.canvas.style.cursor="default";this.view.De("");this.view.ja()};
c.prototype.td=function(a,b){if(b){this.view.Fb=a;this.view.ac=a;var d="fillStyle";this.log("We are drawing lines. Set strokeStyle instead of fillStyle")}else d="strokeStyle";this.view.Sb=a;this.view.setProperty(d,a)};c.prototype.ud=function(a,b){b?(this.view.Fb=Yb(this.view.Fb,a),this.view.ac=Yb(this.view.ac,a)):this.view.Sb=Yb(this.view.Sb,a);this.view.Ol(a,b)};c.prototype.Yc=function(){return this.type};c.prototype.Ge=function(a,b){this.aa[a]=b};return c}();var Md=function(){function c(a,b,d,c,f,g,h){var e=this;this.view=a;this.nodeType=b;this.aa=d;this.width=c;this.height=f;this.mp=g;this.av=h;this.state="initial";this.start=new F(0,0);this.end=new F(0,0);this.node=null;this.log=B.create("DrawShape");"rectangle-tl"===g&&(this.Cn=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke()});this.gc=new Ic(this.view);this.view.sb(!0)}c.prototype.Cn=function(){};c.prototype.uc=
function(){this.log("Entering DrawShapeBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Jc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel()};c.prototype.cancel=function(){this.node&&(this.view.ha.removeNode(this.node),this.view.update(),this.node=null);this.state="initial"};c.prototype.$a=function(a){a=this.gc.$a(a);this.node&&this.gc.active&&(this.view.ha.removeNode(this.node),this.node=null,this.state="initial");return a};c.prototype.ec=function(a){"cancel"===a&&
this.view.Xa()};c.prototype.xb=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.gb(b.pageX,b.pageY);return this.Ta(b.x,b.y)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.Ua(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.ab(b.x,b.y,a)):!1};c.prototype.Ta=function(a,b){"initial"===this.state&&(this.start=this.view.Fa(new F(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};
c.prototype.Ua=function(a,b,d){a=this.view.Fa(new F(a,b));d=d.ctrlKey;"predraw"===this.state&&10<this.start.Pa(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,a,d),this.end=a,this.view.update(!1,this.Cn));return!0};c.prototype.ab=function(a,b,d){"predraw"===this.state?this.view.da.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.pa(),this.view.da.get("autoPickTool")&&this.view.Xa(),this.state=
"initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.Fa(new F(a,b)),d.ctrlKey),this.pa(),this.view.da.get("autoPickTool")&&this.view.Xa(),this.state="initial");return!0};c.prototype.create=function(){if(this.node=R.create(this.nodeType,this.view.ha.Wa(),this.view.ha))this.node.Ib(this.aa),this.view.ha.Uf(this.node)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.mp){var c=a;a=a.Pa(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.mp)a=
a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new F(0,0);else{c=f[0].x;for(var g=f[0].y,h=1;h<f.length;h++)c+=f[h].x,g+=f[h].y;c=new F(c/f.length,g/f.length)}f=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else c=a,a=f=1;d&&(a=f=Math.min(f,a));d=new M(c.x,c.y);d=d.multiply(new P(f,a));this.node&&(this.node.zg(d),this.view.ha.kg(this.node.id))};c.prototype.pa=function(){this.node&&(this.aa.matrix=this.node.Ga(),this.view.ha.removeNode(this.node),
this.node=null,this.view.pa([new V(this.view.ha.Wa(),this.nodeType,this.aa)]))};c.prototype.Jl=function(a){this.aa.lineWidth=a};c.prototype.td=function(a,b){yd.prototype.td.call(this,a,b);this.aa[b?"fillStyle":"strokeStyle"]=a};c.prototype.ud=function(a,b){yd.prototype.ud.call(this,a,b);var d=b?"fillStyle":"strokeStyle",c=Yb(this.aa[d],a);this.log("oldColour=%s+opacity %s = %s",this.aa[d],a,c);this.aa[d]=c};c.prototype.Yc=function(){return this.av};c.prototype.Ge=function(a,b){this.aa[a]=b};c.prototype.ye=
function(a,b){"defaultLineWidth"===a&&this.Jl(b)};return c}();var Nd=function(){function c(a,b){this.view=a;this.aa=b;this.ba=[];this.node=null;this.log=B.create("Wall");this.Fa=b.snap||0}c.prototype.Yc=function(){return"wall"};c.prototype.ec=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort wall and go back to toolbar."),this.view.Xa(),this.view.bc.ta("goto-toolbar"))};c.prototype.uc=function(){this.log("Enter DrawWallBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Jc=function(){this.log("Leaving DrawWallBehaviour");
this.reset()};c.prototype.Ta=function(a,b,d){var c=this.view.Fa(new F(a,b),this.Fa);if(this.node){if(this.view.Us(d))return this.pa(!1),!0;d=new F(this.ba[this.ba.length-4],this.ba[this.ba.length-3]);this.log("Last point=%s new point=%s distance=%s",d,new F(a,b),d.Pa(new F(a,b)));if(10<d.Pa(new F(a,b))){if(10>c.Pa(new F(this.ba[1],this.ba[2])))return this.ba.push("Z"),this.log("Closed path!"),this.pa(!0),!0;this.ba.push(a,b);this.node.setProperty("svgpath",this.ba.join(" "));this.view.ha.kg(this.node.id)}}else this.ba=
["M",c.x,c.y,c.x,c.y],this.node=R.create("WallNode",this.view.ha.pb,this.view.ha),this.node.Ib(this.aa),this.node.setProperty("svgpath",this.ba.join(" ")),this.view.ha.Uf(this.node),this.view.Rl(!0),this.view.De("click-to-place-another-point-or-double-click-to-end-the-line");this.view.update();return!0};c.prototype.Ua=function(a,b){var d=this.view.Fa(new F(a,b),this.Fa);return this.node?(this.ba[this.ba.length-2]=d.x,this.ba[this.ba.length-1]=d.y,this.node.setProperty("svgpath",this.ba.join(" ")),
this.view.ha.kg(this.node.id),this.view.update(),!0):!1};c.prototype.ab=function(a,b){var d=this.view.Fa(new F(a,b),this.Fa);if(this.node){var c=new F(this.ba[this.ba.length-4],this.ba[this.ba.length-3]);this.log("Last point=%s new point=%s distance=%s",c,new F(a,b),c.Pa(new F(a,b)));10<c.Pa(d)&&(this.ba.push(d.x,d.y),this.pa(!1));return!0}return!1};c.prototype.Pd=function(){this.pa(!1);return!0};c.prototype.pa=function(a){this.node&&(this.log("Commit()"),this.view.ha.removeNode(this.node),this.node=
null,this.ba.length-=2,3<this.ba.length&&(a&&this.ba.push("Z"),this.aa.svgpath=this.ba.join(" "),this.view.pa([new V(this.view.ha.Wa(),"WallNode",this.aa)]),this.view.sb()),this.view.Rl(!1),this.view.De(""))};c.prototype.reset=function(){this.node&&(this.view.Rl(!1),this.view.ha.removeNode(this.node),this.view.update(),this.view.De(""))};return c}();var Od=function(){function c(a,b,d){this.view=a;this.aa=b;this.qt=d;this.state="none";this.scale=1;this.log=B.create("ImageStamp");this.ya=document.createElement("img");this.url=this.ya.src=b.url;"scale"in this.aa&&(this.scale=this.aa.scale,delete this.aa.scale)}c.prototype.uc=function(){this.log("Entering ImageStampBehaviour");this.view.canvas.style.cursor="move"};c.prototype.Jc=function(){this.log("Leaving ImageStampBehaviour");this.view.ja()};c.prototype.xb=function(a){if("touchstart"===a.type){var b=
a.changedTouches[0];b=this.view.gb(b.pageX,b.pageY);return this.Ta(b.x,b.y,a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.Ua(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.gb(b.pageX,b.pageY),this.ab(b.x,b.y,a)):!1};c.prototype.Fa=function(a,b){this.ya.complete&&(a-=this.ya.width/2,b-=this.ya.height/2);return this.view.Fa(new F(a,b))};c.prototype.Ta=function(a,b,d){this.log("onMouseDown type %s",d.type);a=this.Fa(a,b);this.view.pa([new V(this.view.ha.Wa(),
"ImageNode",bb({},this.aa,{url:this.url,layer:this.view.La,matrix:(new M(a.x,a.y)).multiply(new P(this.scale,this.scale))}))]);this.qt||(this.log("MultiStamp not set; return to pick mode."),this.view.Xa());return!0};c.prototype.Ua=function(a,b){this.ya.complete||this.log("Don't draw; image not loaded.");var d=this.Fa(a,b),c=this;this.view.ja(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(c.ya,d.x,d.y,c.ya.naturalWidth*c.scale,c.ya.naturalHeight*c.scale);a.globalAlpha=b});return!0};c.prototype.ab=
function(){return!0};c.prototype.ec=function(a){"cancel"===a&&(this.view.Xa(),this.view.bc.ta("goto-toolbar"))};return c}();var Sd=function(){function c(){this.Xh=[];this.Aj=[];this.log=B.create("SnapRules",!0)}c.prototype.Xj=function(a,b){$b(this.Xh,function(b){return b.id===a});$b(this.Aj,function(b){return b.id===a});var d;for(d=0;d<b.length;d++)this.Xh.push({id:a,value:b[d].x}),this.Aj.push({id:a,value:b[d].y})};c.prototype.nr=function(){this.Xh.sort(function(a,b){return a.value-b.value});this.Aj.sort(function(a,b){return a.value-b.value})};c.prototype.Fa=function(a,b,d){return 0===this.Xh.length?new F(a,b):new F(this.Ym(this.Xh,
a,d),this.Ym(this.Aj,b,d))};c.prototype.Ym=function(a,b,d){for(var c=a.length,f=-1,g;1<c-f;)g=(c+f)/2|0,a[g].value<=b?f=g:c=g;-1===f&&(f=0);return Math.abs(a[f].value-b)<d?a[f].value:f+1<a.length&&Math.abs(a[f+1].value-b)<d?a[f+1].value:b};return c}();var Td=function(){function c(a){this.view=a;this.log=B.create("Wall")}c.prototype.Yc=function(){return"split-wall"};c.prototype.ec=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort wall and go back to toolbar."),this.view.Xa(),this.view.bc.ta("goto-toolbar"))};c.prototype.uc=function(){this.log("Enter SplitWallBehaviour");this.view.canvas.style.cursor="default"};c.prototype.Jc=function(){this.log("Leaving DrawWallBehaviour")};c.prototype.Ta=function(a,b,d){this.Ua(a,
b,d);var c=this.view.ha.lb(a,b,this.view.La),f,g;return c&&"WallNode"===c.type()?((f=c.sd(a,b,this.view.scale))&&"middle"===c.ne(f)&&(g=this.Su(c.Hs(),a,b))&&(g.transform(c.Ga().inverse()),f=new Dc,g.ja(f),this.view.pa([new Id([c.id],"svgpath",f.toString())]),f=c.sd(a,b,this.view.scale)),f&&this.view.Qa(new zd(this.view,c,f,a,b,this,d)),!0):!1};c.prototype.Ua=function(a,b){this.view.Fa(new F(a,b));var d=this.view.ha.lb(a,b,this.view.La),c;if(d&&"WallNode"===d.type()&&(c=d.sd(a,b,this.view.scale))){var f=
!0;d=d.ne(c);this.view.canvas.style.cursor="middle"===d?"copy":"move"}f||(this.view.canvas.style.cursor="default");return!0};c.prototype.Su=function(a,b,d){var c,f;new F(0,0);var g=0,h=0,k=0,l=0,m=null,n=null,r=new F(b,d);a.ja({moveTo:function(a,b){var d=new F(a,b);d=r.Pa(d);if(null===m||m>d)m=d;c=a;f=b},lineTo:function(a,b){var d=new F(a,b),e=r.Pa(d);if(null===m||m>e)m=e;d=r.ti(new F(c,f),d);if(null===n||n>d)g=c,h=f,k=a,l=b,n=d;c=a;f=b},beginPath:function(){},closePath:function(){}});if(null!==m&&
(null===n||n>m))return null;var q=new Q;a.ja({moveTo:function(a,b){q.moveTo(a,b);c=a;f=b},lineTo:function(a,b){c===g&&f===h&&a===k&&b===l&&q.lineTo(r.x,r.y);q.lineTo(a,b);c=a;f=b},beginPath:function(){},closePath:function(){q.closePath()}});return q};c.prototype.pa=function(){};return c}();for(var Ud,Vd=[],Wd=0;4>Wd;Wd++)Vd.push(String.fromCharCode(">2$-".charCodeAt(Wd)^"zwibbler3".charCodeAt(Wd%9)));Ud=Vd.join("");for(var Xd,Yd=[115,116,114,111,107,101,84,101,120,116],Zd=[],$d=0;$d<Yd.length;$d++)Zd.push(String.fromCharCode(Yd[$d]));Xd=Zd.join("");
var ee=function(){function c(a,b,d,e,f,g,h,k){this.ha=b;this.$b=d;this.bc=e;this.da=f;this.language=g;this.ua=h;this.vb=k;this.Bd="none";this.Rh=this.Qh=0;this.scale=1;this.hb=this.tb=0;this.ed=new K(0,0,0,0);this.El=new zc;this.xg=this.ej=this.Gh=!0;this.Dl=new O;this.selection=[];this.Ae=[];this.yk=!0;this.La="default";this.Ie=this.xi=!1;this.jd=this.background=this.Te=null;this.backgroundRepeat="no-repeat";this.nd=this.Aa=null;this.Mf=4;this.Em=2*this.Mf;this.Je=this.Fc=null;this.wk=!1;this.md=
null;this.Rf=!1;this.ac=this.Fb=this.Sb="#000000";this.Yf=5;this.ig="";this.hc=0;this.ll=new K(0,0,0,0);this.ml=new K(0,0,0,0);this.Ea={yb:!1,Na:!1,ck:!1,x:100,y:100};this.cp=function(){};this.log=B.create("VIEW");this.canvas=a[0];this.ka=this.canvas.getContext("2d");this.Ie=!0===f.get("pageView");this.Mh=new Sd;this.au();this.na=new yd(this);this.Yb=null;this.qd=new Kc("horizontal",!0,this.vb);this.qd.Zj(this.canvas.parentNode);this.kc=new Kc("vertical",!1,this.vb);this.kc.Zj(this.canvas.parentNode);
this.Wi=this.jh();this.Ve=new nc(this.canvas.width/this.Wi,this.canvas.height/this.Wi);var l=this;this.request=new bd;this.request.canvas=this.canvas;this.request.xa("reformat",function(a){l.log("Node %s requests reformat",a);l.ha.cf(a)&&(l.log("   Reformatting... zoom=%s",l.Bd),l.ha.kg(a));l.update();a===l.jd&&l.mi();l.wg();l.ua.ta("resource-loaded")});this.request.xa("convert-dom-request",function(a,b){l.ua.ta("convert-dom-request",b,a)});f.xa("useTouch",function(){l.Je=null;l.Em=2*l.Mf});this.kc.xa("scroll",
function(a){l.hb=-a*l.scale;l.ja()});this.qd.xa("scroll",function(a){l.tb=-a*l.scale;l.ja()});this.mi();this.ha=this.Df(b);(a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)?(this.log("Using requestAnimationFrame"),this.requestAnimationFrame=a):this.log("Emulating requestAnimationFrame");this.da.xa("update",function(a,b){l.ye(a,b)});this.vb.bind(C(document),"webkitfullscreenchange",function(){0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")&&
(l.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),l.requestAnimationFrame=c.prototype.requestAnimationFrame)});this.na=this.Xa()}c.prototype.jo=function(a){var b,d=-1,c=!1;for(b=0;b<a.yf.length;b++){var f=a.yf[b];this.Mh.Xj(f,[]);f===this.jd&&(this.log("Background node has been removed"),d=-1)}for(b=0;b<a.fd.length;b++){f=a.fd[b];var g=this.ha.za(f,!1);this.Mh.Xj(f,g.Qk());"background"===g.la("layer")&&(this.log("Background node has been added"),d=f)}for(b=0;b<a.Jf.length;b++)f=a.Jf[b],
g=this.ha.za(f,!1),this.Mh.Xj(f,g.Qk()),"background"===g.la("layer")?(this.log("Background node has been changed"),d=f,c=!0):f===this.jd&&(this.log("Node removed from background layer"),d=-1);-1===d||!c&&d===this.jd||(this.jd=d,this.mi(),this.jd&&this.ha.za(this.jd,!1).Ce(!0));(a.fd.length||a.Jf.length)&&this.Mh.nr();a.fd.length&&this.ua.ta("nodes-added",a.fd);a.Jf.length&&this.ua.ta("nodes-changed",a.Jf);a.yf.length&&this.ua.ta("nodes-removed",a.yf)};c.prototype.requestAnimationFrame=function(a){a()};
c.prototype.hh=function(){return parseInt(C(this.canvas).ea("border-left-width"),10)||0};c.prototype.gh=function(){this.log("getActiveLayer() -> %s",this.La);return this.La};c.prototype.fj=function(a){this.log("setActiveLayer(%s)",a);this.La=a;this.sb();this.Tb();this.ja()};c.prototype.Lh=function(a,b){this.ha.Lh(a,b);b||a!==this.La||(this.sb(),this.Tb());this.ja()};c.prototype.zp=function(a){(this.Yb=a)&&this.Yb.Do(this.selection)};c.prototype.Df=function(a){this.log("setDocument()");this.Xa();this.ha=
a;this.scale=1;this.hb=this.tb=0;this.selection=[];this.nd=this.Aa=null;this.hc=1;this.ed=new K(0,0,0,0);this.El=new zc(this.ed);this.Dl=new O;this.yk=!0;this.ig="";this.La="default";this.Fb="#ffffff";this.ac=this.da.Ha("defaultBrushColour");this.Sb=this.da.Ha("defaultStrokeStyle");this.va={};this.va.lineWidth=this.da.Ha("defaultLineWidth");this.va.sloppiness=.5;this.va.fontName=this.da.Ha("defaultFont");this.va.fontSize=this.da.Ha("defaultFontsize");this.va.bold=this.da.Ha("defaultBold");this.va.italic=
this.da.Ha("defaultItalic");this.va.smoothness=.3;this.va.textFillStyle=this.da.Ha("defaultTextFillStyle");this.va.textStrokeStyle=this.da.Ha("defaultTextStrokeStyle");this.va.textLineWidth=this.da.Ha("defaultTextLineWidth");this.va.textDecoration=this.da.Ha("defaultTextDecoration");this.va.textAlign=this.da.Ha("defaultTextAlign");this.Yf=this.da.get("defaultBrushWidth");var b=this.me();this.tb=-b.x;this.hb=-b.y;this.mc();this.ha.Ul=this.da.get("spotHighlightColour");this.ha.nj=this.da.get("spotHighlightZIndex");
this.ha.format(this.ka,this.request);this.ml=new K(0,0,0,0);this.ll=new K(0,0,0,0);"none"!==this.Bd?this.Nc(this.Bd):(this.Nc(this.da.get("defaultZoom")),this.ja());return a};c.prototype.ye=function(a,b){var d=!1;switch(a){case "allowResize":this.Wf();this.ja();break;case "defaultBrushColour":this.ac=b;break;case "defaultFillStyle":this.Fb=this.va.fillStyle=b;break;case "defaultStrokeStyle":this.Sb=b;this.va.strokeStyle=b;break;case "defaultLineWidth":this.va.lineWidth=b;break;case "defaultFont":this.va.fontName=
b;break;case "defaultBold":this.va.bold=b;break;case "defaultTextAlign":this.va.textAlign=b;break;case "defaultTextDecoration":this.va.textDecoration=b;break;case "defaultItalic":this.va.italic=b;break;case "defaultFontSize":this.va.fontSize=b;break;case "defaultTextFillStyle":this.va.textFillStyle=b;break;case "defaultTextStokeStyle":this.va.textStrokeStyle=b;break;case "defaultTextLineWidth":this.va.textLineWidth=b;break;case "defaultBrushWidth":this.Yf=b;break;case "defaultZoom":this.Nc(b);break;
case "pageView":this.Ie=b;d=!0;break;case "pagePlacement":this.Nc(this.Bd);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":case "backgroundImage":this.mi();d=!0;break;case "pageShadow":case "symmetry":case "outsidePageColour":d=!0;break;case "readOnly":!0===b&&(this.Xa(),this.sb(),this.Tb(),d=!0);this.ha.Ag(b);break;case "spotHighlightColour":this.ha.Ul=b;d=!0;break;case "spotHighlightZIndex":this.ha.nj=b;d=!0;break;case "showRuler":case "pixelsPerUnit":case "units":d=
!0}this.na.ye&&this.na.ye(a,b);d&&this.ja()};c.prototype.Be=function(a,b){this.va[a]=b;"fillStyle"===a?this.Fb=b:"strokeStyle"===a&&(this.Sb=b)};c.prototype.Nc=function(a){a!==this.Bd&&this.log("Zooming to: %s",a);var b=this.pd().width-20;var d=this.ha.Ps();var c=!0;this.Bd=a;d||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),c="page"===a||"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.ha.empty()||!d)this.scale=
1;else{if("page"===a)return d=this.me(),this.Kh(d,"centre"===this.da.get("pagePlacement"),!0),this.Bd=a,this.na.kf&&this.na.kf(),c;"width"===a&&(d=this.me(),this.scale=b/d.width,this.tb=-d.x*this.scale,this.hb=-d.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",d,this.scale,this.tb,this.hb),this.Bd=a)}this.mc();this.ja();this.na.kf&&this.na.kf();return c};c.prototype.gb=function(a,b,d){void 0===d&&(d=!1);a=this.ho().apply(a,b);d||(a=this.Fa(a));return a};c.prototype.rk=function(a,b){return this.ho().inverse().apply(a,
b)};c.prototype.jc=function(a){return this.gb(a.pageX,a.pageY,!0)};c.prototype.ec=function(a,b){this.na.ec&&this.na.ec(a,b);if("TEXTAREA"!==b.target.tagName&&"INPUT"!==b.target.tagName&&!this.Ms(a,b)){switch(a){case "next-page":this.Db(this.ha.Va+1);break;case "previous-page":this.Db(this.ha.Va-1);break;case "zoom-to-page":this.da.get("allowZoom")&&this.Nc("page");break;case "zoom-to-width":this.da.get("allowZoom")&&this.Nc("width")}b.preventDefault();b.stopPropagation()}};c.prototype.au=function(){var a=
this;this.hh();C(this.canvas).bind("gesturestart",function(b){a.log("GestureStart");a.na.$a&&!1!==a.na.$a(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});C(this.canvas).bind("gesturechange",function(b){a.na.$a&&!1!==a.na.$a(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});C(this.canvas).bind("gestureend",function(b){a.log("GestureEnd");a.na.$a&&!1!==a.na.$a(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});"ongesturestart"in this.canvas?
this.log("Using native gestures"):(this.log("Using emulated gestures"),hb(this.canvas,function(b){a.na.$a&&!1!==a.na.$a(b)?(b.stopPropagation(),b.preventDefault()):a.log("Allow %s event to pass through",b.type)}));this.da.get("simulateGestures")&&cc(this.canvas,function(b){a.log("Simulating %s",b.type);a.na.$a&&!1!==a.na.$a(b)&&(b.stopPropagation(),b.preventDefault())});var b="ontouchstart"in window,d="onpointerdown"in window,c="ongesturestart"in window,f="onmousedown"in window;this.log("Have TouchEvents: %s",
b);this.log("Have PointerEvents: %s",d);this.log("Have GestureEvents: %s",c);this.log("Have MouseEvents: %s",f);d&&!this.da.get("allowPointerEvents")&&(this.log("Configuration does not allow PointerEvents"),d=!1);var g=new F(0,0),h=0,k=0,l=!1,m=!1,n;this.cp=function(){a.log("Preventing next double click.");l=!0};if(b){this.log("Using touch events for screen movement.");var r=new Date,q=new F(0,0);C(this.canvas).bind("touchstart",function(b){if(a.na.xb&&"touchstart"===b.type){var d=!0;300<(new Date).getTime()-
r.getTime()?d=!1!==a.na.xb(b):a.na.Pd&&(n=new F(b.changedTouches[0].pageX,b.changedTouches[0].pageY),a.log("Double-click distance: %s",n.Pa(q)),10>n.Pa(q)?(n=a.jc(b.changedTouches[0]),d=!1!==a.na.Pd(n.x,n.y,b)):d=!1);d&&(b.stopPropagation(),b.preventDefault());r=new Date;q=new F(b.changedTouches[0].pageX,b.changedTouches[0].pageY)}});C(this.canvas).bind("touchmove",function(b){a.na.xb&&!1!==a.na.xb(b)&&(b.stopPropagation(),b.preventDefault())});C(this.canvas).bind("touchend",function(b){a.na.xb&&
!1!==a.na.xb(b)&&(b.stopPropagation(),b.preventDefault())})}else if(d){this.log("Using pointer events for movement");C(this.canvas).bind("pointerdown",function(b){"pointerdown"===b.type&&(a.log("PointerDown"),g=new F(b.pageX,b.pageY),h=Qb(),m=!0,a.na.Ta&&(n=a.jc(b),!1!==a.na.Ta(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault())))});C(this.canvas).bind("pointermove",function(b){"pointermove"===b.type&&(m&&0===b.buttons&&(a.log("MISSED POINTERUP! Fixing."),v(b)),a.na.Ua&&(n=a.jc(b),!1!==a.na.Ua(n.x,
n.y,b)&&(b.stopPropagation(),b.preventDefault())))});var v=function(b){if("pointerup"===b.type||"pointermove"===b.type){a.log("PointerUp");n=a.jc(b);a.na.ab&&m&&!1!==a.na.ab(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault());m=!1;a.log("TimeDist=%s PixelDist=%s",Qb()-h,g.Pa(new F(b.pageX,b.pageY)));var d=k,c=200>Qb()-h&&2>g.Pa(new F(b.pageX,b.pageY));a.log("Didclick: %s dbltime=%s",c,Qb()-d);a.na.qc&&c&&(a.log("Simulate mouseclick from pointerup"),n=a.jc(b),!1!==a.na.qc(n.x,n.y,b)&&(b.stopPropagation(),
b.preventDefault()));a.na.Pd&&c&&300>Qb()-d&&!l&&(a.log("Simulate double-click"),!1!==a.na.Pd(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault()));c&&(k=Qb(),l=!1)}};this.vb.bind(C(document),"pointerup",v);C(this.canvas).bind("pointerleave",function(b){"pointerleave"===b.type&&a.na.So&&(n=a.jc(b),!1!==a.na.So(n.x,n.y,b)&&(b.stopPropagation(),b.preventDefault()))})}!d||b?(this.log("Using mouse events for screen movement."),C(this.canvas).dl(function(b){"mousemove"===b.type&&(a.na.Ua&&(n=a.jc(b),a.na.Ua(n.x,
n.y,b)),b.preventDefault())}),C(this.canvas).wh(function(b){"mousedown"===b.type&&(m=!0,a.na.Ta&&(n=a.jc(b),a.na.Ta(n.x,n.y,b)),b.preventDefault())}),this.vb.bind(C(document),"mouseup",function(b){"mouseup"===b.type&&(a.na.ab&&m&&(n=a.jc(b),a.na.ab(n.x,n.y,b)),m=!1)}),C(this.canvas).click(function(b){"click"===b.type&&(C(a.canvas).offset(),a.na.qc&&(n=a.jc(b),a.na.qc(n.x,n.y,b)),b.stopPropagation(),b.preventDefault())}),C(this.canvas).mr(function(b){if("dblclick"===b.type){C(a.canvas).offset();if(a.na.Pd||
a.na.qc)n=a.jc(b),Ub()&&a.na.qc&&(a.log("Insert false mouse click for IE"),a.na.qc(n.x,n.y,b)),a.na.Pd&&a.na.Pd(n.x,n.y,b);b.stopPropagation();b.preventDefault()}})):this.log("Not using mouse events.");C(this.canvas).bind("contextmenu",function(b){if("contextmenu"===b.type){var d=a.jc(b);a.na.Qo&&!1!==a.na.Qo(d.x,d.y,b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass contextmenu to browser")}});C(this.canvas).bind("mouseenter",function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseleave",
function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseover",function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseout",function(a){a.stopPropagation();a.preventDefault()});!window.parent&&this.da.get("setFocus")&&C(this.canvas).focus();this.$b.bind("colour",function(b,d){a.na.td&&a.na.td(b,d)});this.$b.bind("opacity",function(b,d){a.na.ud&&a.na.ud(b,d)});this.da.get("simulateGestures")||(b="mousewheel","onwheel"in document.createElement("div")&&(b=
"wheel"),a.log("Binding to '%s' for mouse wheel",b),C(this.canvas).bind(b,function(b){if("wheel"===b.type||"mousewheel"===b.type){var d=b.wheelDelta||-40*b.deltaY,c=d/120*32;n=a.jc(b);a.log("mousewheel: delta %s",d);if((!a.na.pl||!1===a.na.pl(n.x,n.y,c,b))&&a.kc.Ws()){var e=a.me();a.hb=-120>=d?Math.max(a.hb+c,-(e.bottom()*a.scale-a.canvas.clientHeight)):Math.min(a.hb+c,-e.y*a.scale);a.mc();a.ja();b.stopPropagation();b.preventDefault()}}}));C(this.canvas).bind("dragover",function(b){a.log("Dragover");
b.preventDefault()});C(this.canvas).bind("drop",function(){a.log("Drop")});C(this.canvas).bind("dragenter",function(){a.log("DragEnter")});C(this.canvas).bind("dragleave",function(){a.log("DragLeave")})};c.prototype.xt=function(a){function b(a){var b=new FileReader;b.readAsDataURL(a.getAsFile());b.onloadend=function(){d.hl(b.result)}}this.log("Received clipboard event: %s",a.type);var d=this;switch(a.type){case "copy":case "cut":if(!this.lo())break;this.log("Cut to system clipboard.");var c=this.de(!0,
this.wc(!1));a.clipboardData.setData("application/zwibbler",c);a.preventDefault();"cut"===a.type&&this.Zg();break;case "paste":for(this.log("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];this.log("Item [%s] type is %s",c,f.type);if(0===f.type.indexOf("image/")){b(f);a.preventDefault();break}else if("application/zwibbler"===f.type){this.log("Pasting from system clipboard");f.getAsString(function(a){d.sg(a)});
a.preventDefault();break}}}};c.prototype.Ms=function(a,b){if(!this.Ea.yb)return!1;var d=0,c=0,f=this.da.get("nudge");switch(a){case "right":d=f;break;case "left":d=-f;break;case "down":c=f;break;case "up":c=-f;break;case "enter":if(this.na.qc){this.Ea.Na=!1;var g="click"}else this.Ea.Na=!this.Ea.Na,g=this.Ea.Na?"mousedown":"mouseup"}if(d||c)g=this.pd(),this.Ea.x+=d,this.Ea.x=Math.max(this.Ea.x,0),this.Ea.x=Math.min(g.width,this.Ea.x),this.Ea.y+=c,this.Ea.y=Math.max(this.Ea.y,0),this.Ea.y=Math.min(g.height,
this.Ea.y),this.ja(),g="mousemove";return g?(b.preventDefault(),b.stopPropagation(),this.ja(),c=C(this.canvas).offset(),d=this.Ea.x+c.left-window.pageXOffset,c=this.Ea.y+c.top-window.pageYOffset,this.log("Simulate a %s at (%s,%s)",g,d,c),f=document.createEvent("MouseEvents"),f.initMouseEvent(g,!0,!0,window,0,d,c,d,c,!1,!1,!1,!1,this.Ea.Na?1:0,null),this.canvas.dispatchEvent(f),!0):!1};c.prototype.xd=function(a){void 0===a&&(a=!1);this.Ea.yb=!0;this.Ea.Na=!1;this.Ea.ck=a;this.log("Showing keyboard cursor, caret=%s",
a);this.ja()};c.prototype.Cp=function(a){this.Ea.yb=!0;this.Ea.ck=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.Ea.Na=!0;var b=this.ed.Fd();this.Ea.x=b.x;this.Ea.y=b.y;this.Xa();this.Qa(new Hd(this,new Dd(this.selection[0].Ga()),!1,b.x-4,b.y-4,a))}this.ja()};c.prototype.oo=function(){this.Ea.yb&&(this.Ea.yb=!1,this.ja())};c.prototype.Ss=function(){return this.Ea.yb};c.prototype.Vs=function(a){var b=this.hh(),d=C(this.canvas).offset(),c=this.kc.Hi();if("changedTouches"in
a){var f=a.changedTouches[0].pageX-d.left-b;a=a.changedTouches[0].pageY-d.top-b}else if("pageX"in a)f=a.pageX-d.left-b,a=a.pageY-d.top-b;else return!1;b=this.pd();return this.Je&&f>b.width-this.Je.width-c&&a<this.Je.height};c.prototype.Us=function(a){var b=this.hh(),d=C(this.canvas).offset(),c=this.kc.Hi();if("changedTouches"in a){var f=a.changedTouches[0].pageX-d.left-b;a=a.changedTouches[0].pageY-d.top-b}else if("pageX"in a)f=a.pageX-d.left-b,a=a.pageY-d.top-b;else return!1;b=this.pd();return this.Fc&&
f>b.width-this.Fc.width-c&&a<this.Fc.height};c.prototype.Fa=function(a,b){void 0===b&&(b=0);b=b||this.da.get("snap")||0;var d=this.da.get("autoSnap");if(0<b){d=Math.round(a.x/b)*b;var c=Math.round(a.y/b)*b}else{if(0<d)return this.Mh.Fa(a.x,a.y,d/this.scale);d=a.x;c=a.y}return new F(d,c)};c.prototype.Ri=function(){var a=this.wc(!1);a.length&&this.pa([new ae(a,ae.Gm)])};c.prototype.Qi=function(){var a=this.wc(!1);a.length&&this.pa([new ae(a,ae.Fm)])};c.prototype.Qg=function(){var a=this.wc(!1);a.length&&
this.pa([new ae(a,ae.wm)])};c.prototype.Hh=function(){var a=this.wc(!1);a.length&&this.pa([new ae(a,ae.Kj)])};c.prototype.setProperty=function(a,b){var d=this.wc(!0);this.va[a]=b;if(d.length){var c=[new Id(d,a,b)];if("fillStyle"===a)for(var f=0;f<d.length;f++){var g=this.ha.za(d[f],!1);g&&(this.log("nodeType=%s closed=%s",g.type(),g.la("closed")),"PathNode"===g.type()&&!1===g.la("closed")&&c.push(new Id([d[f]],"strokeStyle",b)))}this.pa(c)}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?
this.Yf=b:"textFillStyle"===a&&(this.va.textFillStyle=b)};c.prototype.Ge=function(a,b){this.na.Ge&&this.na.Ge(a,b)};c.prototype.Ei=function(){return this.va.fillStyle};c.prototype.Ii=function(){return this.va.strokeStyle};c.prototype.Ol=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);for(var d=this.wc(!0),c=[],f=b?"fillStyle":"strokeStyle",g=0;g<d.length;g++){var h=d[g],k=this.ha.za(h);k&&(k=k.la(f))&&(k=Yb(k,a),c.push(new Id([h],f,k)),this.log("   set %s of %s to %s",f,h,k))}c.length&&
this.pa(c);this.log("   Affected %s of %s nodes",c.length,d.length)};c.prototype.group=function(){var a=this.wc(!1);a.length&&this.pa([new rd(this.ha.Wa(),a)])};c.prototype.Uh=function(){var a=this.wc(!1);a.length&&this.pa([new be(a)])};c.prototype.Zg=function(){var a=this.wc(!1);a.length&&this.pa([new ce(a)])};c.prototype.sb=function(a){void 0===a&&(a=!1);var b=!1;0<this.selection.length&&(this.hc+=1,this.selection.length=0,this.log("Clear selection. selectGeneration=%s",this.hc),b=!0);null!==this.nd&&
(this.ua.ta("selected-edit-handle",null,null),b=!0);this.Aa&&(this.log("Clear selection."),this.nd=this.Aa=null,b=!0);b&&a&&(this.Tb(),this.ja())};c.prototype.Se=function(a){this.Ef(null);if(a.hc!==this.hc&&a.Kd()===this.La){this.selection.push(a);a.hc=this.hc;if(a.Vk()){for(var b=a.parent,d=0;d<b.children.length;d++)this.Se(b.children[d]);this.Se(b)}a.children&&0<a.children.length&&this.Se(a.children[0])}};c.prototype.selectNodes=function(a){this.sb();for(var b=0;b<a.length;b++)a[b].la("locked")||
"PageNode"===a[b].type()||this.Se(a[b]);this.Tb()};c.prototype.ju=function(a,b){var d=this.ha.za(a,!1);d?d.uo()?(d!==this.Aa&&this.Ef(d),this.log("Select edit handle %s",b),this.nd=b,this.ua.ta("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable."):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.pa=function(a,b){void 0===b&&(b=!1);if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring change.");else if(0!==a.length){var d=this.ha.pa(a,
b),c;this.ha.format(this.ka,this.request);if(d.fd.length&&!b){var f=[];for(c=0;c<d.fd.length;c++)f.push(this.ha.za(d.fd[c],!1));this.da.get("autoPickTool")&&this.selectNodes(f)}else if(this.selection.length||this.Aa){c=!1;for(f=0;f<a.length;f++){var g=a[f];if(g instanceof Id&&("lockSize"===g.name||"lockRotate"===g.name||"lockPosiiton"===g.name||"lockAspectRatio"===g.name)){c=!0;break}}if(0<d.yf.length||c){f=0;this.hc+=1;for(c=0;c<this.selection.length;c++)c!==f&&(this.selection[f]=this.selection[c]),
this.ha.cf(this.selection[f].id)&&(this.selection[f].hc=this.hc,f++);this.selection.length!==f&&(this.selection.length=f);this.Aa&&!this.ha.cf(this.Aa.id)&&(this.log("EditNode %s no longer exists",this.Aa.id),this.Aa=null,null!==this.nd&&this.ua.ta("selected-edit-handle",null,null),this.nd=null);0!==this.selection.length||this.Aa||this.sb();this.Tb();this.log("Done selecting called.")}}this.jo(d);this.wg();this.ja();this.ua.ta("document-changed")}};c.prototype.iu=function(a){a=this.ha.Bs(a);for(var b=
0;b<a.length;b++)this.Se(a[b])};c.prototype.Tb=function(){this.Wf();this.Yb&&this.Yb.Do(this.selection);this.ua.ta("selected-nodes")};c.prototype.Wf=function(){function a(a,b,d,e){!1!==c.Gh&&c.Ae.push(new Bd(b,new F(a.x+d*a.width,a.y+e*a.height),new F(a.x+(1-d)*a.width,a.y+(1-e)*a.height)))}var b;this.xg=this.ej=this.Gh=!0;var d=!1;this.Ae.length=0;if(0!==this.selection.length){this.ed=this.selection[0].rect.clone();this.selection[0].la("lockSize")&&(this.Gh=!1);this.selection[0].la("lockRotation")&&
(this.ej=!1);this.selection[0].la("lockPosition")&&(this.xg=!1);this.selection[0].la("lockAspectRatio")&&(d=!0);for(b=1;b<this.selection.length;b++)this.ed.Vh(this.selection[b].rect),this.selection[b].la("lockSize")&&(this.Gh=!1),this.selection[b].la("lockRotation")&&(this.ej=!1),this.selection[b].la("lockAspectRatio")&&(d=!0),this.selection[b].la("lockPosition")&&(this.xg=!1);this.El=1===this.selection.length?this.selection[0].Fk():new zc(this.ed);var c=this,f=0<this.da.get("snap");if(1<this.selection.length){var g=
new O;b=null;var h=this.ed}else b=this.selection[0],h=b.cb,g=b.Ga();this.da.get("allowResize")&&(d||(a(h,g,.5,0),a(h,g,1,.5),a(h,g,.5,1),a(h,g,0,.5)),a(h,g,0,0),a(h,g,1,0),a(h,g,1,1),a(h,g,0,1));if(this.ej)if(b&&b.la("rotationHandles"))for(d=b.la("rotationHandles"),b=0;b<d.length;b+=4){h=new F(d[b],d[b+1]);var k=new F(d[b+2],d[b+3]);c.Ae.push(new Cd(g,h,k,f))}else c.Ae.push(new Cd(g,new F(h.x+.5*h.width,h.y-10/this.scale),new F(h.x+.5*h.width,h.y+.5*h.height),f))}};c.prototype.Pq=function(){for(var a=
0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.ha.cf(this.selection[a].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.Aa&&!this.ha.cf(this.Aa.id)&&(this.Aa=null,null!==this.nd&&this.ua.ta("selected-edit-handle",null,null),this.nd=null)};c.prototype.$o=function(a,b){return this.selection.length&&this.El.Wc(a,b)};c.prototype.lo=function(){return 0!==this.selection.length||null!==this.Aa};c.prototype.qe=function(){var a=this.selection.concat();
this.Aa&&a.push(this.Aa);return a};c.prototype.As=function(a){if(0===a.length)return new F(0,0);for(var b=a[0].rect.clone(),d=1;d<a.length;d++)b.Vh(a[d].rect);return b.Fd()};c.prototype.Zn=function(a){for(var b=[],d=0;d<a.length;d++)this.log("Selected id=%s",a[d].id),b.push(a[d].id);return b};c.prototype.ho=function(){var a=C(this.canvas).offset();this.da.get("showRuler")&&(a.left+=20,a.top+=20);return(new O).multiply(new P(1/this.scale,1/this.scale)).multiply(new M(-this.tb,-this.hb)).multiply(new M(-a.left,
-a.top))};c.prototype.wc=function(a){var b=this.qe();a||(b=this.ha.ki(b));return this.Zn(b)};c.prototype.Gk=function(a){for(var b=null,d=0;d<a.length;d++){var c=this.ha.za(a[d]);c&&(null===b?b=c.rect.clone():b.Vh(c.rect))}null===b&&(b=new K(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.ha.format(this.ka,this.request)||a)this.Wf(),this.ja(b)};c.prototype.mi=function(){var a=this.da.get("snap"),b=null,d;var c=this.da.get("background");var f=A.Ek(c),g=this.da.get("backgroundImage");
this.background=this.Te=null;this.backgroundRepeat="no-repeat";var h=this;this.log("createBackground() background=%s",c);this.log("backgroundNodeId==%s",this.jd);if("grid"===c){this.backgroundRepeat="repeat";a=this.da.get("gridBlocks");g=this.da.get("gridSpacing");var k=(a||1)*g;b=Pb(document.body);b.width=k;b.height=k;c=b.getContext("2d");c.fillStyle="#ffffff";c.fillRect(0,0,k,k);c.beginPath();for(d=0;d<k;d+=g)if(d%k||1>a)c.moveTo(d+.5,0),c.lineTo(d+.5,k);for(d=0;d<k;d+=g)if(d%k||1>a)c.moveTo(0,
d+.5),c.lineTo(k,d+.5);c.strokeStyle=this.da.get("gridColour");c.lineWidth=.5;c.stroke();if(0<a){c.beginPath();for(d=0;d<=k;d+=k)c.moveTo(d,0),c.lineTo(d,k);for(d=0;d<=k;d+=k)c.moveTo(0,d+.5),c.lineTo(k,d+.5);c.lineWidth=2;c.stroke()}}else if(g)this.request.add(0,"image",g,null,function(a){h.log("Background image finished loading");h.background=a});else if(this.jd){if(this.log("Regenerate background image"),a=this.ha.za(this.jd,!1))c=a.rect.clone(),b=Pb(document.body),b.width=c.x+c.width,b.height=
c.y+c.height,c=b.getContext("2d"),a.ja(c)}else f?(this.log("Using background colour %s",f.toString()),this.Te=function(a,b,d,c,e){a.fillStyle=f.toString();a.fillRect(b,d,c,e)}):0<a&&"clear"!==c&&(this.backgroundRepeat="repeat",b=Pb(document.body),b.width=a,b.height=a,c=b.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.arc(0,0,3,0,2*Math.PI,!1),c.moveTo(a,0),c.arc(a,0,3,0,2*Math.PI,!1),c.moveTo(a,a),c.arc(a,a,3,0,2*Math.PI,!1),c.moveTo(0,a),c.arc(0,a,3,0,2*Math.PI,!1),c.fillStyle="#c0c0c0",c.fill());
b&&document.body.removeChild(b);this.background=b};c.prototype.bh=function(a,b,d,c,f){a.Qf=null;this.background?(a.Qf=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.Qf,a.fillRect(b,d,c,f)):this.Te?this.Te(a,b,d,c,f):"G_vmlCanvasManager"in window&&(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,d,c,f))};c.prototype.tr=function(a){var b=this.ha.Ok();a.beginPath();a.fillStyle="#FFFFFF";this.da.get("pageShadow")&&(a.shadowOffsetX=3/this.scale,a.shadowOffsetY=3/this.scale,a.shadowBlur=
5/this.scale,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.da.get("pageBorderColour");a.stroke();this.bh(a,0,0,b.width,b.height);this.Te&&this.Te(a,0,0,b.width,b.height)};c.prototype.Hl=function(a){a?(this.log("Setting a custom background function."),this.Te=a):this.log("Clearing custom background function.")};c.prototype.rr=function(a){if(this.Ea.yb){var b=this.Ea.x,d=this.Ea.y,
c=this.jh();a.save();a.setTransform(c,0,0,c,0,0);a.beginPath();this.Ea.ck?(a.moveTo(b-3,d-10),a.lineTo(b+3,d-10),a.moveTo(b-3,d+10),a.lineTo(b+3,d+10),a.moveTo(b,d-10),a.lineTo(b,d+10)):(a.moveTo(b,d-3),a.lineTo(b,d-15),a.moveTo(b,d+3),a.lineTo(b,d+15),a.moveTo(b-3,d),a.lineTo(b-15,d),a.moveTo(b+3,d),a.lineTo(b+15,d));this.Ea.Na&&this.ka.arc(b,d,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.kf=function(){var a=this.da.get("showRuler")?20:0,b=C(this.canvas),
d=b.offset(),c=C(this.canvas.parentNode).offset(),f=b.width();b=b.height();var g=d.left-c.left;d=d.top-c.top;c=this.hh();this.kc.moveTo(g+f-20+c,d+c+a);this.kc.Fe(20,b-20);this.qd.moveTo(g+c+a,d+b-20+c);this.qd.Fe(f-20,20);this.wg();this.ja()};c.prototype.wg=function(){if(!this.Yk()){var a=this.me(),b=this.pd();b=new K(0,0,b.width,b.height);a.Jd(this.ml)&&b.Jd(this.ll)||!this.Nc(this.Bd)||(this.ml=a,this.ll=b)}};c.prototype.un=function(){if(this.Ie){var a=this.ha.Ok();this.ka.save();this.ka.beginPath();
this.ka.rect(0,0,a.width,a.height);this.ka.clip()}return this.Ie};c.prototype.ja=function(a){if(!this.Yk()&&(this.md=a||null,!this.wk)){this.wk=!0;var b=this;this.requestAnimationFrame.call(window,function(){b.wk=!1;var a=b.jh();a!==b.Wi&&(b.log("Detected DPR change; resize canvas now"),b.rp(b.Ve.width,b.Ve.height),b.Wi=a);var c=b.se(),f=c.x,g=c.y,h=c.width,k=c.height;b.ka.setTransform(1,0,0,1,0,0);b.ka.clearRect(0,0,b.canvas.width,b.canvas.height);b.Ie&&(b.ka.fillStyle=b.da.get("outsidePageColour"),
b.ka.fillRect(0,0,b.canvas.width,b.canvas.height));b.ka.scale(a,a);b.ka.translate(b.tb,b.hb);b.ka.scale(b.scale,b.scale);b.da.get("showRuler")&&b.ka.translate(20/b.scale,20/b.scale);var l=new M(b.tb,b.hb);l=l.multiply(new P(b.scale,b.scale));b.ka.Ev=l;b.Ie?b.tr(b.ka):b.bh(b.ka,f,g,Math.max(h,h-f),Math.max(k,k-f));b.ha.Ju();f=b.un();g=b.da.Ha("symmetry");if(1<g){h=2*Math.PI/g;k=b.Fa(new F(b.canvas.width/a/2,b.canvas.height/a/2));g&1&&(l=new N(h,k.x,k.y));for(b.ka.save();h<2*Math.PI-1E-8;)0===(g&1)&&
(l=new pc(h,k.x,k.y)),b.ka.transform(l.m11,l.m21,l.m12,l.m22,l.Ca,l.Da),b.ha.ja(b.ka),h+=2*Math.PI/g;b.ka.setTransform(1,0,0,1,0,0);b.ka.fillStyle="rgba(255,255,255,0.3)";b.ka.fillRect(0,0,b.canvas.width,b.canvas.height);b.ka.restore()}b.ha.ja(b.ka,c);b.ua.md&&(b.ka.save(),b.ua.md(b.ka),b.ka.restore());0<b.selection.length&&(b.ka.save(),b.ur(b.ka),b.ka.restore());f&&b.ka.restore();b.Aa&&b.Aa.wi(b.ka,1/b.scale,b.nd);""!==b.ig&&b.da.get("showHints")&&(b.ka.save(),b.ka.font=10/b.scale+"px Arial",b.ka.fillStyle=
"#000000",b.ka.textBaseline="top",b.ka.fillText(b.ig,0,0),b.ka.restore());b.rr(b.ka);b.na.Bh&&b.na.Bh(b.ka);b.md&&b.md(b.ka);b.ua.bf("draw",b.ka);b.da.get("showRuler")&&(b.ka.setTransform(a,0,0,a,0,0),c=b.da.get("pixelsPerUnit")*b.scale,l=b.da.get("units"),b.ka.fillStyle="#ccc",b.ka.fillRect(0,0,20,20),Lc(b.ka,new K(20,0,b.canvas.width-20,20),0,l,c,-b.tb),Lc(b.ka,new K(0,20,20,b.canvas.height-20),2,l,c,-b.hb));b.ka.setTransform(1,0,0,1,0,0);0<b.selection.length&&b.Je&&b.Je.naturalWidth&&(c=b.Je.width,
b.ka.drawImage(b.Je,b.canvas.width-c-b.kc.Hi(),0));b.Fc&&b.Fc.complete&&b.Fc.naturalWidth&&(c=b.Fc.naturalWidth,b.ka.drawImage(b.Fc,b.canvas.width-c-b.kc.Hi(),0));b.ka.setTransform(a,0,0,a,0,0);b.ka.beginPath();b.ka.font="20px Arial";h=b.ka.measureText(Ud).width;a=b.canvas.width/a/h;b.ka.scale(a,a);b.ka.textBaseline="top";b.ka.lineWidth=4/a;b.ka.strokeStyle="rgba(128, 128, 128, 0.1)";b.ka[Xd](Ud,0,0)})}};c.prototype.ur=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=
0;b<this.selection.length;b++){var d=this.selection[b];var c=d.Ga();d=new Q(d.cb);d.transform(c);d.vi(a,[3/this.scale,3/this.scale])}a.stroke();c=this.scale;for(b=0;b<this.Ae.length;b++){d=this.Ae[b];var f=this.Dl.apply(d.x,d.y);d instanceof Cd?this.yk&&(a.beginPath(),a.strokeStyle="#008000",a.lineWidth=3/c,a.moveTo(f.x,f.y),a.arc(f.x,f.y,6/c,0,1.5*Math.PI,!1),a.stroke()):(a.beginPath(),a.strokeStyle="#000",a.lineWidth=1/c,a.rect(f.x-this.Mf/c,f.y-this.Mf/c,this.Mf/c*2,this.Mf/c*2),a.stroke())}};
c.prototype.Ef=function(a){this.Aa=a};c.prototype.Ik=function(){return this.Aa};c.prototype.gm=function(a){this.Dl=a};c.prototype.Ep=function(a){this.yk=a};c.prototype.Ts=function(a){return a.hc===this.hc};c.prototype.os=function(a,b){if(this.Aa)return null;for(var d=this.Em/this.scale,c=null,f=Number.MAX_VALUE,g=0;g<this.Ae.length;g++){var h=this.Ae[g],k=G(h.x,h.y,a,b);k<d&&k<f&&(f=k,c=h)}return c};c.prototype.ib=function(){this.Mp(!1)};c.prototype.wd=function(){this.Mp(!0)};c.prototype.Mp=function(a){if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring undo.");
else if(a?this.ha.Dd():this.ha.Ed())a=a?this.ha.wd():this.ha.ib(),this.ha.format(this.ka,this.request),this.Pq(),this.Wf(),this.wg(),this.mc(),this.jo(a),a=this.ha.lg,this.log("Most recent change page=%s",a),a!==this.ha.Va?(this.log("Undo/redo switched page %s->%s",this.ha.Va,a),this.Db(a)):this.ja(),this.ua.ta("document-changed")};c.prototype.nk=function(){this.de();this.Zg()};c.prototype.de=function(a,b){void 0===a&&(a=!1);var d=b?this.ha.Lk(b,!1,!1):this.qe();var c=this.ha.hu(d);0<d.length&&(!0!==
a&&vd.setItem("clipboard",c),this.log("Reset paste offset to 0"),this.Rh=this.Qh=0);return c};c.prototype.duplicate=function(){var a=this.wc(!1),b=this.da.get("pasteOffset"),d=b||this.da.get("pasteOffsetX");b=b||this.da.get("pasteOffsetY");0<a.length&&this.pa([new de(a,d,b)])};c.prototype.sg=function(a){if(!a&&(a=vd.getItem("clipboard"),!a))return;var b=this.da.get("pasteOffset"),d=b||this.da.get("pasteOffsetX");b=b||this.da.get("pasteOffsetY");this.Qh+=d;this.Rh+=b;this.log("Using paste offset %s,%s",
this.Qh,this.Rh);d=new M(this.Qh,this.Rh);a=this.ha.Eo(a,d);this.pa(a);this.update()};c.prototype.De=function(a){""!==a?(this.ig=this.language.get(a),this.ua.ta("hint",this.ig)):(this.ig="",this.ua.ta("hint",""))};c.prototype.Xa=function(){return this.Qa(new yd(this))};c.prototype.Qa=function(a){this.na&&this.na.Jc&&this.na.Jc();this.na=a;a.uc&&a.uc();a.Yc&&this.ua.ta("tool-changed",a.Yc());return a};c.prototype.Ci=function(){var a=null;this.na.Yc&&(a=this.na.Yc());return a};c.prototype.rj=function(a){if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring tool click.");
else return a=new Jd(this,a),this.Qa(a),a};c.prototype.bl=function(a,b,d){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Qa(new Ld(this,"line",void 0,a,b,d))};c.prototype.vk=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||this.Yf,a.strokeStyle=a.strokeStyle||this.ac,this.Qa(new Kd(this,this.na,a,"brush")))};c.prototype.Dn=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=
a.lineWidth||this.Yf,a.strokeStyle=a.strokeStyle||this.ac,this.Qa(new Kd(this,this.na,a,"shapebrush")))};c.prototype.Bn=function(a,b){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||this.Yf,a.strokeStyle=a.strokeStyle||this.ac,this.Qa(new Kd(this,this.na,a,b)))};c.prototype.kk=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Qa(new Ld(this,"curve",void 0,a))};c.prototype.Tu=function(a){this.da.get("readOnly")?
this.log("readOnly mode: Ignoring tool click."):this.Qa(new Ld(this,"stampline",a))};c.prototype.kn=function(a,b){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Qa(new Ld(this,"arrow",void 0,a,b))};c.prototype.me=function(){if(this.Ie){var a=this.ha.Ok();a=new K(0,0,a.width,a.height);var b=this.da.get("pageInflation");a.xc(b,b)}else a=this.ha.re();return a};c.prototype.mc=function(){if(!this.Yk())if(this.da.get("scrollbars")){var a=this.pd(),b=this.me(),d=this.se(),c=
!1,f=!1;d.y<=b.y&&d.bottom()>=b.bottom()?this.kc.Za():(this.kc.show(),this.kc.Ap(Math.min(d.y,b.y),Math.max(d.bottom(),b.bottom()),d.height,-this.hb/this.scale),c=!0);d.x<=b.x&&d.right()>=b.right()?this.qd.Za():(this.qd.show(),this.qd.Ap(Math.min(d.x,b.x),Math.max(d.right(),b.right()),d.width,-this.tb/this.scale),f=!0);f&&c?(this.kc.Fe(20,a.height-20),this.qd.Fe(a.width-20,20)):c?this.kc.Fe(20,a.height):f&&this.qd.Fe(a.width,20)}else this.kc.Za(),this.qd.Za()};c.prototype.yg=function(a,b,d){this.log("Set document size %s,%s",
a,b);d?d.push(new sd({width:a,height:b})):(this.ha.setProperty("width",a),this.ha.setProperty("height",b),this.mc(),this.wg(),this.ua.ta("document-changed"));return!0};c.prototype.Vi=function(a,b,d){if(this.xg)return a*=d/this.scale,b*=d/this.scale,this.log("Nudge selection by %s, %s",a,b),d=this.wc(!0),d.length&&(a=new M(a,b),this.pa([new Gd(d,a)])),0<d.length;this.log("Can't nudge; selection motion is locked.")};c.prototype.Kf=function(a){var b=new U;var d=new F(-50,-50);var c=new F(50,-50);var f=
new F(50,50);var g=new F(-50,50);b.moveTo(d.x,d.y);b.lineTo(c.x,c.y);b.lineTo(f.x,f.y);b.lineTo(g.x,g.y);b.lineTo(d.x,d.y);b.close();a=bb({},{commands:b.ic(),fillStyle:this.Fb,strokeStyle:this.Sb,seed:Math.round(65535*Math.random()),lineWidth:this.va.lineWidth,sloppiness:this.va.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.La);this.Qa(new Md(this,"PathNode",a,100,100,"rectangle","rectangle"))};c.prototype.km=
function(a,b,d,c){var e=new U;for(var g=0;g<=a;g++){var h=50*Math.sin(b),k=50*-Math.cos(b);g&1&&(h*=d,k*=d);"matrix"in c&&(k=c.matrix.apply(h,k),h=k.x,k=k.y);0===g?e.moveTo(h,k):e.lineTo(h,k);b+=2*Math.PI/a}e.close();"matrix"in c&&delete c.matrix;c=bb({},{commands:e.ic(),fillStyle:this.Fb,strokeStyle:this.Sb,seed:Math.round(65535*Math.random()),lineWidth:this.va.lineWidth,sloppiness:this.va.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},c);this.log("Create an item on layer %s",
this.La);this.Qa(new Md(this,"PathNode",c,100,100,this.da.Yn(),"polygon"))};c.prototype.It=function(){this.Qa(new Jc(this))};c.prototype.Wh=function(a){var b=new F(0,0);var d=new U;d.moveTo(b.x,b.y-50);d.Ze(b.x+50,b.y-50,b.x+50,b.y);d.Ze(b.x+50,b.y+50,b.x,b.y+50);d.Ze(b.x-50,b.y+50,b.x-50,b.y);d.Ze(b.x-50,b.y-50,b.x,b.y-50);d.closePath();b=d.ic();a=bb({},{commands:b,fillStyle:this.Fb,strokeStyle:this.Sb,seed:Math.round(65535*Math.random()),lineWidth:this.va.lineWidth,sloppiness:this.va.sloppiness,
layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},a||{});this.Qa(new Md(this,"PathNode",a,100,100,this.da.Yn(),"circle"))};c.prototype.lm=function(a,b,d,c,f){this.Qa(new Md(this,a,b,d,c,f,"shape"))};c.prototype.jv=function(a,b){this.Qa(new Od(this,a,b))};c.prototype.jm=function(a){var b=this.ha.za(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.hg())return this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()),
!1;this.Xa();this.sb();this.Tb();this.Ef(b);this.ja()};c.prototype.nm=function(a){this.Qa(new Nd(this,a))};c.prototype.mm=function(){this.Qa(new Td(this))};c.prototype.st=function(){if("interactive"===this.da.get("textMode"))this.rj({});else{var a=this.ha.Wa();var b=this.Fa(new F(100,100));b=new M(b.x,b.y);this.pa([new V(a,"TextNode",{text:this.da.Ha("defaultText"),fontSize:this.va.fontSize,fontName:this.va.fontName,bold:this.va.bold,italic:this.va.italic,textFillStyle:this.va.textFillStyle,strokeStyle:this.va.textStrokeStyle,
lineWidth:this.va.textLineWidth,textAlign:this.va.textAlign,textDecoration:this.va.textDecoration,layer:this.La}),new Gd([a],b)])}};c.prototype.hl=function(a){var b=this.ha.Wa();var d=this.Fa(new F(100,100));d=new M(d.x,d.y);this.pa([new V(b,"ImageNode",{url:a,layer:this.La}),new Gd([b],d)]);this.Xa()};c.prototype.gg=function(){return Vb()};c.prototype.zt=function(a,b){this.na.td?(this.log("Simulating click of colour %s",a),this.na.td(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.Et=
function(a,b){this.na.ud?(this.log("Simulating opacity change %s",a),this.na.ud(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.Db=function(a){this.ha.Db(a)&&(this.sb(),this.Tb(),this.ja(),this.ua.ta("set-page",a))};c.prototype.Ml=function(a){this.Ie=a;a=this.me();this.tb=-a.x;this.hb=-a.y;this.mc();this.ja()};c.prototype.Bj=function(){this.Nc(this.da.Bl(1.1*this.scale))};c.prototype.Cj=function(){this.Nc(this.da.Bl(this.scale/1.1))};c.prototype.fh=function(a,b,d){d=d||this.As(a);
b=new pc(b,d.x,d.y);this.pa([new Gd(this.Zn(a),b)])};c.prototype.Pn=function(a,b){this.lo()||this.log("flipSelection: selection is empty");this.fh(this.qe(),a,b)};c.prototype.jh=function(){var a=this.ka;return(window.devicePixelRatio||1)/(a.fw||a.Wv||a.Xv||a.Zv||a.Pv||1)};c.prototype.pd=function(){var a=this.Ve,b=this.da.get("showRuler")?20:0;return new K(b,b,a.width-b,a.height-b)};c.prototype.rp=function(a,b){var d=this.jh();this.canvas.width=a*d;this.canvas.height=b*d;this.canvas.style.width=a+
"px";this.canvas.style.height=b+"px";this.Ve.width=a;this.Ve.height=b};c.prototype.se=function(){var a=this.pd();return new K((0-this.tb)/this.scale,(0-this.hb)/this.scale,a.width/this.scale,a.height/this.scale)};c.prototype.Kh=function(a,b,d){void 0===b&&(b=!1);void 0===d&&(d=!1);this.log("setViewRect(%s)",a);var c=this.pd(),f=Math.min(c.width/a.width,c.height/a.height),g=a.x*f,h=a.y*f;this.tb=b?(c.width-a.width*f)/2-g:-g;this.hb=d?(c.height-a.height*f)/2-h:-h;this.Bd=this.scale=f;this.mc();this.ja()};
c.prototype.Rr=function(a){this.request.Ue?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Pi=function(a){!this.Rf&&a?(this.log("Locking updates."),this.Rf=!0):this.Rf&&!a&&(this.log("Resuming updates"),this.Rf=!1,this.wg(),this.mc(),this.ja())};c.prototype.Yk=function(){this.Rf&&this.log("Updates are locked. Ignoring draw/format request");return this.Rf};c.prototype.Rl=
function(a){var b=this;a?(b.Fc=document.createElement("img"),b.Fc.setAttribute("src",b.da.Ab("wd-done.png")),b.Fc.onload=function(){b.ja()}):b.Fc=null};c.prototype.gl=function(){function a(){c.drawImage(b.canvas,f.x*g,f.y*g,f.width*g,f.height*g,f.x*g,f.y*g,f.width*g,f.height*g);k=!0;l=b.se();b.log("Got new FASTDRAW buffer.")}var b=this,d=document.createElement("canvas");d.width=this.canvas.width;d.height=this.canvas.height;var c=d.getContext("2d"),f=this.pd(),g=this.jh(),h=this,k=!1,l=new K(0,0,0,
0);h.ja(a);return{ja:function(b,c){l.Jd(h.se())||(k=!1,h.ja(a));h.requestAnimationFrame.call(window,function(){k&&(h.ka.setTransform(1,0,0,1,0,0),h.ka.clearRect(f.x*g,f.y*g,f.width*g,f.height*g),h.ka.drawImage(d,0,0),b&&(h.ka.scale(g,g),h.ka.translate(f.x,f.y),h.ka.translate(h.tb,h.hb),h.ka.scale(h.scale,h.scale),b.call(c,h.ka)))})}}};return c}();var fe=function(){function c(a,b,d){var c=this;this.ua=a;this.ia=b;this.vb=new fb;this.Bg=!1;this.Mo=this.Po=-1;this.nq=!1;this.Ao=this.Bo=0;this.Lf="";this.Gg=null;this.log=B.create("APP");this.ia.empty();"absolute"!==this.ia.ea("position")&&"fixed"!==this.ia.ea("position")&&this.ia.ea("position","relative");this.ia.ea("overlow","none");this.ia.ea("text-align","left");this.Xf=new gb(C("<div>").ea("width","300px"),this.vb);this.log("Zwibbler built on %s",new Date(1540944710026));this.ia.append(this.Xf.ia);
this.da=new hd(d);this.language=new jb("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.xp(this.da.get("language"));this.hd=null;this.be=C("<div>");this.be.ea("position","absolute");this.be.ea("overflow","hidden");this.ia.append(this.be);this.canvas=C(Pb(this.be[0]));this.canvas.ea("outline","0");this.canvas.ea("position","absolute");this.canvas.ea("left","0");this.canvas.ea("top","0");this.canvas.ea("touch-action","none");this.canvas.Qb("tabindex","0");this.ka=this.canvas[0].getContext("2d");a=this.da.Wd();this.$b=new ec(this.ia,a?40:20,a,!1,this.da.get("colourPalette"));
this.da.xa("useTouch",function(a,b,d){d||(c.da.Wd()?(a=40,b=!0):(a=20,b=!1),c.$b.Fe(a,b),c.Og(!0))});this.bc=new xb;this.view=new ee(this.canvas,new qd,this.$b,this.bc,this.da,this.language,this.ua,this.vb);this.sp();this.toolbar=this.pi();this.ua.xa("tool-changed",function(a){c.toolbar.qp(a)});this.Ys=this.Fu();this.Yb=new id(this.da,this.language,this.vb);this.ia.append(this.Yb.ia);this.da.Dp()&&this.view.zp(this.Yb);this.Yb.view=this.view;this.Yb.xa("click",function(){c.focus("none")});this.vb.bind(C(window),
"resize",function(){setTimeout(function(){c.Og()},1)});window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){c.log("Bootstrap modal shown; resize now");c.ua.resize()}));this.query=fd();this.Bg="debug"in this.query||this.da.Bg();this.Dc=new Eb(this.ia);this.Dc.ia.ea("border-right","1px solid black");this.Hc=new Eb(this.ia);this.Hc.ia.ea("border-top","1px solid black");this.Hc.xa("click",function(a){c.view.hl(a)});this.Dc.xa("click",
function(a){c.gj(a)});null!==this.da.Ha("backgroundImage")&&(this.gj(this.da.Ha("backgroundImage")),this.view.ha.Eh());this.Cr();this.da.xa("update",function(a,b){c.ye(a,b)});this.fc=new fc(this.ua,C("<div>"),!1,!this.da.get("showPageSelectorControls"));this.fc.ia.ea("position","absolute");this.fc.ia.ea("top","0");this.fc.ia.ea("bottom","0");this.fc.ia.ea("width","160px");this.fc.ia.ea("left","50px");this.fc.ia.ea("background",this.da.get("outsidePageColour"));this.fc.hj(this.da.get("showPageSelector"));
this.ia.append(this.fc.ia);this.wl=C("<div>").ea("position","absolute").ea("top","0").ea("right","0").ea("box-shadow","3px 3px 3px #444").ea("background","#ccc").ea("color","black").ea("border-bottom-left-radius","4px").ea("font-family","arial,sans");this.ia.append(this.wl);this.Og();this.mk=(a=this.da.Jk("pageSelectorDiv"))?new fc(this.ua,C(a),!0,!0):null;this.da.get("setFocus")&&this.focus("toolbar");this.ui=[];this.fc.Gl(this.ua);this.mk&&(this.mk.Gl(this.ua),this.mk.hj(!0));this.ua.ta("document-changed");
this.ua.ta("set-page",this.view.ha.Va);if(vd.hi()){if(this.da.get("persistent")&&(a=vd.getItem("zwibbler-document")))try{var f=ud.Ij(a);if(f)this.Df(f);else throw Error("Failed to open document.");}catch(g){this.log("Failed to load persistent document: %s",g.message)}this.Gg=wd(function(){c.da.get("persistent")&&(c.log("Saving document"),vd.setItem("zwibbler-document",c.ua.save()))});this.ua.xa("document-changed",function(){c.Gg()});this.vb.add(function(){c.Gg.cancel()})}this.vb.add(function(){c.ia.empty();
delete c.ia[0].zwibbler})}c.prototype.Zf=function(){this.vb.Zf()};c.prototype.ye=function(a,b){var d=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "debug":case "showDebug":this.Bg=b;d=!0;break;case "showPageSelector":d=!0;this.fc.hj(b);break;case "backgroundImage":this.gj(b);break;case "colourPalette":this.$b.ou(b);break;case "showToolbar":case "showColourPanel":d=!0;break;case "showPropertyPanel":this.view.zp(b?this.Yb:null);d=!0;break;case "showArrowTool":case "showBrushTool":case "showCircleTool":case "showCopyPaste":case "showCurveTool":case "showLineTool":case "showMoveToFrontBack":case "showPickTool":case "showRoundRectTool":case "showShapeBrushTool":case "showSquareTool":case "showTextTool":case "showUndoRedo":case "toolbarButtonSize":this.pi();
d=!0;break;case "language":this.language.xp(b)}d&&this.Og(!0)};c.prototype.Cr=function(){var a;var b=this.da.Ha("fonts");var d=[];var c=0;for(a=b.length;c<a;c++){var f=b[c];this.log("Preloading: %s",f);f=C("<div>").ea("font-family",f).text("abcd");f.ea("color","transparent");d.push(this.ia.append(f))}};c.prototype.sp=function(){this.da.Ha("sloppy")||this.view.Be("sloppiness",0);this.view.Be("smoothness",this.da.gs());this.view.Be("fillStyle",this.da.Ha("defaultFillStyle"));this.view.Be("strokeStyle",
this.da.Ha("defaultStrokeStyle"));this.view.Be("fontName",this.da.Ha("defaultFont"));this.view.Be("fontSize",this.da.Ha("defaultFontSize"));this.view.Be("lineWidth",this.da.Ha("defaultLineWidth"));this.view.Be("textFillStyle",this.da.Ha("defaultTextFillStyle"))};c.prototype.lu=function(a,b){var d;this.Dc.clear();b&&this.Dc.ij(b,b);var c=[];var f=0;for(d=a.length;f<d;f++){var g=a[f];"string"===typeof g?c.push(this.Dc.ei(g,g)):c.push(this.Dc.ei(g.small,g.large,g.tooltip))}};c.prototype.xu=function(a,
b){var d;this.Hc.clear();var c=[];b&&this.Hc.ij(b,b);var f=0;for(d=a.length;f<d;f++){var g=a[f];"string"===typeof g?c.push(this.Hc.ei(g,g)):c.push(this.Hc.ei(g.small,g.large,g.tooltip))}};c.prototype.Df=function(a){this.hd=null;this.view.Df(a);this.sp();this.Jr();this.ua&&(this.ua.ta("document-changed"),this.ua.ta("set-page",a.Va));for(a=0;a<this.ui.length;a++){var b=this.ui[a];this.log("Removing old DomElement of type %s",b.tagName);C(b).remove()}this.ui=[]};c.prototype.Uq=function(){this.view.ha.Eh()};
c.prototype.pi=function(){function a(a){return 0===a.type.indexOf("key")}var b,d=this;this.toolbar&&this.toolbar.ia.remove();var c=this.language.fn(),f=new yb(this.da.get("toolbarButtonSize"));this.toolbar=f;if(this.da.get("showToolbar")){this.da.get("showPickTool")&&f.Re("pick",c("pick-tool"),this.da.Ab("wd-pick.png"),function(b){d.view.Xa();a(b)&&d.xd()});this.da.get("showSquareTool")&&f.lc(this.da.Ab("wd-box.png"),c("rectangle-tool"),function(b){d.view.Kf({});a(b)&&d.Yl(b)});this.da.get("showRoundRectTool")&&
f.lc(this.da.Ab("wd-roundrect.png"),c("rounded-rectangle-tool"),function(b){d.view.Kf({roundRadius:d.da.get("defaultRoundRectRadius")});a(b)&&d.Yl(b)});this.da.get("showCircleTool")&&f.lc(this.da.Ab("wd-circle.png"),c("circle-tool"),function(b){d.view.Wh({});a(b)&&d.Yl(b)});this.da.get("showShapeBrushTool")&&f.Re("shapebrush",c("shape-brush-tool"),this.da.Ab("wd-shapebrush.png"),function(b){d.view.Dn({});a(b)&&d.xd()});this.da.Hu()&&f.Re("brush",c("brush-tool"),this.da.Ab("wd-brush.png"),function(b){d.view.vk({});
a(b)&&d.xd()});this.da.get("showLineTool")&&f.Re("line",c("line-tool"),this.da.Ab("wd-line.png"),function(b){d.view.bl({angleArcs:d.da.get("angleArcs")},!1,!1);a(b)&&d.xd()});this.da.get("showCurveTool")&&f.Re("curve",c("curve-tool"),this.da.Ab("wd-curve.png"),function(b){d.view.kk({});a(b)&&d.xd()});this.da.get("showArrowTool")&&f.Re("arrow",c("arrow-tool"),this.da.Ab("wd-arrow.png"),function(b){d.view.kn({},!1);a(b)&&d.xd()});this.da.get("showTextTool")&&f.Re("text",c("text-tool"),this.da.Ab("wd-text.png"),
function(b){d.view.st();a(b)&&d.xd(!0)});var g=function(a){d.toolbar.lc(a.image,a.name,function(b){d.Ct(b,a)})};var h=0;for(b=td.buttons.length;h<b;h++){var k=td.buttons[h];this.log("add custom button %s",name);g(k)}f.qp("pick");this.da.Ha("showImageTool")&&f.lc(this.da.Ab("wd-image.png"),c("image-tool"),function(){d.view.hl("logo.png")});this.da.Ha("showMoveToFrontBack")&&(f.lc(this.da.Ab("wd-moveup.png"),c("bring-to-front"),function(){d.view.Qg()}),f.lc(this.da.Ab("wd-movedown.png"),c("send-to-back"),
function(){d.view.Hh()}));this.da.get("showUndoRedo")&&(f.lc(this.da.Ab("wd-undo.png"),c("undo"),function(){d.view.ib()}),f.lc(this.da.Ab("wd-redo.png"),c("redo"),function(){d.view.wd()}));this.da.get("showCopyPaste")&&(f.lc(this.da.Ab("wd-copy.png"),c("copy"),function(){d.view.de()}),f.lc(this.da.Ab("wd-paste.png"),c("paste"),function(){d.view.sg()}))}f.xa("click",function(){d.focus("toolbar")});f.ia.style.position="absolute";f.ia.style.left="0";f.ia.style.right="0";this.ia.append(C(f.ia));return f};
c.prototype.Ct=function(a,b){this.log("Custom button %s clicked.",b.name);b.onclick.call(a.target,this.ua)};c.prototype.Fu=function(){var a=this,b=this;this.Lf="none";var d=new Ab;this.da.Bq(d);d.xa("*",function(a,d){"toolbar"===b.Lf?b.toolbar.ec(a,d):"canvas"===b.Lf?b.view.ec(a,d):b.log("Ignore key action -- don't have focus.")});this.ia.Qb("tabindex","0");d.Cq(this.ia[0]);this.vb.add(function(){b.Ys.detach(b.ia[0])});this.view.xi=!1;this.canvas.click(function(){Ub()||b.view.xi?b.Lf="canvas":b.focus("canvas");
b.view.xi=!1});C(this.toolbar.ia).click(function(){b.focus("toolbar")});this.$b.xa("colour",function(){b.focus("canvas")});this.bc.xa("goto-toolbar",function(){b.da.get("showToolbar")?b.focus("toolbar"):b.ua.ta("blur")});this.bc.xa("goto-canvas",function(){b.focus("canvas")});this.vb.bind(this.ia,"blur",function(){b.log("Blur event received -- hide keyboard cursor");b.view.oo()});this.da.Uk()&&this.vb.bind(C(document),"cut copy paste",function(b){a.view.xt(b)});return d};c.prototype.focus=function(a){this.log("Set focus to %s",
a);if("toolbar"!==a&&"canvas"!==a&&"none"!==a)throw"Focus must be toolbar or canvas or none, not "+a;this.Lf=a;"toolbar"===this.Lf?(this.toolbar.focus(),this.view.oo(),this.da.get("setFocus")&&this.ia.focus()):"canvas"===this.Lf&&(this.toolbar.blur(),this.da.get("setFocus")&&this.ia.focus())};c.prototype.Yl=function(a){this.focus("canvas");this.view.Cp(a)};c.prototype.xd=function(a){void 0===a&&(a=!1);this.focus("canvas");this.view.xd(a)};c.prototype.createNode=function(a,b,d){var c=this.view.ha.Wa();
"layer"in d||(d.layer=this.view.La);a.push(new V(c,b,d));return c};c.prototype.transformNode=function(a,b,d){a.push(new Gd(b,d));return!0};c.prototype.Ll=function(a,b,d,c,f,g,h,k){d=new O(d,f,c,g,h,k);a.push(new Id(b,"matrix",d));return!0};c.prototype.vj=function(a,b,d,c){d=new M(d,c);a.push(new Gd(b,d));return!0};c.prototype.Cl=function(a,b,d,c,f,g){d=new P(d,c,f,g);a.push(new Gd(b,d));return!0};c.prototype.Ec=function(a,b){a.push(new ce(b));return!0};c.prototype.Jr=function(){var a=this;this.hd=
null;this.view.ha.kb(!1,function(b){"ImageNode"!==b.type()||"background"!==b.la("layer")&&"background"!==b.la("tag")||(a.log("Found background image at nodeid %s",b.id),a.hd=b.id,b.Ce(!0))})};c.prototype.gj=function(a){var b=[];null!==this.hd&&this.view.ha.cf(this.hd)&&b.push(new ce([this.hd]));if(a){var d=this.view.ha.Wa();b.push(new V(d,"ImageNode",{url:a,locked:!0,tag:"background",layer:this.view.La}));b.push(new ae([d],ae.Kj))}this.hd=d||null;this.view.pa(b);d&&this.view.ha.za(d,!1).Ce(!0);this.view.sb();
this.view.Tb()};c.prototype.bs=function(){return null!==this.hd&&this.view.ha.cf(this.hd)?this.view.ha.za(this.hd).la("url"):null};c.prototype.fl=function(){this.Df(new qd);null!==this.da.Ha("backgroundImage")&&(this.gj(this.da.Ha("backgroundImage")),this.view.ha.Eh())};c.prototype.Og=function(a){void 0===a&&(a=!1);var b,d,c;var f=C(window).width();var g=C(window).height();if(a||f!==this.Bo||g!==this.Ao)if(this.Bo=f,this.Ao=g,f=this.ia.width()-0,g=this.ia.height()-0,!(0>=f||!a&&f===this.Po&&g===this.Mo)){this.Po=
f;this.Mo=g;if(this.da.Ha("showBackgroundSelector")){var h=100;this.Dc.show();this.Dc.ij(h-24,0)}else h=0,this.Dc.Za();if(this.da.Ha("showImageSelector")){var k=100;this.Hc.ij(0,k-24);this.Hc.show()}else k=0,this.Hc.Za();if(this.da.Ha("showPageSelector")){this.fc.ia.show();var l=this.fc.ia.outerWidth()}else this.fc.ia.Za(),l=0;if(this.da.Iu()){this.$b.show();this.$b.Ql(f);var m=this.$b.height()}else this.$b.Za(),m=0;this.log("Colour panel height is %s",m);if(this.da.Lu()){this.toolbar.show(!0);this.toolbar.Tr(g-
m);var n=this.toolbar.width()}else this.toolbar.show(!1),n=0;a=this.view.hh();this.toolbar&&this.toolbar.moveTo(h+l,0);var r=g-m;var q=b=c=0;this.Bg&&(this.Xf.show(),q=this.Xf.width());(d=this.da.Dp()&&700<=f)&&(b=300);c+=b+q;var v=f-2*a-h-c;var y=g-2*a-m-k;this.Dc.width(h);this.Dc.height(g-2*a-m);this.Dc.moveTo(0,0);this.fc.ia.ea("top","0");this.fc.ia.ea("left","0");this.Hc.width(v);this.Hc.height(k);this.Hc.moveTo(h,g-2*a-m-k);k=l+h+n;h=f-2*a-n-c-h-l;this.be.ea("left",""+k+"px");this.be.ea("top",
"0");this.be.ea("width",""+h+"px");this.be.ea("height",""+y+"px");this.view.rp(h,y);this.$b&&(this.$b.moveTo(k,r),this.$b.Ql(f-k),this.$b.ja());this.wl.ea("top","0").ea("right",""+(b+q)+"px");this.Bg?(this.Xf.moveTo(f-q,0),this.Xf.height(g-2*a-m)):this.Xf.Za();d?(this.Yb.show(),this.Yb.moveTo(f-q-b,0),this.Yb.width(b),this.Yb.height(g-2*a-m)):this.nq||this.Yb.Za();this.view.kf()}};c.prototype.Nj=function(a,b,d){void 0===d&&(d=this.view.ha.Va);var c=this.view.ha.Va;this.view.ha.Db(d);a.translate(-b.x,
-b.y);this.view.bh(a,b.x,b.y,b.width,b.height);this.view.ha.ja(a);this.ua.md&&this.ua.md(a);this.view.ha.Db(c)};c.prototype.jp=function(a,b){if("image/svg+xml"===a||"application/pdf"===a){var d=!1;if("image/svg+xml"===a)var c=new pd(new K(0,0,b.width,b.height));else c=new nd(new K(0,0,b.width,b.height),td.fonts),d=!0;if(d)for(d=0;d<this.view.ha.Gc();d++)0<d&&c.Cg(),this.Nj(c,b,d);else this.Nj(c,b);return"data:"+a+";base64,"+x.encode("base64",c.toString())}d=C("<canvas>");d.Qb("width",""+b.width);
d.Qb("height",""+b.height);c=d[0].getContext("2d");if("image/jpeg"===a||"image/bmp"===a)c.fillStyle="#ffffff",c.fillRect(0,0,b.width,b.height);this.Nj(c,b);if("image/bmp"===a)if(c=d[0],d=c.getContext("2d"),null===d)c="error";else{var f=d.getImageData(0,0,c.width,c.height);c=f.width;var g=f.height;d=c*g*3;var h=d+54,k=[66,77,h&255,h>>8&255,h>>16&255,h>>24&255,0,0,0,0,54,0,0,0],l=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,g&255,g>>8&255,g>>16&255,g>>24&255,1,0,24,0,0,0,0,0,d&255,d>>8&255,d>>16&255,
d>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];d=(4-3*c%4)%4;f=f.data;h=c<<2;for(var m=Ib.Kg("Base64Encoder"),n=0;n<k.length;n++)m.Ra(k[n]);for(n=0;n<l.length;n++)m.Ra(l[n]);do{k=h*(g-1);for(l=0;l<c;l++)n=l<<2,m.Ra(f[k+n+2]),m.Ra(f[k+n+1]),m.Ra(f[k+n]);for(k=0;k<d;k++)m.Ra(0)}while(--g);m.flush();c="data:image/bmp;base64,"+m.cg().toString()}else c=d[0].toDataURL(a);return c};c.prototype.Ee=function(a,b,d,c){this.log("External app setItemProperty %s: %s=%s",b,d,c);a.push(new Id(b,d,c));return!0};c.prototype.Kl=
function(a,b,d){var c;this.log("External app setNodeProperty %s: %s",b,d);for(c in d)d.hasOwnProperty(c)&&a.push(new Id(b,c,d[c]));return!0};c.prototype.Fi=function(a,b){var d,c;(d=this.view.ha.za(a))&&(c=d.la(b));this.log("GetItemProperty %s: %s=%s",a,b,c);return c};c.prototype.hk=function(a,b){var d,c;if(6>b.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var f=new U;var g=d=0;for(c=b.length-1;d<=c;g=d+=2){var h=this.view.Fa(new F(b[g],b[g+1]));if(0===g){f.moveTo(h.x,
h.y);var k=h}else f.lineTo(h.x,h.y)}k&&(f.lineTo(k.x,k.y),f.close());return this.ni(a,f.ic())}};c.prototype.ni=function(a,b){return this.createNode(a,"PathNode",{commands:b,fillStyle:this.view.Fb,strokeStyle:this.view.Sb,seed:Math.round(65535*Math.random()),lineWidth:this.view.va.lineWidth,sloppiness:this.view.va.sloppiness,angleArcs:this.da.get("angleArcs")})};c.prototype.Xg=function(a,b){var d=this.view.ha.Wa();a.push(new rd(d,b));return d};c.prototype.Uh=function(a,b){a.push(new be(b));return!0};
c.prototype.ir=function(a){return new cb(this.wl,a)};return c}();var ge=function(){function c(a,b){this.view=a;this.methods=b;this.log=B.create("CustomToolBehaviour");this.gc=new Ic(a)}c.prototype.uc=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.Jc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.qc=function(a,b,d){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,d):!1};c.prototype.Ta=function(a,b,d){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,d):!1};c.prototype.Ua=function(a,b,d){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,d):!1};c.prototype.ab=function(a,b,d){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,d):!1};c.prototype.So=function(a,b,d){return this.methods.onMouseLeave?this.methods.onMouseLeave(a,b,d):!1};c.prototype.Pd=function(a,b,d){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,d):!1};c.prototype.Qo=function(a,b,d){return this.methods.onContextMenu?this.methods.onContextMenu(a,
b,d):!1};c.prototype.td=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.ud=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.ec=function(a,b){this.log("keyboard: %s",a);this.methods.onKeyCommand&&!1===this.methods.onKeyCommand(a,b)||"cancel"!==a||(this.log("ESC pressed. Abort and go back to toolbar."),this.view.Xa(),this.view.bc.ta("goto-toolbar"))};c.prototype.Bh=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};
c.prototype.xb=function(a){if(this.methods.onTouch)return this.methods.onTouch(a);if("touchstart"===a.type||"touchmove"===a.type||"touchend"===a.type){if(a.touches&&a.touches.length)var b=a.touches[0];else a.changedTouches&&a.changedTouches.length?b=a.changedTouches[0]:(this.log("No touches!"),b={pageX:0,pageY:0});b=this.view.gb(b.pageX,b.pageY);return"touchstart"===a.type?this.Ta(b.x,b.y,a):"touchend"===a.type?this.ab(b.x,b.y,a):"touchmove"===a.type?this.Ua(b.x,b.y,a):!1}};c.prototype.$a=function(a){return this.methods.onGesture?
this.methods.onGesture(a):this.gc.$a(a)};c.prototype.pl=function(a,b,d,c){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,d,c):!1};c.prototype.Yc=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();var he=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.element=null;b.si=void 0;b.qb=new zc;b.Sk=new zc;b.ie=new O;b.readOnly=!1;b.yb=!1;b.Xc=null;b.width=0;b.height=0;b.rc=null;b.log=B.create("DomNode",!0);b.aa.data="";b.aa.locked=!1;return b}p(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.setProperty=function(a,d){if("data"===a)this.element&&(C(this.element).remove(),this.si=this.element=null);else if("border"===a||"lockSize"===a||"lockRotate"===a||"preview"===a){this.aa[a]=
d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.uu=function(a){null!==this.Xc&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.element&&(this.log("   Remove existing DOM element"),C(this.element).remove()),this.element=a,this.element.style.position="absolute","IFRAME"!==a.tagName&&(this.element.style.pointerEvents="none"),C(this.element).fi(this.Xc.Hk()),this.width=this.element.offsetWidth||parseFloat(this.element.getAttribute("width")||"0"),this.height=this.element.offsetHeight||
parseFloat(this.element.getAttribute("height")||"0"),C(this.element).remove(),this.Ag(this.readOnly,!0),this.element.style.top="0px",this.element.style.left="0px",this.Tj("transformOrigin","top left"),this.log("element height: %s, %s",this.element.offsetWidth,this.element.offsetHeight),this.Xc.Dh(this.id))};a.prototype.Jk=function(){return this.element};a.prototype.Tj=function(a,d){if(null!==this.element){for(var b=a.charAt(0).toUpperCase()+a.substr(1),c=["ms","Webkit","O","Moz"],g=0;g<c.length;g++)this.element.style[c[g]+
b]=d;this.element.style[a]=d}};a.prototype.Ce=function(a){R.prototype.Ce.call(this,a);this.element&&(this.element.style.visibility=this.ai?"hidden":"visible")};a.prototype.Ag=function(a,d){void 0===d&&(d=!1);if(d||this.readOnly!==a)this.readOnly=a,this.element&&this.Xc&&this.yb&&(C(this.element).fi(this.Xc.Hk()),a?C(this.element).ea("pointer-events","auto"):C(this.element).ea("pointer-events","none"))};a.prototype.format=function(a,d){var b=this;null===this.element&&this.si!==this.la("data")&&d&&
(this.si=this.la("data"),this.Xc=d,this.log("DomNode %s requests conversion to DOM element",this.id),this.Xc.br(this.si,this.id));if(this.element){var c=this.ie;c=c.multiply(this.Ga());c.xo()?(this.Tj("transform",""),this.element.style.left=""+c.Ca+"px",this.element.style.top=""+c.Da+"px"):(this.element.style.left="0px",this.element.style.top="0px",this.Tj("transform","matrix("+c.m11+","+c.m21+","+c.m12+","+c.m22+","+c.Ca+","+c.Da+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=
this.height;this.element.style.visibility=this.ai?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.qb=new zc(this.rect);this.cb=this.rect.clone();this.rect.transform(this.Ga());this.qb.transform(this.Ga());if(c=this.aa.border)this.rect.xc(c),this.Sk=this.qb.clone(),this.Sk.xc(c/2),this.qb.xc(c);!this.aa.preview||null!==this.rc&&this.rc.src===this.aa.preview?this.aa.preview||(this.rc=null):(this.log("Requesting new preview image for %s",this.aa.preview),
this.rc=document.createElement("img"),this.rc.src=this.aa.preview,this.rc.onload=function(){b.log("Preview image loaded.");d.Dh(b.id)},this.rc.onerror=function(){b.log("FAiled to load preview image")})};a.prototype.Oe=function(a){var b=a.Ev;b&&this.Xc&&(b.m11!==this.ie.m11||b.m21!==this.ie.m21||b.m12!==this.ie.m12||b.m22!==this.ie.m22||b.Ca!==this.ie.Ca||b.Da!==this.ie.Da)&&(this.log("Moving DOM element as result of draw zooming"),this.ie=b,this.format(a,this.Xc));if(this.element){if(b=this.aa.border){var c=
this.Sk;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=b;a.strokeStyle="#cccccc";a.moveTo(c.oa[0].x,c.oa[0].y);a.lineTo(c.oa[1].x,c.oa[1].y);a.lineTo(c.oa[2].x,c.oa[2].y);a.lineTo(c.oa[3].x,c.oa[3].y);a.lineTo(c.oa[0].x,c.oa[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",0,0);if(this.rc&&this.rc.naturalHeight){this.log("Drawing preview image %s,%s ->%s,s",
this.rc.naturalWidth,this.rc.naturalHeight,this.width,this.height);try{a.drawImage(this.rc,0,0,this.rc.naturalWidth,this.rc.naturalHeight,0,0,this.width,this.height)}catch(f){this.log("Tried to draw image, got error: %s",f.toString())}}};a.prototype.lb=function(a,d){return!this.aa.locked&&this.rect.Wc(a,d)&&this.qb.Wc(a,d,3)?this:null};a.prototype.ol=function(){this.element&&this.Xc&&(this.log("Added DOM NODE %s",this.id),C(this.element).fi(this.Xc.Hk()),this.readOnly?C(this.element).ea("pointer-events",
"auto"):C(this.element).ea("pointer-events","none"));this.yb=!0};a.prototype.ql=function(){this.log("Removed DOM NODE %s",this.id);this.element&&C(this.element).remove();this.yb=!1};return a}(R);R.Vc("DomNode",he);var X,ie=X||(X={});ie[ie.IDLE=0]="IDLE";ie[ie.CONNECTING=1]="CONNECTING";ie[ie.CONNECTED=2]="CONNECTED";ie[ie.WAIT_FOR_ACK=3]="WAIT_FOR_ACK";ie[ie.ERROR_WAIT=4]="ERROR_WAIT";ie[ie.STOPPING=5]="STOPPING";
var me=function(c){function a(a,d,e){var b=c.call(this)||this;b.name=a;b.log=B.create("Sharing");b.state=X.IDLE;b.paused=!1;b.k=0;b.timeout=null;b.pg=null;b.ut=1;a=new je;var g=new ke(d,a);b.jj=new wb(g);a=new le(b.jj,a);d.ha.Bu(a,e);b.k=0;b.connect();return b}p(a,c);a.prototype.Ff=function(a){this.log(X[this.state]+" -> "+X[a]);this.state=a};a.prototype.connect=function(){var a=this;this.log("connect(): "+X[this.state]);this.state!==X.IDLE?this.log("Bad state"):(this.Ff(X.CONNECTING),this.Nh=new WebSocket("ws://zwibbler.com:3000/socket/"+
this.name),this.Nh.addEventListener("open",function(){a.Bt()}),this.Nh.addEventListener("close",function(){a.yt()}),this.Nh.addEventListener("message",function(b){a.Dt(b)}))};a.prototype.Bt=function(){this.log("onConnected(): "+X[this.state]);this.state!==X.CONNECTING?this.log("Bad state"):(this.Ff(X.Up),this.Fl())};a.prototype.yt=function(){this.log("onClose(): "+X[this.state]);this.state!==X.Zh&&(this.state===X.CONNECTING?(this.Ff(X.Zh),this.Zt()):(this.Ff(X.IDLE),this.paused||(this.k=0,this.connect())))};
a.prototype.Zt=function(){var a=this;this.state===X.Zh&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){a.state===X.Zh&&(a.log("onTimeout(): "+X[a.state]),a.timeout=null,a.Ff(X.IDLE),a.connect())},1E3*Math.pow(2,this.k)),5>this.k&&(this.k+=1))};a.prototype.Fl=function(){if(this.state===X.Up){if(this.paused)this.log("Currently paused; ignoring changes.");else if(null!==this.pg){this.log("Have outstanding changes... not sending more.");return}var a=this.jj.cs();
a.empty()||(this.pg=a,this.Nh.send(JSON.stringify({type:"Data",MID:""+this.ut++,oldCID:"0",newCID:"0",data:a.getData()})))}};a.prototype.Dt=function(a){var b=JSON.parse(a.data);"Data"===b.type?(this.log("Got message from socket: %s",a.data.substr(0,64)),this.jj.yq(b.data)):"Ack"===b.type&&this.pg&&(this.log("Marking changes sent to: %s",this.pg.eg()),this.jj.lt(this.pg.eg()),this.pg=null,this.Fl())};a.prototype.pause=function(a){this.log("SharedSession.pause(): "+X[this.state]);(this.paused=a)?stop():
this.state===X.IDLE&&(this.Ff(X.CONNECTING),this.connect())};a.prototype.stop=function(){this.log("SharedSession.stop(): "+X[this.state]);this.paused=!0;this.state<X.Zh?this.Nh.close():this.Ff(X.IDLE)};return a}(xb),je=function(){function c(){this.local={};this.remote={};this.add("0",0)}c.prototype.add=function(a,b){this.local[a]=b;this.remote[b]=a};c.prototype.remove=function(a,b){delete this.local[a];delete this.remote[b]};c.prototype.Eg=function(a){return this.local[a]};c.prototype.Hf=function(a){a in
this.remote||console.log("LocalId "+a+" has no remote");return this.remote[a]};return c}();function ne(c){var a={},b;for(b in c)a[b]="matrix"===b?c[b].ic():c[b];return a}function oe(c){var a={},b;for(b in c)a[b]="matrix"===b&&c[b]instanceof Array?new O(c[b]):c[b];return a}
var ke=function(){function c(a,b){this.view=a;this.map=b;this.ee={};this.actions=[];this.log=B.create("Remote")}c.prototype.createNode=function(a,b,d,c){if(!c.type)throw console.log(c),Error("Tried to create node with bad type");var e=oe(c),g=e.type;delete e.type;var h=this.view.ha.Wa();this.log("Create node "+g+" "+a+"/"+h+" at "+b+":"+d);this.map.add(a,h);b=new V(h,g,e,this.map.Eg(b),d);this.actions.push(b);this.ee[a]=c};c.prototype.Ec=function(a,b,d){var c=this.map.Eg(a);this.log("Delete node "+
a+"/"+c+" from "+b+":"+d);b=new ce([c]);this.actions.push(b);this.map.remove(a,c)};c.prototype.gf=function(a,b,d){this.log("Move node "+a+" to "+b+":"+d);this.actions.push(new pe(this.map.Eg(a),this.map.Eg(b),d))};c.prototype.Ib=function(a,b){b=oe(b);var d=this.map.Eg(a);this.log("Set properties for node "+a+"/"+d+" to "+JSON.stringify(b));for(var c in b)this.actions.push(new Id([d],c,b[c]));if(a in this.ee)for(var f in b)this.ee[a][f]=b[f]};c.prototype.vc=function(a){var b={};if(a in this.ee)b=this.ee[a];
else if(a=this.view.ha.za(this.map.Eg(a)))b=ne(a.vc()),b.type=a.type();return b};c.prototype.pa=function(){this.ee={};this.view.pa(this.actions,!0);this.view.Wf();this.view.ja();this.actions=[]};return c}(),le=function(){function c(a,b){this.dd=a;this.map=b;this.log=B.create("LOCAL")}c.prototype.createNode=function(a,b,d,c){if(!this.dd.Hb){this.log("Create node "+c.type+" "+a+" at "+b+":"+d);if(!c.type)throw Error("Error: Local tried to create node with bad type.");c=ne(c);var e=this.dd.jt(a);this.map.add(e,
a);a=this.map.Hf(b);this.dd.createNode(e,a,d,c)}};c.prototype.Ec=function(a,b,d){this.dd.Hb||(this.log("Delete node "+a+" from "+b+":"+d),b=this.map.Hf(b),a=this.map.Hf(a),this.dd.Ec(a,b,d))};c.prototype.gf=function(a,b,d,c,f){this.dd.Hb||(this.log("Move node "+a+" from "+c+":"+f+" to "+b+":"+d),this.dd.gf(this.map.Hf(a),this.map.Hf(b),d,this.map.Hf(c),f))};c.prototype.Ib=function(a,b){this.dd.Hb||(this.log("Set properties for node "+a+" to "+JSON.stringify(b)),b=ne(b),this.dd.Ib(this.map.Hf(a),b))};
c.prototype.pa=function(){this.dd.Hb||this.dd.pa()};return c}();function qe(c){return c instanceof Array?c:[c]}
var Y=function(){function c(a,b){var d=this;this.Sa={};this.Bb=0;this.actions=[];this.ri=new u;this.qk=new u;this.Yi=0;this.jk=-1;this.cl=null;this.Tf={};this.He=this.md=null;this.log=B.create("CONTEXT");this.ga=new fe(this,a,b);this.To();var c=this;td.Tk.push(this);this.ga.vb.add(function(){d.qj();delete a[0].zwibbler;delete c.Sa;delete c.actions;delete c.ga;delete c.md;for(var b=td.Tk,e=0;e<b.length;e++)if(b[e]===c){b.splice(e,1);break}});this.xa("document-changed",function(){d.He&&d.He.Fl()})}
c.prototype.tq=function(){1<this.Bb&&this.Ia("abortTransaction is not implemented for nested calls. Please contact support.");this.Bb=0;this.actions=[]};c.prototype.Yj=function(a){this.ga.language.Yj(a)};c.prototype.xq=function(){return this.qh(this.Gc())};c.prototype.nn=function(){this.Bb+=1;1===this.Bb?(this.actions=[],this.qk.clear(),this.ri.clear(),this.Yi=0,this.jk=this.ga.view.ha.Va,this.log("beginTransaction() -- beginning new")):this.log("beginTransaction() -- already in one, bump counter")};
c.prototype.Qg=function(){this.ga.view.Qg()};c.prototype.Dd=function(){return this.ga.view.ha.Dd()};c.prototype.Ed=function(){return this.ga.view.ha.Ed()};c.prototype.sb=function(){this.ga.view.sb();this.ga.view.Tb();this.ga.view.ja()};c.prototype.Tq=function(){this.ga.Uq()};c.prototype.Vq=function(a,b){this.Ih(a,!b)};c.prototype.Zq=function(){this.Bb=Math.max(0,this.Bb-1);0===this.Bb?(this.ga.view.pa(this.actions,!0),this.actions=[],this.log("committing irreversible transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",
this.Bb)};c.prototype.gk=function(){this.Bb=Math.max(0,this.Bb-1);0===this.Bb?(this.ga.view.pa(this.actions),this.actions=[],this.log("committing transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",this.Bb)};c.prototype.de=function(a,b){void 0===a&&(a=!1);"boolean"!==typeof a&&this.Ia("First parameter of copy() must be true/false");return this.ga.view.de(a,b)};c.prototype.Xg=function(a){if(0<a.length)return this.Pb(this.ga.Xg(this.actions,a))};c.prototype.Eb=function(a){void 0===
a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var d in a)if(a.hasOwnProperty(d)){var c=a[d];"matrix"===d&&("[object Array]"===Object.prototype.toString.apply(c)&&"Matrix"===c[0]&&c.splice(0,1),c=new O(c));b[d]=c}return b};c.prototype.createNode=function(a,b){this.log("createNode(%s)",a);var d=this.Eb(b);return this.Pb(this.ga.createNode(this.actions,a,d))};c.prototype.ni=function(a){return this.Pb(this.ga.ni(this.actions,a))};c.prototype.pi=function(a,
b){function d(a,b){b.click(function(b){a.onclick.call(this,f,b)})}var c=Ob(a);pa(b)||this.Ia("createToolbar: second parameter must be array");for(var f=this,g=0;g<b.length;g++){var h=b[g],k=C("<a>").Qb("href","javascript:void(0)");k.ea("background-repeat","no-repeat");k.ea("background-position","center");k.ea("display","inline-block");k.Qe("zwibbler-button");h.toolName&&k.Qe(h.toolName);h.onclick&&d(h,k);h.title&&k.Qb("title",h.title);h.background?k.ea("background",h.background):h.image&&k.ea("background-image",
"url("+h.image+")");h.html&&(k[0].innerHTML=h.html,k.ea("overflow","hidden"));c.append(k)}var l;this.xa("tool-changed",function(a){f.log("Tool-changed: %s",a);l&&l.bu();l=c.find("."+a);l.Qe("zwibbler-selected")})};c.prototype.lr=function(a,b){var d="string"===typeof b?C("#"+b):C(b);if("PageSelector"===a)this.log("Creating page selector"),d=new fc(this,d,!1,!1),d.hj(!0),d.Gl(this),d.yl();else return this.Ia("Cannot create UI Elemment %s",a),!1;return!0};c.prototype.hk=function(a){if(a=this.ga.hk(this.actions,
a))return this.Pb(a);this.Ia("createShape needs an array of at least 6 numbers");return null};c.prototype.nk=function(){var a=this.ga.view.de(!1);this.An();return a};c.prototype.Zf=function(){this.ga.Zf();for(var a in this)this.hasOwnProperty(a)&&delete this[a]};c.prototype.Pb=function(a){this.Bb?"number"===typeof a&&this.ri.add(a):(this.log("Not in a transaction. committing immediately. id=%s",a),this.gk());return a};c.prototype.Ec=function(a){this.yn(a)};c.prototype.jq=function(a){for(var b=0;b<
a.length;b++){var d=a[b],c=this.ga.view.ha.za(d,!1);c&&!this.qk.contains(d)||!c&&this.ri.contains(d)||(a.splice(b,1),--b)}return 0<a.length};c.prototype.yn=function(a){this.log("deleteNodes()");a=qe(a);this.jq(a)&&(this.Pb(this.ga.Ec(this.actions,a)),this.qk.add(a))};c.prototype.zn=function(){1<this.Bb&&this.Ia("deletePage is not implemented inside transactions. Please contact support.");1===this.Gc()?this.log("Cannot remove all the pages."):(this.actions.push(new ce([this.ga.view.ha.Nk().id])),this.Pb())};
c.prototype.An=function(){this.ga.view.Zg()};c.prototype.fe=function(){1===arguments.length&&!1===arguments[0]&&this.ga.view.ha.Go();return this.ga.view.ha.fe()};c.prototype.download=function(a,b,d){"jpeg"===a&&(a="jpg");var c;if("pdf"===a||"svg"===a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a){var f="zwibbler3"===a?ud.Lj(this.ga.view.ha,a,"data-uri"):this.save(a,d);"Blob"in window&&(c=Zb(f));if(c){if(window.navigator.msSaveOrOpenBlob){this.log("Using msSaveOrOpenBlob()");window.navigator.msSaveOrOpenBlob(c,
b);return}f=window.URL.createObjectURL(c);this.log("Using blob object url %s",f);this.ga.vb.add(function(){window.URL.revokeObjectURL(f)})}var g=document.createElement("a");g.innerHTML="download";g.setAttribute("href",f);g.setAttribute("download",b);g.style.display="none";document.body.appendChild(g);g.click();setTimeout(function(){document.body.removeChild(g)},1E3)}else this.log("unsupported format for download: %s",a)};c.prototype.ja=function(a,b){void 0===b&&(b={});var d=b.page||0,c=this.ga.view.ha.Va,
f=this.ga.view.ha.re();this.ga.view.ha.Db(d);this.ga.view.bh(a,0,0,f.width,f.height);this.ga.view.ha.ja(a);this.ga.view.ha.Db(c)};c.prototype.xr=function(a){var b=this.ga.view.ha.za(a,!1);b?b.Li()?(a=this.ga.view.rj({}))&&a.Xl(b,b.rect.x,b.rect.y):this.log("editNodeText: node %s (%s) cannot contain text.",a,b.type()):this.log("editNodeText: nodeid %s does not exist.",a)};c.prototype.duplicate=function(){this.ga.view.duplicate()};c.prototype.ta=function(a){for(var b=1;b<arguments.length;b++);var d=
this;this.Sa||(this.Sa={});if(!this.Vm(a)){var c=Array.prototype.slice.call(arguments,1);setTimeout(function(){var b;if(a in d.Sa){var e=d.Sa[a];var h=0;for(b=e.length;h<b;h++){var k=e[h];k.apply(null,c)}}},0);return this}};c.prototype.bf=function(a){for(var b=1;b<arguments.length;b++);this.Sa||(this.Sa={});if(!this.Vm(a)){b=Array.prototype.slice.call(arguments,1);var d;if(a in this.Sa){var c=this.Sa[a];var f=0;for(d=c.length;f<d;f++){var g=c[f];g.apply(null,b)}}}};c.prototype.Nu=function(a){this.Tf[a]=
a in this.Tf?this.Tf[a]+1:1};c.prototype.Vm=function(a){return a in this.Tf&&0<this.Tf[a]?(this.log("Skipped %s event",a),--this.Tf[a],!0):!1};c.prototype.focus=function(a){void 0===a&&(a=!1);a?this.ga.xd():this.ga.focus("canvas")};c.prototype.Lr=function(a){a=this.Mn(a);return a.length?a[0]:null};c.prototype.Mn=function(a){a=this.ga.view.ha.Mr(a);for(var b=[],d=0;d<a.length;d++)b.push(a[d].id);return b};c.prototype.Or=function(a,b,d){if(3===arguments.length)if("number"!==typeof b||"number"!==typeof d)this.Ia("flip: 2nd and 3rd args must be numbers.");
else{var c=new F(b,d);this.ga.view.Pn(a/180*Math.PI,c)}else this.ga.view.Pn(a/180*Math.PI)};c.prototype.fh=function(a,b,c,e){a=this.an(a);"number"===typeof c&&"number"===typeof e?(c=new F(c,e),this.ga.view.fh(a,b/180*Math.PI,c)):this.ga.view.fh(a,b/180*Math.PI)};c.prototype.Ur=function(a,b,c){function d(a){a.xa("click contextmenu",function(b){if("click"===b.type||"contextmenu"===b.type)m.call(h,a.ea("background-color"),0===b.button),b.preventDefault()})}function f(){var a=C("<div>").ea("width",b+
"px").ea("height",b+"px").ea("display","inline-block");k.append(a);return a}function g(a,b){var c=document.createElement("canvas");c.width=a;c.height=a;b(c.getContext("2d"),0,0,a);return f().append(c)}void 0===c&&(c={});var h=this,k=Ob(a),l,m=c.onColour||c.onColor||h.Ih;a=g(b,ec.Cm);a.xa("click contextmenu",function(a){if("click"===a.type||"contextmenu"===a.type)m.call(h,"transparent",0===a.button),a.preventDefault()});a=g(b,ec.Bm);a.xa("click contextmenu",function(a){if("click"===a.type||"contextmenu"===
a.type){if(c.onOpacity)c.onOpacity(.5,0===a.button);else h.yp(.5,0===a.button);a.preventDefault()}});for(l=0;1>=l;l+=1/13){var n=(new A(A.Bc,[0,0,l,1])).toString();d(f().ea("background-color",n))}for(l=.3;1>=l;l+=.7/14)for(a=0;360>a;a+=22.5)n=(new A(A.Bc,[a,.7,l,1])).toString(),d(f().ea("background-color",n));for(a=0;360>a;a+=22.5)n=(new A(A.Bc,[a,1,1,1])).toString(),d(f().ea("background-color",n))};c.prototype.gh=function(){return this.ga.view.gh()};c.prototype.Wr=function(){var a=[];this.ga.view.ha.$e(function(b){a.push(b.id)},
this.le());return a};c.prototype.lq=function(){var a=[];this.ga.view.ha.kb(!1,function(b){a.push(b.id)});return a};c.prototype.$r=function(){return this.ga.bs()};c.prototype.Gk=function(a){return this.Pe(this.ga.view.Gk(a))};c.prototype.ih=function(a){qa(a)||this.Ia("getConfig: Expected string");return this.ga.da.get(a)};c.prototype.le=function(){return this.Bb?this.jk:this.ga.view.ha.Va};c.prototype.es=function(){return this.ga.view.Ei()};c.prototype.fs=function(){return this.ga.view.Ii()};c.prototype.Ci=
function(){return this.ga.view.Ci()};c.prototype.hs=function(a,b){var c=this.ga.view.gb(a,b);return{x:c.x,y:c.y}};c.prototype.Di=function(){return this.Pe(this.ga.view.ha.re())};c.prototype.Ei=function(){return this.ga.view.Ei()};c.prototype.ts=function(a){return this.ga.language.get(a)};c.prototype.Pe=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.bi=function(a){"object"!==typeof a&&this.Ia("Error: Rectangle object expected.");a=new K(a.x||0,a.y||0,a.width||0,a.height||
0);a.gp();return a};c.prototype.ks=function(){return this.Pe(this.ga.view.ha.Vn())};c.prototype.rs=function(a,b){return this.Fi(a,b)};c.prototype.vs=function(){var a=[],b={};this.ga.view.ha.kb(!1,function(d){!(c=d.Kd())||c in b||(b[c]=1,a.push(c))});var c=this.gh();c in b||a.push(c);return a};c.prototype.us=function(a){var b=[];this.ga.view.ha.kb(!1,function(c){c.Kd()===a&&b.push(c.id)});return b};c.prototype.pe=function(a){return this.ga.view.ha.pe(a)};c.prototype.Fi=function(a,b){return this.ga.Fi(a,
b)};c.prototype.ws=function(a){a=qe(a);for(var b=null,c=0;c<a.length;c++){var e=a[c],f=this.ga.view.ha.za(e);null===f?this.Ia("Error: node %s does not exist",e):b?b.Vh(f.rect):b=f.rect.clone()}b||(b=new K(0,0,0,0));return this.Pe(b)};c.prototype.xs=function(a){var b=this.ga.view.ha.za(a);if(null===b)return this.Ia("Error: node %s does not exist",a),null;a=b.Ga().fg();return{x:a.x,y:a.y}};c.prototype.ys=function(a){return(a=this.ga.view.ha.za(a))?a.type():""};c.prototype.zs=function(a,b){var c=this.ga.view.ha.lb(a,
b,this.ga.view.La);return c?c.id:this.ga.view.$o(a,b)&&(c=this.qe(),c.length)?c[0]:null};c.prototype.Gc=function(){var a=this.ga.view.ha.Gc();this.Bb&&(a+=this.Yi);return a};c.prototype.$n=function(a){return(a=this.ga.view.ha.Nk(a))?a.id:null};c.prototype.ao=function(a){return this.Pe(this.ga.view.ha.re(a))};c.prototype.Gi=function(a){var b=this.ga.view.ha.za(a,!1);if(!b||"PathNode"!==b.type())return null;a=b.Gi().clone().Vd();var c=[];b.Ga();for(b=0;b<a.length;b++){var e=a[b];c.push(e.x);c.push(e.y)}return c};
c.prototype.Cs=function(a){a=this.ga.view.ha.za(a,!1);if(!a||"PathNode"!==a.type())return null;a=a.Gi();for(var b=[],c=[],e=0;e<a.ba.length;){switch(a.ba[e]){case Q.Tc:c=[{x:a.ba[e+1],y:a.ba[e+2]}];b.push(c);break;case Q.Sc:c.push({x:a.ba[e+1],y:a.ba[e+2]})}e+=Q.Cc[a.ba[e]]}return b};c.prototype.Wn=function(){return this.ga.view.scale};c.prototype.Ik=function(){var a=this.ga.view.Ik();return a?a.id:0};c.prototype.Fs=function(a,b,c,e){var d=this.ga.view.rk(a,b);if(void 0===c||void 0===e)return{x:d.x,
y:d.y};a=this.ga.view.rk(a+c,b+e);return this.Pe(new K(d.x,d.y,a.x-d.x,a.y-d.y))};c.prototype.Gs=function(){return this.ga.view.nd};c.prototype.Ii=function(){return this.ga.view.Ii()};c.prototype.ne=function(a,b){var c=this.ga.view.ha.za(a,!1);return c?c.ne(b):null};c.prototype.tu=function(a,b,c){var d=this.ga.view.ha.za(a,!1);if(!d)return this.log("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return this.log("setEditHandle: node %s is not a PathNode.",a),!1;d=d.la("commands");
d=S.eq(d,b,c);if(!d)return this.log("setEditHandle: failed"),!1;this.Ee(a,"commands",d);return!0};c.prototype.qe=function(a){void 0===a&&(a=!1);return this.ga.view.wc(a)};c.prototype.Es=function(a){function b(a,b){var d=c.properties[a];void 0!==b&&(c.properties[a]=d!==b&&void 0!==d?null:b)}void 0===a&&(a=this.qe());for(var c={properties:{},types:{},nodes:a},e=this.ga.da.get("allowTextInShape"),f=0;f<a.length;f++){var g=this.ga.view.ha.za(a[f],!1);if(g){var h=g.type();c.types[h]=!0;c.types.AnyNode=
!0;"PathNode"===h&&(h=g.la("closed")?"PathNode-closed":"PathNode-open",c.types[h]=!0);g=g.vc();for(var k in g)g.hasOwnProperty(k)&&"matrix"!==k&&("BrushNode"!==h||"fillStyle"!==k)&&("PathNode-open"!==h||"fontSize"!==k&&"fontName"!==k&&"fillStyle"!==k)&&("PathNode-closed"!==h||e||"fontSize"!==k&&"fontName"!==k)&&b(k,g[k])}}"text"===this.Ci()&&(b("textFillStyle",this.ih("defaultTextFillStyle")),b("bold",this.ih("defaultBold")),b("italic",this.ih("defaultItalic")),b("textDecoration",this.ih("defaultTextDecoration")));
return c};c.prototype.Ks=function(){return this.Pe(this.ga.view.se())};c.prototype.Ia=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));var f=c.join("");this.log(f);throw{message:f,toString:function(){return f}};};c.prototype.qh=function(a){var b=this.ga.view.ha.Wa();this.actions.push(new V(b,"PageNode",{},this.ga.view.ha.root.id,a));this.Pb(b);this.Bb&&(this.Yi+=1);return a};
c.prototype.Xk=function(a){return this.ga.view.ha.Xk(a)};c.prototype.load=function(a,b){void 0===b&&(b=a);var c=ud.Ij(b);return c?(this.qj(),this.ga.Df(c),!0):!1};c.prototype.Pi=function(a){var b=this;t(a)?(this.cl&&clearTimeout(this.cl),this.cl=setTimeout(function(){b.ga.view.Pi(!1)},a),b.ga.view.Pi(!0)):this.Ia("lockUpdates: Expected a number")};c.prototype.Qi=function(){this.ga.view.Qi()};c.prototype.pt=function(a,b){if(t(a)&&t(b)){var c=this.Gc();0>a||a>=c?this.Ia("From page must be > 0 and less than getPageCount()"):
0>b||b>=c?this.Ia("From page must be > 0 and less than getPageCount()"):(c=this.$n(a),null!==c&&(this.actions.push(new ae([c],ae.Jm,b)),this.Pb()))}else this.Ia("movePage: needs two valid page numbers.")};c.prototype.Ri=function(){this.ga.view.Ri()};c.prototype.fl=function(){this.qj();this.ga.fl();this.To()};c.prototype.nextPage=function(){this.Cf(Math.min(this.le()+1,this.Gc()-1))};c.prototype.xa=function(a,b){"draw"===a?this.md=b:a in this.Sa?this.Sa[a].push(b):this.Sa[a]=[b];return this};c.prototype.At=
function(a){"function"===typeof a||this.Ia("Error: onComplete needs a function argument.");this.ga.view.Rr(a)};c.prototype.To=function(){var a=this.ga.da.get("defaultPaperSize");this.log("onNewDocument()");"none"!==a&&this.Nl(a)};c.prototype.sg=function(a){this.ga.view.sg(a)};c.prototype.Pt=function(){this.Cf(Math.max(this.le()-1,0))};c.prototype.print=function(a,b){var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(t(a[e]))c.push(a[e]);else{this.Ia("print(): pageSpec must be array of numbers");
return}else if(!a)for(e=0;e<this.Gc();e++)c.push(e);var f=b?this.bi(b):this.bi(this.Di());var g=this.le(),h=document.createElement("canvas");h.width=f.width;h.height=f.height;var k=h.getContext("2d");k.translate(-f.x,-f.y);e=window.location.hostname;var l=window.open("about:blank","_blank");l.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.Cf(c[e]),this.ga.view.bh(k,f.x,f.y,f.width,f.height),this.ga.view.ha.ja(k),0<e?l.document.write("<div style='page-break-before:always'>"):
l.document.write("<div>"),l.document.write("<img style='width:100%' src='"),l.document.write(h.toDataURL()),l.document.write("'></div>"),k.clearRect(f.x,f.y,f.width,f.height);l.document.write("</body></html>");l.document.close();setTimeout(function(){l.focus();l.print();setTimeout(function(){l.close()},1E3)},1E3);this.Cf(g)};c.prototype.wd=function(){this.ga.view.wd()};c.prototype.ze=function(a){this.ga.view.ja(a)};c.prototype.resize=function(){var a=this;setTimeout(function(){a.ga.Og(!0)},1)};c.prototype.save=
function(a,b){void 0===a&&(a="zwibbler3");var c={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"},e=this.bi(b||this.Di());switch(a){case "list":return ud.Lj(this.ga.view.ha,"list","object");case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.ga.jp(c[a],e);case "zwibbler3":return ud.Lj(this.ga.view.ha,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":return c=this.ga.jp(a,e),c=c.substr(c.indexOf(",")+
1),x.decode("base64",c);default:return"Unsupported format: "+a}};c.prototype.ru=function(a){C(this.ga.view.canvas).ea("cursor",a)};c.prototype.Ge=function(a,b){this.ga.view.Ge(a,b)};c.prototype.an=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.ga.view.ha.za(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){a=this.an(qe(a));this.ga.view.selectNodes(a);this.ga.view.Tb();this.ga.view.ja()};c.prototype.Hh=function(){this.ga.view.Hh()};c.prototype.fj=function(a){this.ga.view.fj(a)};
c.prototype.ku=function(a,b){this.ga.lu(a,b)};c.prototype.pu=function(a,b){"defaultPaperSize"===a&&this.Nl(b);return this.ga.da.set(a,b)};c.prototype.Ih=function(a,b){this.ga.view.zt(a,b)};c.prototype.Cf=function(a){this.Bb?(this.log("Set page to %s inside transaction",a),this.actions.push(new re(a)),this.jk=a):this.ga.view.Db(a)};c.prototype.Hl=function(a){this.ga.view.Hl(a)};c.prototype.yg=function(a,b){!t(a)&&null!==a||!t(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ga.view.yg(a,
b)};c.prototype.tp=function(a,b){!t(a)&&null!==a||!t(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.Pb(this.ga.view.yg(a,b,this.actions))};c.prototype.su=function(a,b){var c=this.ga.view.ha.za(a);c?("DomNode"!==c.type()&&this.Ia("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.uu(b),this.ga.ui.push(b)):this.Ia("setDomElement: Node %s does not exist",a)};c.prototype.js=function(a){var b=this.ga.view.ha.za(a);if(!b)return this.Ia("getDomElement: Node %s does not exist",
a),null;b instanceof he||this.Ia("getDomElement: Node %s is not a DomNode. It is %s",a,b.type());return b.Jk()};c.prototype.zu=function(a,b){qa(a)&&qa(b)?(this.gh()===a&&this.fj(b),this.ga.view.ha.kb(!1,function(c){c.Kd()===a&&c.setProperty("layer",b)})):this.Ia("setLayerName() needs string arguments.")};c.prototype.Nl=function(a,b){var c=null,e=null,f=!0,g=!1;if(2===arguments.length)if(t(arguments[0])&&t(arguments[1])){var h=arguments[0];c=arguments[1]}else qa(arguments[0])&&"boolean"===typeof arguments[1]?
(e=arguments[0],g=arguments[1]):f=!1;else if(1===arguments.length&&qa(arguments[0]))for(var k=arguments[0].split(" "),l=0;l<k.length;l++)"landscape"===k[l]?g=!0:"portrait"===k[l]?g=!1:e=k[l];if(!1===f)return this.log("Bad arguments to setPaperSize()."),!1;if(null===e)return this.yg(h,c),!0;switch(e.toLowerCase()){case "letter":h=816;c=1056;break;case "legal":h=816;c=1344;break;case "11x17":h=1056;c=1632;break;case "tabloid":h=1056;c=1632;break;case "a0":h=841/25.4*96;c=1189/25.4*96;break;case "a1":h=
594/25.4*96;c=841/25.4*96;break;case "a2":h=420/25.4*96;c=594/25.4*96;break;case "a3":h=297/25.4*96;c=420/25.4*96;break;case "a4":h=210/25.4*96;c=297/25.4*96;break;case "none":c=h=null;break;default:return this.log("Invalid paper size: %s",e),!1}g&&(e=h,h=c,c=e);this.yg(h,c);return!0};c.prototype.wu=function(a,b){this.ga.xu(a,b)};c.prototype.yu=function(a,b,c){this.Ee(a,b,c)};c.prototype.Kl=function(a,b){if(2!==arguments.length)throw"Error: setNodeProperties takes 2 arguments.";return this.Pb(this.ga.Kl(this.actions,
qe(a),this.Eb(b)))};c.prototype.Ee=function(a,b,c){3!==arguments.length&&this.Ia("Error: setNodeProperty takes 3 arguments.");return this.Pb(this.ga.Ee(this.actions,qe(a),b,this.Eb(c)))};c.prototype.Au=function(a,b){for(var c=qe(a),e=0;e<c.length;e++){var f=this.ga.view.ha.za(c[e],!0);f&&f.Ce(!b)}this.ga.view.ja()};c.prototype.yp=function(a,b){this.ga.view.Et(a,b)};c.prototype.Ml=function(a){this.ga.view.Ml(a)};c.prototype.Eu=function(a){ra(a)&&t(a.x)&&t(a.y)&&t(a.width)&&t(a.height)||this.Ia("setViewRect: arg must be an object with numeric x, y, width, height properties");
0!==a.width&&0!==a.height||this.Ia("setViewRect: width and height must be non-zero.");this.ga.view.Kh(this.bi(a))};c.prototype.Nc=function(a,b,c){if(t(a)||"page"===a||"width"===a)if(1===arguments.length)this.ga.view.Nc(a);else if(3===arguments.length&&"number"===typeof a&&t(b)&&t(c)){var d=this.Wn()/a,f=this.ga.view.se();f.transform(new P(d,d,b,c));this.ga.view.Kh(f)}else this.Ia("setZoom: invalid arguments.");else this.log("setZoom: invalid parameter.")};c.prototype.Lh=function(a,b){void 0===b&&
(b=!0);this.ga.view.Lh(a,b)};c.prototype.vj=function(a,b,c){this.log("Translate node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Pb(this.ga.vj(this.actions,qe(a),b,c))};c.prototype.fu=function(a){var b=Math.round(a/(Math.PI/2));a=b*Math.PI/2;b=0===b%2;var c=this.lq(),e=this.Di(),f=e.width/2,g=e.height/2;this.nn();for(var h=0;h<c.length;h++)this.ip(c[h],a,f,g),b||this.vj(c[h],g-f,f-g);b||this.tp(e.height,e.width);this.gk()};c.prototype.ip=function(a,b,c,e){this.log("Rotate nodes by %s around (%s,%s) actions=%s",
b/Math.PI*180,c,e,this.actions.length);for(var d=4===arguments.length,g=qe(a),h=new F(0,0),k=0;k<g.length;k++){var l=g[k],m=this.ga.view.ha.za(l);!m&&!this.ri.contains(l)||!m&&!d?this.log("rotateNode: Node %s does not exist",l):!d&&m&&(l=m.rect.Fd(),h.x+=l.x,h.y+=l.y)}d?(h.x=c,h.y=e):(h.x/=g.length,h.y/=g.length);d=new N(b,h.x,h.y);return this.Pb(this.ga.transformNode(this.actions,g,d))};c.prototype.Cl=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);this.log("Scale node %s by %s,%s actions=%s",
a,b,c,this.actions.length);return this.Pb(this.ga.Cl(this.actions,qe(a),b,c,e,f))};c.prototype.Ll=function(a,b,c,e,f,g,h){7!==arguments.length&&this.Ia("setNodeTransform: requires 7 arguments");this.log("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,g,h);return this.Pb(this.ga.Ll(this.actions,qe(a),b,c,e,f,g,h))};c.prototype.kr=function(){var a=[];for(var b=0;32>b;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);a=a.join("");this.log("Creating shared session "+
a);return this.Wm(a,!0)};c.prototype.Wm=function(a,b){this.log("Attach to shared session "+a);this.He&&this.He.stop();this.He=new me(a,this.ga.view,b);return a};c.prototype.Xs=function(a){var b=new qd(!0);this.ga.Df(b);this.Wm(a,!1)};c.prototype.qj=function(){this.He&&(this.He.stop(),this.He=null)};c.prototype.ib=function(){this.ga.view.ib()};c.prototype.Uh=function(a){this.Pb(this.ga.Uh(this.actions,qe(a)))};c.prototype.upload=function(a,b){function c(){}function e(){}var f=this.ga.ir(b||"Working"),
g=new XMLHttpRequest,h=new FormData(a);g.upload.addEventListener("progress",function(a){f.update(a.loaded/a.total)},!1);g.addEventListener("load",function(){200===g.status?(f.done(),e(g.response,g)):(f.error("Error"),c(g))},!1);g.addEventListener("error",function(){f.error("Error");c(g)},!1);g.addEventListener("abort",function(){f.error("Aborted");c(g)},!1);g.open(a.method,a.action);g.send(h);var k={success:function(a){e=a;return k},error:function(a){c=a;return k}};return k};c.prototype.cv=function(a,
b){void 0===b&&(b=!1);this.ga.view.kn(this.Eb(a),b)};c.prototype.dv=function(a,b){2===arguments.length?this.ga.view.vk({lineWidth:b,strokeStyle:a}):this.ga.view.vk(this.Eb(arguments[0]))};c.prototype.ev=function(a){this.ga.view.Wh(this.Eb(a))};c.prototype.fv=function(a){this.ga.view.kk(this.Eb(a))};c.prototype.gv=function(a){ra(a)?(a=new ge(this.ga.view,a),this.ga.view.Qa(a)):this.Ia("useCustomTool(): requires an object as argument.")};c.prototype.jm=function(a){this.ga.view.jm(a)};c.prototype.Wh=
function(a){void 0===a&&(a={});this.ga.view.Wh(this.Eb(a))};c.prototype.iv=function(a,b,c){void 0===c&&(c="freehand");ra(a)?(a=this.Eb(a),c=b):a={strokeStyle:a,lineWidth:b};this.ga.view.Bn(a,c)};c.prototype.sv=function(a,b){void 0===b&&(b=!0);var c=a;qa(a)?c={url:a}:"url"in c||this.Ia("useStampTool: missing url in properties");this.ga.view.jv(c,1===arguments.length||!0===b)};c.prototype.kv=function(a,b){if(ra(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.ga.view.bl(this.Eb(a),c,e)};c.prototype.lv=
function(){this.ga.view.It()};c.prototype.mv=function(){this.ga.view.Xa()};c.prototype.km=function(a,b,c,e){t(a)||this.Ia("usePolygonTool: parameter 1 must be a number.");t(b)||this.Ia("usePolygonTool: parameter 2 must be a number.");c&&!t(c)&&this.Ia("usePolygonTool: parameter 3 must be a number.");e&&!ra(e)&&this.Ia("usePolygonTool: parameter 4 must be a object properties.");this.ga.view.km(a,b,c||1,this.Eb(e||{}))};c.prototype.nv=function(a){void 0===a&&(a={});this.ga.view.Bn(this.Eb(a),"quadratic")};
c.prototype.Kf=function(a){void 0===a&&(a={});this.ga.view.Kf(this.Eb(a))};c.prototype.ov=function(a){void 0===a&&(a={});this.ga.view.Kf(bb({},{roundRadius:this.ga.da.get("defaultRoundRectRadius")},a))};c.prototype.pv=function(a,b){var c={};ra(a)?c=this.Eb(a):qa(a)&&(c.stokeStyle=a);t(b)&&(c.lineWidth=b);this.ga.view.Dn(c)};c.prototype.lm=function(a,b,c,e,f){void 0===f&&(f="rectangle-tl");this.ga.view.lm(a,this.Eb(b),c,e,f)};c.prototype.mm=function(){this.ga.view.mm()};c.prototype.rv=function(a){this.ga.view.Tu(a)};
c.prototype.qv=function(a){this.ga.view.Kf(this.Eb(a))};c.prototype.tv=function(a){this.ga.view.rj(this.Eb(a))};c.prototype.nm=function(a){this.ga.view.nm(this.Eb(a))};c.prototype.Bj=function(){this.ga.view.Bj()};c.prototype.Cj=function(){this.ga.view.Cj()};return c}();Y.prototype.log=Y.prototype.log;Y.prototype.abortTransaction=Y.prototype.tq;Y.prototype.addToLanguage=Y.prototype.Yj;Y.prototype.addPage=Y.prototype.xq;Y.prototype.beginTransaction=Y.prototype.nn;Y.prototype.bringToFront=Y.prototype.Qg;
Y.prototype.canRedo=Y.prototype.Dd;Y.prototype.canUndo=Y.prototype.Ed;Y.prototype.clearSelection=Y.prototype.sb;Y.prototype.clearUndo=Y.prototype.Tq;Y.prototype.clickColour=Y.prototype.Vq;Y.prototype.commitIrreversibleTransaction=Y.prototype.Zq;Y.prototype.commitTransaction=Y.prototype.gk;Y.prototype.copy=Y.prototype.de;Y.prototype.createGroup=Y.prototype.Xg;Y.prototype.createNode=Y.prototype.createNode;Y.prototype.createPath=Y.prototype.ni;Y.prototype.createToolbar=Y.prototype.pi;
Y.prototype.createUiElement=Y.prototype.lr;Y.prototype.createShape=Y.prototype.hk;Y.prototype.cut=Y.prototype.nk;Y.prototype.destroy=Y.prototype.Zf;Y.prototype.deleteNode=Y.prototype.Ec;Y.prototype.deleteNodes=Y.prototype.yn;Y.prototype.deletePage=Y.prototype.zn;Y.prototype.deleteSelection=Y.prototype.An;Y.prototype.dirty=Y.prototype.fe;Y.prototype.download=Y.prototype.download;Y.prototype.draw=Y.prototype.ja;Y.prototype.editNodeText=Y.prototype.xr;Y.prototype.duplicate=Y.prototype.duplicate;
Y.prototype.emit=Y.prototype.ta;Y.prototype.skipEvent=Y.prototype.Nu;Y.prototype.focus=Y.prototype.focus;Y.prototype.findNode=Y.prototype.Lr;Y.prototype.findNodes=Y.prototype.Mn;Y.prototype.flip=Y.prototype.Or;Y.prototype.flipNodes=Y.prototype.fh;Y.prototype.generatePalette=Y.prototype.Ur;Y.prototype.getActiveLayer=Y.prototype.gh;Y.prototype.getAllNodes=Y.prototype.Wr;Y.prototype.getBackgroundImage=Y.prototype.$r;Y.prototype.getBoundingRectangle=Y.prototype.Gk;Y.prototype.getConfig=Y.prototype.ih;
Y.prototype.getCurrentPage=Y.prototype.le;Y.prototype.getCurrentFillColour=Y.prototype.es;Y.prototype.getCurrentOutlineColour=Y.prototype.fs;Y.prototype.getCurrentTool=Y.prototype.Ci;Y.prototype.getDocumentCoordinates=Y.prototype.hs;Y.prototype.getDocumentSize=Y.prototype.Di;Y.prototype.getFillColour=Y.prototype.Ei;Y.prototype.getLanguageString=Y.prototype.ts;Y.prototype.getDrawingRectangle=Y.prototype.ks;Y.prototype.getItemProperty=Y.prototype.rs;Y.prototype.getLayers=Y.prototype.vs;
Y.prototype.getLayerNodes=Y.prototype.us;Y.prototype.getNodePageNumber=Y.prototype.pe;Y.prototype.getNodeProperty=Y.prototype.Fi;Y.prototype.getNodeRectangle=Y.prototype.ws;Y.prototype.getNodeScale=Y.prototype.xs;Y.prototype.getNodeType=Y.prototype.ys;Y.prototype.getNodeUnderPoint=Y.prototype.zs;Y.prototype.getPageCount=Y.prototype.Gc;Y.prototype.getPageNode=Y.prototype.$n;Y.prototype.getPageRect=Y.prototype.ao;Y.prototype.getPathData=Y.prototype.Gi;Y.prototype.getPathAsPoints=Y.prototype.Cs;
Y.prototype.getCanvasScale=Y.prototype.Wn;Y.prototype.getEditNode=Y.prototype.Ik;Y.prototype.getScreenCoordinates=Y.prototype.Fs;Y.prototype.getSelectedEditHandle=Y.prototype.Gs;Y.prototype.getStrokeColour=Y.prototype.Ii;Y.prototype.getEditHandleType=Y.prototype.ne;Y.prototype.setEditHandle=Y.prototype.tu;Y.prototype.getSelectedNodes=Y.prototype.qe;Y.prototype.getPropertySummary=Y.prototype.Es;Y.prototype.getViewRectangle=Y.prototype.Ks;Y.prototype.insertPage=Y.prototype.qh;
Y.prototype.isLayerVisible=Y.prototype.Xk;Y.prototype.load=Y.prototype.load;Y.prototype.lockUpdates=Y.prototype.Pi;Y.prototype.moveDown=Y.prototype.Qi;Y.prototype.movePage=Y.prototype.pt;Y.prototype.moveUp=Y.prototype.Ri;Y.prototype.newDocument=Y.prototype.fl;Y.prototype.nextPage=Y.prototype.nextPage;Y.prototype.on=Y.prototype.xa;Y.prototype.onComplete=Y.prototype.At;Y.prototype.paste=Y.prototype.sg;Y.prototype.previousPage=Y.prototype.Pt;Y.prototype.print=Y.prototype.print;Y.prototype.redo=Y.prototype.wd;
Y.prototype.redraw=Y.prototype.ze;Y.prototype.resize=Y.prototype.resize;Y.prototype.save=Y.prototype.save;Y.prototype.setCursor=Y.prototype.ru;Y.prototype.setToolProperty=Y.prototype.Ge;Y.prototype.selectNodes=Y.prototype.selectNodes;Y.prototype.sendToBack=Y.prototype.Hh;Y.prototype.setActiveLayer=Y.prototype.fj;Y.prototype.setBackgroundBrowserImages=Y.prototype.ku;Y.prototype.setConfig=Y.prototype.pu;Y.prototype.setColour=Y.prototype.Ih;Y.prototype.setCurrentPage=Y.prototype.Cf;
Y.prototype.setCustomBackgroundFn=Y.prototype.Hl;Y.prototype.setDocumentSize=Y.prototype.yg;Y.prototype.setDocumentSizeInTransaction=Y.prototype.tp;Y.prototype.setDomElement=Y.prototype.su;Y.prototype.getDomElement=Y.prototype.js;Y.prototype.setLayerName=Y.prototype.zu;Y.prototype.setPaperSize=Y.prototype.Nl;Y.prototype.setIconBrowserImages=Y.prototype.wu;Y.prototype.setItemProperty=Y.prototype.yu;Y.prototype.setNodeProperties=Y.prototype.Kl;Y.prototype.setNodeProperty=Y.prototype.Ee;
Y.prototype.setNodeVisibility=Y.prototype.Au;Y.prototype.setOpacity=Y.prototype.yp;Y.prototype.setPageView=Y.prototype.Ml;Y.prototype.setViewRectangle=Y.prototype.Eu;Y.prototype.setZoom=Y.prototype.Nc;Y.prototype.showLayer=Y.prototype.Lh;Y.prototype.translateNode=Y.prototype.vj;Y.prototype.rotateDocument=Y.prototype.fu;Y.prototype.rotateNode=Y.prototype.ip;Y.prototype.scaleNode=Y.prototype.Cl;Y.prototype.setNodeTransform=Y.prototype.Ll;Y.prototype.createSharedSession=Y.prototype.kr;
Y.prototype.joinSharedSession=Y.prototype.Xs;Y.prototype.stopSharing=Y.prototype.qj;Y.prototype.undo=Y.prototype.ib;Y.prototype.ungroup=Y.prototype.Uh;Y.prototype.upload=Y.prototype.upload;Y.prototype.useArrowTool=Y.prototype.cv;Y.prototype.useBrushTool=Y.prototype.dv;Y.prototype.useCircleTool=Y.prototype.ev;Y.prototype.useCurveTool=Y.prototype.fv;Y.prototype.useCustomTool=Y.prototype.gv;Y.prototype.useEditHandleTool=Y.prototype.jm;Y.prototype.useEllipseTool=Y.prototype.Wh;
Y.prototype.useFreehandTool=Y.prototype.iv;Y.prototype.useStampTool=Y.prototype.sv;Y.prototype.useLineTool=Y.prototype.kv;Y.prototype.usePanTool=Y.prototype.lv;Y.prototype.usePickTool=Y.prototype.mv;Y.prototype.usePolygonTool=Y.prototype.km;Y.prototype.useQuadraticBezierTool=Y.prototype.nv;Y.prototype.useRectangleTool=Y.prototype.Kf;Y.prototype.useRoundRectTool=Y.prototype.ov;Y.prototype.useShapeBrushTool=Y.prototype.pv;Y.prototype.useShapeTool=Y.prototype.lm;Y.prototype.useSplitWallTool=Y.prototype.mm;
Y.prototype.useStampLineTool=Y.prototype.rv;Y.prototype.useSquareTool=Y.prototype.qv;Y.prototype.useTextTool=Y.prototype.tv;Y.prototype.useWallTool=Y.prototype.nm;Y.prototype.zoomIn=Y.prototype.Bj;Y.prototype.zoomOut=Y.prototype.Cj;"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new Y(C(d),c);d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Z=function(){function c(){this.Tk=[];this.buttons=[];this.lk={};this.fonts=new lc;this.log=B.create("ZWIBBLER")}c.prototype.create=function(a,b){"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var c=Ob(a);return 0===c.length?(alert("Zwibbler.create: Cannot find an element with id "+a),null):new Y(c,b)};c.prototype.lc=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);
return!0};c.prototype.uq=function(a,b){this.lk[a]=b};c.prototype.aq=function(a,b){void 0===b&&(b={});return this.Am(a,b)};c.prototype.Am=function(a,b){function c(){var a=e.outerWidth(),b=e.outerHeight(),c=ac();e.offset({left:c.x+c.width/2-a/2,top:c.y+c.height/2-b/2})}void 0===b&&(b={});var e=Ob(a);if(0===e.length)throw Error("Zwibbler.Dialog: Bad element passed in: "+a);null===e[0].parentNode&&C(document.body).append(e);"static"===e.ea("position")&&e.ea("position","absolute");e.ea("display","none");
var f=new db("transparent");f.insertBefore=e;var g=b.showNear,h=b.showHow,k=!1,l={hide:function(){f.Za();e.Za();if(l.onhide)l.onhide();C(window).Hg("resize",c)},show:function(a,b,d,q){void 0===d&&(d=!1);void 0===q&&(q=!0);var m=0,n=0,r="",w="";if("number"===typeof a&&"number"===typeof b){m=a;n=b;var E=!0}else r=a||g,w=b||h,E=!1;a=Vb()+1;e.ea("z-index",a);f.zIndex=a;e.show();a=e.outerWidth();b=e.outerHeight();E?(w=ac(),m={left:m,top:n},m.left=Math.min(m.left,w.x+w.width-a-2),m.top=Math.min(m.top,w.y+
w.height-b-3),e.offset(m)):r&&w?(n=Ob(r),m=e,r=w,w=n.offset(),r=r.toLowerCase().split(" "),2!==r.length&&(r=["tl","tl"]),0<=r[0].indexOf("b")&&(w.top+=n.outerHeight()),0<=r[0].indexOf("r")&&(w.left+=n.outerWidth()),0<=r[1].indexOf("b")&&(w.top-=m.outerHeight()),0<=r[1].indexOf("r")&&(w.left-=m.outerWidth()),m.ea("position","absolute"),n=ac(),r=m.width(),a=m.height(),w.left=Math.min(w.left,n.x+n.width-r),w.top=Math.min(w.top,n.y+n.height-a),m.offset(w)):(C(window).xa("resize",c),c());q&&f.show(l.hide);
if(l.onshow)l.onshow();k=d},onshow:b.onshow,onhide:b.onhide};e.xa("click",function(){k&&l.hide()});return l};c.prototype.Vp=function(a,b){var c=Ob(a),e=new ib(c[0],b),f=new xb;e.rl=function(a){f.ta("change",a)};return{on:function(a,b){f.xa(a,b)},colour:function(){if(arguments.length)e.up(arguments[0]);else return e.ob.toString()}}};c.prototype.fq=function(a,b){void 0===b&&(b={});var c=b.autohide,e=new zb(Ob(a));b.onshow&&e.xa("show",b.onshow);b.onhide&&e.xa("hide",b.onhide);return{show:function(a){e.show("left"===
a?"left":"right",c)},hide:function(){e.Za()}}};c.prototype.hr=function(a,b){return this.zf(a,b)};c.prototype.zf=function(a,b){function c(){var a=q.re(),b=1,c=0,d=0;h&&(a.y=h);m&&(a.height=m-a.y);k&&(a.x=k);l&&(a.width=l-a.x);f&&g?b=Math.min(f/a.width,g/a.height):f?(b=f/a.width,g=a.height*b):g?(b=g/a.height,f=a.width*b):(f=a.width,g=a.height);a.width*b<f&&(c=f/2-a.width*b/2);a.height*b<g&&(d=g/2-a.height*b/2);c-=a.x*b;d-=a.y*b;n.width=Math.ceil(f);n.height=Math.ceil(g);r.translate(c,d);r.scale(b,b);
q.ja(r);e.log("Drawn.")}var e=this;void 0===b&&(b={});var f=b.width||0,g=b.height||0,h=b.top||0,k=b.left||0,l=b.right||0,m=b.bottom||0,n=Pb(null),r=n.getContext("2d"),q=ud.Ij(a);if(!q)throw Error("Zwibbler.render: Could not open document");var v=new bd;q.format(r,v);v.xa("reformat",function(a){q.kg(a.id)});v.Ue?v.xa("done",function(){q.format(r,v);c()}):c();return n};c.prototype.Nt=function(a){a=A.pc(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.it=function(a){return(new A(A.RGBA,
[a.r,a.g,a.b,a.a])).toString()};c.prototype.Vr=function(a){var b=document.createElement("a");b.href=a;return b.href};c.prototype.Fq=function(a){return x.encode("base64",a)};c.prototype.vq=function(a,b){this.fonts.add(a,b)};c.prototype.$p=function(a){return new U(a)};c.prototype.Xp=function(a){var b=new U;Cc(b,a);return b.ic()};c.prototype.qs=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.nu=function(a,b){return Yb(a,
b)};c.prototype.$u=function(a){var b=Ob(a)[0];if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.vo()?document.exitFullscreen?document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};
c.prototype.vo=function(){var a=document;return document.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?!0:!1};c.prototype.Ar=function(){B.zr()};return c}(),td=new Z;td.instances=td.Tk;Z.prototype.addButton=Z.prototype.lc;Z.prototype.addCustomNode=Z.prototype.uq;Z.prototype.Popup=Z.prototype.aq;Z.prototype.Dialog=Z.prototype.Am;Z.prototype.ColourWheel=Z.prototype.Vp;Z.prototype.SlidingPanel=Z.prototype.fq;Z.prototype.createPreview=Z.prototype.hr;
Z.prototype.render=Z.prototype.zf;Z.prototype.parseColour=Z.prototype.Nt;Z.prototype.makeColour=Z.prototype.it;Z.prototype.getAbsoluteUrl=Z.prototype.Vr;Z.prototype.base64Encode=Z.prototype.Fq;Z.prototype.addFont=Z.prototype.vq;Z.prototype.PathCommands=Z.prototype.$p;Z.prototype.CommandsFromSvgPath=Z.prototype.Xp;Z.prototype.getImageSize=Z.prototype.qs;Z.prototype.setColourOpacity=Z.prototype.nu;Z.prototype.toggleFullScreen=Z.prototype.$u;Z.prototype.isFullScreen=Z.prototype.vo;
Z.prototype.enableConsoleLogging=Z.prototype.Ar;window.Zwibbler=td;var se=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Ic=null;b.log=B.create("CUSTOM");return b}p(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.setProperty=function(a,d){if(null===this.Ic&&"type"===a){var b=td.lk[d];this.Ic=new b(this.id)}this.Ic&&this.Ic.setProperty?this.Ic.setProperty(a,d):c.prototype.setProperty.call(this,a,d)};a.prototype.la=function(a){return this.Ic&&this.Ic.setProperty?this.Ic.getProperty(a):c.prototype.la.call(this,a)};a.prototype.format=function(a){"format"in
this.Ic?this.Ic.format(a):alert("Error: custom item must have a format(ctx) function");a=this.Ic.rect;this.rect=new K(a.x,a.y,a.width,a.height)};a.prototype.ja=function(a){this.Ic.draw(a)};return a}(R);R.Vc("CustomNode",se);var te=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Oc=null;b.od=null;b.width=100;b.height=20;b.qb=new zc;b.af=[];b.$c=new K(0,0,b.width,b.height);b.nc=new K(0,0,b.width,b.height);b.log=B.create("IMAGE",!0);delete b.aa.fillStyle;b.aa.url="";return b}p(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "url":this.od=this.Oc=null;break;case "brightness":case "contrast":case "gamma":this.od=null;
this.aa[a]=d;break;case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":this.aa[a]=d}};a.prototype.qu=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.$c.width);a.height=Math.min(a.height,this.$c.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.aa.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.Xn=function(){var a=this.aa.crop,c=new K(0,0,this.$c.width,this.$c.height);a&&(a=a.split(","),c.x=parseFloat(a[0])|
0,c.y=parseFloat(a[1])|0,c.width=parseFloat(a[2])|0,c.height=parseFloat(a[3])|0);return c};a.prototype.gu=function(){var a={brightness:this.la("brightness"),contrast:this.la("contrast"),gamma:this.la("gamma")};this.od=a&&this.Oc?this.Ir(this.Oc,a):this.Oc};a.prototype.format=function(a,c){function b(a,b,c){l.af.push({x:l.nc.x+a*l.nc.width,y:l.nc.y+b*l.nc.height,Md:c})}var d=this;null===this.Oc&&"ImageSurface"in window?(this.Oc=new window.ImageSurface(this.aa.url),this.$c=new K(0,0,this.Oc.width,this.Oc.height)):
null===this.Oc?(this.$c=new K(0,0,this.width,this.height),c.add(this.id,"image",this.aa.url,null,function(a){d.log("Got image response.");d.Oc=a;return c.Dh(d.id)})):this.$c=new K(0,0,this.Oc.width,this.Oc.height);if(null===this.od&&(this.gu(),this.od)){var g=this.la("width"),h=this.la("height");this.log("Override width/height as %s/%s",g,h);g&&(this.od.style.width=g+"px");h&&(this.od.style.height=h+"px")}this.nc=this.Xn();this.rect=this.nc.clone();if(g=this.la("boundingPolygon")){h=[];for(var k=
0;k<g.length;k+=2)h.push(new F(g[k],g[k+1]));this.qb=new zc(h)}else this.qb=new zc(this.rect);this.cb=this.rect.clone();this.qb.transform(this.aa.matrix);this.rect.transform(this.aa.matrix);this.af.length=0;var l=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.Fk=function(){return this.qb};a.prototype.lb=function(a,c){return!this.aa.locked&&this.qb.Wc(a,c,3)?this:null};a.prototype.Oe=function(b){var c,e,f=!1;if(this.od)try{var g=b.globalCompositeOperation,h=b.globalAlpha,k=this.la("blendMode"),
l=this.la("opacity");k&&(b.globalCompositeOperation=""+k,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,k));void 0!==l&&(b.globalAlpha=l);var m=this.la("lineWidth")||0;if(m){b.save();this.oe().Th(b);var n=this.qb.clone();n.xc(m/2);b.beginPath();n.ja(b);b.lineWidth=m;b.strokeStyle=this.la("strokeStyle")||"#000000";b.stroke();b.restore()}b.drawImage(this.od,this.nc.x,this.nc.y,this.nc.width,this.nc.height,this.nc.x,this.nc.y,this.nc.width,this.nc.height);b.globalAlpha=
h;b.globalCompositeOperation=g;if(a.ym){var r=this.qb.oa;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";b.moveTo(r[0].x,r[0].y);var q=c=1;for(e=r.length-1;c<=e;q=c+=1)b.lineTo(r[q].x,r[q].y);b.closePath();b.stroke();b.restore()}}catch(v){this.log("Error drawing image: %s",v.message),f=v}if(null===this.od||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.width,this.height),b.restore()};a.prototype.hg=function(){return!0===this.la("allowCrop")&&
!0!==this.la("lockEditMode")};a.prototype.wi=function(a,c){a.save();a.beginPath();a.lineWidth=1*c;a.strokeStyle="#0050B7";for(var b=this.Ga(),d=0;d<this.af.length;d++){var g=this.af[d],h=b.apply(g.x,g.y),k;if(g.Md){var l=20;var m=k=0;var n=3;g=h.x-10;h=h.y-6}else l=0,k=20,m=3,n=0,g=h.x-6,h=h.y-10;for(var r=0;5>r;r++)a.moveTo(g,h),a.lineTo(g+l*c,h+k*c),g+=m*c,h+=n*c}a.stroke();a.restore()};a.prototype.sd=function(a,c,e){var b=this.Ga();e*=10;for(var d=0;d<this.af.length;d++){var h=this.af[d];h=b.apply(h.x,
h.y);if(h.x-e<=a&&a<h.x+e&&h.y-e<=c&&c<h.y+e)return d}return null};a.prototype.kh=function(a){a=this.af[a];return this.Ga().apply(a.x,a.y)};a.prototype.we=function(a,c,e){var b=this.Xn();c=this.oe().apply(c,e);c.x=Math.round(c.x);c.y=Math.round(c.y);0===a&&0<=c.y&&c.y<this.$c.height?(b.height-=c.y-b.y,b.y=c.y):1===a&&0<=c.x&&c.x<this.$c.width?b.width=c.x-b.x:2===a&&0<=c.y&&c.y<this.$c.height?b.height=c.y-b.y:3===a&&0<=c.x&&c.x<this.$c.width&&(b.width-=c.x-b.x,b.x=c.x);this.qu(b)};a.prototype.Ir=function(a,
c){var b=a.width,d=a.height;if(!(a instanceof HTMLCanvasElement)){var g=document.createElement("canvas");g.width=b;g.height=d;g.getContext("2d").drawImage(a,0,0);a=g}g="number"===typeof c.brightness?c.brightness:-1;var h="number"===typeof c.contrast?c.contrast:-1,k="number"===typeof c.gamma?c.gamma:-1,l=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(c));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",g,h,k,b,d);l.width=b+1;l.height=d;var m=a.getContext("2d").getImageData(0,
0,b,d).data;b=l.getContext("2d").getImageData(0,0,b,d);d=b.data;for(var n=0;n<m.length;n+=4){var r=m[n]/255,q=m[n+1]/255,v=m[n+2]/255,y=m[n+3];0<=k&&(r=Math.pow(r,k),q=Math.pow(q,k),v=Math.pow(v,k));0<=g&&(r*=g,v*=g,q*=g);0<=h&&(r=r*h-.5*h+.5,q=q*h-.5*h+.5,v=v*h-.5*h+.5);d[n]=Math.min(255*r|0,255);d[n+1]=Math.min(255*q|0,255);d[n+2]=Math.min(255*v|0,255);d[n+3]=y}l.getContext("2d").putImageData(b,0,0);return l};a.ym=!1;return a}(R);R.Vc("ImageNode",te);var ue=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.ya=null;b.ph=20;b.Zc=20;b.qb=new zc;b.Pc=0;b.Qc=0;b.Xd=0;b.Yd=0;b.log=B.create("STAMPLINE",!0);b.log("New StampLineNode created.");b.aa.x1=10;b.aa.y1=10;b.aa.x2=100;b.aa.y2=100;b.aa.url="http://zwibbler.com/wd-box.png";return b}p(a,c);a.prototype.type=function(){return"StampLineNode"};a.prototype.format=function(a,c){var b=this;null===this.ya?(c.add(this.id,"image",this.aa.url,null,function(a){b.log("Got image response.");b.ya=a;c.Dh(b.id)}),
this.Zc=this.ph=20):(this.ph=this.ya.width,this.Zc=this.ya.height);this.Pc=this.aa.x1;this.Qc=this.aa.y1;this.Xd=this.aa.x2;this.Yd=this.aa.y2;var d=G(this.Pc,this.Qc,this.Xd,this.Yd);var g=-Math.atan2(this.Yd-this.Qc,this.Xd-this.Pc);this.qb=new zc;this.qb.add(0,-this.Zc/2);this.qb.add(d,-this.Zc/2);this.qb.add(d,this.Zc/2);this.qb.add(0,this.Zc/2);d=new O;d=d.multiply(this.Ga());d=d.multiply(new M(this.Pc,this.Qc));d=d.multiply(new N(g,0,0));this.qb.transform(d);this.rect=this.qb.qn()};a.prototype.lb=
function(a,c){return!this.aa.locked&&this.qb.Wc(a,c,3)?this:null};a.prototype.hg=function(){return!0};a.prototype.sd=function(a,c,e){var b=this.Ga();var d=b.apply(this.Pc,this.Qc);b=b.apply(this.Xd,this.Yd);e*=8;return a>=d.x-e&&a<d.x+e&&c>=d.y-e&&c<d.y+e?0:a>=b.x-e&&a<b.x+e&&c>=b.y-e&&c<b.y+e?1:null};a.prototype.kh=function(a){return 0===a?this.Ga().apply(this.aa.x1,this.aa.y1):this.Ga().apply(this.aa.x2,this.aa.y2)};a.prototype.we=function(a,c,e){c=this.oe().apply(c,e);0===a?(this.aa.x1=c.x,this.aa.y1=
c.y):1===a&&(this.aa.x2=c.x,this.aa.y2=c.y)};a.prototype.wi=function(a,c){a.save();a.lineWidth=1*c;a.strokeStyle="#0050B7";var b=this.Ga();var d=b.apply(this.Pc,this.Qc);b=b.apply(this.Xd,this.Yd);var g=4*c;a.beginPath();a.moveTo(d.x,d.y);a.lineTo(b.x,b.y);a.rect(d.x-g,d.y-g,2*g,2*g);a.rect(b.x-g,b.y-g,2*g,2*g);a.stroke();a.restore()};a.prototype.Oe=function(a){var b,c;var f=new F(this.Pc,this.Qc);var g=new F(this.Xd,this.Yd);g=f.Pa(g);f=new N(-Math.atan2(this.Yd-this.Qc,this.Xd-this.Pc),this.Pc,
this.Qc);f=f.multiply(new M(this.Pc,this.Qc));a.transform(f.m11,f.m21,f.m12,f.m22,f.Ca,f.Da);a.beginPath();f=b=0;for(c=this.ph;0<c?b<=g:b>=g;f=b+=c)this.ya?this.ph<g-f?a.drawImage(this.ya,f,-this.Zc/2|0):1<g-f&&a.drawImage(this.ya,0,0,g-f|0,this.Zc,f,-this.Zc/2|0,g-f|0,this.Zc):a.rect(f,0,this.ph,this.Zc);null===this.ya&&(a.lineWidth=2,a.strokeStyle="red",a.stroke())};return a}(R);R.Vc("StampLineNode",ue);var ve=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.di="UnknownNode";b.width=100;b.height=20;b.nb=new Nc;b.log=B.create("UNKNOWN",!0);b.nb.op("center","middle");return b}p(a,c);a.prototype.Du=function(a){this.di=a;this.nb.Bp(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.di};a.prototype.setProperty=function(a,c){this.aa[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.di);this.rect=new K(0,0,this.width,
this.height);this.rect.transform(this.aa.matrix);this.nb.format(a,this.width,this.height)};a.prototype.Oe=function(a){this.log("Drawing placeholder for for %s",this.di);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.nb.ja(a,0,0);a.restore()};a.ym=!1;return a}(R);R.Vc("UnknownNode",ve);var we=function(){function c(a,b){this.next=this.cd=null;this.Zl=this.sj=this.length=0;this.Lp=!1;this.text="";this.Si=!0;this.log=B.create("WallSegment",!0);a instanceof c?(this.cd=a,this.cd.next=this,this.from=this.cd.fa):this.from=a;this.fa=b}c.prototype.Sn=function(a,b,c){this.text=a;this.sj=b;this.Zl=c;this.Lp=!1};c.prototype.sr=function(a){if(""!==this.text){var b=G(this.from.x,this.from.y,this.fa.x,this.fa.y);if(!(b<this.sj)){a.save();var c=2*this.Zl,e=I(this.from.x,this.from.y,this.fa.x,this.fa.y),
f=new F(e.y,-e.x),g=Math.atan2(this.fa.y-this.from.y,this.fa.x-this.from.x);0>g&&(g+=2*Math.PI);this.Lp&&(c*=-1);var h=(b-this.sj)/2,k=new F(this.from.x+f.x*c,this.from.y+f.y*c),l=new F(this.fa.x+f.x*c,this.fa.y+f.y*c);a.beginPath();a.moveTo(k.x-f.x*c/4+e.x*c/4,k.y-f.y*c/4+e.y*c/4);a.lineTo(k.x,k.y);a.lineTo(k.x+f.x*c/4+e.x*c/4,k.y+f.y*c/4+e.y*c/4);a.moveTo(l.x-f.x*c/4-e.x*c/4,l.y-f.y*c/4-e.y*c/4);a.lineTo(l.x,l.y);a.lineTo(l.x+f.x*c/4-e.x*c/4,l.y+f.y*c/4-e.y*c/4);a.moveTo(k.x,k.y);a.lineTo(k.x+e.x*
h,k.y+e.y*h);a.moveTo(l.x,l.y);a.lineTo(l.x-e.x*h,l.y-e.y*h);a.stroke();g>Math.PI/2&&g<3*Math.PI/2&&(g+=Math.PI);a.translate(k.x+e.x*b/2,k.y+e.y*b/2);a.rotate(g);a.translate(-this.sj/2,this.Zl/2*.8);a.fillText(this.text,0,0);a.restore()}}};c.prototype.pr=function(a,b){var c=I(this.from.x,this.from.y,this.fa.x,this.fa.y),e=new F(c.y,-c.x),f=e.x*(a-this.from.x)+e.y*(b-this.from.y);c=new F(this.from.x+f*e.x,this.from.y+f*e.y);e=new F(this.fa.x+f*e.x,this.fa.y+f*e.y);this.cd&&(f=Ac(this.cd.from.x,this.cd.from.y,
this.cd.fa.x,this.cd.fa.y,c.x,c.y,e.x,e.y))&&(c=f);this.next&&(f=Ac(this.next.from.x,this.next.from.y,this.next.fa.x,this.next.fa.y,c.x,c.y,e.x,e.y))&&(e=f);this.from.x=c.x;this.from.y=c.y;this.fa.x=e.x;this.fa.y=e.y};return c}(),xe=function(){function c(a,b){this.Ka=a;this.type=b;this.log=B.create("WallEditHandle",!0);this.Ka=a;this.type=b}c.prototype.lb=function(a,b,c,e,f){switch(this.type){case "from":a=G(a,b,this.Ka.from.x,this.Ka.from.y);break;case "to":a=G(a,b,this.Ka.fa.x,this.Ka.fa.y);break;
default:var d=0,h=0;"middle"===e?(d=-f/2,h=f/2):"outside"===e?d=-f:h=f;e=I(this.Ka.from.x,this.Ka.from.y,this.Ka.fa.x,this.Ka.fa.y);e=new F(e.y,-e.x);d=(new F(a,b)).ti(new F(this.Ka.from.x+d*e.x,this.Ka.from.y+d*e.y),new F(this.Ka.fa.x+d*e.x,this.Ka.fa.y+d*e.y));a=(new F(a,b)).ti(new F(this.Ka.from.x+h*e.x,this.Ka.from.y+h*e.y),new F(this.Ka.fa.x+h*e.x,this.Ka.fa.y+h*e.y));a=Math.min(d,a)}return a<c};c.prototype.moveTo=function(a,b){switch(this.type){case "from":var c=this.Ka.cd;this.Ka.from.x=a;
this.Ka.from.y=b;break;case "to":var e=this.Ka.next;this.Ka.fa.x=a;this.Ka.fa.y=b;break;default:c=this.Ka.cd,e=this.Ka.next,this.Ka.pr(a,b)}c&&(c.Si=!0);e&&(e.Si=!0)};c.prototype.Ds=function(){switch(this.type){case "from":return this.Ka.from;case "to":return this.Ka.fa;default:return this.Ka.from}};c.prototype.Yr=function(){return Math.atan2(this.Ka.fa.y-this.Ka.from.y,this.Ka.fa.x-this.Ka.from.x)};return c}();var ye=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.precision=1;b.font="";b.rect=new K(0,0,0,0);b.cb=new K(0,0,0,0);b.path=null;b.Sg=[];b.Ob=[];b.Nb=[];b.ka=null;b.lineWidth=0;b.Dg=0;b.log=B.create("WallNode",!0);b.log("New WallNode created.");b.aa.svgpath="";b.aa.strokeStyle="#000000";b.aa.lineWidth=1;b.aa.pixelsPerUnit=1;b.aa.units="px";b.aa.fontSize=15;b.aa.fontName="Arial";b.aa.textFillStyle="#000000";b.aa.insideFillStyle="rgba(0,0,0,0.0)";b.aa.fillStyle="rgba(0,0,0,0.0)";b.aa.thickness=
10;b.aa.placement="middle";b.aa.lockCorners=!1;return b}p(a,c);a.prototype.type=function(){return"WallNode"};a.prototype.resolve=function(a){var b=a.Fk().clone();this.log("Resolve with: %s %s",a.type(),b.oa);b.transform(this.oe());this.Sg.push(b);return a.rect.Gt(this.rect)};a.prototype.format=function(a,c){this.ka=a;var b=new F(0,0),d=[],g=null,h=this.Ga(),k=[],l=[],m,n=this,r={beginPath:function(){},moveTo:function(a,c){b=h.apply(a,c);k.push(new F(a,c));l.push(b);g=null;r.moveTo=r.lineTo},lineTo:function(a,
c){var e=h.apply(a,c);g?g=new we(g,e):m=g=new we(b,e);k.push(new F(a,c));l.push(e);b=e;d.push(g)},bezierCurveTo:function(){},quadraticCurveTo:function(){},closePath:function(){n.log("close");m&&g!==m&&null!==g&&(n.log("close up!"),m.cd=g,g.next=m,g.fa=m.from)}};this.Ob=d;this.path=new Q;this.log("Formatting svgpath=%s",this.la("svgpath"));Cc(this.path,this.la("svgpath"));var q;for(q=0;q<this.Sg.length;q++)this.log("path: %s",this.path.Vd()),this.log("poly: %s",this.Sg[q].Vd()),this.path=this.path.Xq(this.Sg[q]);
this.path.ja(r);this.cb=K.Me(k);this.rect=K.Me(l);this.path.transform(this.Ga());this.lineWidth=q=this.la("lineWidth");this.rect.xc(q/2,q/2);this.Dg=this.la("thickness");this.rect.xc(2*this.Dg);this.rect.xc(3*this.aa.fontSize);this.font=""+this.aa.fontSize+'px "'+this.aa.fontName+'"';for(q=0;q<this.Ob.length;q++)this.Tn(a,this.Ob[q]);this.Nb.length=0;for(q=0;q<d.length;q++){var v=d[q];y!==v.from&&this.Nb.push(new xe(v,"from"));this.Nb.push(new xe(v,"to"));var y=v.fa}for(q=0;q<d.length;q++)v=d[q],
this.Nb.push(new xe(v,"middle"));y=this.la("insideFillStyle");this.Sr(a,c,y);this.Sg.length=0};a.prototype.Tn=function(a,c){c.Si=!1;if(0>=this.aa.pixelsPerUnit)c.Sn("",0,0);else{var b=G(c.from.x,c.from.y,c.fa.x,c.fa.y)/this.aa.pixelsPerUnit;if("ft-in"===this.aa.units){var d=Math.floor(b);b=Math.round(12*(b-d));12===b&&(b=0,d+=1);b=b?" "+d+"'"+b+'" ':" "+d+"' "}else d=Math.pow(10,this.precision),b=Math.round(b*d)/d,b=" "+b+this.aa.units+" ";a.font=this.font;c.Sn(b,a.measureText(b).width,this.aa.fontSize)}};
a.prototype.$t=function(){this.log("Reconstruct path!");var a=new Dc,c=this.Ga().inverse();a.transform(c.m11,c.m21,c.m12,c.m22,c.Ca,c.Da);this.Fn(a);this.setProperty("svgpath",a.toString())};a.prototype.dg=function(){return"svgpath"};a.prototype.Hs=function(){return this.path||new Q};a.prototype.Fn=function(a){var b=null,c;for(c=0;c<this.Ob.length;c++){var f=this.Ob[c];if(b!==f.from){a.moveTo(f.from.x,f.from.y);var g=f.from}a.lineTo(f.fa.x,f.fa.y);f.fa===g&&a.closePath();b=f.fa}};a.prototype.ja=function(a){var b;
a.save();this.ug(a);a.lineJoin="square";a.lineCap="square";a.strokeStyle=this.la("strokeStyle");a.lineWidth=this.la("lineWidth");a.beginPath();this.Fn(a);a.fillStyle=this.ms();a.fill();a.beginPath();var c=[];for(b=0;b<this.Ob.length;b++){var f=this.Ob[b];g!==f.from&&(Ec(a,c,this.la("thickness"),this.la("placement")),c.length=0,c.push(f.from));c.push(f.fa);var g=f.fa}Ec(a,c,this.la("thickness"),this.la("placement"));a.fillStyle=this.la("fillStyle");a.strokeStyle=this.la("strokeStyle");a.fill();a.stroke();
a.fillStyle=a.strokeStyle;if(0<this.la("pixelsPerUnit"))for(a.textBaseline="alphabetic",a.fillStyle=this.la("textFillStyle"),a.strokeStyle=this.la("textFillStyle"),a.font=this.font,b=0;b<this.Ob.length;b++)f=this.Ob[b],f.sr(a);this.tg(a);a.restore()};a.prototype.lb=function(a,c){if(null===this.path)return null;var b=6+2*this.la("thickness");return"rgba(0,0,0,0.0)"===this.la("fillStyle")?!this.hidden()&&!this.la("locked")&&this.rect.Wc(a,c,b)&&this.path.ul(a,c,b)?this:null:!this.hidden()&&!this.la("locked")&&
this.rect.Wc(a,c,b)&&this.path.ap(a,c,b)?this:null};a.prototype.sd=function(a,c,e){var b=this.la("thickness"),d=this.la("wallPlacement");e=6/e+b;for(var h=this.aa.lockCorners,k=0;k<this.Nb.length;k++)if(this.Nb[k].lb(a,c,e,d,b)&&(!h||"middle"===this.Nb[k].type))return k;return null};a.prototype.hg=function(){return!1};a.prototype.kh=function(a){return a>=this.Nb.length?(this.log("Bad edit handle %s",a),null):this.Nb[a].Ds()};a.prototype.ne=function(a){return null!==a&&a<this.Nb.length?this.Nb[a].type:
null};a.prototype.ls=function(a){return null!==a&&a<this.Nb.length?this.Nb[a].Yr():0};a.prototype.Pk=function(a,c,e,f,g){if(null===a||a>=this.Nb.length)return new F(0,0);a=this.Nb[a].Ka;var b=this.la("placement");"middle"===b?e-=this.Dg/2:"outside"===b&&(e-=this.Dg);"middle"===c?e+=this.Dg/2:"outside"===c&&(e+=this.Dg);c=I(a.from.x,a.from.y,a.fa.x,a.fa.y);var d=new F(c.y,-c.x);c=a.from.x+e*d.x;b=a.from.y+e*d.y;var l=a.fa.x+e*d.x-c;e=a.fa.y+e*d.y-b;f=((f-c)*l+(g-b)*e)/(l*l+e*e);1<f?f=1:0>f&&(f=0);
return new F(c+f*l,b+f*e)};a.prototype.we=function(a,c,e){if(a>=this.Nb.length)this.log("Bad edit handle %s",a);else{this.Nb[a].moveTo(c,e);for(a=0;a<this.Ob.length;a++)c=this.Ob[a],c.Si&&this.ka&&this.Tn(this.ka,c);this.$t()}};return a}(R);R.Vc("WallNode",ye);var ze=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Zb="Action";a.log=B.create("ACTION");return a}p(a,c);a.prototype.zb=function(){};a.prototype.toString=function(){return""+this.Zb+"()"};return a}(Fb),V=function(c){function a(a,d,e,f,g){void 0===f&&(f=null);void 0===g&&(g=-1);var b=c.call(this)||this;b.id=a;b.type=d;b.aa=e;b.Zi=f;b.index=g;b.node=null;b.Zb="CreateAction";return b}p(a,c);a.prototype.zb=function(a){var b=R.create(this.type,this.id,a);b||(this.type in td.lk?
(b=new se(this.id,a),b.setProperty("type",this.type)):(this.log("Bad node type: %s",this.type),b=R.create("UnknownNode",this.id,a),b.Du(this.type)));b.Ib(this.aa);null===this.Zi&&(this.Zi=a.Nk().id,this.index=-1);var c=a.za(this.Zi,!1);c instanceof cd&&(a.ub(c,b,this.index),this.log("Add %s id %s to parent %s index %s",b.type(),this.id,c.type(),this.index),this.node=b)};a.prototype.toString=function(){return""+this.Zb+"("+this.type+NaN+this.id+", "+JSON.stringify(this.aa)+", parent="+this.Zi+", index="+
this.index+")"};a.prototype.ib=function(a){this.node&&a.removeNode(this.node)};return a}(ze),ce=function(c){function a(a){var b=c.call(this)||this;b.Oa=a;b.xe=[];b.Zb="DeleteAction";return b}p(a,c);a.prototype.zb=function(a){var b;this.xe.length=0;var c=this.Oa;var f=0;for(b=c.length;f<b;f++){var g=c[f];(g=a.za(g,!1))&&this.xe.push({node:g,parent:g.parent,index:a.removeNode(g)})}};a.prototype.ib=function(a){for(var b,c=this.xe.length-1;0<=c;--c)b=this.xe[c],b.node&&b.parent&&a.ub(b.parent,b.node,
b.index)};return a}(ze),Id=function(c){function a(a,d,e){var b=c.call(this)||this;b.Oa=a;b.name=d;b.value=e;b.Od=[];b.Zb="SetAction";return b}p(a,c);a.prototype.zb=function(a){var b;this.Od.length=0;var c=this.Oa;var f=0;for(b=c.length;f<b;f++){var g=c[f];if(g=a.za(g,!0))this.Od.push(g.la(this.name)),a.Ee(g,this.name,this.value)}};a.prototype.ib=function(a){var b,c,f;if(0!==this.Oa.length){var g=c=0;for(f=this.Oa.length-1;0<=f?c<=f:c>=f;g=0<=f?++c:--c)(b=a.za(this.Oa[g],!0))&&a.Ee(b,this.name,this.Od[g])}};
a.prototype.Jo=function(b){if(!(b instanceof a)||this.name!==b.name)return!1;switch(this.name){case "arrowSize":case "arrowStyle":case "arrowXOffset":case "background":case "bold":case "border":case "cloudRadius":case "dashes":case "doubleArrow":case "fillStyle":case "fontName":case "fontSize":case "italic":case "lineWidth":case "opacity":case "roudRadius":case "strokeStyle":case "textDecoration":break;default:return!1}this.Oa.sort();b.Oa.sort();if(this.Oa.length!==b.Oa.length)return!1;for(var c=
0;c<this.Oa.length;c++)if(this.Oa[c]!==b.Oa[c])return!1;this.log("Merging property change %s",this.name);this.value=b.value;return!0};return a}(ze),Gd=function(c){function a(a,d){var b=c.call(this)||this;b.Oa=a;b.sa=d;b.Zb="TransformAction";b.inverse=d.inverse();return b}p(a,c);a.prototype.zb=function(a){for(var b=a.Lk(this.Oa,!0,!0),c=0;c<b.length;c++){var f=b[c];f.transform(this.sa);a.dc.Ib(f.id,{matrix:f.Ga()})}};a.prototype.ib=function(a){for(var b=a.Lk(this.Oa,!0,!0),c=0;c<b.length;c++){var f=
b[c];f.transform(this.inverse);a.dc.Ib(f.id,{matrix:f.Ga()})}};return a}(ze),xd=function(c){function a(a,d,e,f,g,h){var b=c.call(this)||this;b.id=a;b.handle=d;b.vt=e;b.wt=f;b.x=g;b.y=h;b.Zb="MoveEditHandleAction";return b}p(a,c);a.prototype.zb=function(a){var b;if(b=a.za(this.id,!0)){b.we(this.handle,this.x,this.y);var c={};c[b.dg()]=b.la(b.dg());a.dc.Ib(b.id,c)}};a.prototype.ib=function(a){var b;if(b=a.za(this.id,!0)){b.we(this.handle,this.vt,this.wt);var c={};c[b.dg()]=b.la(b.dg());a.dc.Ib(b.id,
c)}};return a}(ze),rd=function(c){function a(a,d){var b=c.call(this)||this;b.id=a;b.Oa=d;b.xe=[];b.node=null;b.Zb="GroupAction";return b}p(a,c);a.prototype.zb=function(a){var b;this.xe.length=0;var c=this.Oa;var f=0;for(b=c.length;f<b;f++){var g=c[f];(g=a.za(g))&&this.xe.push({node:g,parent:g.parent,index:g.parent.Ck(g)})}this.node=a.Xg(this.id,this.Oa)};a.prototype.ib=function(a){var b,c;if(0!==this.Oa.length&&this.node){for(b=c=this.Oa.length-1;0<=c&&!(0>b);b=c+=-1)b=this.xe[b],b.parent&&b.node&&
a.ub(b.parent,b.node,b.index);a.removeNode(this.node)}};a.prototype.toString=function(){return"GroupAction("+JSON.stringify(this.Oa)+")"};return a}(ze),be=function(c){function a(a){var b=c.call(this)||this;b.Oa=a;b.Ld=[];b.Zb="UngroupAction";return b}p(a,c);a.prototype.zb=function(a){var b,c,f={};var g=this.Oa;var h=0;for(b=g.length;h<b;h++){var k=g[h];k=a.za(k);if(k instanceof cd){var l=k;if(!(l.id in f)){f[l.id]=!0;var m={node:l,parent:l.parent,children:l.children.concat(),index:0};var n=m.children;
var r=0;for(c=n.length;r<c;r++)k=n[r],a.ub(l.parent,k,-1);m.index=a.removeNode(l);this.Ld.push(m)}}}};a.prototype.ib=function(a){var b,c,f,g;if(0!==this.Ld.length){for(b=f=this.Ld.length-1;0<=f&&!(0>b);b=f+=-1)if(b=this.Ld[b],0!==b.children.length)for(a.ub(b.parent,b.node,b.index),c=g=b.children.length-1;0<=g&&!(0>c);c=g+=-1)a.ub(b.node,b.children[c],-1);a.Ai=!0}};return a}(ze);
function Ae(c,a){var b;if(c.wo()){var d=c.children;var e=0;for(b=d.length;e<b;e++){var f=d[e];Ae(f,a)}}else c.transform(a)}
var de=function(c){function a(a,d,e){var b=c.call(this)||this;b.Oa=a;b.offsetX=d;b.offsetY=e;b.ra=[];b.Zb="DuplicateAction";return b}p(a,c);a.prototype.zb=function(a){var b;var c=new M(this.offsetX,this.offsetY);this.ra.length=0;var f=function(){return a.Wa()};var g=this.Oa;var h=0;for(b=g.length;h<b;h++){var k=g[h];if(k=a.za(k))k=k.clone(f),c.Wk()||Ae(k,c),a.Uf(k),this.ra.push(k)}};a.prototype.ib=function(a){var b,c;if(0!==this.ra.length)for(b=c=this.ra.length-1;0<=c&&!(0>b);b=c+=-1)a.removeNode(this.ra[b])};
return a}(ze),ae=function(c){function a(a,d,e){var b=c.call(this)||this;b.Oa=a;b.type=d;b.Ko=e;b.ra=[];b.nl=[];b.Zb="ChangeOrderAction";return b}p(a,c);a.prototype.zb=function(b){var c,e;this.nl.length=0;this.ra.length=0;var f=this.Oa;var g=0;for(e=f.length;g<e;g++){var h=f[g];if(h=b.za(h))if(c=h.parent){var k=h.ff();this.nl.push(k);this.ra.push(h);switch(this.type){case a.wm:b.ub(c,h,-1);break;case a.Kj:b.ub(c,h,0);break;case a.Fm:0<k?b.ub(c,h,k-1):b.ub(c,h,k);break;case a.Gm:k<c.children.length?
b.ub(c,h,k+1):b.ub(c,h,k);break;case a.Jm:void 0===this.Ko?b.ub(c,h,-1):b.ub(c,h,this.Ko)}}}};a.prototype.ib=function(a){var b,c,f;if(0!==this.Oa.length)for(b=f=this.Oa.length-1;0<=f&&!(0>b);b=f+=-1){var g=this.ra[b];(c=g.parent)&&g&&a.ub(c,g,this.nl[b])}};a.wm=0;a.Kj=1;a.Gm=2;a.Fm=3;a.Jm=4;return a}(ze),pe=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.Yu=d;b.Xu=e;b.Zb="MoveNodeAction";b.Oo=0;b.jf=0;return b}p(a,c);a.prototype.zb=function(a){var b=a.za(this.id),c=a.za(this.Yu);if(c&&
!(c instanceof cd)&&b)throw console.log("FATAL: Parent node: "+c.id+":"+c.type()+" child "+b.id+":"+b.type()),Error("Tried to move to a non-group node!");b&&b.parent&&c&&(this.Oo=b.parent.id,this.jf=b.ff(),a.ub(c,b,this.Xu))};a.prototype.ib=function(a){var b=a.za(this.id),c=a.za(this.Oo);b&&b.parent&&c&&a.ub(c,b,this.jf)};return a}(ze),sd=function(c){function a(a){var b=c.call(this)||this;b.aa=a;b.Od={};b.Zb="SetDocumentPropertiesAction";return b}p(a,c);a.prototype.zb=function(a){var b;this.Od={};
for(b in this.aa)this.aa.hasOwnProperty(b)&&(this.Od[b]=a.la(b),a.setProperty(b,this.aa[b]))};a.prototype.ib=function(a){for(var b in this.Od)this.Od.hasOwnProperty(b)&&a.setProperty(b,this.Od[b])};return a}(ze),re=function(c){function a(a){var b=c.call(this)||this;b.Ht=a;b.No=0;b.Zb="SetPageAction";return b}p(a,c);a.prototype.zb=function(a){this.No=a.Va;a.Db(this.Ht)};a.prototype.ib=function(a){a.Db(this.No)};return a}(ze);var Be=function(c){function a(b,d){var e=c.call(this,b,d,a)||this;e.log=B.create("PAGE",!0);e.children=[];return e}p(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.format=function(){};a.prototype.lb=function(){return null};a.prototype.ja=function(){};return a}(cd);R.Vc("PageNode",Be);var Ce=function(){function c(){this.log=B.create("NullObserver")}c.prototype.createNode=function(a,b,c,e){this.log("Create node "+e.type+" "+a+" at "+b+":"+c)};c.prototype.Ec=function(a,b,c){this.log("Delete node "+a+" from "+b+":"+c)};c.prototype.gf=function(a,b,c,e,f){this.log("Move node "+a+" from "+e+":"+f+" to "+b+":"+c)};c.prototype.Ib=function(a,b){this.log("Set properties for node "+a+" to "+JSON.stringify(b))};c.prototype.pa=function(){};return c}(),qd=function(c){function a(a){void 0===
a&&(a=!1);var b=c.call(this)||this;b.Qv=a;b.dc=new Ce;b.sc=new Gb;b.ra={};b.ze=new u;b.Rn=!0;b.Ai=!0;b.pb=0;b.ad=new u;b.removedNodes=new u;b.ce=new u;b.root=new cd(b.Wa(),b);b.nj=0;b.Ul="magenta";b.readOnly=!1;b.Ob=new u;b.uk=new u;b.sk=new u;b.aa={};b.Mi=new u;b.vm=new u;b.yd=[];b.bb=[];b.Va=0;b.ah=0;b.Tv=-1;b.lg=0;b.kp=0;b.log=B.create("DOC");b.ra[b.root.id]=b.root;b.Go();a||(b.Pj(b.root,0),b.Db(b.qh(0)));return b}p(a,c);a.prototype.empty=function(){return 0===this.root.children.length};a.prototype.Go=
function(){this.kp=this.sc.next};a.prototype.fe=function(){return this.kp!==this.sc.next};a.prototype.Wa=function(){for(;;){var a=this.pb++;if(!(a in this.ra))return a}};a.prototype.cf=function(a){return a in this.ra};a.prototype.Pj=function(a,c,e,f,g){void 0===e&&(e=!0);void 0===f&&(f=null);void 0===g&&(g=0);var b,d=!1;if(a.id in this.ra)null!==f&&a.parent&&(this.dc.gf(a.id,a.parent.id,a.ff(),f,g),this.log("Node %s inserted at %s:%s; was at %s",a.id,a.parent.id,a.ff(),g));else if(d=!0,this.ra[a.id]=
a,a.parent&&(f=a.vc(),f.type=a.type(),this.dc.createNode(a.id,a.parent.id,a.ff(),f)),a instanceof cd){var l=a.children;g=0;for(b=l.length;g<b;g++)f=l[g],this.Pj(f,c,e)}"PageNode"!==a.type()&&d&&(this.ad.add(a.id),this.removedNodes.remove(a.id));a.Ag(this.readOnly);e&&this.ze.add(a.id);this.vm.add(a.gg());a.la("spotHighlight")&&"PathNode"===a.type()&&this.yd.push(a);this.lg=void 0===c||null===c?this.pe(a.id)||0:c;a.la("wallAffinity")&&this.uk.add(a.id);"WallNode"===a.type()?this.Ob.add(a.id):"DomNode"===
a.type()?this.sk.add(a.id):"PageNode"===a.type()&&(this.ah=-1);d&&a.ol()};a.prototype.kg=function(a){this.ce.add(a);this.lg=this.pe(a)||0;this.ze.add(a)};a.prototype.Uf=function(a){this.bb[this.Va]||console.log("FATAL: Asked to add a node but bad page.",this.Va,this.bb);this.ub(this.bb[this.Va],a,-1)};a.prototype.za=function(a,c){void 0===c&&(c=!1);if(a in this.ra){var b=this.ra[a];c&&(this.ze.add(a),this.ce.add(a),this.lg=this.pe(a)||0);return b}return null};a.prototype.pe=function(a){for(a=this.za(a,
!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;for(var b=0;b<this.bb.length;b++)if(this.bb[b]===a)return b;return null};a.prototype.Lk=function(a,c,e){for(var b=[],d=0;d<a.length;d++){var h=this.za(a[d],e);h&&b.push(h)}return b=c?this.Er(b):this.ki(b)};a.prototype.Mr=function(a){var b=[],c;for(c in this.ra)if(this.ra.hasOwnProperty(c)){var f=this.ra[c];f.la("tag")===a&&b.push(f)}return b};a.prototype.pa=function(a,c){void 0===c&&(c=!1);this.ad=
new u;this.removedNodes=new u;this.ce=new u;if(c){this.log("Performing actions without adding to undo stack");for(var b=0;b<a.length;b++)a[b].zb(this)}else this.sc.pa(a,!1,this);this.dc.pa();return{fd:this.ad.Ad(),yf:this.removedNodes.Ad(),Jf:this.ce.$f(this.ad).$f(this.removedNodes).Ad()}};a.prototype.ib=function(){this.ad=new u;this.removedNodes=new u;this.ce=new u;this.sc.ib(this);this.dc.pa();return{fd:this.ad.Ad(),yf:this.removedNodes.Ad(),Jf:this.ce.$f(this.ad).$f(this.removedNodes).Ad()}};
a.prototype.wd=function(){this.ad=new u;this.removedNodes=new u;this.ce=new u;this.sc.wd(this);this.dc.pa();return{fd:this.ad.Ad(),yf:this.removedNodes.Ad(),Jf:this.ce.$f(this.ad).$f(this.removedNodes).Ad()}};a.prototype.Ed=function(){return this.sc.Ed()};a.prototype.Dd=function(){return this.sc.Dd()};a.prototype.Eh=function(){this.sc=new Gb};a.prototype.format=function(a,c){var b=this,d;var g=[];if(this.Rn)for(n in this.ra)g.push(this.ra[n]);else this.ze.kb(function(a){g.push(b.ra[parseInt(a,10)]);
return!1});var h=this.ki(g);var k=[],l=[];var m=0;for(d=h.length;m<d;m++){var n=h[m];"WallNode"!==n.type()?(n.format(a,c),n.la("wallAffinity")&&k.push(n)):l.push(n)}if(!this.Ob.empty()){var r=new u,q,v,y=this,z;y.Ob.kb(function(a){a=parseInt(a,10);for(z=0;z<k.length;z++)q=k[z],y.ra[a].resolve(q)&&h.push(y.ra[a]),r.add(a+"_"+q.id);return!1});y.uk.kb(function(a){a=parseInt(a,10);for(z=0;z<l.length;z++)v=l[z],r.contains(v.id+"_"+a)||v.resolve(y.ra[a])&&h.push(v);return!1});m=0;for(d=h.length;m<d;m++)n=
h[m],"WallNode"!==n.type()||r.contains(n.id)||(r.add(n.id),n.format(a,c))}this.ze.clear();this.Rn=!1;return g.length};a.prototype.vr=function(a,c,e){if(0!==this.yd.length&&c===this.nj){a.save();a.beginPath();c=e||this.re();a.moveTo(c.x,c.y);a.lineTo(c.x,c.bottom());a.lineTo(c.right(),c.bottom());a.lineTo(c.right(),c.y);a.closePath();e=!1;for(var b=0;b<this.yd.length;b++)this.yd[b].page===this.bb[this.Va]&&(this.yd[b].clip(a),e=!0);e&&(a.clip(),a.fillStyle=this.Ul,a.fillRect(c.x,c.y,c.width,c.height));
a.restore()}};a.prototype.ja=function(a,c){function b(b){g.$e(function(c){g.Mi.contains(c.Kd())||c.gg()===b&&(c.hidden()||c.ja(a))});g.vr(a,b,c)}var d,g=this;this.vm.add(this.nj);var h=this.vm.Ad();h.sort(function(a,b){return a-b});var k=0;for(d=h.length;k<d;k++)b(h[k])};a.prototype.lb=function(a,c,e,f){var b=null;this.$e(function(d){d.Kd()===e&&d.lb(a,c)&&(!(null===b||b.gg()<=d.gg())||f&&f!==d.type()||(b=d))});return b};a.prototype.Bs=function(a){var b=[];this.$e(function(c){a.contains(c.rect)&&
b.push(c)});return b};a.prototype.ki=function(a){var b,c;var f=[];var g={};var h=0;for(c=a.length;h<c;h++){for(b=a[h];b.Vk()&&b.parent;)this.log("Node type %s:%s is a group member",b.id,b.type()),b=b.parent;b.id in g||(g[b.id]=b,f.push(b))}this.Pu(f);return f};a.prototype.Er=function(a){function b(a){if(!(a.id in f)&&(f[a.id]=a,c.push(a),a.children))for(var d=0;d<a.children.length;d++)b(a.children[d])}for(var c=[],f={},g=0;g<a.length;g++)b(a[g]);return c};a.prototype.kb=function(a,c){function b(d){var e;
if(d.children){a&&c(d);var f=d.children;var k=0;for(e=f.length;k<e;k++)d=f[k],b(d)}else c(d)}b(this.root)};a.prototype.$e=function(a,c){function b(c){if(c.children)for(var d=0;d<c.children.length;d++)b(c.children[d]);else"PageNode"!==c.type()&&a(c)}void 0===c&&(c=this.Va);c<this.bb.length&&b(this.bb[c||0])};a.prototype.filter=function(a){var b=[];this.kb(!1,function(c){if(a(c))return b.push(c)});return b};a.prototype.Pu=function(a){var b=0;this.Ai&&(this.Ai=!1,this.kb(!0,function(a){a.order=b++}));
a.sort(function(a,b){return a.order-b.order})};a.prototype.Xg=function(a,c){var b;var d=new cd(a,this);this.Uf(d);var g=0;for(b=c.length;g<b;g++){var h=c[g];this.ub(d,this.ra[h],-1)}return d};a.prototype.hu=function(a){var b,c=[];var f=0;var g=this.ki(a);var h=0;for(b=g.length;h<b;h++)a=g[h],f=this.Xm(a,c,f,null);return"zwibblerclip."+JSON.stringify(c)};a.prototype.Xm=function(a,c,e,f){var b=a.vc(),d={},k;for(k in b){var l=b[k];l instanceof O&&(l=["Matrix",l.m11,l.m12,l.m21,l.m22,l.Ca,l.Da]);d[k]=
l}c.push({type:"CreateAction",node:a.type(),parent:f,properties:d});f=e+1;if(a.children)for(b=0,a=a.children;b<a.length;b++)f=this.Xm(a[b],c,f,e);return f};a.prototype.Eo=function(a,c){var b,d;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var g=[];var h=JSON.parse(a);var k=[];var l={},m=0,n=0;var r=0;for(d=h.length;r<d;r++){var q=h[r];if("GroupAction"===q.type){var v=this.Wa();l[m++]=v;var y=[];var z=0;for(q=q.members;z<q.length;z++)y.push(l[q[z]]);k.push(new rd(v,y));g.push(v)}else if("CreateAction"===
q.type){z=q.properties;y={};for(b in z)z.hasOwnProperty(b)&&(v=z[b],"[object Array]"===Object.prototype.toString.apply(v)&&"Matrix"===v[0]&&(v.splice(0,1),v=new O(v)),y[b]=v);v=this.Wa();l[m++]=v;z=null;var w=-1;"parent"in q&&q.parent in l?z=l[q.parent]:"PageNode"===q.node&&(z=this.root.id,w=this.Va+1+n,n+=1);k.push(new V(v,q.node,y,z,w));g.push(v)}}0!==n||c.Wk()||k.push(new Gd(g,c));return k};a.prototype.ub=function(a,c,e){var b=null,d=0;c.parent&&(b=c.parent.id,d=c.ff(),this.removeNode(c,!1));-1===
e?a.children.push(c):a.children.splice(e,0,c);c instanceof Be&&(-1===e?this.bb.push(c):this.bb.splice(e,0,c));c.parent=a;this.Pj(c,this.pe(a.id),!0,b,d);this.Ai=!0};a.prototype.cu=function(a,c){var b="function"!==typeof c?function(a){return a===c}:c;for(var d=0,g=0;g<a.length;g++)b(a[g])?d+=1:d&&(a[g-d]=a[g]);a.length-=d};a.prototype.removeNode=function(a,c){void 0===c&&(c=!0);var b=this,d=this.pe(a.id);if(!a.parent||null===d)return this.log("Error: removeNode -- should not happen!"),-1;var g=a.parent.Ck(a);
if(0<=g&&(c&&this.dc.Ec(a.id,a.parent.id,g),a.parent.children.splice(g,1),a.parent=null,c)){var h=function(a){var c;delete b.ra[a.id];b.ad.remove(a.id);b.removedNodes.add(a.id);a.ql();b.ze.remove(a.id);if(a.children){var d=a.children;var e=0;for(c=d.length;e<c;e++){var f=d[e];h(f)}}a.la("spotHighlight")&&b.cu(b.yd,a);b.Ob.remove(a.id);b.uk.remove(a.id);b.sk.remove(a.id)};h(a)}"PageNode"===a.type()?(this.bb.splice(g,1),g===this.Va&&(this.log("Removed current page."),this.Db(Math.min(g,this.bb.length-
1)),this.lg=this.Va),this.ah=-1):this.lg=d;return g};a.prototype.Vn=function(a){function b(a){if(!k||a.rect.x<c)c=a.rect.x;if(!k||a.rect.right()>f)f=a.rect.right();if(!k||a.rect.y<g)g=a.rect.y;if(!k||a.rect.bottom()>h)h=a.rect.bottom();k=!0}var c=0,f=0,g=0,h=0,k=!1;"number"===typeof a?this.$e(b,a):this.kb(!1,b);return k?new K(c,g,f-c,h-g):new K(0,0,10,10)};a.prototype.re=function(a){return this.aa.width?new K(0,0,this.aa.width,this.aa.height):this.Vn(a)};a.prototype.la=function(a){return this.aa[a]};
a.prototype.Ps=function(){return"width"in this.aa};a.prototype.setProperty=function(a,c){null===c?a in this.aa&&delete this.aa[a]:this.aa[a]=c;var b={};b[a]=c;this.dc.Ib(this.root.id,b)};a.prototype.Ee=function(a,c,e){a===this.root&&this.setProperty(c,e);a.setProperty(c,e);var b={};b[c]=e;this.dc.Ib(a.id,b);if("spotHighlight"===c&&"PathNode"===a.type()){for(c=0;c<this.yd.length;c++)if(this.yd[c]===a){this.yd.splice(c,1);break}e?(this.log("Added node %s to spotHighlightNodes",a.id),this.yd.push(a)):
this.log("Removed node %s from spotHighlightNodes",a.id)}};a.prototype.Lh=function(a,c){this.log("showLayer(%s, %s)",a,c);c?this.Mi.remove(a):this.Mi.add(a)};a.prototype.Xk=function(a){return!this.Mi.contains(a)};a.prototype.qh=function(a){this.log("Adding page to document with index %s",a);if(a>this.bb.length)return this.log("Error: Can insert page with index %s",a),-1;var b=R.create("PageNode",this.Wa(),this);this.ub(this.root,b,a);return a};a.prototype.Gc=function(){return this.bb.length};a.prototype.Db=
function(a){if(a!==this.Va){if(0<=a&&a<this.bb.length)return this.log("Set current page to %s/%s",a,this.bb.length),this.Va=a,!0;this.log("Tried to set page to non-existing %s",a);return!1}};a.prototype.Ju=function(){this.ah!==this.Va&&(this.dm(this.ah,!1),this.dm(this.Va,!0),this.ah=this.Va)};a.prototype.dm=function(a,c){var b=this;c?this.$e(function(a){"DomNode"===a.type()&&a.ol()},a):this.sk.kb(function(a){(a=b.za(parseInt(a,10),!1))&&a.ql()})};a.prototype.Nk=function(a){return 0===this.bb.length?
this.root:void 0===a?this.bb[this.Va]:this.bb[a]};a.prototype.Ok=function(){var a=816,c=1056;"width"in this.aa&&(a=this.aa.width);"height"in this.aa&&(c=this.aa.height);return new nc(a,c)};a.prototype.Ag=function(a){this.kb(!1,function(b){b.Ag(a)})};a.prototype.getRootNode=function(){return this.root};a.prototype.Bu=function(a,c){void 0===c&&(c=!0);this.dc=a;c&&(this.dc.Ib(this.root.id,this.aa),this.kb(!0,function(b){if(b.parent){var c=b.vc();c.type=b.type();a.createNode(b.id,b.parent.id,b.ff(),c)}}),
this.dc.pa())};return a}(xb);}).call(window);
